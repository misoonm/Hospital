<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø·Ø¨ÙŠØ¨ 24/7 - Ø³Ø¬Ù„Ø§ØªÙŠ Ø§Ù„Ø·Ø¨ÙŠØ©</title>
    <link rel="stylesheet" href="medical-records.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700;800&family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
    /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: Ø£Ø²Ø±Ù‚ Ø·Ø¨ÙŠ Ù‡Ø§Ø¯Ø¦ */
    --primary: #1976D2;
    --primary-dark: #1565C0;
    --primary-light: #BBDEFB;
    --secondary: #4CAF50;
    --accent: #FF5252;
    --success: #4CAF50;
    --warning: #FF9800;
    --info: #2196F3;

    /* Ø®Ù„ÙÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: ÙØ§ØªØ­Ø© ÙˆÙ…Ø±ÙŠØ­Ø© Ù„Ù„Ø¹ÙŠÙ† */
    --bg-light: #F5F9FF;
    --bg-surface: #ffffff;
    --shadow-light: -6px -6px 12px rgba(255, 255, 255, 0.9), 6px 6px 12px rgba(0, 0, 0, 0.08);
    --shadow-inset: inset 3px 3px 6px rgba(0, 0, 0, 0.1), inset -3px -3px 6px rgba(255, 255, 255, 0.9);
    --shadow-card: 0 10px 30px rgba(25, 118, 210, 0.15);
    --text-primary: #1E293B;
    --text-secondary: #475569;

    /* Ø§Ù„Ø²ÙˆØ§ÙŠØ§ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª */
    --radius-xl: 30px;
    --radius-lg: 20px;
    --radius-md: 16px;
    --radius-sm: 12px;
    --transition-liquid: all 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);

    /* Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø­Ø¯Ø«Ø© */
    --font-primary: 'IBM Plex Sans Arabic', 'Tajawal', sans-serif;
    --font-heading: 'Almarai', sans-serif;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: var(--font-primary);
    -webkit-tap-highlight-color: transparent;
}

body {
    background: var(--bg-light);
    color: var(--text-primary);
    direction: rtl;
    overflow-x: hidden;
    min-height: 100vh;
    font-size: 14px;
    line-height: 1.5;
}

/* Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
.ultra-app {
    max-width: 450px;
    min-height: 100vh;
    margin: 0 auto;
    background: var(--bg-light);
    position: relative;
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.05);
    overflow-x: hidden;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© */
.status-bar {
    background: transparent;
    color: var(--text-primary);
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    font-weight: 500;
    z-index: 1000;
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
.app-header {
    padding: 20px 16px 0;
}

.header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.title-section h1 {
    font-family: var(--font-heading);
    font-size: 22px;
    font-weight: 800;
    color: var(--primary-dark);
    margin-bottom: 4px;
}

.title-section p {
    font-size: 13px;
    color: var(--text-secondary);
}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ */
.action-icon {
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    cursor: pointer;
    transition: var(--transition-liquid);
    position: relative;
    font-size: 16px;
}

.action-icon:active {
    box-shadow: var(--shadow-inset);
    color: var(--primary-dark);
}

.icon-badge {
    position: absolute;
    top: 4px;
    right: 4px;
    background: var(--accent);
    color: white;
    border-radius: 50%;
    width: 14px;
    height: 14px;
    font-size: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
}

/* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
.tabs-container {
    margin-bottom: 16px;
    padding: 0 16px;
}

.tabs-scroll {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    scrollbar-width: none;
    padding-bottom: 6px;
}

.tabs-scroll::-webkit-scrollbar {
    display: none;
}

.tab {
    padding: 12px 16px;
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    border-radius: var(--radius-lg);
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition-liquid);
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 8px;
    border: 1px solid transparent;
    font-size: 13px;
    position: relative;
    flex: 1;
    justify-content: center;
    min-width: 100px;
}

.tab.active {
    background: var(--primary);
    color: white;
    box-shadow: var(--shadow-inset);
    transform: scale(0.95);
    border-color: var(--primary-dark);
}

.tab:hover {
    box-shadow: var(--shadow-inset);
}

.tab i {
    font-size: 14px;
}

/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
.main-content {
    padding: 0 16px 100px;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.section-header h2 {
    font-family: var(--font-heading);
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
}

/* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª */
.documents-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.document-card {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    transition: var(--transition-liquid);
    cursor: pointer;
    overflow: hidden;
    position: relative;
}

.document-card:hover {
    box-shadow: var(--shadow-inset);
    transform: translateY(-2px);
}

.document-icon {
    background: var(--primary-light);
    padding: 20px;
    text-align: center;
    color: var(--primary);
    font-size: 24px;
}

.document-info {
    padding: 12px;
}

.document-name {
    font-weight: 700;
    margin-bottom: 4px;
    font-size: 13px;
    color: var(--text-primary);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.document-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
}

.document-type {
    font-size: 11px;
    color: var(--text-secondary);
    background: var(--bg-surface);
    padding: 2px 6px;
    border-radius: var(--radius-sm);
}

.document-date {
    font-size: 10px;
    color: var(--text-secondary);
}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ§Øª */
.allergies-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.allergy-card {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    transition: var(--transition-liquid);
    padding: 16px;
    border-right: 4px solid var(--warning);
}

.allergy-card:hover {
    box-shadow: var(--shadow-inset);
}

.allergy-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
}

.allergy-name {
    font-weight: 700;
    color: var(--text-primary);
    font-size: 14px;
}

.allergy-severity {
    padding: 4px 8px;
    border-radius: var(--radius-sm);
    font-size: 10px;
    font-weight: 600;
}

.severity-low {
    background: var(--success);
    color: white;
}

.severity-medium {
    background: var(--warning);
    color: white;
}

.severity-high {
    background: var(--accent);
    color: white;
}

.allergy-substance {
    color: var(--text-secondary);
    font-size: 12px;
    margin-bottom: 8px;
}

.allergy-symptoms {
    font-size: 12px;
    color: var(--text-primary);
    line-height: 1.4;
}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© */
.medications-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.medication-card {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    transition: var(--transition-liquid);
    padding: 16px;
    border-right: 4px solid var(--info);
    position: relative;
}

.medication-card:hover {
    box-shadow: var(--shadow-inset);
}

.medication-card.active {
    border-right-color: var(--success);
}

.medication-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
}

.medication-name {
    font-weight: 700;
    color: var(--text-primary);
    font-size: 14px;
}

.medication-status {
    padding: 4px 8px;
    border-radius: var(--radius-sm);
    font-size: 10px;
    font-weight: 600;
    background: var(--info);
    color: white;
}

.medication-status.active {
    background: var(--success);
}

.medication-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    font-size: 12px;
    margin-bottom: 8px;
}

.medication-detail {
    display: flex;
    align-items: center;
    gap: 4px;
    color: var(--text-secondary);
}

.medication-times {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin-top: 8px;
}

.medication-time {
    background: var(--primary-light);
    color: var(--primary-dark);
    padding: 2px 6px;
    border-radius: var(--radius-sm);
    font-size: 10px;
    font-weight: 600;
}

/* Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø¶ÙŠ */
.timeline {
    position: relative;
    padding: 20px 0;
}

.timeline::before {
    content: '';
    position: absolute;
    right: 20px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--primary-light);
}

.timeline-item {
    position: relative;
    margin-bottom: 20px;
    padding-right: 50px;
}

.timeline-item::before {
    content: '';
    position: absolute;
    right: 17px;
    top: 8px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--primary);
    border: 2px solid white;
    box-shadow: var(--shadow-light);
}

.timeline-date {
    font-size: 11px;
    color: var(--text-secondary);
    margin-bottom: 4px;
}

.timeline-content {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    padding: 16px;
    transition: var(--transition-liquid);
}

.timeline-content:hover {
    box-shadow: var(--shadow-inset);
}

.timeline-title {
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 6px;
    font-size: 14px;
}

.timeline-type {
    display: inline-block;
    background: var(--primary-light);
    color: var(--primary-dark);
    padding: 2px 8px;
    border-radius: var(--radius-sm);
    font-size: 10px;
    font-weight: 600;
    margin-bottom: 8px;
}

.timeline-details {
    font-size: 12px;
    color: var(--text-primary);
    line-height: 1.4;
}

/* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
    transition: opacity 0.3s ease-out;
    z-index: 2000;
}

.modal-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.4);
    box-shadow: var(--shadow-card);
    animation: modalSlideUp 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    max-height: 90vh;
    overflow-y: auto;
}

@keyframes modalSlideUp {
    from {opacity: 0; transform: translateY(100%);}
    to {opacity: 1; transform: translateY(0);}
}

.modal-header {
    background: var(--primary);
    color: white;
    padding: 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    position: sticky;
    top: 0;
    z-index: 10;
}

.modal-header h2 {
    margin: 0;
    font-size: 18px;
}

.close {
    font-size: 20px;
    cursor: pointer;
}

/* Ù†Ù…Ø§Ø°Ø¬ Ø·Ø¨ÙŠØ© */
.medical-form {
    padding: 18px;
}

.form-group {
    margin-bottom: 16px;
}

.form-label {
    display: block;
    margin-bottom: 6px;
    font-weight: 600;
    color: var(--text-primary);
    font-size: 13px;
}

.required {
    color: var(--accent);
}

.form-input, .form-select, .form-textarea {
    width: 100%;
    padding: 12px 16px;
    border: none;
    background: var(--bg-surface);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-inset);
    font-size: 14px;
    color: var(--text-primary);
    outline: none;
    transition: var(--transition-liquid);
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
    box-shadow: var(--shadow-light);
}

.form-textarea {
    resize: vertical;
    min-height: 80px;
}

/* Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª */
.file-upload {
    position: relative;
    margin-bottom: 8px;
}

.file-preview {
    width: 100%;
    height: 120px;
    border: 2px dashed var(--primary-light);
    border-radius: var(--radius-lg);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition-liquid);
    background: var(--bg-surface);
    text-align: center;
    padding: 10px;
}

.file-preview:hover {
    border-color: var(--primary);
    background: var(--primary-light);
}

.file-preview.has-file {
    border-style: solid;
    background-size: cover;
    background-position: center;
}

.file-preview i {
    font-size: 32px;
    color: var(--primary);
    margin-bottom: 8px;
}

.file-preview span {
    font-size: 12px;
    color: var(--text-secondary);
    text-align: center;
}

.file-input {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
}

/* Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª */
.permissions-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
}

/* Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø´Ø¯Ø© */
.severity-levels {
    display: grid;
    grid-template-columns: 1fr;
    gap: 8px;
}

.radio-label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
}

.radio-label input {
    display: none;
}

.radiomark {
    width: 18px;
    height: 18px;
    border: 2px solid var(--primary-light);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-liquid);
    flex-shrink: 0;
}

.radio-label input:checked + .radiomark {
    border-color: var(--primary);
}

.radio-label input:checked + .radiomark::after {
    content: '';
    width: 8px;
    height: 8px;
    background: var(--primary);
    border-radius: 50%;
}

.severity-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px;
    border-radius: var(--radius-md);
    background: var(--bg-surface);
    box-shadow: var(--shadow-light);
    transition: var(--transition-liquid);
    flex: 1;
}

.radio-label input:checked ~ .severity-item {
    background: var(--primary-light);
    box-shadow: var(--shadow-inset);
}

/* Ø®Ø§Ù†Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± */
.checkbox-label {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    cursor: pointer;
    font-size: 13px;
    color: var(--text-primary);
}

.checkbox-label input {
    display: none;
}

.checkmark {
    width: 18px;
    height: 18px;
    border: 2px solid var(--primary-light);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-liquid);
    flex-shrink: 0;
    margin-top: 2px;
}

.checkbox-label input:checked + .checkmark {
    background: var(--primary);
    border-color: var(--primary);
}

.checkbox-label input:checked + .checkmark::after {
    content: 'âœ“';
    color: white;
    font-size: 12px;
    font-weight: bold;
}

/* Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø© */
.dose-inputs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

/* Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙˆÙ‚Øª */
.time-slots {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
}

.time-slot-option {
    text-align: center;
}

/* Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ® */
.date-range {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ */
.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 24px;
}

.btn-primary {
    background: var(--primary);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition-liquid);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    flex: 1;
}

.btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
}

.btn-secondary {
    background: var(--bg-light);
    color: var(--text-primary);
    border: none;
    padding: 12px 24px;
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-liquid);
    box-shadow: var(--shadow-light);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    flex: 1;
}

.btn-secondary:hover {
    box-shadow: var(--shadow-inset);
}

/* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
.bottom-nav-dock {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    display: flex;
    padding: 6px 8px;
    border-radius: var(--radius-xl);
    z-index: 1000;
    max-width: 340px;
    width: calc(100% - 32px);
    border: 1px solid rgba(255, 255, 255, 0.5);
}

.nav-item-dock {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 6px 0;
    border-radius: var(--radius-md);
    transition: var(--transition-liquid);
    flex: 1;
    position: relative;
    text-decoration: none;
    color: var(--text-secondary);
}

.nav-item-dock.active {
    color: var(--primary-dark);
}

.nav-item-dock.active .nav-icon-dock {
    background: var(--primary);
    color: white;
    box-shadow: 0 4px 15px rgba(25, 118, 210, 0.5);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    transform: translateY(-8px);
    transition: var(--transition-liquid);
}

.nav-icon-dock {
    font-size: 16px;
    margin-bottom: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    transition: var(--transition-liquid);
}

.nav-label {
    font-size: 9px;
    font-weight: 600;
    margin-top: 2px;
    transition: var(--transition-liquid);
}

.nav-item-dock.active .nav-label {
    font-weight: 800;
    color: var(--primary-dark);
}

/* Ø­Ø§Ù„Ø§Øª ÙØ§Ø±ØºØ© */
.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
}

.empty-state i {
    font-size: 48px;
    margin-bottom: 16px;
    color: var(--primary-light);
}

.empty-state h3 {
    margin-bottom: 8px;
    color: var(--text-primary);
}

.empty-state p {
    font-size: 14px;
    line-height: 1.5;
}

/* Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 428px) {
    .documents-grid {
        grid-template-columns: 1fr;
    }
    
    .tabs-scroll {
        gap: 6px;
    }
    
    .tab {
        padding: 10px 12px;
        font-size: 12px;
        min-width: 80px;
    }
    
    .dose-inputs {
        grid-template-columns: 1fr;
    }
    
    .date-range {
        grid-template-columns: 1fr;
    }
    
    .time-slots {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .medication-details {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .section-header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
    }
    
    .section-header .btn-primary {
        width: 100%;
    }
}
</style>
</head>
<body>
    <div class="ultra-app">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© -->
        <div class="status-bar">
            <div class="status-left">
                <span id="currentTime">10:03 Ù…</span>
            </div>
            <div class="status-right">
                <i class="fas fa-signal"></i>
                <i class="fas fa-wifi"></i>
                <i class="fas fa-battery-full"></i>
            </div>
        </div>

        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="app-header">
            <div class="header-top">
                <div class="title-section">
                    <h1>Ø³Ø¬Ù„Ø§ØªÙŠ Ø§Ù„Ø·Ø¨ÙŠØ© ğŸ¥</h1>
                    <p id="patientWelcome">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© ÙˆØ§Ù„Ø£Ø¯ÙˆÙŠØ©</p>
                </div>
                <div class="customer-actions">
                    <button class="action-icon" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        <span class="icon-badge" id="notificationBadge">0</span>
                    </button>
                    <button class="action-icon" id="emergencyBtn">
                        <i class="fas fa-plus-circle"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© -->
        <div class="main-content">
            <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
            <div class="tabs-container">
                <div class="tabs-scroll" id="mainTabs">
                    <div class="tab active" data-tab="records">
                        <i class="fas fa-file-medical"></i>
                        <span>Ø³Ø¬Ù„Ø§ØªÙŠ Ø§Ù„Ø·Ø¨ÙŠØ©</span>
                    </div>
                    <div class="tab" data-tab="allergies">
                        <i class="fas fa-allergies"></i>
                        <span>Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ§Øª</span>
                    </div>
                    <div class="tab" data-tab="medications">
                        <i class="fas fa-pills"></i>
                        <span>Ø£Ø¯ÙˆÙŠØªÙŠ</span>
                    </div>
                    <div class="tab" data-tab="history">
                        <i class="fas fa-history"></i>
                        <span>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø¶ÙŠ</span>
                    </div>
                </div>
            </div>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© -->
            <div class="tab-content active" id="recordsContent">
                <div class="section-header">
                    <h2>Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</h2>
                    <button class="btn-primary" onclick="medicalRecords.showAddDocumentModal()">
                        <i class="fas fa-plus"></i>
                        Ø±ÙØ¹ Ù…Ø³ØªÙ†Ø¯ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
                <div class="documents-grid" id="documentsGrid">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù‡Ù†Ø§ -->
                </div>
            </div>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ§Øª -->
            <div class="tab-content" id="allergiesContent">
                <div class="section-header">
                    <h2>Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ§Øª</h2>
                    <button class="btn-primary" onclick="medicalRecords.showAddAllergyModal()">
                        <i class="fas fa-plus"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø³ÙŠØ©
                    </button>
                </div>
                <div class="allergies-list" id="allergiesList">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ§Øª Ù‡Ù†Ø§ -->
                </div>
            </div>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© -->
            <div class="tab-content" id="medicationsContent">
                <div class="section-header">
                    <h2>Ø£Ø¯ÙˆÙŠØªÙŠ</h2>
                    <button class="btn-primary" onclick="medicalRecords.showAddMedicationModal()">
                        <i class="fas fa-plus"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡
                    </button>
                </div>
                <div class="medications-list" id="medicationsList">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ù‡Ù†Ø§ -->
                </div>
            </div>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø¶ÙŠ -->
            <div class="tab-content" id="historyContent">
                <div class="section-header">
                    <h2>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø¶ÙŠ</h2>
                    <button class="btn-primary" onclick="medicalRecords.showAddMedicalHistoryModal()">
                        <i class="fas fa-plus"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù…Ø±Ø¶ÙŠ
                    </button>
                </div>
                <div class="timeline" id="medicalHistoryTimeline">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ -->
        <div class="bottom-nav-dock">
            <a href="index.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-home"></i>
                </div>
                <div class="nav-label">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
            </a>
            <a href="doctor-appointment.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-user-md"></i>
                </div>
                <div class="nav-label">Ø­Ø¬Ø² Ø¯ÙƒØªÙˆØ±</div>
            </a>
            <a href="consultation.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-comment-medical"></i>
                </div>
                <div class="nav-label">Ø§Ø³ØªØ´Ø§Ø±Ø© Ø·Ø¨ÙŠØ©</div>
            </a>
            <a href="medical-records.html" class="nav-item-dock active">
                <div class="nav-icon-dock">
                    <i class="fas fa-file-medical"></i>
                </div>
                <div class="nav-label">Ø³Ø¬Ù„Ø§ØªÙŠ</div>
            </a>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ†Ø¯ Ø·Ø¨ÙŠ -->
    <div id="addDocumentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø±ÙØ¹ Ù…Ø³ØªÙ†Ø¯ Ø·Ø¨ÙŠ Ø¬Ø¯ÙŠØ¯</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addDocumentForm" class="medical-form">
                    <div class="form-group">
                        <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ <span class="required">*</span></label>
                        <select class="form-select" id="documentType" required>
                            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯</option>
                            <option value="ØªØ­Ù„ÙŠÙ„">ØªØ­Ù„ÙŠÙ„ Ø·Ø¨ÙŠ</option>
                            <option value="Ø£Ø´Ø¹Ø©">ØµÙˆØ±Ø© Ø£Ø´Ø¹Ø©</option>
                            <option value="ØªÙ‚Ø±ÙŠØ±">ØªÙ‚Ø±ÙŠØ± Ø·Ø¨ÙŠ</option>
                            <option value="Ø±ÙˆØ´ØªØ©">Ø±ÙˆØ´ØªØ© Ø¹Ù„Ø§Ø¬</option>
                            <option value="Ø®Ù„Ø§ØµØ©">Ø®Ù„Ø§ØµØ© Ø­Ø§Ù„Ø©</option>
                            <option value="ØªØ®Ø·ÙŠØ·">ØªØ®Ø·ÙŠØ· Ù‚Ù„Ø¨</option>
                            <option value="Ø¢Ø®Ø±">Ù…Ø³ØªÙ†Ø¯ Ø¢Ø®Ø±</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯ <span class="required">*</span></label>
                        <input type="text" class="form-input" id="documentName" required 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø³ØªÙ†Ø¯ <span class="required">*</span></label>
                        <input type="date" class="form-input" id="documentDate" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù <span class="required">*</span></label>
                        <div class="file-upload">
                            <div class="file-preview" id="documentFilePreview">
                                <i class="fas fa-file-upload"></i>
                                <span>Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù (PDF, JPG, PNG)</span>
                            </div>
                            <input type="file" id="documentFileInput" accept=".pdf,.jpg,.jpeg,.png" class="file-input" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª <span class="required">*</span></label>
                        <div class="permissions-grid">
                            <label class="checkbox-label">
                                <input type="checkbox" id="permissionMe" checked disabled>
                                <span class="checkmark"></span>
                                Ø®Ø§Øµ Ø¨ÙŠ ÙÙ‚Ø·
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="permissionDoctors">
                                <span class="checkmark"></span>
                                Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ÙŠÙ†
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="permissionEmergency">
                                <span class="checkmark"></span>
                                Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙÙ‚Ø·
                            </label>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="medicalRecords.closeAddDocumentModal()">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i>
                            Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªÙ†Ø¯
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø³ÙŠØ© -->
    <div id="addAllergyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø³ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addAllergyForm" class="medical-form">
                    <div class="form-group">
                        <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© <span class="required">*</span></label>
                        <select class="form-select" id="allergyType" required>
                            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ©</option>
                            <option value="Ø¯ÙˆØ§Ø¡">Ø¯ÙˆØ§Ø¡</option>
                            <option value="Ø·Ø¹Ø§Ù…">Ø·Ø¹Ø§Ù…</option>
                            <option value="Ø¨ÙŠØ¦Ø©">Ø¨ÙŠØ¦Ø©</option>
                            <option value="Ø­Ø´Ø±Ø§Øª">Ø­Ø´Ø±Ø§Øª</option>
                            <option value="Ø¢Ø®Ø±">Ù†ÙˆØ¹ Ø¢Ø®Ø±</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ù…Ø³Ø¨Ø¨Ø© <span class="required">*</span></label>
                        <input type="text" class="form-input" id="allergySubstance" required 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ù…Ø³Ø¨Ø¨Ø© Ù„Ù„Ø­Ø³Ø§Ø³ÙŠØ©">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø´Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© <span class="required">*</span></label>
                        <div class="severity-levels">
                            <label class="radio-label">
                                <input type="radio" name="severity" value="Ø®ÙÙŠÙØ©" required>
                                <span class="radiomark"></span>
                                <span class="severity-item severity-low">
                                    <i class="fas fa-smile"></i>
                                    Ø®ÙÙŠÙØ©
                                </span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="severity" value="Ù…ØªÙˆØ³Ø·Ø©">
                                <span class="radiomark"></span>
                                <span class="severity-item severity-medium">
                                    <i class="fas fa-meh"></i>
                                    Ù…ØªÙˆØ³Ø·Ø©
                                </span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="severity" value="Ø´Ø¯ÙŠØ¯Ø©">
                                <span class="radiomark"></span>
                                <span class="severity-item severity-high">
                                    <i class="fas fa-frown"></i>
                                    Ø´Ø¯ÙŠØ¯Ø©
                                </span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙƒØªØ´Ø§Ù</label>
                        <input type="date" class="form-input" id="allergyDiscoveryDate">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ <span class="required">*</span></label>
                        <textarea class="form-textarea" id="allergySymptoms" required 
                                  placeholder="ØµÙ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø±Ø¶ Ù„Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ù…Ø³Ø¨Ø¨Ø©..."
                                  rows="4"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="medicalRecords.closeAddAllergyModal()">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-plus"></i>
                            Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ©
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ -->
    <div id="addMedicationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addMedicationForm" class="medical-form">
                    <div class="form-group">
                        <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡ <span class="required">*</span></label>
                        <input type="text" class="form-input" id="medicationName" required 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¬Ø±Ø¹Ø© <span class="required">*</span></label>
                        <div class="dose-inputs">
                            <input type="text" class="form-input" id="medicationDose" required 
                                   placeholder="Ø§Ù„Ø¬Ø±Ø¹Ø© (Ù…Ø«Ø§Ù„: 500mg)">
                            <select class="form-select" id="medicationFrequency" required>
                                <option value="">Ø§Ù„ØªØ±Ø¯Ø¯</option>
                                <option value="Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹">Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                                <option value="Ù…Ø±ØªÙŠÙ† ÙŠÙˆÙ…ÙŠØ§Ù‹">Ù…Ø±ØªÙŠÙ† ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                                <option value="Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹">Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                                <option value="Ø£Ø±Ø¨Ø¹ Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹">Ø£Ø±Ø¨Ø¹ Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                                <option value="ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª">ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª</option>
                                <option value="ÙƒÙ„ 8 Ø³Ø§Ø¹Ø§Øª">ÙƒÙ„ 8 Ø³Ø§Ø¹Ø§Øª</option>
                                <option value="ÙƒÙ„ 12 Ø³Ø§Ø¹Ø©">ÙƒÙ„ 12 Ø³Ø§Ø¹Ø©</option>
                                <option value="Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©">Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</label>
                        <div class="time-slots" id="medicationTimes">
                            <div class="time-slot-option">
                                <label class="checkbox-label">
                                    <input type="checkbox" value="08:00">
                                    <span class="checkmark"></span>
                                    8:00 Øµ
                                </label>
                            </div>
                            <div class="time-slot-option">
                                <label class="checkbox-label">
                                    <input type="checkbox" value="12:00">
                                    <span class="checkmark"></span>
                                    12:00 Ù…
                                </label>
                            </div>
                            <div class="time-slot-option">
                                <label class="checkbox-label">
                                    <input type="checkbox" value="16:00">
                                    <span class="checkmark"></span>
                                    4:00 Ù…
                                </label>
                            </div>
                            <div class="time-slot-option">
                                <label class="checkbox-label">
                                    <input type="checkbox" value="20:00">
                                    <span class="checkmark"></span>
                                    8:00 Ù…
                                </label>
                            </div>
                            <div class="time-slot-option">
                                <label class="checkbox-label">
                                    <input type="checkbox" value="22:00">
                                    <span class="checkmark"></span>
                                    10:00 Ù…
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ÙØªØ±Ø© Ø§Ù„Ø¹Ù„Ø§Ø¬</label>
                        <div class="date-range">
                            <div>
                                <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label>
                                <input type="date" class="form-input" id="medicationStartDate">
                            </div>
                            <div>
                                <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                                <input type="date" class="form-input" id="medicationEndDate">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„ØºØ±Ø¶ Ù…Ù† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… <span class="required">*</span></label>
                        <input type="text" class="form-input" id="medicationPurpose" required 
                               placeholder="Ø§Ù„ØºØ±Ø¶ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <textarea class="form-textarea" id="medicationNotes" 
                                  placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ø¯ÙˆØ§Ø¡..."
                                  rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableReminders">
                            <span class="checkmark"></span>
                            ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="medicalRecords.closeAddMedicationModal()">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i>
                            Ø­ÙØ¸ Ø§Ù„Ø¯ÙˆØ§Ø¡
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù…Ø±Ø¶ÙŠ -->
    <div id="addMedicalHistoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù…Ø±Ø¶ÙŠ</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addMedicalHistoryForm" class="medical-form">
                    <div class="form-group">
                        <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù…Ø±Ø¶ÙŠ <span class="required">*</span></label>
                        <select class="form-select" id="eventType" required>
                            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¯Ø«</option>
                            <option value="Ù…Ø±Ø¶">Ù…Ø±Ø¶</option>
                            <option value="Ø¹Ù…Ù„ÙŠØ©">Ø¹Ù…Ù„ÙŠØ© Ø¬Ø±Ø§Ø­ÙŠØ©</option>
                            <option value="Ø¥ØµØ§Ø¨Ø©">Ø¥ØµØ§Ø¨Ø©</option>
                            <option value="ÙƒØ³Ø±">ÙƒØ³Ø±</option>
                            <option value="Ø­Ù…Ù„">Ø­Ù…Ù„ ÙˆÙˆÙ„Ø§Ø¯Ø©</option>
                            <option value="ØªØ·Ø¹ÙŠÙ…">ØªØ·Ø¹ÙŠÙ…</option>
                            <option value="Ø¢Ø®Ø±">Ø­Ø¯Ø« Ø¢Ø®Ø±</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø­Ø¯Ø« <span class="required">*</span></label>
                        <input type="text" class="form-input" id="eventName" required 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù…Ø±Ø¶ÙŠ">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¯Ø« <span class="required">*</span></label>
                        <input type="date" class="form-input" id="eventDate" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„ØªÙØ§ØµÙŠÙ„ <span class="required">*</span></label>
                        <textarea class="form-textarea" id="eventDetails" required 
                                  placeholder="ØµÙ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù…Ø±Ø¶ÙŠ ÙˆØ§Ù„Ø£Ø¹Ø±Ø§Ø¶ ÙˆØ§Ù„Ø¹Ù„Ø§Ø¬..."
                                  rows="5"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø±Ø¨Ø· Ø¨Ù…Ø³ØªÙ†Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <select class="form-select" id="linkedDocument">
                            <option value="">Ø§Ø®ØªØ± Ù…Ø³ØªÙ†Ø¯ Ù…Ø±ØªØ¨Ø·</option>
                            <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù‡Ù†Ø§ -->
                        </select>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="medicalRecords.closeAddMedicalHistoryModal()">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-plus"></i>
                            Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø¯Ø«
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ -->
    <div id="viewDocumentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="viewDocumentTitle">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªÙ†Ø¯</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="viewDocumentBody">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ù‡Ù†Ø§ -->
            </div>
        </div>
    </div>

    <script>
// Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© ÙˆØ§Ù„Ø£Ø¯ÙˆÙŠØ©
class MedicalRecords {
    constructor() {
        this.patientData = null;
        this.medicalData = {
            documents: [],
            allergies: [],
            medications: [],
            medicalHistory: []
        };
        this.currentTab = 'records';
        this.init();
    }

    init() {
        this.loadPatientData();
        this.loadMedicalData();
        this.setupEventListeners();
        this.renderAllContent();
        this.updateTime();
        this.setupNotifications();
    }

    loadPatientData() {
        const savedPatientData = localStorage.getItem('patient_profile_data');
        if (savedPatientData) {
            this.patientData = JSON.parse(savedPatientData);
            this.updatePatientWelcome();
        } else {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø­Ø³Ø§Ø¨ØŒ ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
            setTimeout(() => {
                if (confirm('ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠØŸ')) {
                    window.location.href = 'patient-profile.html';
                }
            }, 1000);
        }
    }

    updatePatientWelcome() {
        if (this.patientData) {
            const welcomeElement = document.getElementById('patientWelcome');
            if (welcomeElement) {
                welcomeElement.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${this.patientData.fullName} - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©`;
            }
        }
    }

    loadMedicalData() {
        const savedMedicalData = localStorage.getItem('medical_records_data');
        if (savedMedicalData) {
            this.medicalData = JSON.parse(savedMedicalData);
        } else {
            // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø¹Ø±Ø¶
            this.medicalData = this.getSampleMedicalData();
            this.saveMedicalData();
        }
    }

    getSampleMedicalData() {
        return {
            documents: [
                {
                    id: 'DOC001',
                    type: 'ØªØ­Ù„ÙŠÙ„',
                    name: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¯Ù… Ø§Ù„Ø´Ø§Ù…Ù„',
                    date: '2024-01-10',
                    file: '',
                    permissions: ['me', 'doctors'],
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'DOC002',
                    type: 'Ø£Ø´Ø¹Ø©',
                    name: 'Ø£Ø´Ø¹Ø© Ø§Ù„ØµØ¯Ø±',
                    date: '2024-01-05',
                    file: '',
                    permissions: ['me', 'doctors', 'emergency'],
                    createdAt: new Date().toISOString()
                }
            ],
            allergies: [
                {
                    id: 'ALL001',
                    type: 'Ø¯ÙˆØ§Ø¡',
                    substance: 'Ø¨Ù†Ø³Ù„ÙŠÙ†',
                    severity: 'Ø´Ø¯ÙŠØ¯Ø©',
                    discoveryDate: '2018-03-15',
                    symptoms: 'Ø·ÙØ­ Ø¬Ù„Ø¯ÙŠØŒ ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªÙ†ÙØ³ØŒ ØªÙˆØ±Ù… ÙÙŠ Ø§Ù„ÙˆØ¬Ù‡',
                    createdAt: new Date().toISOString()
                }
            ],
            medications: [
                {
                    id: 'MED001',
                    name: 'Ø¨Ø§Ø±Ø§Ø³ÙŠØªØ§Ù…ÙˆÙ„',
                    dose: '500mg',
                    frequency: 'ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª',
                    times: ['08:00', '14:00', '20:00', '02:00'],
                    startDate: '2024-01-01',
                    endDate: '2024-01-07',
                    purpose: 'ØªØ®ÙÙŠÙ Ø§Ù„Ø¢Ù„Ø§Ù…',
                    notes: 'ÙŠØ¤Ø®Ø° Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ø¹Ø§Ù…',
                    reminders: true,
                    status: 'active',
                    createdAt: new Date().toISOString()
                }
            ],
            medicalHistory: [
                {
                    id: 'HIS001',
                    type: 'Ù…Ø±Ø¶',
                    name: 'Ø§Ù„Ø¥Ù†ÙÙ„ÙˆÙ†Ø²Ø§',
                    date: '2023-12-20',
                    details: 'Ø¥ØµØ§Ø¨Ø© Ø¨Ø§Ù„Ø¥Ù†ÙÙ„ÙˆÙ†Ø²Ø§ Ù…Ø¹ Ø§Ø±ØªÙØ§Ø¹ ÙÙŠ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© ÙˆØ³Ø¹Ø§Ù„',
                    linkedDocument: 'DOC001',
                    createdAt: new Date().toISOString()
                }
            ]
        };
    }

    saveMedicalData() {
        localStorage.setItem('medical_records_data', JSON.stringify(this.medicalData));
    }

    setupEventListeners() {
        // Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', (e) => {
                this.switchTab(e.currentTarget.dataset.tab);
            });
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ°
        document.querySelectorAll('.close').forEach(closeBtn => {
            closeBtn.addEventListener('click', function() {
                this.closest('.modal').style.display = 'none';
            });
        });

        // Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†ÙˆØ§ÙØ°
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        document.getElementById('addDocumentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.addDocument();
        });

        document.getElementById('addAllergyForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.addAllergy();
        });

        document.getElementById('addMedicationForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.addMedication();
        });

        document.getElementById('addMedicalHistoryForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.addMedicalHistory();
        });

        // Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
        this.setupFileUploads();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
        setInterval(() => this.updateTime(), 60000);
    }

    updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('ar-EG', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true 
        });
        document.getElementById('currentTime').textContent = timeString;
    }

    switchTab(tab) {
        this.currentTab = tab;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
        document.getElementById(`${tab}Content`).classList.add('active');
        
        this.renderTabContent(tab);
    }

    renderAllContent() {
        this.renderTabContent(this.currentTab);
    }

    renderTabContent(tab) {
        switch (tab) {
            case 'records':
                this.renderDocuments();
                break;
            case 'allergies':
                this.renderAllergies();
                break;
            case 'medications':
                this.renderMedications();
                break;
            case 'history':
                this.renderMedicalHistory();
                break;
        }
    }

    setupFileUploads() {
        // Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªÙ†Ø¯
        const documentInput = document.getElementById('documentFileInput');
        const documentPreview = document.getElementById('documentFilePreview');
        
        documentInput.addEventListener('change', (e) => {
            this.previewFile(e.target, documentPreview);
        });
    }

    previewFile(input, previewElement) {
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                previewElement.style.backgroundImage = `url(${e.target.result})`;
                previewElement.classList.add('has-file');
                previewElement.innerHTML = `
                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px; border-radius: 5px;">
                        <i class="fas fa-check"></i>
                        <div>${file.name}</div>
                        <small>${this.formatFileSize(file.size)}</small>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }
    }

    formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª ===
    showAddDocumentModal() {
        const modal = document.getElementById('addDocumentModal');
        modal.style.display = 'block';
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('addDocumentForm').reset();
        document.getElementById('documentFilePreview').classList.remove('has-file');
        document.getElementById('documentFilePreview').innerHTML = `
            <i class="fas fa-file-upload"></i>
            <span>Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù (PDF, JPG, PNG)</span>
        `;
    }

    closeAddDocumentModal() {
        document.getElementById('addDocumentModal').style.display = 'none';
    }

    addDocument() {
        const formData = {
            id: 'DOC' + Date.now(),
            type: document.getElementById('documentType').value,
            name: document.getElementById('documentName').value,
            date: document.getElementById('documentDate').value,
            file: this.getFileData('documentFilePreview'),
            permissions: this.getSelectedPermissions(),
            createdAt: new Date().toISOString()
        };

        this.medicalData.documents.unshift(formData);
        this.saveMedicalData();
        this.renderDocuments();
        this.closeAddDocumentModal();
        
        alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø¨Ù†Ø¬Ø§Ø­!');
    }

    getSelectedPermissions() {
        const permissions = ['me']; // Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø®Ø§Øµ Ø¨ÙŠ
        
        if (document.getElementById('permissionDoctors').checked) {
            permissions.push('doctors');
        }
        
        if (document.getElementById('permissionEmergency').checked) {
            permissions.push('emergency');
        }
        
        return permissions;
    }

    getFileData(previewElementId) {
        const preview = document.getElementById(previewElementId);
        const backgroundImage = preview.style.backgroundImage;
        
        if (backgroundImage && backgroundImage !== 'none') {
            return backgroundImage.slice(5, -2);
        }
        
        return '';
    }

    renderDocuments() {
        const container = document.getElementById('documentsGrid');
        
        if (this.medicalData.documents.length === 0) {
            container.innerHTML = this.getEmptyStateHTML('Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª', 'fas fa-file-medical');
            return;
        }

        let documentsHTML = '';
        
        this.medicalData.documents.forEach(doc => {
            const icon = this.getDocumentIcon(doc.type);
            const date = this.formatDate(doc.date);
            
            documentsHTML += `
                <div class="document-card" onclick="medicalRecords.viewDocument('${doc.id}')">
                    <div class="document-icon">
                        <i class="${icon}"></i>
                    </div>
                    <div class="document-info">
                        <div class="document-name">${doc.name}</div>
                        <div class="document-meta">
                            <span class="document-type">${doc.type}</span>
                            <span class="document-date">${date}</span>
                        </div>
                    </div>
                </div>
            `;
        });

        container.innerHTML = documentsHTML;
    }

    getDocumentIcon(type) {
        const icons = {
            'ØªØ­Ù„ÙŠÙ„': 'fas fa-vial',
            'Ø£Ø´Ø¹Ø©': 'fas fa-x-ray',
            'ØªÙ‚Ø±ÙŠØ±': 'fas fa-file-medical-alt',
            'Ø±ÙˆØ´ØªØ©': 'fas fa-prescription',
            'Ø®Ù„Ø§ØµØ©': 'fas fa-file-contract',
            'ØªØ®Ø·ÙŠØ·': 'fas fa-heartbeat',
            'Ø¢Ø®Ø±': 'fas fa-file-medical'
        };
        return icons[type] || 'fas fa-file-medical';
    }

    viewDocument(documentId) {
        const document = this.medicalData.documents.find(doc => doc.id === documentId);
        if (!document) return;

        const modal = document.getElementById('viewDocumentModal');
        const title = document.getElementById('viewDocumentTitle');
        const body = document.getElementById('viewDocumentBody');

        title.textContent = document.name;
        
        body.innerHTML = `
            <div style="padding: 20px; text-align: center;">
                <div style="font-size: 48px; color: var(--primary); margin-bottom: 20px;">
                    <i class="${this.getDocumentIcon(document.type)}"></i>
                </div>
                <h3 style="margin-bottom: 10px; color: var(--text-primary);">${document.name}</h3>
                <div style="color: var(--text-secondary); margin-bottom: 20px;">
                    <div>Ø§Ù„Ù†ÙˆØ¹: ${document.type}</div>
                    <div>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${this.formatDate(document.date)}</div>
                    <div>Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª: ${this.getPermissionsText(document.permissions)}</div>
                </div>
                
                ${document.file ? `
                <div style="margin: 20px 0;">
                    <img src="${document.file}" alt="${document.name}" style="max-width: 100%; max-height: 400px; border-radius: 10px; box-shadow: var(--shadow-light);">
                </div>
                ` : `
                <div style="background: var(--bg-light); padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <i class="fas fa-file" style="font-size: 32px; color: var(--text-secondary); margin-bottom: 10px;"></i>
                    <div style="color: var(--text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ù„Ù</div>
                </div>
                `}
                
                <div class="form-actions">
                    <button class="btn-primary" onclick="medicalRecords.downloadDocument('${document.id}')">
                        <i class="fas fa-download"></i>
                        ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯
                    </button>
                </div>
            </div>
        `;

        modal.style.display = 'block';
    }

    getPermissionsText(permissions) {
        const texts = {
            'me': 'Ø®Ø§Øµ Ø¨ÙŠ ÙÙ‚Ø·',
            'doctors': 'Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ÙŠÙ†',
            'emergency': 'Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙÙ‚Ø·'
        };
        
        return permissions.map(p => texts[p]).join('ØŒ ');
    }

    downloadDocument(documentId) {
        const document = this.medicalData.documents.find(doc => doc.id === documentId);
        if (document && document.file) {
            const link = document.createElement('a');
            link.href = document.file;
            link.download = `${document.name}.${this.getFileExtension(document.file)}`;
            link.click();
        } else {
            alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙ†Ø¯');
        }
    }

    getFileExtension(fileData) {
        if (fileData.startsWith('data:image/jpeg')) return 'jpg';
        if (fileData.startsWith('data:image/png')) return 'png';
        if (fileData.startsWith('data:application/pdf')) return 'pdf';
        return 'file';
    }

    // === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ§Øª ===
    showAddAllergyModal() {
        const modal = document.getElementById('addAllergyModal');
        modal.style.display = 'block';
        document.getElementById('addAllergyForm').reset();
    }

    closeAddAllergyModal() {
        document.getElementById('addAllergyModal').style.display = 'none';
    }

    addAllergy() {
        const formData = {
            id: 'ALL' + Date.now(),
            type: document.getElementById('allergyType').value,
            substance: document.getElementById('allergySubstance').value,
            severity: document.querySelector('input[name="severity"]:checked').value,
            discoveryDate: document.getElementById('allergyDiscoveryDate').value || new Date().toISOString().split('T')[0],
            symptoms: document.getElementById('allergySymptoms').value,
            createdAt: new Date().toISOString()
        };

        this.medicalData.allergies.unshift(formData);
        this.saveMedicalData();
        this.renderAllergies();
        this.closeAddAllergyModal();
        
        alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
    }

    renderAllergies() {
        const container = document.getElementById('allergiesList');
        
        if (this.medicalData.allergies.length === 0) {
            container.innerHTML = this.getEmptyStateHTML('Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ§Øª', 'fas fa-allergies');
            return;
        }

        let allergiesHTML = '';
        
        this.medicalData.allergies.forEach(allergy => {
            allergiesHTML += `
                <div class="allergy-card">
                    <div class="allergy-header">
                        <div class="allergy-name">${allergy.substance}</div>
                        <div class="allergy-severity severity-${allergy.severity === 'Ø´Ø¯ÙŠØ¯Ø©' ? 'high' : allergy.severity === 'Ù…ØªÙˆØ³Ø·Ø©' ? 'medium' : 'low'}">
                            ${allergy.severity}
                        </div>
                    </div>
                    <div class="allergy-substance">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ©: ${allergy.type}</div>
                    <div class="allergy-symptoms">${allergy.symptoms}</div>
                    ${allergy.discoveryDate ? `
                    <div style="font-size: 11px; color: var(--text-secondary); margin-top: 8px;">
                        ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙƒØªØ´Ø§Ù: ${this.formatDate(allergy.discoveryDate)}
                    </div>
                    ` : ''}
                </div>
            `;
        });

        container.innerHTML = allergiesHTML;
    }

    // === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© ===
    showAddMedicationModal() {
        const modal = document.getElementById('addMedicationModal');
        modal.style.display = 'block';
        document.getElementById('addMedicationForm').reset();
        
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('medicationStartDate').value = today;
    }

    closeAddMedicationModal() {
        document.getElementById('addMedicationModal').style.display = 'none';
    }

    addMedication() {
        const selectedTimes = Array.from(document.querySelectorAll('#medicationTimes input:checked'))
            .map(input => input.value);
        
        const formData = {
            id: 'MED' + Date.now(),
            name: document.getElementById('medicationName').value,
            dose: document.getElementById('medicationDose').value,
            frequency: document.getElementById('medicationFrequency').value,
            times: selectedTimes,
            startDate: document.getElementById('medicationStartDate').value,
            endDate: document.getElementById('medicationEndDate').value,
            purpose: document.getElementById('medicationPurpose').value,
            notes: document.getElementById('medicationNotes').value,
            reminders: document.getElementById('enableReminders').checked,
            status: 'active',
            createdAt: new Date().toISOString()
        };

        this.medicalData.medications.unshift(formData);
        this.saveMedicalData();
        
        // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø¥Ø°Ø§ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        if (formData.reminders) {
            this.setupMedicationReminders(formData);
        }
        
        this.renderMedications();
        this.closeAddMedicationModal();
        
        alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!' + (formData.reminders ? ' ØªÙ… ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª.' : ''));
    }

    setupMedicationReminders(medication) {
        // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙØ¹Ù„ÙŠØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Service Workers Ùˆ Push Notifications
        console.log('ØªÙØ¹ÙŠÙ„ ØªØ°ÙƒÙŠØ±Ø§Øª Ù„Ù„Ø¯ÙˆØ§Ø¡:', medication);
        
        medication.times.forEach(time => {
            this.scheduleNotification(medication, time);
        });
    }

    scheduleNotification(medication, time) {
        // Ù‡Ø°Ø§ ÙƒÙˆØ¯ ØªØ¬Ø±ÙŠØ¨ÙŠØŒ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙØ¹Ù„ÙŠ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Notification API
        const now = new Date();
        const [hours, minutes] = time.split(':').map(Number);
        const notificationTime = new Date();
        notificationTime.setHours(hours, minutes, 0, 0);
        
        if (notificationTime < now) {
            notificationTime.setDate(notificationTime.getDate() + 1);
        }
        
        const delay = notificationTime - now;
        
        setTimeout(() => {
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification(`â° ØªØ°ÙƒÙŠØ± Ø¨Ø£Ø®Ø° Ø§Ù„Ø¯ÙˆØ§Ø¡`, {
                    body: `Ø­Ø§Ù† ÙˆÙ‚Øª Ø£Ø®Ø° ${medication.name} - Ø§Ù„Ø¬Ø±Ø¹Ø©: ${medication.dose}`,
                    icon: '/icon.png',
                    tag: `medication-${medication.id}`
                });
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            this.updateNotificationBadge();
            
        }, delay);
    }

    updateNotificationBadge() {
        const badge = document.getElementById('notificationBadge');
        let count = parseInt(badge.textContent) || 0;
        count++;
        badge.textContent = count;
        badge.style.display = count > 0 ? 'flex' : 'none';
    }

    renderMedications() {
        const container = document.getElementById('medicationsList');
        
        if (this.medicalData.medications.length === 0) {
            container.innerHTML = this.getEmptyStateHTML('Ø§Ù„Ø£Ø¯ÙˆÙŠØ©', 'fas fa-pills');
            return;
        }

        let medicationsHTML = '';
        
        this.medicalData.medications.forEach(med => {
            const isActive = med.status === 'active';
            const endDate = med.endDate ? new Date(med.endDate) : null;
            const isExpired = endDate && endDate < new Date();
            
            medicationsHTML += `
                <div class="medication-card ${isActive && !isExpired ? 'active' : ''}">
                    <div class="medication-header">
                        <div class="medication-name">${med.name}</div>
                        <div class="medication-status ${isActive && !isExpired ? 'active' : ''}">
                            ${isExpired ? 'Ù…Ù†ØªÙ‡ÙŠ' : isActive ? 'Ù†Ø´Ø·' : 'Ù…ØªÙˆÙ‚Ù'}
                        </div>
                    </div>
                    
                    <div class="medication-details">
                        <div class="medication-detail">
                            <i class="fas fa-syringe"></i>
                            ${med.dose}
                        </div>
                        <div class="medication-detail">
                            <i class="fas fa-clock"></i>
                            ${med.frequency}
                        </div>
                        <div class="medication-detail">
                            <i class="fas fa-calendar"></i>
                            ${this.formatDate(med.startDate)}
                        </div>
                        <div class="medication-detail">
                            <i class="fas fa-bullseye"></i>
                            ${med.purpose}
                        </div>
                    </div>
                    
                    ${med.times.length > 0 ? `
                    <div class="medication-times">
                        ${med.times.map(time => `
                            <span class="medication-time">${time}</span>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    ${med.notes ? `
                    <div style="font-size: 11px; color: var(--text-secondary); margin-top: 8px;">
                        Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${med.notes}
                    </div>
                    ` : ''}
                    
                    ${med.reminders ? `
                    <div style="font-size: 10px; color: var(--success); margin-top: 6px;">
                        <i class="fas fa-bell"></i> Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ù…ÙØ¹Ù„Ø©
                    </div>
                    ` : ''}
                </div>
            `;
        });

        container.innerHTML = medicationsHTML;
    }

    // === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø¶ÙŠ ===
    showAddMedicalHistoryModal() {
        const modal = document.getElementById('addMedicalHistoryModal');
        modal.style.display = 'block';
        document.getElementById('addMedicalHistoryForm').reset();
        
        // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª
        this.populateDocumentsDropdown();
    }

    closeAddMedicalHistoryModal() {
        document.getElementById('addMedicalHistoryModal').style.display = 'none';
    }

    populateDocumentsDropdown() {
        const dropdown = document.getElementById('linkedDocument');
        dropdown.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù…Ø³ØªÙ†Ø¯ Ù…Ø±ØªØ¨Ø·</option>';
        
        this.medicalData.documents.forEach(doc => {
            const option = document.createElement('option');
            option.value = doc.id;
            option.textContent = `${doc.type} - ${doc.name}`;
            dropdown.appendChild(option);
        });
    }

    addMedicalHistory() {
        const formData = {
            id: 'HIS' + Date.now(),
            type: document.getElementById('eventType').value,
            name: document.getElementById('eventName').value,
            date: document.getElementById('eventDate').value,
            details: document.getElementById('eventDetails').value,
            linkedDocument: document.getElementById('linkedDocument').value || null,
            createdAt: new Date().toISOString()
        };

        this.medicalData.medicalHistory.unshift(formData);
        this.saveMedicalData();
        this.renderMedicalHistory();
        this.closeAddMedicalHistoryModal();
        
        alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù…Ø±Ø¶ÙŠ Ø¨Ù†Ø¬Ø§Ø­!');
    }

    renderMedicalHistory() {
        const container = document.getElementById('medicalHistoryTimeline');
        
        if (this.medicalData.medicalHistory.length === 0) {
            container.innerHTML = this.getEmptyStateHTML('Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø¶ÙŠ', 'fas fa-history');
            return;
        }

        let historyHTML = '';
        
        // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
        const sortedHistory = [...this.medicalData.medicalHistory].sort((a, b) => 
            new Date(b.date) - new Date(a.date)
        );
        
        sortedHistory.forEach(event => {
            historyHTML += `
                <div class="timeline-item">
                    <div class="timeline-date">${this.formatDate(event.date)}</div>
                    <div class="timeline-content">
                        <div class="timeline-title">${event.name}</div>
                        <div class="timeline-type">${event.type}</div>
                        <div class="timeline-details">${event.details}</div>
                        
                        ${event.linkedDocument ? `
                        <div style="margin-top: 8px;">
                            <button class="btn-small" onclick="medicalRecords.viewLinkedDocument('${event.linkedDocument}')">
                                <i class="fas fa-external-link-alt"></i>
                                Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø±ØªØ¨Ø·
                            </button>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        });

        container.innerHTML = historyHTML;
    }

    viewLinkedDocument(documentId) {
        this.viewDocument(documentId);
    }

    // === Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ===
    getEmptyStateHTML(title, icon) {
        return `
            <div class="empty-state">
                <i class="${icon}"></i>
                <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ${title}</h3>
                <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ ${title} Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
            </div>
        `;
    }

    formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('ar-EG');
    }

    setupNotifications() {
        // Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        if ("Notification" in window) {
            Notification.requestPermission();
        }
        
        // ØªÙØ¹ÙŠÙ„ ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù†Ø´Ø·Ø©
        this.medicalData.medications
            .filter(med => med.reminders && med.status === 'active')
            .forEach(med => {
                med.times.forEach(time => {
                    this.scheduleNotification(med, time);
                });
            });
    }
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
document.addEventListener('DOMContentLoaded', function() {
    window.medicalRecords = new MedicalRecords();
});
</script>
</body>
</html>
