<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>التحاليل الطبية - طبيب 24/7</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
:root {
    --primary: #1e40af;
    --primary-dark: #1e3a8a;
    --primary-light: #dbeafe;
    --secondary: #dc2626;
    --accent: #f59e0b;
    --success: #059669;
    --warning: #d97706;
    --error: #dc2626;
    --dark: #1e1b4b;
    --light: #f0f9ff;
    --surface: #ffffff;
    --glass: rgba(255, 255, 255, 0.25);
    --glass-dark: rgba(255, 255, 255, 0.1);
    --text-primary: #1e293b;
    --text-secondary: #475569;
    --text-light: #64748b;
    --gradient-primary: linear-gradient(135deg, #1e40af 0%, #3730a3 100%);
    --gradient-lab: linear-gradient(135deg, #7c3aed 0%, #3730a3 100%);
    --gradient-premium: linear-gradient(135deg, #1e40af 0%, #3730a3 50%, #7c3aed 100%);
    --gradient-success: linear-gradient(135deg, #059669 0%, #10b981 100%);
    --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.1);
    --shadow-glass: 0 8px 32px rgba(124, 58, 237, 0.2);
    --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.08);
    --shadow-large: 0 16px 48px rgba(0, 0, 0, 0.15);
    --radius-xl: 24px;
    --radius-lg: 20px;
    --radius-md: 16px;
    --radius-sm: 12px;
    --transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-bounce: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Tajawal', 'El Messiri', sans-serif;
    -webkit-tap-highlight-color: transparent;
}

body {
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #dbeafe 100%);
    color: var(--text-primary);
    direction: rtl;
    overflow-x: hidden;
    min-height: 100vh;
}

/* تصميم شريط الحالة المتميز */
.status-bar {
    background: transparent;
    color: var(--text-primary);
    padding: 12px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    font-weight: 500;
    backdrop-filter: blur(20px);
    position: relative;
    z-index: 1000;
}

.status-bar::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--glass);
    backdrop-filter: blur(20px);
    z-index: -1;
}

/* التطبيق الرئيسي */
.premium-app {
    max-width: 428px;
    margin: 0 auto;
    background: transparent;
    min-height: 100vh;
    position: relative;
    overflow: hidden;
}

/* الخلفية الديناميكية */
.background-effects {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
}

.floating-shapes {
    position: absolute;
    width: 100%;
    height: 100%;
}

.shape {
    position: absolute;
    border-radius: 50%;
    background: var(--gradient-lab);
    opacity: 0.1;
    animation: float 6s ease-in-out infinite;
}

.shape:nth-child(1) {
    width: 200px;
    height: 200px;
    top: 10%;
    left: 10%;
    animation-delay: 0s;
}

.shape:nth-child(2) {
    width: 150px;
    height: 150px;
    top: 60%;
    right: 20%;
    animation-delay: 2s;
}

.shape:nth-child(3) {
    width: 100px;
    height: 100px;
    bottom: 20%;
    left: 20%;
    animation-delay: 4s;
}

@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
}

/* الهيدر المتقدم */
.lab-header {
    background: var(--gradient-lab);
    color: white;
    padding: 40px 24px 30px;
    border-radius: 0 0 var(--radius-xl) var(--radius-xl);
    box-shadow: var(--shadow-glass);
    position: relative;
    overflow: hidden;
}

.header-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><polygon fill="rgba(255,255,255,0.05)" points="0,1000 1000,0 1000,1000"/></svg>');
    background-size: cover;
}

.header-content {
    position: relative;
    z-index: 2;
    text-align: center;
}

.header-title {
    font-size: 28px;
    font-weight: 800;
    margin-bottom: 8px;
    background: linear-gradient(45deg, #fff, #ddd6fe);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.header-subtitle {
    font-size: 16px;
    opacity: 0.9;
    margin-bottom: 25px;
}

.quick-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-top: 20px;
}

.stat-item {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-md);
    padding: 15px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.stat-value {
    font-size: 20px;
    font-weight: 800;
    margin-bottom: 4px;
}

.stat-label {
    font-size: 12px;
    opacity: 0.9;
}

/* المحتوى الرئيسي */
.lab-content {
    padding: 25px 20px;
    padding-bottom: 120px;
}

.section-title {
    font-size: 20px;
    font-weight: 800;
    margin: 30px 0 20px;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 12px;
    padding-right: 8px;
}

.section-title::before {
    content: '';
    width: 4px;
    height: 24px;
    background: var(--gradient-lab);
    border-radius: 2px;
}

/* التبويبات */
.lab-tabs {
    display: flex;
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 8px;
    margin-bottom: 25px;
    box-shadow: var(--shadow-card);
    border: 1px solid #f1f5f9;
}

.tab-btn {
    flex: 1;
    padding: 12px 16px;
    border: none;
    background: transparent;
    border-radius: var(--radius-md);
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: var(--transition-smooth);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    color: var(--text-secondary);
}

.tab-btn.active {
    background: var(--gradient-lab);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-soft);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* البحث عن التحاليل */
.search-tests-section {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
}

.search-container {
    position: relative;
}

.search-input {
    width: 100%;
    padding: 15px 50px 15px 15px;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    font-size: 16px;
    transition: var(--transition-smooth);
}

.search-input:focus {
    border-color: #7c3aed;
    outline: none;
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
}

.search-icon {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
}

/* فئات التحاليل */
.categories-section {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
}

.categories-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-top: 20px;
}

.category-card {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    padding: 15px 8px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition-bounce);
}

.category-card:hover {
    border-color: #7c3aed;
    transform: translateY(-5px);
    box-shadow: var(--shadow-soft);
}

.category-card.active {
    background: var(--gradient-lab);
    color: white;
    border-color: #7c3aed;
}

.category-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-md);
    background: var(--gradient-lab);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 8px;
    font-size: 18px;
    color: white;
}

.category-card.active .category-icon {
    background: rgba(255, 255, 255, 0.2);
}

.category-name {
    font-weight: 700;
    font-size: 12px;
    line-height: 1.3;
}

/* التحاليل المقترحة */
.suggested-tests {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
}

.tests-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
    margin-top: 20px;
}

.test-card {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    padding: 20px;
    cursor: pointer;
    transition: var(--transition-bounce);
    display: flex;
    align-items: center;
    gap: 15px;
}

.test-card:hover {
    border-color: #7c3aed;
    transform: translateX(-5px);
    box-shadow: var(--shadow-soft);
}

.test-card.added {
    background: var(--primary-light);
    border-color: var(--primary);
}

.test-icon {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-md);
    background: var(--gradient-lab);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
    flex-shrink: 0;
}

.test-details {
    flex: 1;
}

.test-name {
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 4px;
}

.test-description {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 8px;
    line-height: 1.4;
}

.test-meta {
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 12px;
    color: var(--text-light);
}

.test-price {
    font-weight: 800;
    font-size: 16px;
    color: var(--success);
}

.add-to-cart-btn {
    background: var(--gradient-lab);
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: var(--radius-sm);
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition-smooth);
    display: flex;
    align-items: center;
    gap: 6px;
    flex-shrink: 0;
}

.add-to-cart-btn:hover {
    transform: translateY(-2px);
}

.add-to-cart-btn.added {
    background: var(--primary);
}

/* سلة التحاليل */
.cart-section {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
}

.cart-container {
    min-height: 200px;
    margin-bottom: 20px;
}

.empty-cart {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
}

.empty-cart i {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.cart-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: #f8fafc;
    border-radius: var(--radius-md);
    margin-bottom: 12px;
    border: 1px solid #e2e8f0;
}

.cart-item-icon {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-sm);
    background: var(--gradient-lab);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
    flex-shrink: 0;
}

.cart-item-details {
    flex: 1;
}

.cart-item-name {
    font-weight: 700;
    font-size: 14px;
    margin-bottom: 4px;
}

.cart-item-price {
    font-weight: 600;
    color: var(--success);
    font-size: 14px;
}

.remove-item-btn {
    background: var(--error);
    color: white;
    border: none;
    width: 32px;
    height: 32px;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 12px;
}

.cart-summary {
    background: #f8fafc;
    border-radius: var(--radius-md);
    padding: 20px;
    border: 2px solid var(--success);
}

.summary-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #e2e8f0;
}

.summary-item:last-child {
    border-bottom: none;
}

.summary-item.total {
    font-weight: 800;
    font-size: 18px;
    color: var(--success);
    padding-top: 12px;
    border-top: 2px solid #e2e8f0;
}

/* معلومات الحجز */
.booking-section {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
}

.service-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
    margin-bottom: 20px;
}

.service-option {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: var(--transition-smooth);
}

.service-option:hover {
    border-color: #7c3aed;
    transform: translateX(-5px);
}

.service-option.active {
    background: var(--primary-light);
    border-color: var(--primary);
}

.option-icon {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-md);
    background: var(--gradient-lab);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
    flex-shrink: 0;
}

.option-details {
    flex: 1;
}

.option-title {
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 4px;
}

.option-description {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 6px;
}

.option-price {
    font-weight: 800;
    color: var(--success);
    font-size: 16px;
}

.booking-form {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #e2e8f0;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 700;
    color: var(--text-primary);
    font-size: 14px;
}

.form-input, .form-select, .form-textarea {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    font-size: 16px;
    transition: var(--transition-smooth);
    background: white;
    font-family: 'Tajawal', sans-serif;
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
    border-color: #7c3aed;
    outline: none;
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
}

.form-textarea {
    resize: vertical;
    min-height: 80px;
}

.location-info {
    background: #f8fafc;
    border-radius: var(--radius-md);
    padding: 15px;
    margin-top: 15px;
    border: 1px solid #e2e8f0;
}

.info-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    font-size: 14px;
}

.info-item i {
    color: #7c3aed;
    width: 16px;
}

/* الدفع */
.payment-section {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
}

.payment-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
}

.payment-option {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: var(--transition-smooth);
}

.payment-option:hover {
    border-color: #7c3aed;
    transform: translateX(-5px);
}

.payment-option.active {
    background: var(--primary-light);
    border-color: var(--primary);
}

.payment-option .option-icon {
    background: var(--gradient-primary);
}

.option-balance {
    font-weight: 600;
    color: var(--success);
    font-size: 14px;
}

/* تأكيد الحجز */
.booking-actions {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
    text-align: center;
}

.confirm-booking {
    width: 100%;
    padding: 18px 24px;
    font-size: 18px;
    background: var(--gradient-lab);
}

.confirm-booking:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-large);
}

/* مواعيدي */
.appointments-filter {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    overflow-x: auto;
    padding-bottom: 10px;
}

.filter-btn {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    padding: 10px 16px;
    border-radius: var(--radius-md);
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    white-space: nowrap;
    transition: var(--transition-smooth);
}

.filter-btn.active {
    background: var(--gradient-lab);
    color: white;
    border-color: #7c3aed;
}

.appointments-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.appointment-card {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 20px;
    box-shadow: var(--shadow-card);
    border: 1px solid #f1f5f9;
    transition: var(--transition-smooth);
}

.appointment-card:hover {
    transform: translateX(-5px);
    box-shadow: var(--shadow-soft);
}

.appointment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e2e8f0;
}

.appointment-number {
    font-weight: 800;
    color: var(--primary);
    font-size: 16px;
}

.appointment-status {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
}

.status-upcoming { background: #fef3c7; color: #92400e; }
.status-completed { background: #d1fae5; color: #065f46; }
.status-cancelled { background: #fee2e2; color: #991b1b; }

.appointment-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

.appointment-detail {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.detail-label {
    font-size: 12px;
    color: var(--text-secondary);
}

.detail-value {
    font-weight: 600;
    font-size: 14px;
}

.appointment-tests {
    margin-bottom: 15px;
}

.tests-count {
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 8px;
}

.appointment-actions {
    display: flex;
    gap: 10px;
}

.action-btn {
    flex: 1;
    padding: 10px 16px;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    background: white;
    color: var(--text-primary);
    font-weight: 700;
    font-size: 13px;
    cursor: pointer;
    transition: var(--transition-smooth);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.action-btn.primary {
    background: var(--gradient-lab);
    color: white;
    border-color: #7c3aed;
}

.action-btn:hover {
    transform: translateY(-2px);
}

/* نتائج التحاليل */
.results-actions {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
    display: flex;
    gap: 12px;
}

.results-actions .btn {
    flex: 1;
}

.results-list {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
}

.result-card {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 20px;
    box-shadow: var(--shadow-card);
    border: 1px solid #f1f5f9;
    transition: var(--transition-smooth);
}

.result-card:hover {
    transform: translateX(-5px);
    box-shadow: var(--shadow-soft);
}

.result-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.result-test-name {
    font-weight: 700;
    font-size: 16px;
    color: var(--text-primary);
}

.result-date {
    font-size: 13px;
    color: var(--text-secondary);
}

.result-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

.result-value {
    font-size: 18px;
    font-weight: 800;
    color: var(--success);
    text-align: center;
    padding: 10px;
    background: #f0fdf4;
    border-radius: var(--radius-md);
    border: 2px solid #bbf7d0;
}

.result-normal {
    color: var(--success);
    background: #f0fdf4;
    border-color: #bbf7d0;
}

.result-abnormal {
    color: var(--error);
    background: #fef2f2;
    border-color: #fecaca;
}

.result-actions {
    display: flex;
    gap: 10px;
}

/* النوافذ المنبثقة */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.modal-content {
    background: white;
    border-radius: var(--radius-xl);
    padding: 30px;
    max-width: 400px;
    width: 100%;
    box-shadow: var(--shadow-large);
    animation: modalAppear 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    max-height: 90vh;
    overflow-y: auto;
}

@keyframes modalAppear {
    from {
        opacity: 0;
        transform: scale(0.8) translateY(50px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.modal-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f1f5f9;
}

.modal-title {
    font-size: 22px;
    font-weight: 800;
    color: var(--text-primary);
}

.close-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--text-secondary);
    transition: var(--transition-smooth);
}

.close-modal:hover {
    color: var(--error);
    transform: rotate(90deg);
}

/* تأكيد الحجز */
.booking-summary {
    margin-bottom: 25px;
}

.booking-number {
    background: var(--primary-light);
    color: var(--primary);
    padding: 12px;
    border-radius: var(--radius-md);
    font-family: monospace;
    font-weight: 700;
    text-align: center;
    margin-bottom: 20px;
    font-size: 18px;
}

.summary-section {
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e2e8f0;
}

.summary-title {
    font-weight: 700;
    margin-bottom: 12px;
    color: var(--text-primary);
    font-size: 16px;
}

.tests-list, .booking-info, .payment-info {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.test-summary-item, .booking-info-item, .payment-info-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #f1f5f9;
}

.test-summary-item:last-child, .booking-info-item:last-child, .payment-info-item:last-child {
    border-bottom: none;
}

.total-amount {
    display: flex;
    justify-content: space-between;
    padding: 15px;
    background: #f8fafc;
    border-radius: var(--radius-md);
    font-weight: 800;
    font-size: 18px;
    color: var(--success);
    border: 2px solid var(--success);
}

.modal-actions {
    display: flex;
    gap: 12px;
}

.modal-actions .btn {
    flex: 1;
}

/* نجاح الحجز */
.success-content {
    text-align: center;
    padding: 20px 0;
}

.success-icon {
    font-size: 64px;
    color: var(--success);
    margin-bottom: 20px;
}

.success-content h3 {
    margin-bottom: 10px;
    color: var(--text-primary);
}

.success-content p {
    color: var(--text-secondary);
    margin-bottom: 20px;
    line-height: 1.6;
}

.booking-details {
    background: #f8fafc;
    border-radius: var(--radius-lg);
    padding: 20px;
    margin: 20px 0;
    text-align: right;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #e2e8f0;
}

.detail-item:last-child {
    border-bottom: none;
}

.detail-label {
    font-weight: 600;
    color: var(--text-secondary);
}

.detail-value {
    font-weight: 700;
    color: var(--text-primary);
}

.preparation-instructions {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: 20px;
    text-align: right;
    margin: 20px 0;
}

.instructions-title {
    font-weight: 700;
    margin-bottom: 12px;
    color: #92400e;
}

.preparation-instructions ul {
    list-style: none;
    padding: 0;
}

.preparation-instructions li {
    padding: 6px 0;
    position: relative;
    padding-right: 20px;
}

.preparation-instructions li::before {
    content: '•';
    color: #f59e0b;
    font-weight: bold;
    position: absolute;
    right: 0;
}

/* الأزرار */
.btn {
    padding: 14px 24px;
    border: none;
    border-radius: var(--radius-md);
    font-weight: 800;
    cursor: pointer;
    transition: var(--transition-bounce);
    font-size: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: center;
}

.btn-primary {
    background: var(--gradient-lab);
    color: white;
}

.btn-secondary {
    background: var(--light);
    color: var(--text-primary);
    border: 2px solid #e2e8f0;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-soft);
}

.btn:active {
    transform: translateY(0);
}

/* شريط التنقل السفلي */
.bottom-nav-premium {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    display: flex;
    padding: 15px;
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-soft);
    z-index: 1000;
    max-width: 380px;
    width: calc(100% - 40px);
}

.nav-item-premium {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 12px;
    border-radius: var(--radius-md);
    transition: var(--transition-bounce);
    flex: 1;
    position: relative;
    text-decoration: none;
    color: inherit;
}

.nav-item-premium.active {
    background: var(--gradient-lab);
    color: white;
    transform: translateY(-10px);
}

.nav-item-premium.active .nav-label {
    color: white;
}

.nav-item-premium.active::before {
    content: '';
    position: absolute;
    top: -8px;
    width: 20px;
    height: 3px;
    background: var(--gradient-lab);
    border-radius: 2px;
}

.nav-icon-premium {
    font-size: 20px;
    margin-bottom: 6px;
    transition: var(--transition-smooth);
}

.nav-item-premium.active .nav-icon-premium {
    transform: scale(1.2);
}

.nav-label {
    font-size: 11px;
    font-weight: 700;
    color: var(--text-secondary);
}

/* التكيف مع الشاشات */
@media (max-width: 428px) {
    .categories-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .tests-grid {
        grid-template-columns: 1fr;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .modal-actions {
        flex-direction: column;
    }
    
    .appointment-details {
        grid-template-columns: 1fr;
    }
    
    .result-details {
        grid-template-columns: 1fr;
    }
    
    .appointment-actions {
        flex-direction: column;
    }
    
    .result-actions {
        flex-direction: column;
    }
    
    .results-actions {
        flex-direction: column;
    }
}
</style>
</head>
<body>
    <!-- تأثيرات الخلفية الديناميكية -->
    <div class="background-effects">
        <div class="floating-shapes">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
        </div>
    </div>

    <!-- شريط الحالة -->
    <div class="status-bar">
        <div class="status-left">
            <span id="currentTime">2:45</span>
        </div>
        <div class="status-right">
            <i class="fas fa-signal"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-battery-three-quarters"></i>
        </div>
    </div>

    <!-- التطبيق الرئيسي -->
    <div class="premium-app">
        <!-- الهيدر -->
        <div class="lab-header">
            <div class="header-background"></div>
            <div class="header-content">
                <h1 class="header-title">التحاليل الطبية</h1>
                <p class="header-subtitle">احجز تحاليلك الطبية في أفضل المختبرات مع نتائج سريعة</p>
                
                <div class="quick-stats">
                    <div class="stat-item">
                        <div class="stat-value">50+</div>
                        <div class="stat-label">مختبر متعاقد</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">24/7</div>
                        <div class="stat-label">خدمة منزلية</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">4.8</div>
                        <div class="stat-label">تقييم العملاء</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- المحتوى الرئيسي -->
        <div class="lab-content">
            <!-- التبويبات -->
            <div class="lab-tabs">
                <button class="tab-btn active" data-tab="book-test">
                    <i class="fas fa-flask"></i>
                    حجز تحاليل
                </button>
                <button class="tab-btn" data-tab="my-appointments">
                    <i class="fas fa-calendar-check"></i>
                    مواعيدي
                </button>
                <button class="tab-btn" data-tab="test-results">
                    <i class="fas fa-file-medical"></i>
                    نتائج التحاليل
                </button>
            </div>

            <!-- تبويب حجز تحاليل -->
            <div class="tab-content active" id="book-test">
                <!-- البحث عن التحاليل -->
                <div class="search-tests-section">
                    <div class="section-title">ابحث عن التحاليل</div>
                    <div class="search-container">
                        <input type="text" class="search-input" id="testSearch" placeholder="ابحث عن تحليل طبي...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>

                <!-- الفئات الرئيسية -->
                <div class="categories-section">
                    <div class="section-title">فئات التحاليل</div>
                    <div class="categories-grid">
                        <div class="category-card" data-category="blood">
                            <div class="category-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <div class="category-name">تحاليل الدم</div>
                        </div>
                        <div class="category-card" data-category="urine">
                            <div class="category-icon">
                                <i class="fas fa-vial"></i>
                            </div>
                            <div class="category-name">تحاليل البول</div>
                        </div>
                        <div class="category-card" data-category="hormones">
                            <div class="category-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="category-name">هرمونات</div>
                        </div>
                        <div class="category-card" data-category="vitamins">
                            <div class="category-icon">
                                <i class="fas fa-capsules"></i>
                            </div>
                            <div class="category-name">فيتامينات</div>
                        </div>
                        <div class="category-card" data-category="liver">
                            <div class="category-icon">
                                <i class="fas fa-liver"></i>
                            </div>
                            <div class="category-name">وظائف الكبد</div>
                        </div>
                        <div class="category-card" data-category="kidney">
                            <div class="category-icon">
                                <i class="fas fa-kidneys"></i>
                            </div>
                            <div class="category-name">وظائف الكلى</div>
                        </div>
                        <div class="category-card" data-category="thyroid">
                            <div class="category-icon">
                                <i class="fas fa-gland"></i>
                            </div>
                            <div class="category-name">الغدة الدرقية</div>
                        </div>
                        <div class="category-card" data-category="all">
                            <div class="category-icon">
                                <i class="fas fa-list"></i>
                            </div>
                            <div class="category-name">عرض الكل</div>
                        </div>
                    </div>
                </div>

                <!-- التحاليل المقترحة -->
                <div class="suggested-tests">
                    <div class="section-title">تحاليل مقترحة</div>
                    <div class="tests-grid" id="testsGrid">
                        <!-- سيتم تعبئتها بالجافاسكربت -->
                    </div>
                </div>

                <!-- سلة التحاليل -->
                <div class="cart-section">
                    <div class="section-title">سلة التحاليل</div>
                    <div class="cart-container" id="cartContainer">
                        <div class="empty-cart">
                            <i class="fas fa-shopping-cart"></i>
                            <p>سلة التحاليل فارغة</p>
                            <small>اختر التحاليل المطلوبة من القائمة أعلاه</small>
                        </div>
                    </div>
                    
                    <div class="cart-summary" id="cartSummary" style="display: none;">
                        <div class="summary-item">
                            <span>المجموع:</span>
                            <span id="subtotal">0 ر.ي</span>
                        </div>
                        <div class="summary-item">
                            <span>رسوم الخدمة:</span>
                            <span id="serviceFee">0 ر.ي</span>
                        </div>
                        <div class="summary-item total">
                            <span>الإجمالي:</span>
                            <span id="totalAmount">0 ر.ي</span>
                        </div>
                    </div>
                </div>

                <!-- معلومات الحجز -->
                <div class="booking-section">
                    <div class="section-title">معلومات الحجز</div>
                    
                    <div class="service-options">
                        <div class="service-option active" data-type="lab">
                            <div class="option-icon">
                                <i class="fas fa-clinic-medical"></i>
                            </div>
                            <div class="option-details">
                                <div class="option-title">الحضور للمختبر</div>
                                <div class="option-description">احجز موعد في أقرب مختبر</div>
                                <div class="option-price">مجاني</div>
                            </div>
                        </div>
                        <div class="service-option" data-type="home">
                            <div class="option-icon">
                                <i class="fas fa-home"></i>
                            </div>
                            <div class="option-details">
                                <div class="option-title">خدمة منزلية</div>
                                <div class="option-description">فني مختبر يزورك في المنزل</div>
                                <div class="option-price">15 ر.ي</div>
                            </div>
                        </div>
                    </div>

                    <div class="booking-form">
                        <div class="form-group">
                            <label class="form-label">تاريخ الحجز</label>
                            <input type="date" class="form-input" id="bookingDate">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">وقت الحجز</label>
                            <select class="form-select" id="bookingTime">
                                <option value="">اختر الوقت المناسب</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">الموقع</label>
                            <select class="form-select" id="locationSelect">
                                <option value="">اختر الموقع</option>
                            </select>
                        </div>

                        <div class="location-info" id="locationInfo" style="display: none;">
                            <div class="info-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span id="labAddress">---</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-clock"></i>
                                <span id="labHours">---</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-phone"></i>
                                <span id="labPhone">---</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">ملاحظات إضافية</label>
                            <textarea class="form-textarea" id="bookingNotes" placeholder="أي ملاحظات خاصة بالتحاليل..." rows="2"></textarea>
                        </div>
                    </div>
                </div>

                <!-- الدفع -->
                <div class="payment-section">
                    <div class="section-title">طريقة الدفع</div>
                    <div class="payment-options">
                        <div class="payment-option active" data-method="wallet">
                            <div class="option-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div class="option-details">
                                <div class="option-title">المحفظة الرقمية</div>
                                <div class="option-balance">الرصيد: <span id="walletBalance">0 ر.ي</span></div>
                            </div>
                        </div>
                        <div class="payment-option" data-method="cash">
                            <div class="option-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="option-details">
                                <div class="option-title">الدفع عند الاستلام</div>
                                <div class="option-description">ادفع نقداً عند تقديم الخدمة</div>
                            </div>
                        </div>
                        <div class="payment-option" data-method="card">
                            <div class="option-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <div class="option-details">
                                <div class="option-title">البطاقة الائتمانية</div>
                                <div class="option-description">دفع آمن عبر البطاقة</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- تأكيد الحجز -->
                <div class="booking-actions">
                    <button class="btn btn-primary confirm-booking" id="confirmBooking">
                        <i class="fas fa-calendar-check"></i>
                        تأكيد الحجز
                    </button>
                </div>
            </div>

            <!-- تبويب مواعيدي -->
            <div class="tab-content" id="my-appointments">
                <div class="section-title">مواعيد التحاليل</div>
                
                <div class="appointments-filter">
                    <button class="filter-btn active" data-status="all">الكل</button>
                    <button class="filter-btn" data-status="upcoming">قادمة</button>
                    <button class="filter-btn" data-status="completed">مكتملة</button>
                    <button class="filter-btn" data-status="cancelled">ملغية</button>
                </div>

                <div class="appointments-list" id="appointmentsList">
                    <!-- سيتم تعبئتها بالجافاسكربت -->
                </div>
            </div>

            <!-- تبويب نتائج التحاليل -->
            <div class="tab-content" id="test-results">
                <div class="section-title">نتائج التحاليل</div>
                
                <div class="results-actions">
                    <button class="btn btn-primary" onclick="labSystem.uploadResults()">
                        <i class="fas fa-upload"></i>
                        رفع نتائج
                    </button>
                    <button class="btn btn-secondary" onclick="labSystem.requestResults()">
                        <i class="fas fa-envelope"></i>
                        طلب نتائج
                    </button>
                </div>

                <div class="results-list" id="resultsList">
                    <!-- سيتم تعبئتها بالجافاسكربت -->
                </div>
            </div>
        </div>

        <!-- نوافذ منبثقة -->
        
        <!-- نافذة تأكيد الحجز -->
        <div id="bookingConfirmationModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">تأكيد حجز التحاليل</div>
                    <button class="close-modal" onclick="closeModal('bookingConfirmationModal')">×</button>
                </div>
                
                <div class="booking-summary">
                    <div class="booking-number" id="bookingNumber">LAB-2024-001</div>
                    
                    <div class="summary-section">
                        <div class="summary-title">التحاليل المطلوبة</div>
                        <div class="tests-list" id="bookingTestsList">
                            <!-- سيتم تعبئتها بالجافاسكربت -->
                        </div>
                    </div>

                    <div class="summary-section">
                        <div class="summary-title">معلومات الحجز</div>
                        <div class="booking-info" id="bookingInfo">
                            <!-- سيتم تعبئتها بالجافاسكربت -->
                        </div>
                    </div>

                    <div class="summary-section">
                        <div class="summary-title">الدفع</div>
                        <div class="payment-info" id="bookingPaymentInfo">
                            <!-- سيتم تعبئتها بالجافاسكربت -->
                        </div>
                    </div>

                    <div class="total-amount">
                        <span>المبلغ الإجمالي:</span>
                        <span id="bookingTotalAmount">0 ر.ي</span>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeModal('bookingConfirmationModal')">
                        تعديل الحجز
                    </button>
                    <button class="btn btn-primary" onclick="labSystem.confirmBooking()">
                        <i class="fas fa-check-circle"></i>
                        تأكيد الحجز
                    </button>
                </div>
            </div>
        </div>

        <!-- نافذة نجاح الحجز -->
        <div id="bookingSuccessModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">تم تأكيد حجزك</div>
                    <button class="close-modal" onclick="closeModal('bookingSuccessModal')">×</button>
                </div>
                
                <div class="success-content">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>تم تأكيد حجز التحاليل!</h3>
                    <p>سيتم إرسال تفاصيل الموعد على بريدك الإلكتروني ورقم هاتفك</p>
                    
                    <div class="booking-details">
                        <div class="detail-item">
                            <span class="detail-label">رقم الحجز:</span>
                            <span class="detail-value" id="successBookingNumber">LAB-2024-001</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">التاريخ والوقت:</span>
                            <span class="detail-value" id="successBookingDateTime">---</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">المكان:</span>
                            <span class="detail-value" id="successBookingLocation">---</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">المبلغ:</span>
                            <span class="detail-value" id="successBookingAmount">0 ر.ي</span>
                        </div>
                    </div>

                    <div class="preparation-instructions">
                        <div class="instructions-title">تعليمات قبل التحاليل:</div>
                        <ul>
                            <li>الصيام لمدة 8-12 ساعة لتحاليل الدم</li>
                            <li>شرب كمية كافية من الماء</li>
                            <li>إحضار أي تقارير طبية سابقة</li>
                            <li>التوقف عن بعض الأدوية حسب إرشادات الطبيب</li>
                        </ul>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="closeModal('bookingSuccessModal'); labSystem.switchTab('my-appointments')">
                        <i class="fas fa-calendar"></i>
                        عرض المواعيد
                    </button>
                    <button class="btn btn-secondary" onclick="closeModal('bookingSuccessModal')">
                        <i class="fas fa-print"></i>
                        طباعة التفاصيل
                    </button>
                </div>
            </div>
        </div>

        <!-- نافذة تفاصيل الموعد -->
        <div id="appointmentDetailsModal" class="modal">
            <!-- سيتم إنشاؤها بالجافاسكربت -->
        </div>

        <!-- نافذة نتائج التحاليل -->
        <div id="testResultsModal" class="modal">
            <!-- سيتم إنشاؤها بالجافاسكربت -->
        </div>

        <!-- شريط التنقل السفلي -->
        <div class="bottom-nav-premium">
            <a href="index.html" class="nav-item-premium">
                <div class="nav-icon-premium">
                    <i class="fas fa-home"></i>
                </div>
                <div class="nav-label">الرئيسية</div>
            </a>
            <a href="consultation.html" class="nav-item-premium">
                <div class="nav-icon-premium">
                    <i class="fas fa-stethoscope"></i>
                </div>
                <div class="nav-label">الاستشارات</div>
            </a>
            <a href="doctor-appointment.html" class="nav-item-premium">
                <div class="nav-icon-premium">
                    <i class="fas fa-user-md"></i>
                </div>
                <div class="nav-label">حجز دكتور</div>
            </a>
            <a href="lab-tests.html" class="nav-item-premium active">
                <div class="nav-icon-premium">
                    <i class="fas fa-flask"></i>
                </div>
                <div class="nav-label">التحاليل</div>
            </a>
            <a href="profile.html" class="nav-item-premium">
                <div class="nav-icon-premium">
                    <i class="fas fa-user"></i>
                </div>
                <div class="nav-label">حسابي</div>
            </a>
        </div>
    </div>

    <script>
  // نظام التحاليل الطبية وحجز المواعيد
class LabSystem {
    constructor() {
        this.tests = [];
        this.labs = [];
        this.cart = [];
        this.appointments = JSON.parse(localStorage.getItem('labAppointments')) || [];
        this.testResults = JSON.parse(localStorage.getItem('testResults')) || [];
        this.currentTab = 'book-test';
        this.serviceType = 'lab';
        this.paymentMethod = 'wallet';
        this.currentFilter = 'all';
        this.selectedCategory = 'all';
        this.init();
    }

    init() {
        this.loadTests();
        this.loadLabs();
        this.setupEventListeners();
        this.updateTime();
        this.loadUserData();
        this.updateCartSummary();
        this.generateTimeSlots();
        setInterval(() => this.updateTime(), 60000);
    }

    setupEventListeners() {
        // التبويبات
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.switchTab(e.currentTarget.dataset.tab);
            });
        });

        // البحث عن التحاليل
        const testSearch = document.getElementById('testSearch');
        if (testSearch) {
            testSearch.addEventListener('input', (e) => {
                this.handleTestSearch(e.target.value);
            });
        }

        // فئات التحاليل
        document.querySelectorAll('.category-card').forEach(card => {
            card.addEventListener('click', (e) => {
                this.filterByCategory(e.currentTarget.dataset.category);
            });
        });

        // خيارات الخدمة
        document.querySelectorAll('.service-option').forEach(option => {
            option.addEventListener('click', (e) => {
                this.selectServiceType(e.currentTarget.dataset.type);
            });
        });

        // خيارات الدفع
        document.querySelectorAll('.payment-option').forEach(option => {
            option.addEventListener('click', (e) => {
                this.selectPaymentMethod(e.currentTarget.dataset.method);
            });
        });

        // تأكيد الحجز
        const confirmBooking = document.getElementById('confirmBooking');
        if (confirmBooking) {
            confirmBooking.addEventListener('click', () => {
                this.showBookingConfirmation();
            });
        }

        // اختيار المختبر
        const locationSelect = document.getElementById('locationSelect');
        if (locationSelect) {
            locationSelect.addEventListener('change', (e) => {
                this.selectLab(e.target.value);
            });
        }

        // تصفية المواعيد
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.filterAppointments(e.currentTarget.dataset.status);
            });
        });

        // تاريخ الحجز
        const bookingDate = document.getElementById('bookingDate');
        if (bookingDate) {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            bookingDate.min = tomorrow.toISOString().split('T')[0];
            bookingDate.addEventListener('change', (e) => {
                this.generateTimeSlots();
            });
        }
    }

    loadUserData() {
        this.userAccount = JSON.parse(localStorage.getItem('financialAccount')) || { balance: 500 };
        this.updateWalletBalance();
    }

    updateWalletBalance() {
        const walletBalance = document.getElementById('walletBalance');
        if (walletBalance && this.userAccount) {
            walletBalance.textContent = this.userAccount.balance + ' ر.ي';
        }
    }

    loadTests() {
        this.tests = [
            {
                id: 1,
                name: 'تحليل الدم الشامل',
                description: 'تحليل شامل لخلايا الدم الحمراء والبيضاء والصفائح الدموية',
                price: 25,
                category: 'blood',
                duration: '5-10 دقائق',
                preparation: 'الصيام لمدة 8 ساعات',
                icon: 'fa-tint'
            },
            {
                id: 2,
                name: 'تحليل السكر في الدم',
                description: 'قياس مستوى الجلوكوز في الدم',
                price: 15,
                category: 'blood',
                duration: '5 دقائق',
                preparation: 'الصيام لمدة 8-12 ساعة',
                icon: 'fa-vial'
            },
            {
                id: 3,
                name: 'تحليل وظائف الكبد',
                description: 'قياس إنزيمات الكبد والبروتينات',
                price: 35,
                category: 'liver',
                duration: '10 دقائق',
                preparation: 'الصيام لمدة 8 ساعات',
                icon: 'fa-liver'
            },
            {
                id: 4,
                name: 'تحليل وظائف الكلى',
                description: 'قياس الكرياتينين واليوريا في الدم',
                price: 30,
                category: 'kidney',
                duration: '10 دقائق',
                preparation: 'الصيام لمدة 8 ساعات',
                icon: 'fa-kidneys'
            },
            {
                id: 5,
                name: 'تحليل الغدة الدرقية',
                description: 'قياس هرمونات TSH, T3, T4',
                price: 40,
                category: 'thyroid',
                duration: '10 دقائق',
                preparation: 'لا يحتاج صيام',
                icon: 'fa-gland'
            },
            {
                id: 6,
                name: 'تحليل فيتامين د',
                description: 'قياس مستوى فيتامين د في الدم',
                price: 45,
                category: 'vitamins',
                duration: '10 دقائق',
                preparation: 'لا يحتاج صيام',
                icon: 'fa-sun'
            },
            {
                id: 7,
                name: 'تحليل البول الكامل',
                description: 'فحص شامل للبول والرواسب',
                price: 20,
                category: 'urine',
                duration: '5 دقائق',
                preparation: 'عينة بول صباحية',
                icon: 'fa-flask'
            },
            {
                id: 8,
                name: 'تحليل الدهون',
                description: 'قياس الكوليسترول والدهون الثلاثية',
                price: 30,
                category: 'blood',
                duration: '10 دقائق',
                preparation: 'الصيام لمدة 12 ساعة',
                icon: 'fa-chart-pie'
            },
            {
                id: 9,
                name: 'تحليل الهيموجلوبين',
                description: 'قياس مستوى الهيموجلوبين في الدم',
                price: 18,
                category: 'blood',
                duration: '5 دقائق',
                preparation: 'لا يحتاج صيام',
                icon: 'fa-heartbeat'
            },
            {
                id: 10,
                name: 'تحليل الحمل',
                description: 'فحص هرمون الحمل في الدم',
                price: 35,
                category: 'hormones',
                duration: '15 دقيقة',
                preparation: 'لا يحتاج صيام',
                icon: 'fa-baby'
            }
        ];
        this.renderTests();
    }

    loadLabs() {
        this.labs = [
            {
                id: 1,
                name: 'مختبر النخبة الطبي',
                address: 'شارع الزبيري، صنعاء',
                phone: '017234567',
                hours: '7:00 ص - 10:00 م',
                rating: 4.8
            },
            {
                id: 2,
                name: 'مختبر الأمل للتشخيص',
                address: 'حي السبعين، صنعاء',
                phone: '017234568',
                hours: '24/7',
                rating: 4.6
            },
            {
                id: 3,
                name: 'مختبر الحياة',
                address: 'كريتر، عدن',
                phone: '027234569',
                hours: '6:00 ص - 12:00 م',
                rating: 4.7
            },
            {
                id: 4,
                name: 'مختبر الشفاء',
                address: 'شارع 26 سبتمبر، تعز',
                phone: '047234570',
                hours: '8:00 ص - 11:00 م',
                rating: 4.9
            }
        ];
        this.renderLabsSelect();
    }

    renderTests() {
        const container = document.getElementById('testsGrid');
        if (!container) return;

        container.innerHTML = '';

        let filteredTests = this.tests;
        if (this.selectedCategory !== 'all') {
            filteredTests = this.tests.filter(test => test.category === this.selectedCategory);
        }

        filteredTests.forEach(test => {
            const testElement = document.createElement('div');
            testElement.className = 'test-card';
            
            const isInCart = this.cart.some(item => item.id === test.id);
            
            testElement.innerHTML = `
                <div class="test-icon">
                    <i class="fas ${test.icon}"></i>
                </div>
                <div class="test-details">
                    <div class="test-name">${test.name}</div>
                    <div class="test-description">${test.description}</div>
                    <div class="test-meta">
                        <span><i class="fas fa-clock"></i> ${test.duration}</span>
                        <span><i class="fas fa-info-circle"></i> ${test.preparation}</span>
                    </div>
                </div>
                <div class="test-price">${test.price} ر.ي</div>
                <button class="add-to-cart-btn ${isInCart ? 'added' : ''}" onclick="labSystem.addToCart(${test.id})">
                    <i class="fas ${isInCart ? 'fa-check' : 'fa-cart-plus'}"></i>
                    ${isInCart ? 'مضاف' : 'إضافة'}
                </button>
            `;
            
            container.appendChild(testElement);
        });
    }

    renderLabsSelect() {
        const select = document.getElementById('locationSelect');
        if (!select) return;

        select.innerHTML = '<option value="">اختر المختبر</option>';
        
        this.labs.forEach(lab => {
            select.innerHTML += `<option value="${lab.id}">${lab.name} ⭐ ${lab.rating}</option>`;
        });
    }

    switchTab(tabName) {
        this.currentTab = tabName;
        
        // تحديث التبويبات
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        document.querySelector(`.tab-btn[data-tab="${tabName}"]`).classList.add('active');

        // تحديث المحتوى
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        
        document.getElementById(tabName).classList.add('active');

        // تحميل البيانات إذا لزم الأمر
        if (tabName === 'my-appointments') {
            this.renderAppointments();
        } else if (tabName === 'test-results') {
            this.renderTestResults();
        }
    }

    handleTestSearch(query) {
        if (query.length >= 2) {
            const filteredTests = this.tests.filter(test => 
                test.name.includes(query) || 
                test.description.includes(query) ||
                test.category.includes(query)
            );
            this.renderFilteredTests(filteredTests);
        } else if (query.length === 0) {
            this.renderTests();
        }
    }

    renderFilteredTests(tests) {
        const container = document.getElementById('testsGrid');
        if (!container) return;

        if (tests.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i class="fas fa-search" style="font-size: 48px; margin-bottom: 16px;"></i>
                    <div>لا توجد نتائج</div>
                    <p style="font-size: 14px; margin-top: 8px;">جرب استخدام كلمات بحث مختلفة</p>
                </div>
            `;
            return;
        }

        container.innerHTML = '';

        tests.forEach(test => {
            const testElement = document.createElement('div');
            testElement.className = 'test-card';
            
            const isInCart = this.cart.some(item => item.id === test.id);
            
            testElement.innerHTML = `
                <div class="test-icon">
                    <i class="fas ${test.icon}"></i>
                </div>
                <div class="test-details">
                    <div class="test-name">${test.name}</div>
                    <div class="test-description">${test.description}</div>
                    <div class="test-meta">
                        <span><i class="fas fa-clock"></i> ${test.duration}</span>
                        <span><i class="fas fa-info-circle"></i> ${test.preparation}</span>
                    </div>
                </div>
                <div class="test-price">${test.price} ر.ي</div>
                <button class="add-to-cart-btn ${isInCart ? 'added' : ''}" onclick="labSystem.addToCart(${test.id})">
                    <i class="fas ${isInCart ? 'fa-check' : 'fa-cart-plus'}"></i>
                    ${isInCart ? 'مضاف' : 'إضافة'}
                </button>
            `;
            
            container.appendChild(testElement);
        });
    }

    filterByCategory(category) {
        this.selectedCategory = category;
        
        // تحديث الواجهة
        document.querySelectorAll('.category-card').forEach(card => {
            card.classList.remove('active');
        });
        
        document.querySelector(`.category-card[data-category="${category}"]`).classList.add('active');

        this.renderTests();
    }

    addToCart(testId) {
        const test = this.tests.find(t => t.id === testId);
        if (!test) return;

        const existingItem = this.cart.find(item => item.id === testId);
        
        if (!existingItem) {
            this.cart.push({
                ...test,
                quantity: 1
            });
            this.updateCartDisplay();
            this.showNotification(`${test.name} تمت الإضافة إلى السلة`, 'success');
        } else {
            this.removeFromCart(testId);
        }
    }

    removeFromCart(testId) {
        this.cart = this.cart.filter(item => item.id !== testId);
        this.updateCartDisplay();
        this.showNotification('تم إزالة التحليل من السلة', 'warning');
    }

    updateCartDisplay() {
        const container = document.getElementById('cartContainer');
        const summary = document.getElementById('cartSummary');
        
        if (!container) return;

        if (this.cart.length === 0) {
            container.innerHTML = `
                <div class="empty-cart">
                    <i class="fas fa-shopping-cart"></i>
                    <p>سلة التحاليل فارغة</p>
                    <small>اختر التحاليل المطلوبة من القائمة أعلاه</small>
                </div>
            `;
            if (summary) summary.style.display = 'none';
            return;
        }

        container.innerHTML = '';
        
        this.cart.forEach(item => {
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item';
            cartItem.innerHTML = `
                <div class="cart-item-icon">
                    <i class="fas ${item.icon}"></i>
                </div>
                <div class="cart-item-details">
                    <div class="cart-item-name">${item.name}</div>
                    <div class="cart-item-price">${item.price} ر.ي</div>
                </div>
                <button class="remove-item-btn" onclick="labSystem.removeFromCart(${item.id})">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(cartItem);
        });

        if (summary) {
            summary.style.display = 'block';
            this.updateCartSummary();
        }

        // إعادة render الاختبارات لتحديث أزرار الإضافة
        this.renderTests();
    }

    updateCartSummary() {
        const subtotal = this.cart.reduce((sum, item) => sum + item.price, 0);
        const serviceFee = this.serviceType === 'home' ? 15 : 0;
        const total = subtotal + serviceFee;

        const subtotalElement = document.getElementById('subtotal');
        const serviceFeeElement = document.getElementById('serviceFee');
        const totalElement = document.getElementById('totalAmount');

        if (subtotalElement) subtotalElement.textContent = subtotal + ' ر.ي';
        if (serviceFeeElement) serviceFeeElement.textContent = serviceFee + ' ر.ي';
        if (totalElement) totalElement.textContent = total + ' ر.ي';
    }

    selectServiceType(type) {
        this.serviceType = type;
        
        // تحديث الواجهة
        document.querySelectorAll('.service-option').forEach(option => {
            option.classList.remove('active');
        });
        
        document.querySelector(`.service-option[data-type="${type}"]`).classList.add('active');

        this.updateCartSummary();
    }

    selectPaymentMethod(method) {
        this.paymentMethod = method;
        
        document.querySelectorAll('.payment-option').forEach(option => {
            option.classList.remove('active');
        });
        
        document.querySelector(`.payment-option[data-method="${method}"]`).classList.add('active');
    }

    selectLab(labId) {
        const lab = this.labs.find(l => l.id == labId);
        if (!lab) return;

        const infoContainer = document.getElementById('locationInfo');
        if (!infoContainer) return;

        document.getElementById('labAddress').textContent = lab.address;
        document.getElementById('labHours').textContent = lab.hours;
        document.getElementById('labPhone').textContent = lab.phone;
        
        infoContainer.style.display = 'block';
    }

    generateTimeSlots() {
        const timeSelect = document.getElementById('bookingTime');
        if (!timeSelect) return;

        timeSelect.innerHTML = '<option value="">اختر الوقت المناسب</option>';

        const times = [
            '8:00 ص', '8:30 ص', '9:00 ص', '9:30 ص', '10:00 ص', '10:30 ص',
            '11:00 ص', '11:30 ص', '12:00 م', '12:30 م', '1:00 م', '1:30 م',
            '2:00 م', '2:30 م', '3:00 م', '3:30 م', '4:00 م', '4:30 م',
            '5:00 م', '5:30 م', '6:00 م', '6:30 م', '7:00 م', '7:30 م'
        ];

        times.forEach(time => {
            timeSelect.innerHTML += `<option value="${time}">${time}</option>`;
        });
    }

    showBookingConfirmation() {
        if (this.cart.length === 0) {
            this.showNotification('يرجى إضافة تحاليل إلى السلة أولاً', 'error');
            return;
        }

        const bookingDate = document.getElementById('bookingDate').value;
        const bookingTime = document.getElementById('bookingTime').value;
        const location = document.getElementById('locationSelect').value;

        if (!bookingDate || !bookingTime) {
            this.showNotification('يرجى اختيار التاريخ والوقت', 'error');
            return;
        }

        if (this.serviceType === 'lab' && !location) {
            this.showNotification('يرجى اختيار المختبر', 'error');
            return;
        }

        this.prepareBookingSummary();
        this.openModal('bookingConfirmationModal');
    }

    prepareBookingSummary() {
        // توليد رقم حجز عشوائي
        const bookingNumber = 'LAB-' + new Date().getFullYear() + '-' + Math.random().toString(36).substr(2, 9).toUpperCase();
        document.getElementById('bookingNumber').textContent = bookingNumber;
        document.getElementById('successBookingNumber').textContent = bookingNumber;

        // تحديث قائمة التحاليل
        const testsList = document.getElementById('bookingTestsList');
        testsList.innerHTML = '';
        
        this.cart.forEach(item => {
            const testItem = document.createElement('div');
            testItem.className = 'test-summary-item';
            testItem.innerHTML = `
                <span>${item.name}</span>
                <span>${item.price} ر.ي</span>
            `;
            testsList.appendChild(testItem);
        });

        // تحديث معلومات الحجز
        const bookingInfo = document.getElementById('bookingInfo');
        bookingInfo.innerHTML = '';
        
        const bookingDate = document.getElementById('bookingDate').value;
        const bookingTime = document.getElementById('bookingTime').value;
        const selectedLab = this.labs.find(l => l.id == document.getElementById('locationSelect').value);

        if (this.serviceType === 'lab') {
            bookingInfo.innerHTML = `
                <div class="booking-info-item">
                    <span>نوع الخدمة:</span>
                    <span>الحضور للمختبر</span>
                </div>
                <div class="booking-info-item">
                    <span>المختبر:</span>
                    <span>${selectedLab ? selectedLab.name : 'غير محدد'}</span>
                </div>
                <div class="booking-info-item">
                    <span>التاريخ والوقت:</span>
                    <span>${bookingDate} - ${bookingTime}</span>
                </div>
                <div class="booking-info-item">
                    <span>رسوم الخدمة:</span>
                    <span>مجاني</span>
                </div>
            `;

            document.getElementById('successBookingDateTime').textContent = `${this.formatDate(bookingDate)} - ${bookingTime}`;
            document.getElementById('successBookingLocation').textContent = selectedLab ? selectedLab.name : 'غير محدد';
        } else {
            bookingInfo.innerHTML = `
                <div class="booking-info-item">
                    <span>نوع الخدمة:</span>
                    <span>خدمة منزلية</span>
                </div>
                <div class="booking-info-item">
                    <span>التاريخ والوقت:</span>
                    <span>${bookingDate} - ${bookingTime}</span>
                </div>
                <div class="booking-info-item">
                    <span>رسوم الخدمة:</span>
                    <span>15 ر.ي</span>
                </div>
            `;

            document.getElementById('successBookingDateTime').textContent = `${this.formatDate(bookingDate)} - ${bookingTime}`;
            document.getElementById('successBookingLocation').textContent = 'المنزل';
        }

        // تحديث معلومات الدفع
        const paymentInfo = document.getElementById('bookingPaymentInfo');
        paymentInfo.innerHTML = '';
        
        let paymentMethodText = '';
        switch (this.paymentMethod) {
            case 'wallet':
                paymentMethodText = 'المحفظة الرقمية';
                break;
            case 'cash':
                paymentMethodText = 'الدفع عند الاستلام';
                break;
            case 'card':
                paymentMethodText = 'البطاقة الائتمانية';
                break;
        }
        
        paymentInfo.innerHTML = `
            <div class="payment-info-item">
                <span>طريقة الدفع:</span>
                <span>${paymentMethodText}</span>
            </div>
        `;

        // تحديث المبلغ الإجمالي
        const subtotal = this.cart.reduce((sum, item) => sum + item.price, 0);
        const serviceFee = this.serviceType === 'home' ? 15 : 0;
        const total = subtotal + serviceFee;
        
        document.getElementById('bookingTotalAmount').textContent = total + ' ر.ي';
        document.getElementById('successBookingAmount').textContent = total + ' ر.ي';
    }

    formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('ar-YE', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }

    confirmBooking() {
        const subtotal = this.cart.reduce((sum, item) => sum + item.price, 0);
        const serviceFee = this.serviceType === 'home' ? 15 : 0;
        const total = subtotal + serviceFee;

        const bookingDate = document.getElementById('bookingDate').value;
        const bookingTime = document.getElementById('bookingTime').value;
        const selectedLab = this.labs.find(l => l.id == document.getElementById('locationSelect').value);
        const notes = document.getElementById('bookingNotes').value;

        // إنشاء الحجز
        const appointment = {
            id: Date.now(),
            number: document.getElementById('bookingNumber').textContent,
            tests: [...this.cart],
            serviceType: this.serviceType,
            lab: selectedLab,
            date: bookingDate,
            time: bookingTime,
            notes: notes,
            paymentMethod: this.paymentMethod,
            total: total,
            status: 'upcoming',
            createdAt: new Date().toISOString()
        };

        // إضافة الحجز إلى القائمة
        this.appointments.unshift(appointment);
        localStorage.setItem('labAppointments', JSON.stringify(this.appointments));

        // تفريغ السلة
        this.cart = [];
        this.updateCartDisplay();

        // إغلاق النافذة الحالية وفتح نافذة النجاح
        this.closeModal('bookingConfirmationModal');
        this.openModal('bookingSuccessModal');

        // تحديث رصيد المحفظة إذا كان الدفع بالمحفظة
        if (this.paymentMethod === 'wallet' && this.userAccount) {
            this.userAccount.balance -= total;
            localStorage.setItem('financialAccount', JSON.stringify(this.userAccount));
            this.updateWalletBalance();
        }

        this.showNotification('تم تأكيد حجزك بنجاح', 'success');
    }

    // تصفية المواعيد حسب الحالة
    filterAppointments(status) {
        this.currentFilter = status;
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        document.querySelector(`.filter-btn[data-status="${status}"]`).classList.add('active');

        this.renderAppointments();
    }

    renderAppointments() {
        const container = document.getElementById('appointmentsList');
        if (!container) return;

        container.innerHTML = '';

        // تصفية المواعيد حسب الحالة
        let filteredAppointments = this.appointments;
        if (this.currentFilter !== 'all') {
            filteredAppointments = this.appointments.filter(appointment => appointment.status === this.currentFilter);
        }

        if (filteredAppointments.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i class="fas fa-calendar" style="font-size: 48px; margin-bottom: 16px;"></i>
                    <div>لا توجد مواعيد ${this.currentFilter !== 'all' ? 'بهذه الحالة' : ''}</div>
                    <p style="font-size: 14px; margin-top: 8px;">${this.currentFilter !== 'all' ? 'جرب اختيار حالة أخرى' : 'يمكنك حجز موعد جديد للتحاليل'}</p>
                </div>
            `;
            return;
        }

        filteredAppointments.forEach(appointment => {
            const appointmentElement = document.createElement('div');
            appointmentElement.className = 'appointment-card';
            
            let statusClass = '';
            let statusText = '';
            
            switch (appointment.status) {
                case 'upcoming':
                    statusClass = 'status-upcoming';
                    statusText = 'قادم';
                    break;
                case 'completed':
                    statusClass = 'status-completed';
                    statusText = 'مكتمل';
                    break;
                case 'cancelled':
                    statusClass = 'status-cancelled';
                    statusText = 'ملغي';
                    break;
            }

            appointmentElement.innerHTML = `
                <div class="appointment-header">
                    <div class="appointment-number">${appointment.number}</div>
                    <div class="appointment-status ${statusClass}">${statusText}</div>
                </div>
                <div class="appointment-details">
                    <div class="appointment-detail">
                        <div class="detail-label">التاريخ</div>
                        <div class="detail-value">${this.formatDate(appointment.date)}</div>
                    </div>
                    <div class="appointment-detail">
                        <div class="detail-label">الوقت</div>
                        <div class="detail-value">${appointment.time}</div>
                    </div>
                    <div class="appointment-detail">
                        <div class="detail-label">المبلغ</div>
                        <div class="detail-value">${appointment.total} ر.ي</div>
                    </div>
                    <div class="appointment-detail">
                        <div class="detail-label">نوع الخدمة</div>
                        <div class="detail-value">${appointment.serviceType === 'lab' ? 'مختبر' : 'منزلي'}</div>
                    </div>
                </div>
                <div class="appointment-tests">
                    <div class="tests-count">${appointment.tests.length} تحليل</div>
                </div>
                <div class="appointment-actions">
                    <button class="action-btn" onclick="labSystem.viewAppointmentDetails(${appointment.id})">
                        <i class="fas fa-eye"></i>
                        تفاصيل
                    </button>
                    ${appointment.status === 'upcoming' ? `
                        <button class="action-btn primary" onclick="labSystem.cancelAppointment(${appointment.id})">
                            <i class="fas fa-times"></i>
                            إلغاء
                        </button>
                    ` : ''}
                    ${appointment.status === 'completed' ? `
                        <button class="action-btn primary" onclick="labSystem.viewTestResults(${appointment.id})">
                            <i class="fas fa-file-medical"></i>
                            النتائج
                        </button>
                    ` : ''}
                </div>
            `;
            
            container.appendChild(appointmentElement);
        });
    }

    viewAppointmentDetails(appointmentId) {
        const appointment = this.appointments.find(a => a.id === appointmentId);
        if (!appointment) return;

        this.createAppointmentDetailsModal(appointment);
        this.openModal('appointmentDetailsModal');
    }

    createAppointmentDetailsModal(appointment) {
        let modal = document.getElementById('appointmentDetailsModal');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'appointmentDetailsModal';
            modal.className = 'modal';
            document.body.appendChild(modal);
        }

        let statusClass = '';
        let statusText = '';
        
        switch (appointment.status) {
            case 'upcoming':
                statusClass = 'status-upcoming';
                statusText = 'قادم';
                break;
            case 'completed':
                statusClass = 'status-completed';
                statusText = 'مكتمل';
                break;
            case 'cancelled':
                statusClass = 'status-cancelled';
                statusText = 'ملغي';
                break;
        }

        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">تفاصيل الموعد</div>
                    <button class="close-modal" onclick="labSystem.closeModal('appointmentDetailsModal')">×</button>
                </div>
                
                <div class="booking-summary">
                    <div class="booking-number ${statusClass}">${appointment.number} - ${statusText}</div>
                    
                    <div class="summary-section">
                        <div class="summary-title">التحاليل المطلوبة</div>
                        <div class="tests-list">
                            ${appointment.tests.map(test => `
                                <div class="test-summary-item">
                                    <span>${test.name}</span>
                                    <span>${test.price} ر.ي</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="summary-section">
                        <div class="summary-title">معلومات الحجز</div>
                        <div class="booking-info">
                            <div class="booking-info-item">
                                <span>نوع الخدمة:</span>
                                <span>${appointment.serviceType === 'lab' ? 'الحضور للمختبر' : 'خدمة منزلية'}</span>
                            </div>
                            <div class="booking-info-item">
                                <span>${appointment.serviceType === 'lab' ? 'المختبر:' : 'موقع الخدمة:'}</span>
                                <span>${appointment.serviceType === 'lab' ? appointment.lab.name : 'المنزل'}</span>
                            </div>
                            <div class="booking-info-item">
                                <span>التاريخ والوقت:</span>
                                <span>${this.formatDate(appointment.date)} - ${appointment.time}</span>
                            </div>
                            <div class="booking-info-item">
                                <span>وقت الإنشاء:</span>
                                <span>${new Date(appointment.createdAt).toLocaleString('ar-YE')}</span>
                            </div>
                        </div>
                    </div>

                    ${appointment.notes ? `
                    <div class="summary-section">
                        <div class="summary-title">ملاحظات</div>
                        <div class="notes-content" style="background: #f8fafc; padding: 15px; border-radius: 10px;">
                            ${appointment.notes}
                        </div>
                    </div>
                    ` : ''}

                    <div class="summary-section">
                        <div class="summary-title">الدفع</div>
                        <div class="payment-info">
                            <div class="payment-info-item">
                                <span>طريقة الدفع:</span>
                                <span>${appointment.paymentMethod === 'cash' ? 'الدفع عند الاستلام' : appointment.paymentMethod === 'wallet' ? 'المحفظة الرقمية' : 'البطاقة الائتمانية'}</span>
                            </div>
                            <div class="payment-info-item">
                                <span>حالة الدفع:</span>
                                <span>${appointment.paymentMethod === 'cash' ? 'سيتم الدفع عند الاستلام' : 'تم الدفع'}</span>
                            </div>
                        </div>
                    </div>

                    <div class="total-amount">
                        <span>المبلغ الإجمالي:</span>
                        <span>${appointment.total} ر.ي</span>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="labSystem.closeModal('appointmentDetailsModal')">
                        إغلاق
                    </button>
                    ${appointment.status === 'upcoming' ? `
                        <button class="btn btn-primary" onclick="labSystem.cancelAppointment(${appointment.id})">
                            <i class="fas fa-times"></i>
                            إلغاء الموعد
                        </button>
                    ` : ''}
                </div>
            </div>
        `;
    }

    cancelAppointment(appointmentId) {
        const appointment = this.appointments.find(a => a.id === appointmentId);
        if (!appointment) return;

        appointment.status = 'cancelled';
        localStorage.setItem('labAppointments', JSON.stringify(this.appointments));
        
        this.closeModal('appointmentDetailsModal');
        this.renderAppointments();
        this.showNotification('تم إلغاء الموعد بنجاح', 'success');
    }

    // نتائج التحاليل
    renderTestResults() {
        const container = document.getElementById('resultsList');
        if (!container) return;

        container.innerHTML = '';

        if (this.testResults.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i class="fas fa-file-medical" style="font-size: 48px; margin-bottom: 16px;"></i>
                    <div>لا توجد نتائج تحاليل</div>
                    <p style="font-size: 14px; margin-top: 8px;">سيظهر هنا نتائج تحاليلك بعد إكمالها</p>
                </div>
            `;
            return;
        }

        this.testResults.forEach(result => {
            const resultElement = document.createElement('div');
            resultElement.className = 'result-card';
            
            resultElement.innerHTML = `
                <div class="result-header">
                    <div class="result-test-name">${result.testName}</div>
                    <div class="result-date">${new Date(result.date).toLocaleDateString('ar-YE')}</div>
                </div>
                <div class="result-details">
                    <div class="result-detail">
                        <div class="detail-label">القيمة</div>
                        <div class="result-value ${result.isNormal ? 'result-normal' : 'result-abnormal'}">
                            ${result.value} ${result.unit}
                        </div>
                    </div>
                    <div class="result-detail">
                        <div class="detail-label">الحالة</div>
                        <div class="result-status ${result.isNormal ? 'result-normal' : 'result-abnormal'}" style="padding: 10px; text-align: center; border-radius: var(--radius-md); font-weight: 700;">
                            ${result.isNormal ? 'طبيعي' : 'غير طبيعي'}
                        </div>
                    </div>
                </div>
                <div class="result-actions">
                    <button class="action-btn" onclick="labSystem.viewResultDetails('${result.id}')">
                        <i class="fas fa-chart-line"></i>
                        التفاصيل الكاملة
                    </button>
                    <button class="action-btn primary" onclick="labSystem.downloadResult('${result.id}')">
                        <i class="fas fa-download"></i>
                        تحميل النتيجة
                    </button>
                </div>
            `;
            
            container.appendChild(resultElement);
        });
    }

    viewResultDetails(resultId) {
        const result = this.testResults.find(r => r.id === resultId);
        if (!result) return;

        this.createResultDetailsModal(result);
        this.openModal('testResultsModal');
    }

    createResultDetailsModal(result) {
        let modal = document.getElementById('testResultsModal');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'testResultsModal';
            modal.className = 'modal';
            document.body.appendChild(modal);
        }

        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">نتيجة التحليل</div>
                    <button class="close-modal" onclick="labSystem.closeModal('testResultsModal')">×</button>
                </div>
                
                <div class="result-details-content">
                    <div class="result-header" style="text-align: center; margin-bottom: 20px;">
                        <div class="result-test-name" style="font-size: 24px; font-weight: 800; color: var(--text-primary);">${result.testName}</div>
                        <div class="result-date" style="color: var(--text-secondary); margin-top: 8px;">${new Date(result.date).toLocaleDateString('ar-YE')}</div>
                    </div>
                    
                    <div class="result-main-value" style="text-align: center; margin: 30px 0;">
                        <div class="value-display ${result.isNormal ? 'result-normal' : 'result-abnormal'}" style="font-size: 32px; font-weight: 800; padding: 20px; border-radius: var(--radius-lg); display: inline-block;">
                            ${result.value} ${result.unit}
                        </div>
                        <div class="value-status" style="margin-top: 10px; font-size: 18px; font-weight: 700;">
                            ${result.isNormal ? '✅ النتيجة ضمن المعدل الطبيعي' : '⚠️ النتيجة خارج المعدل الطبيعي'}
                        </div>
                    </div>
                    
                    <div class="result-ranges" style="background: #f8fafc; padding: 20px; border-radius: var(--radius-lg); margin: 20px 0;">
                        <div class="section-title">المعدلات الطبيعية</div>
                        <div class="range-item" style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e2e8f0;">
                            <span>المعدل الطبيعي:</span>
                            <span style="font-weight: 700;">${result.normalRange}</span>
                        </div>
                        <div class="range-item" style="display: flex; justify-content: space-between; padding: 10px 0;">
                            <span>نطاق الخطر:</span>
                            <span style="font-weight: 700; color: var(--error);">${result.criticalRange || 'غير محدد'}</span>
                        </div>
                    </div>
                    
                    ${result.notes ? `
                    <div class="result-notes" style="background: #fef3c7; padding: 20px; border-radius: var(--radius-lg); margin: 20px 0;">
                        <div class="section-title">ملاحظات الطبيب</div>
                        <p style="margin-top: 10px; line-height: 1.6;">${result.notes}</p>
                    </div>
                    ` : ''}
                    
                    <div class="result-recommendations" style="background: #d1fae5; padding: 20px; border-radius: var(--radius-lg); margin: 20px 0;">
                        <div class="section-title">التوصيات</div>
                        <ul style="margin-top: 10px; padding-right: 20px;">
                            <li>مراجعة الطبيب المختص</li>
                            <li>إعادة التحليل بعد 3 أشهر</li>
                            <li>الالتزام بنظام غذائي صحي</li>
                            ${!result.isNormal ? '<li>المتابعة الدورية مع الطبيب</li>' : ''}
                        </ul>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="labSystem.closeModal('testResultsModal')">
                        إغلاق
                    </button>
                    <button class="btn btn-primary" onclick="labSystem.downloadResult('${result.id}')">
                        <i class="fas fa-download"></i>
                        تحميل التقرير
                    </button>
                </div>
            </div>
        `;
    }

    downloadResult(resultId) {
        this.showNotification('جاري تحميل التقرير...', 'info');
        // محاكاة عملية التحميل
        setTimeout(() => {
            this.showNotification('تم تحميل التقرير بنجاح', 'success');
        }, 2000);
    }

    uploadResults() {
        this.showNotification('سيتم رفع نتائج التحاليل قريباً', 'info');
    }

    requestResults() {
        this.showNotification('تم إرسال طلب النتائج إلى المختبر', 'success');
    }

    updateTime() {
        const timeElement = document.getElementById('currentTime');
        if (timeElement) {
            const now = new Date();
            timeElement.textContent = now.toLocaleTimeString('ar-YE', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
        }
    }

    openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
    }

    closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    }

    showNotification(message, type = 'info') {
        // إنشاء عنصر الإشعار
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `
            <div class="notification-content">
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}-circle"></i>
                <span>${message}</span>
            </div>
        `;

        // إضافة الأنماط
        notification.style.cssText = `
            position: fixed;
            top: 100px;
            right: 20px;
            background: ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--error)' : 'var(--primary)'};
            color: white;
            padding: 15px 20px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-large);
            z-index: 10000;
            animation: slideInRight 0.3s ease-out;
            max-width: 400px;
        `;

        document.body.appendChild(notification);

        // إزالة الإشعار بعد 3 ثوان
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease-in';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }
}

// الدوال العامة
function closeModal(modalId) {
    labSystem.closeModal(modalId);
}

// تهيئة النظام عند تحميل الصفحة
let labSystem;
document.addEventListener('DOMContentLoaded', function() {
    labSystem = new LabSystem();
});

// إضافة أنماط CSS للرسوم المتحركة
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOutRight {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
    
    .notification {
        font-family: 'Tajawal', sans-serif;
        font-weight: 500;
    }
    
    .notification-content {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .notification-content i {
        font-size: 18px;
    }
    
    .fa-liver:before {
        content: "🔬";
    }
    
    .fa-kidneys:before {
        content: "🧫";
    }
    
    .fa-gland:before {
        content: "🦋";
    }
    
    .value-display.result-normal {
        background: #f0fdf4;
        border: 3px solid #bbf7d0;
        color: var(--success);
    }
    
    .value-display.result-abnormal {
        background: #fef2f2;
        border: 3px solid #fecaca;
        color: var(--error);
    }
`;
document.head.appendChild(style);
</script>
</body>
</html>
