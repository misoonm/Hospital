<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الاستشارات الطبية - طبيب 24/7</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e40af;
            --primary-dark: #1e3a8a;
            --primary-light: #dbeafe;
            --secondary: #dc2626;
            --accent: #f59e0b;
            --success: #059669;
            --warning: #d97706;
            --error: #dc2626;
            --dark: #1e1b4b;
            --light: #f0f9ff;
            --surface: #ffffff;
            --glass: rgba(255, 255, 255, 0.25);
            --glass-dark: rgba(255, 255, 255, 0.1);
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-light: #64748b;
            --gradient-primary: linear-gradient(135deg, #1e40af 0%, #3730a3 100%);
            --gradient-hospital: linear-gradient(135deg, #1e40af 0%, #dc2626 100%);
            --gradient-premium: linear-gradient(135deg, #1e40af 0%, #3730a3 50%, #7c3aed 100%);
            --gradient-ai: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
            --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.1);
            --shadow-glass: 0 8px 32px rgba(30, 64, 175, 0.2);
            --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.08);
            --shadow-large: 0 16px 48px rgba(0, 0, 0, 0.15);
            --radius-xl: 24px;
            --radius-lg: 20px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', 'El Messiri', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #dbeafe 100%);
            color: var(--text-primary);
            direction: rtl;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* تصميم شريط الحالة المتميز */
        .status-bar {
            background: transparent;
            color: var(--text-primary);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            font-weight: 500;
            backdrop-filter: blur(20px);
            position: relative;
            z-index: 1000;
        }

        .status-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--glass);
            backdrop-filter: blur(20px);
            z-index: -1;
        }

        /* التطبيق الرئيسي */
        .premium-app {
            max-width: 428px;
            margin: 0 auto;
            background: transparent;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* الخلفية الديناميكية */
        .background-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            background: var(--gradient-primary);
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }

        .shape:nth-child(1) {
            width: 200px;
            height: 200px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 150px;
            height: 150px;
            top: 60%;
            right: 20%;
            animation-delay: 2s;
        }

        .shape:nth-child(3) {
            width: 100px;
            height: 100px;
            bottom: 20%;
            left: 20%;
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* الهيدر المتقدم */
        .consultation-header {
            background: var(--gradient-hospital);
            color: white;
            padding: 40px 24px 30px;
            border-radius: 0 0 var(--radius-xl) var(--radius-xl);
            box-shadow: var(--shadow-glass);
            position: relative;
            overflow: hidden;
        }

        .header-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><polygon fill="rgba(255,255,255,0.05)" points="0,1000 1000,0 1000,1000"/></svg>');
            background-size: cover;
        }

        .header-content {
            position: relative;
            z-index: 2;
            text-align: center;
        }

        .header-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(45deg, #fff, #dbeafe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 25px;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-md);
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        /* المحتوى الرئيسي */
        .consultation-content {
            padding: 25px 20px;
            padding-bottom: 120px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 800;
            margin: 30px 0 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            padding-right: 8px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--gradient-hospital);
            border-radius: 2px;
        }

        /* المساعد الذكي */
        .ai-assistant {
            background: var(--gradient-ai);
            border-radius: var(--radius-lg);
            padding: 25px;
            color: white;
            margin-bottom: 25px;
            box-shadow: var(--shadow-soft);
            position: relative;
            overflow: hidden;
        }

        .ai-assistant::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: 20px 20px;
        }

        .ai-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .ai-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            backdrop-filter: blur(10px);
        }

        .ai-info h3 {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .ai-info p {
            font-size: 14px;
            opacity: 0.9;
        }

        .ai-input-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .ai-input {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-primary);
            font-size: 14px;
        }

        .ai-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5);
        }

        .ai-send-btn {
            background: white;
            color: var(--primary);
            border: none;
            border-radius: var(--radius-md);
            padding: 12px 20px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .ai-send-btn:hover {
            transform: translateY(-2px);
        }

        /* الاستشارة الفورية */
        .quick-consultation {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-card);
            margin-bottom: 25px;
            border: 1px solid #f1f5f9;
        }

        .consultation-types {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .consultation-type {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-md);
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-bounce);
        }

        .consultation-type:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--shadow-soft);
        }

        .consultation-type.active {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .type-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            background: var(--gradient-hospital);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 20px;
            color: white;
        }

        .type-name {
            font-weight: 700;
            margin-bottom: 6px;
            font-size: 14px;
        }

        .type-duration {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* البحث المتقدم */
        .search-section {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-card);
            margin-bottom: 25px;
            border: 1px solid #f1f5f9;
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 15px 50px 15px 15px;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 16px;
            transition: var(--transition-smooth);
        }

        .search-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .search-filters {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .filter-select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        /* التخصصات */
        .specialties-section {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-card);
            margin-bottom: 25px;
            border: 1px solid #f1f5f9;
        }

        .specialties-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .specialty-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-md);
            padding: 20px 12px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .specialty-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .specialty-card.active {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .specialty-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            background: var(--gradient-hospital);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 20px;
            color: white;
        }

        .specialty-name {
            font-weight: 700;
            font-size: 13px;
            margin-bottom: 6px;
        }

        .specialty-count {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* الأطباء */
        .doctors-section {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-card);
            margin-bottom: 25px;
            border: 1px solid #f1f5f9;
        }

        .doctors-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .doctor-card {
            background: #f8fafc;
            border-radius: var(--radius-lg);
            padding: 20px;
            display: flex;
            gap: 15px;
            cursor: pointer;
            transition: var(--transition-bounce);
            border: 2px solid transparent;
        }

        .doctor-card:hover {
            transform: translateX(-8px);
            border-color: var(--primary);
            box-shadow: var(--shadow-soft);
        }

        .doctor-avatar {
            width: 70px;
            height: 70px;
            border-radius: var(--radius-md);
            background: var(--gradient-hospital);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            flex-shrink: 0;
        }

        .doctor-info {
            flex: 1;
        }

        .doctor-name {
            font-weight: 800;
            font-size: 16px;
            margin-bottom: 6px;
        }

        .doctor-specialty {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .doctor-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .stars {
            color: #f59e0b;
        }

        .rating-value {
            font-weight: 700;
            font-size: 14px;
        }

        .rating-count {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .doctor-features {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .feature-tag {
            background: var(--primary-light);
            color: var(--primary);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .doctor-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            justify-content: center;
        }

        .consult-btn {
            background: var(--gradient-hospital);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: var(--radius-md);
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .consult-btn:hover {
            transform: translateY(-2px);
        }

        .price {
            font-weight: 800;
            font-size: 14px;
            color: var(--primary);
            text-align: center;
        }

        /* النوافذ المنبثقة */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-xl);
            padding: 30px;
            max-width: 400px;
            width: 100%;
            box-shadow: var(--shadow-large);
            animation: modalAppear 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 800;
            color: var(--text-primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition-smooth);
        }

        .close-modal:hover {
            color: var(--error);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 16px;
            transition: var(--transition-smooth);
            background: white;
            font-family: 'Tajawal', sans-serif;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 30px;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 800;
            cursor: pointer;
            transition: var(--transition-bounce);
            flex: 1;
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--gradient-hospital);
            color: white;
        }

        .btn-secondary {
            background: var(--light);
            color: var(--text-primary);
            border: 2px solid #e2e8f0;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* تفاصيل الاستشارة */
        .consultation-summary {
            background: #f8fafc;
            border-radius: var(--radius-lg);
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #e2e8f0;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .summary-value {
            font-weight: 700;
            color: var(--text-primary);
        }

        .consultation-number {
            background: var(--primary-light);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: var(--radius-md);
            font-family: monospace;
            font-weight: 700;
            text-align: center;
            margin: 15px 0;
        }

        /* شريط التنقل السفلي */
        .bottom-nav-premium {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            padding: 15px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-soft);
            z-index: 1000;
            max-width: 380px;
            width: calc(100% - 40px);
        }

        .nav-item-premium {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 12px;
            border-radius: var(--radius-md);
            transition: var(--transition-bounce);
            flex: 1;
            position: relative;
            text-decoration: none;
            color: inherit;
        }

        .nav-item-premium.active {
            background: var(--gradient-hospital);
            color: white;
            transform: translateY(-10px);
        }

        .nav-item-premium.active .nav-label {
            color: white;
        }

        .nav-item-premium.active::before {
            content: '';
            position: absolute;
            top: -8px;
            width: 20px;
            height: 3px;
            background: var(--gradient-hospital);
            border-radius: 2px;
        }

        .nav-icon-premium {
            font-size: 20px;
            margin-bottom: 6px;
            transition: var(--transition-smooth);
        }

        .nav-item-premium.active .nav-icon-premium {
            transform: scale(1.2);
        }

        .nav-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* التحميل والحركات */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* الإشعارات */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 16px 24px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-large);
            z-index: 3000;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideDown 0.3s ease-out;
        }

        .notification.error {
            background: var(--error);
        }

        .notification.warning {
            background: var(--warning);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* التكيف مع الشاشات */
        @media (max-width: 428px) {
            .consultation-types {
                grid-template-columns: 1fr;
            }
            
            .specialties-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .search-filters {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .doctor-card {
                flex-direction: column;
                text-align: center;
            }
            
            .doctor-actions {
                flex-direction: row;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- تأثيرات الخلفية الديناميكية -->
    <div class="background-effects">
        <div class="floating-shapes">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
        </div>
    </div>

    <!-- شريط الحالة -->
    <div class="status-bar">
        <div class="status-left">
            <span id="currentTime">2:45</span>
        </div>
        <div class="status-right">
            <i class="fas fa-signal"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-battery-three-quarters"></i>
        </div>
    </div>

    <!-- التطبيق الرئيسي -->
    <div class="premium-app">
        <!-- الهيدر -->
        <div class="consultation-header">
            <div class="header-background"></div>
            <div class="header-content">
                <h1 class="header-title">الاستشارات الطبية</h1>
                <p class="header-subtitle">استشارات طبية فورية مع أفضل الأطباء المتخصصين</p>
                
                <div class="quick-stats">
                    <div class="stat-item">
                        <div class="stat-value">24/7</div>
                        <div class="stat-label">متاح دائماً</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">150+</div>
                        <div class="stat-label">طبيب متخصص</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">4.8</div>
                        <div class="stat-label">تقييم المرضى</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- المحتوى الرئيسي -->
        <div class="consultation-content">
            <!-- المساعد الذكي -->
            <div class="section-title">المساعد الذكي</div>
            <div class="ai-assistant">
                <div class="ai-header">
                    <div class="ai-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="ai-info">
                        <h3>المساعد الطبي الذكي</h3>
                        <p>أساعدك في توجيهك للطبيب المناسب</p>
                    </div>
                </div>
                <div class="ai-input-container">
                    <input type="text" class="ai-input" id="aiQuestion" placeholder="ما هي الأعراض التي تعاني منها؟">
                    <button class="ai-send-btn" onclick="askAI()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- الاستشارة الفورية -->
            <div class="section-title">الاستشارة الفورية</div>
            <div class="quick-consultation">
                <div class="consultation-types">
                    <div class="consultation-type" onclick="selectConsultationType('video')">
                        <div class="type-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="type-name">استشارة فيديو</div>
                        <div class="type-duration">30 دقيقة</div>
                    </div>
                    <div class="consultation-type" onclick="selectConsultationType('voice')">
                        <div class="type-icon">
                            <i class="fas fa-phone-alt"></i>
                        </div>
                        <div class="type-name">استشارة صوتية</div>
                        <div class="type-duration">20 دقيقة</div>
                    </div>
                    <div class="consultation-type" onclick="selectConsultationType('chat')">
                        <div class="type-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="type-name">محادثة نصية</div>
                        <div class="type-duration">مفتوحة</div>
                    </div>
                    <div class="consultation-type" onclick="selectConsultationType('emergency')">
                        <div class="type-icon">
                            <i class="fas fa-ambulance"></i>
                        </div>
                        <div class="type-name">استشارة طارئة</div>
                        <div class="type-duration">فورية</div>
                    </div>
                </div>
            </div>

            <!-- البحث المتقدم -->
            <div class="section-title">البحث عن الأطباء</div>
            <div class="search-section">
                <div class="search-container">
                    <input type="text" class="search-input" id="doctorSearch" placeholder="ابحث عن طبيب أو تخصص...">
                    <i class="fas fa-search search-icon"></i>
                </div>
                <div class="search-filters">
                    <select class="filter-select" id="specialtyFilter">
                        <option value="">جميع التخصصات</option>
                        <option value="cardiology">أمراض القلب</option>
                        <option value="neurology">الأعصاب</option>
                        <option value="pediatrics">طب الأطفال</option>
                        <option value="surgery">الجراحة</option>
                    </select>
                    <select class="filter-select" id="availabilityFilter">
                        <option value="">جميع الأوقات</option>
                        <option value="now">متاح الآن</option>
                        <option value="today">اليوم</option>
                        <option value="week">هذا الأسبوع</option>
                    </select>
                </div>
            </div>

            <!-- التخصصات -->
            <div class="section-title">التخصصات الطبية</div>
            <div class="specialties-section">
                <div class="specialties-grid" id="specialtiesGrid">
                    <!-- سيتم تعبئتها بالجافاسكربت -->
                </div>
            </div>

            <!-- الأطباء -->
            <div class="section-title">الأطباء المتاحون</div>
            <div class="doctors-section">
                <div class="doctors-grid" id="doctorsGrid">
                    <!-- سيتم تعبئتها بالجافاسكربت -->
                </div>
            </div>
        </div>

        <!-- نوافذ منبثقة -->
        
        <!-- نافذة إنشاء استشارة -->
        <div id="createConsultationModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">حجز استشارة طبية</div>
                    <button class="close-modal" onclick="closeModal('createConsultationModal')">×</button>
                </div>
                
                <div class="consultation-summary">
                    <div class="consultation-number" id="consultationNumber">CS-2024-001</div>
                    <div class="summary-item">
                        <span class="summary-label">الطبيب:</span>
                        <span class="summary-value" id="summaryDoctor">د. أحمد محمد</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">نوع الاستشارة:</span>
                        <span class="summary-value" id="summaryType">استشارة فيديو</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">المدة:</span>
                        <span class="summary-value" id="summaryDuration">30 دقيقة</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">التكلفة:</span>
                        <span class="summary-value" id="summaryCost">150 ر.ي</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">تاريخ ووقت الاستشارة *</label>
                    <input type="datetime-local" class="form-input" id="consultationDateTime" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">وصف الحالة *</label>
                    <textarea class="form-textarea" id="consultationDescription" placeholder="صف حالتك الصحية والأعراض التي تعاني منها..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">المرفقات (اختياري)</label>
                    <input type="file" class="form-input" id="consultationAttachments" multiple accept="image/*,.pdf">
                    <small style="color: var(--text-secondary); font-size: 12px;">يمكنك رفع الصور أو التقارير الطبية</small>
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeModal('createConsultationModal')">إلغاء</button>
                    <button class="btn btn-primary" onclick="proceedToPayment()">متابعة للدفع</button>
                </div>
            </div>
        </div>

        <!-- نافذة تأكيد الدفع -->
        <div id="paymentModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">تأكيد الدفع</div>
                    <button class="close-modal" onclick="closeModal('paymentModal')">×</button>
                </div>
                
                <div class="consultation-summary">
                    <div class="consultation-number" id="paymentConsultationNumber">CS-2024-001</div>
                    <div class="summary-item">
                        <span class="summary-label">المبلغ:</span>
                        <span class="summary-value" id="paymentAmount">150 ر.ي</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">الضريبة:</span>
                        <span class="summary-value">0 ر.ي</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">الإجمالي:</span>
                        <span class="summary-value" id="paymentTotal">150 ر.ي</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">طريقة الدفع *</label>
                    <select class="form-select" id="paymentMethod" required>
                        <option value="">اختر طريقة الدفع</option>
                        <option value="wallet">المحفظة الرقمية</option>
                        <option value="card">البطاقة الائتمانية</option>
                        <option value="bank">التحويل البنكي</option>
                    </select>
                </div>
                
                <div id="walletPayment" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">المحفظة</label>
                        <select class="form-select" id="selectedWallet">
                            <option value="">اختر المحفظة</option>
                        </select>
                    </div>
                </div>
                
                <div id="cardPayment" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">البطاقة</label>
                        <select class="form-select" id="selectedCard">
                            <option value="">اختر البطاقة</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">كلمة المرور *</label>
                    <input type="password" class="form-input" id="paymentPassword" placeholder="أدخل كلمة المرور" required>
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeModal('paymentModal')">إلغاء</button>
                    <button class="btn btn-primary" onclick="processPayment()">تأكيد الدفع</button>
                </div>
            </div>
        </div>

        <!-- نافذة تأكيد الحجز -->
        <div id="confirmationModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">تم الحجز بنجاح</div>
                    <button class="close-modal" onclick="closeModal('confirmationModal')">×</button>
                </div>
                
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 64px; color: var(--success); margin-bottom: 20px;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 style="margin-bottom: 10px; color: var(--text-primary);">تم تأكيد حجز الاستشارة</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">سنرسل لك رسالة تأكيد بالتفاصيل</p>
                    
                    <div class="consultation-number pulse" style="font-size: 18px; margin: 20px 0;" id="finalConsultationNumber">CS-2024-001</div>
                    
                    <div class="consultation-summary">
                        <div class="summary-item">
                            <span class="summary-label">الطبيب:</span>
                            <span class="summary-value" id="finalDoctor">د. أحمد محمد</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">الوقت:</span>
                            <span class="summary-value" id="finalDateTime">السبت 15 مارس - 10:00 ص</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">رقم الجلسة:</span>
                            <span class="summary-value" id="finalSessionId">RM-123456</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="closeModal('confirmationModal')">حسناً</button>
                </div>
            </div>
        </div>

        <!-- شريط التنقل السفلي -->
        <div class="bottom-nav-premium">
            <a href="index.html" class="nav-item-premium">
                <div class="nav-icon-premium">
                    <i class="fas fa-home"></i>
                </div>
                <div class="nav-label">الرئيسية</div>
            </a>
            <a href="consultation.html" class="nav-item-premium active">
                <div class="nav-icon-premium">
                    <i class="fas fa-stethoscope"></i>
                </div>
                <div class="nav-label">الاستشارات</div>
            </a>
            <a href="appointments.html" class="nav-item-premium">
                <div class="nav-icon-premium">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="nav-label">المواعيد</div>
            </a>
            <a href="wallet.html" class="nav-item-premium">
                <div class="nav-icon-premium">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="nav-label">المال</div>
            </a>
            <a href="profile.html" class="nav-item-premium">
                <div class="nav-icon-premium">
                    <i class="fas fa-user"></i>
                </div>
                <div class="nav-label">حسابي</div>
            </a>
        </div>
    </div>

    <script>
  // نظام الاستشارات الطبية المتقدم مع التكامل الكامل
class AdvancedConsultationSystem {
    constructor() {
        this.specialties = [];
        this.doctors = [];
        this.consultationTypes = [];
        this.userConsultations = JSON.parse(localStorage.getItem('userConsultations')) || [];
        this.currentConsultation = null;
        this.aiConversation = [];
        this.paymentSystem = new PaymentIntegration();
        this.isAIThinking = false;
        this.init();
    }

    init() {
        this.loadSpecialties();
        this.loadDoctors();
        this.loadConsultationTypes();
        this.setupEventListeners();
        this.updateTime();
        this.loadUserData();
        this.initializeAIAssistant();
        setInterval(() => this.updateTime(), 60000);
    }

    initializeAIAssistant() {
        // رسالة ترحيب أولية من المساعد
        setTimeout(() => {
            this.addAIMessage('مرحباً! أنا المساعد الطبي الذكي. كيف يمكنني مساعدتك اليوم؟');
        }, 2000);
    }

    setupEventListeners() {
        // البحث في الوقت الحقيقي
        const doctorSearch = document.getElementById('doctorSearch');
        if (doctorSearch) {
            doctorSearch.addEventListener('input', (e) => {
                this.handleSearch(e.target.value);
            });
        }

        // الفلاتر
        const specialtyFilter = document.getElementById('specialtyFilter');
        if (specialtyFilter) {
            specialtyFilter.addEventListener('change', () => {
                this.applyFilters();
            });
        }

        const availabilityFilter = document.getElementById('availabilityFilter');
        if (availabilityFilter) {
            availabilityFilter.addEventListener('change', () => {
                this.applyFilters();
            });
        }

        // الذكاء الاصطناعي
        const aiQuestion = document.getElementById('aiQuestion');
        const aiSendBtn = document.querySelector('.ai-send-btn');
        
        if (aiQuestion) {
            aiQuestion.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !this.isAIThinking) {
                    this.askAI();
                }
            });
        }

        if (aiSendBtn) {
            aiSendBtn.addEventListener('click', () => {
                if (!this.isAIThinking) {
                    this.askAI();
                }
            });
        }

        // طرق الدفع
        const paymentMethod = document.getElementById('paymentMethod');
        if (paymentMethod) {
            paymentMethod.addEventListener('change', (e) => {
                this.handlePaymentMethodChange(e.target.value);
            });
        }

        // تأكيد الدفع
        const paymentPassword = document.getElementById('paymentPassword');
        if (paymentPassword) {
            paymentPassword.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    this.processPayment();
                }
            });
        }
    }

    loadUserData() {
        this.userAccount = JSON.parse(localStorage.getItem('financialAccount'));
        this.userWallets = JSON.parse(localStorage.getItem('linkedWallets')) || [];
        this.userCards = JSON.parse(localStorage.getItem('linkedCards')) || [];
    }

    loadSpecialties() {
        this.specialties = [
            {
                id: 1,
                name: 'أمراض القلب',
                icon: 'fa-heartbeat',
                doctorCount: 25,
                color: '#ef4444',
                description: 'تشخيص وعلاج أمراض القلب والشرايين'
            },
            {
                id: 2,
                name: 'الأعصاب',
                icon: 'fa-brain',
                doctorCount: 18,
                color: '#8b5cf6',
                description: 'علاج اضطرابات الجهاز العصبي'
            },
            {
                id: 3,
                name: 'طب الأطفال',
                icon: 'fa-baby',
                doctorCount: 32,
                color: '#3b82f6',
                description: 'رعاية صحية شاملة للأطفال'
            },
            {
                id: 4,
                name: 'الجراحة',
                icon: 'fa-syringe',
                doctorCount: 15,
                color: '#f59e0b',
                description: 'عمليات جراحية وتشخيصية'
            },
            {
                id: 5,
                name: 'العيون',
                icon: 'fa-eye',
                doctorCount: 12,
                color: '#06b6d4',
                description: 'علاج أمراض العيون والرؤية'
            },
            {
                id: 6,
                name: 'الأسنان',
                icon: 'fa-tooth',
                doctorCount: 20,
                color: '#84cc16',
                description: 'عناية شاملة بصحة الفم والأسنان'
            },
            {
                id: 7,
                name: 'الجلدية',
                icon: 'fa-allergies',
                doctorCount: 14,
                color: '#f97316',
                description: 'علاج الأمراض الجلدية والتجميل'
            },
            {
                id: 8,
                name: 'الباطنية',
                icon: 'fa-stethoscope',
                doctorCount: 28,
                color: '#ec4899',
                description: 'تشخيص وعلاج الأمراض الداخلية'
            }
        ];
        this.renderSpecialties();
    }

    loadDoctors() {
        this.doctors = [
            {
                id: 1,
                name: 'د. أحمد محمد',
                specialty: 'أمراض القلب',
                specialtyId: 1,
                rating: 4.8,
                ratingCount: 124,
                experience: '15 سنة',
                price: 150,
                availability: ['now', 'today'],
                features: ['استشارة فيديو', 'استشارة صوتية', 'محادثة نصية'],
                image: '👨‍⚕️',
                bio: 'استشاري أمراض القلب والشرايين، حاصل على البورد الأمريكي',
                education: 'دكتوراه في أمراض القلب - جامعة هارفارد',
                languages: ['العربية', 'الإنجليزية'],
                availableSlots: this.generateTimeSlots(true)
            },
            {
                id: 2,
                name: 'د. سارة خالد',
                specialty: 'طب الأطفال',
                specialtyId: 3,
                rating: 4.9,
                ratingCount: 98,
                experience: '12 سنة',
                price: 120,
                availability: ['today', 'week'],
                features: ['استشارة فيديو', 'محادثة نصية'],
                image: '👩‍⚕️',
                bio: 'استشارية طب الأطفال وحديثي الولادة',
                education: 'ماجستير طب الأطفال - جامعة الملك سعود',
                languages: ['العربية', 'الفرنسية'],
                availableSlots: this.generateTimeSlots(false)
            },
            {
                id: 3,
                name: 'د. محمد علي',
                specialty: 'الأعصاب',
                specialtyId: 2,
                rating: 4.7,
                ratingCount: 87,
                experience: '18 سنة',
                price: 180,
                availability: ['now'],
                features: ['استشارة فيديو', 'استشارة صوتية'],
                image: '👨‍⚕️',
                bio: 'أستاذ مساعد في طب الأعصاب، متخصص في الصداع والألم',
                education: 'بورد الأعصاب - المعهد القومي للأعصاب',
                languages: ['العربية', 'الإنجليزية'],
                availableSlots: this.generateTimeSlots(true)
            },
            {
                id: 4,
                name: 'د. فاطمة عبدالله',
                specialty: 'الأسنان',
                specialtyId: 6,
                rating: 4.6,
                ratingCount: 76,
                experience: '10 سنة',
                price: 100,
                availability: ['today', 'week'],
                features: ['استشارة فيديو'],
                image: '👩‍⚕️',
                bio: 'اختصاصية تجميل وزراعة الأسنان',
                education: 'دبلوم زراعة الأسنان - جامعة القاهرة',
                languages: ['العربية'],
                availableSlots: this.generateTimeSlots(false)
            },
            {
                id: 5,
                name: 'د. خالد إبراهيم',
                specialty: 'الجلدية',
                specialtyId: 7,
                rating: 4.8,
                ratingCount: 112,
                experience: '14 سنة',
                price: 130,
                availability: ['now', 'today'],
                features: ['استشارة فيديو', 'محادثة نصية'],
                image: '👨‍⚕️',
                bio: 'استشاري الأمراض الجلدية والتناسلية',
                education: 'زمالة الأمراض الجلدية - لندن',
                languages: ['العربية', 'الإنجليزية'],
                availableSlots: this.generateTimeSlots(true)
            },
            {
                id: 6,
                name: 'د. منى السيد',
                specialty: 'الباطنية',
                specialtyId: 8,
                rating: 4.9,
                ratingCount: 145,
                experience: '16 سنة',
                price: 140,
                availability: ['today', 'week'],
                features: ['استشارة فيديو', 'استشارة صوتية', 'محادثة نصية'],
                image: '👩‍⚕️',
                bio: 'استشارية الباطنية وأمراض السكري والغدد',
                education: 'دكتوراه الباطنية - جامعة عين شمس',
                languages: ['العربية', 'الإنجليزية'],
                availableSlots: this.generateTimeSlots(false)
            }
        ];
        this.renderDoctors();
    }

    generateTimeSlots(isAvailableNow) {
        const slots = [];
        const now = new Date();
        
        if (isAvailableNow) {
            // إضافة موعد فوري (بعد 15 دقيقة)
            const immediateSlot = new Date(now.getTime() + 15 * 60000);
            slots.push({
                datetime: immediateSlot.toISOString(),
                display: 'فوري (بعد 15 دقيقة)',
                type: 'immediate'
            });
        }

        // إضافة مواعيد اليوم
        for (let i = 1; i <= 3; i++) {
            const slotTime = new Date(now);
            slotTime.setHours(now.getHours() + i * 2);
            slotTime.setMinutes(0);
            
            slots.push({
                datetime: slotTime.toISOString(),
                display: slotTime.toLocaleTimeString('ar-EG', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: true 
                }),
                type: 'today'
            });
        }

        // إضافة مواعيد الأسبوع
        for (let i = 1; i <= 2; i++) {
            const slotDate = new Date(now);
            slotDate.setDate(now.getDate() + i);
            slotDate.setHours(10, 0, 0, 0);
            
            slots.push({
                datetime: slotDate.toISOString(),
                display: slotDate.toLocaleDateString('ar-EG', { 
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true 
                }),
                type: 'week'
            });
        }

        return slots;
    }

    loadConsultationTypes() {
        this.consultationTypes = {
            'video': {
                name: 'استشارة فيديو',
                duration: '30 دقيقة',
                price: 150,
                icon: 'fa-video',
                description: 'مكالمة فيديو مباشرة مع الطبيب'
            },
            'voice': {
                name: 'استشارة صوتية',
                duration: '20 دقيقة',
                price: 120,
                icon: 'fa-phone-alt',
                description: 'مكالمة صوتية مع الطبيب'
            },
            'chat': {
                name: 'محادثة نصية',
                duration: 'مفتوحة',
                price: 80,
                icon: 'fa-comments',
                description: 'محادثة نصية مع الطبيب'
            },
            'emergency': {
                name: 'استشارة طارئة',
                duration: 'فورية',
                price: 200,
                icon: 'fa-ambulance',
                description: 'استشارة طبية فورية وعاجلة'
            }
        };
    }

    renderSpecialties() {
        const container = document.getElementById('specialtiesGrid');
        if (!container) return;

        container.innerHTML = '';

        this.specialties.forEach(specialty => {
            const specialtyElement = document.createElement('div');
            specialtyElement.className = 'specialty-card';
            specialtyElement.onclick = () => this.filterBySpecialty(specialty.id);
            specialtyElement.title = specialty.description;
            
            specialtyElement.innerHTML = `
                <div class="specialty-icon" style="background: ${specialty.color}">
                    <i class="fas ${specialty.icon}"></i>
                </div>
                <div class="specialty-name">${specialty.name}</div>
                <div class="specialty-count">${specialty.doctorCount} طبيب</div>
            `;
            
            container.appendChild(specialtyElement);
        });
    }

    renderDoctors(filteredDoctors = null) {
        const container = document.getElementById('doctorsGrid');
        if (!container) return;

        const doctorsToShow = filteredDoctors || this.doctors;

        if (doctorsToShow.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i class="fas fa-user-md" style="font-size: 48px; margin-bottom: 16px;"></i>
                    <div>لا توجد نتائج</div>
                    <p style="font-size: 14px; margin-top: 8px;">جرب تغيير معايير البحث</p>
                </div>
            `;
            return;
        }

        container.innerHTML = '';

        doctorsToShow.forEach(doctor => {
            const doctorElement = document.createElement('div');
            doctorElement.className = 'doctor-card';
            doctorElement.onclick = () => this.showDoctorDetails(doctor);
            
            const stars = this.generateStars(doctor.rating);
            const availabilityText = this.getAvailabilityText(doctor.availability);
            
            doctorElement.innerHTML = `
                <div class="doctor-avatar">
                    ${doctor.image}
                </div>
                <div class="doctor-info">
                    <div class="doctor-name">${doctor.name}</div>
                    <div class="doctor-specialty">${doctor.specialty} • ${doctor.experience}</div>
                    <div class="doctor-rating">
                        <div class="stars">${stars}</div>
                        <div class="rating-value">${doctor.rating}</div>
                        <div class="rating-count">(${doctor.ratingCount})</div>
                    </div>
                    <div class="doctor-features">
                        ${doctor.features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                    </div>
                    <div style="font-size: 12px; color: var(--success); margin-top: 8px;">
                        <i class="fas fa-circle" style="font-size: 6px;"></i>
                        ${availabilityText}
                    </div>
                </div>
                <div class="doctor-actions">
                    <button class="consult-btn" onclick="event.stopPropagation(); consultationSystem.selectDoctor(${doctor.id})">
                        <i class="fas fa-calendar-plus"></i>
                        حجز استشارة
                    </button>
                    <div class="price">${doctor.price} ر.ي</div>
                </div>
            `;
            
            container.appendChild(doctorElement);
        });
    }

    getAvailabilityText(availability) {
        const texts = {
            'now': 'متاح الآن',
            'today': 'متاح اليوم',
            'week': 'متاح هذا الأسبوع'
        };
        
        return availability.map(a => texts[a]).join(' • ');
    }

    generateStars(rating) {
        const fullStars = Math.floor(rating);
        const halfStar = rating % 1 >= 0.5;
        const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
        
        let stars = '';
        
        for (let i = 0; i < fullStars; i++) {
            stars += '<i class="fas fa-star"></i>';
        }
        
        if (halfStar) {
            stars += '<i class="fas fa-star-half-alt"></i>';
        }
        
        for (let i = 0; i < emptyStars; i++) {
            stars += '<i class="far fa-star"></i>';
        }
        
        return stars;
    }

    showDoctorDetails(doctor) {
        const modalContent = `
            <div class="modal-header">
                <div class="modal-title">تفاصيل الطبيب</div>
                <button class="close-modal" onclick="closeModal('doctorDetailsModal')">×</button>
            </div>
            <div style="text-align: center; padding: 20px;">
                <div class="doctor-avatar" style="width: 100px; height: 100px; font-size: 40px; margin: 0 auto 20px;">
                    ${doctor.image}
                </div>
                <h3 style="margin-bottom: 10px;">${doctor.name}</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">${doctor.specialty}</p>
                
                <div style="background: #f8fafc; border-radius: var(--radius-md); padding: 20px; margin: 20px 0;">
                    <h4 style="margin-bottom: 15px; color: var(--text-primary);">معلومات الطبيب</h4>
                    <div style="text-align: right;">
                        <p><strong>الخبرة:</strong> ${doctor.experience}</p>
                        <p><strong>التعليم:</strong> ${doctor.education}</p>
                        <p><strong>اللغات:</strong> ${doctor.languages.join('، ')}</p>
                        <p><strong>التقييم:</strong> ${doctor.rating} (${doctor.ratingCount} تقييم)</p>
                    </div>
                </div>
                
                <div style="background: #f8fafc; border-radius: var(--radius-md); padding: 20px; margin: 20px 0;">
                    <h4 style="margin-bottom: 15px; color: var(--text-primary);">المواعيد المتاحة</h4>
                    <div style="display: grid; gap: 10px;">
                        ${doctor.availableSlots.map(slot => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: white; border-radius: var(--radius-sm);">
                                <span>${slot.display}</span>
                                <button class="consult-btn" style="padding: 5px 10px; font-size: 12px;" 
                                        onclick="closeModal('doctorDetailsModal'); consultationSystem.selectDoctor(${doctor.id}); consultationSystem.selectTimeSlot('${slot.datetime}')">
                                    اختر
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="closeModal('doctorDetailsModal'); consultationSystem.selectDoctor(${doctor.id})">
                        <i class="fas fa-calendar-plus"></i>
                        حجز استشارة
                    </button>
                </div>
            </div>
        `;

        this.createModal('doctorDetailsModal', modalContent);
        openModal('doctorDetailsModal');
    }

    createModal(modalId, content) {
        let modal = document.getElementById(modalId);
        if (!modal) {
            modal = document.createElement('div');
            modal.id = modalId;
            modal.className = 'modal';
            modal.innerHTML = `<div class="modal-content">${content}</div>`;
            document.body.appendChild(modal);
        } else {
            modal.querySelector('.modal-content').innerHTML = content;
        }
    }

    handleSearch(query) {
        if (query.length >= 2) {
            const filteredDoctors = this.doctors.filter(doctor => 
                doctor.name.includes(query) || 
                doctor.specialty.includes(query) ||
                doctor.bio.includes(query)
            );
            this.renderDoctors(filteredDoctors);
        } else if (query.length === 0) {
            this.renderDoctors();
        }
    }

    applyFilters() {
        const specialty = document.getElementById('specialtyFilter').value;
        const availability = document.getElementById('availabilityFilter').value;
        
        let filteredDoctors = this.doctors;
        
        if (specialty) {
            const specialtyObj = this.specialties.find(s => s.name === specialty);
            if (specialtyObj) {
                filteredDoctors = filteredDoctors.filter(doctor => doctor.specialtyId === specialtyObj.id);
            }
        }
        
        if (availability) {
            filteredDoctors = filteredDoctors.filter(doctor => 
                doctor.availability.includes(availability)
            );
        }
        
        this.renderDoctors(filteredDoctors);
    }

    filterBySpecialty(specialtyId) {
        const filteredDoctors = this.doctors.filter(doctor => doctor.specialtyId === specialtyId);
        this.renderDoctors(filteredDoctors);
        
        // تحديث حالة التخصص النشط
        document.querySelectorAll('.specialty-card').forEach(card => {
            card.classList.remove('active');
        });
        event.target.closest('.specialty-card').classList.add('active');
        
        this.showNotification(`تم عرض أطباء التخصص المحدد`, 'info');
    }

    selectDoctor(doctorId) {
        const doctor = this.doctors.find(d => d.id === doctorId);
        if (!doctor) {
            this.showNotification('الطبيب غير موجود', 'error');
            return;
        }

        this.currentConsultation = {
            doctor: doctor,
            type: null,
            datetime: null,
            description: '',
            attachments: [],
            selectedSlot: null
        };
        
        this.showNotification(`تم اختيار ${doctor.name}`, 'success');
        
        // عرض أنواع الاستشارات
        document.querySelectorAll('.consultation-type').forEach(type => {
            type.classList.remove('active');
        });
    }

    selectTimeSlot(datetime) {
        if (!this.currentConsultation) {
            this.showNotification('يرجى اختيار الطبيب أولاً', 'error');
            return;
        }

        this.currentConsultation.selectedSlot = datetime;
        this.showNotification('تم اختيار الموعد', 'success');
    }

    selectConsultationType(type) {
        if (!this.currentConsultation || !this.currentConsultation.doctor) {
            this.showNotification('يرجى اختيار الطبيب أولاً', 'error');
            return;
        }

        this.currentConsultation.type = type;
        
        // تحديث الواجهة
        document.querySelectorAll('.consultation-type').forEach(element => {
            element.classList.remove('active');
        });
        event.target.closest('.consultation-type').classList.add('active');
        
        this.showNotification(`تم اختيار ${this.consultationTypes[type].name}`, 'success');
        
        // فتح نافذة إنشاء الاستشارة
        this.openCreateConsultationModal();
    }

    openCreateConsultationModal() {
        if (!this.currentConsultation || !this.currentConsultation.doctor || !this.currentConsultation.type) {
            this.showNotification('يرجى اختيار الطبيب ونوع الاستشارة', 'error');
            return;
        }

        const consultationNumber = 'CS-' + new Date().getFullYear() + '-' + String(this.userConsultations.length + 1).padStart(3, '0');
        
        document.getElementById('consultationNumber').textContent = consultationNumber;
        document.getElementById('summaryDoctor').textContent = this.currentConsultation.doctor.name;
        document.getElementById('summaryType').textContent = this.consultationTypes[this.currentConsultation.type].name;
        document.getElementById('summaryDuration').textContent = this.consultationTypes[this.currentConsultation.type].duration;
        document.getElementById('summaryCost').textContent = this.currentConsultation.doctor.price + ' ر.ي';
        
        // تعيين الوقت الافتراضي إذا لم يتم اختيار موعد
        if (!this.currentConsultation.selectedSlot) {
            const now = new Date();
            now.setHours(now.getHours() + 2);
            const defaultDateTime = now.toISOString().slice(0, 16);
            document.getElementById('consultationDateTime').value = defaultDateTime;
        } else {
            document.getElementById('consultationDateTime').value = this.currentConsultation.selectedSlot.slice(0, 16);
        }
        
        openModal('createConsultationModal');
    }

    proceedToPayment() {
        const datetime = document.getElementById('consultationDateTime').value;
        const description = document.getElementById('consultationDescription').value;
        
        if (!datetime || !description) {
            this.showNotification('يرجى ملء جميع الحقول الإلزامية', 'error');
            return;
        }

        this.currentConsultation.datetime = datetime;
        this.currentConsultation.description = description;
        
        // التحقق من رصيد المستخدم
        if (!this.userAccount) {
            this.showNotification('يرجى إنشاء حساب مالي أولاً', 'error');
            setTimeout(() => {
                window.location.href = 'wallet.html';
            }, 2000);
            return;
        }

        if (this.userAccount.balance < this.currentConsultation.doctor.price) {
            this.showNotification('رصيدك غير كافي، يرجى شحن الحساب', 'error');
            setTimeout(() => {
                window.location.href = 'wallet.html';
            }, 2000);
            return;
        }

        // فتح نافذة الدفع
        this.openPaymentModal();
    }

    openPaymentModal() {
        document.getElementById('paymentConsultationNumber').textContent = document.getElementById('consultationNumber').textContent;
        document.getElementById('paymentAmount').textContent = this.currentConsultation.doctor.price + ' ر.ي';
        document.getElementById('paymentTotal').textContent = this.currentConsultation.doctor.price + ' ر.ي';
        
        // تحميل طرق الدفع المتاحة
        this.loadPaymentMethods();
        
        closeModal('createConsultationModal');
        openModal('paymentModal');
    }

    loadPaymentMethods() {
        this.loadUserData();
        
        const walletSelect = document.getElementById('selectedWallet');
        const cardSelect = document.getElementById('selectedCard');
        
        walletSelect.innerHTML = '<option value="">اختر المحفظة</option>';
        cardSelect.innerHTML = '<option value="">اختر البطاقة</option>';
        
        this.userWallets.forEach(wallet => {
            walletSelect.innerHTML += `<option value="${wallet.id}">${wallet.name} - ${wallet.balance} ر.ي</option>`;
        });
        
        this.userCards.forEach(card => {
            cardSelect.innerHTML += `<option value="${card.id}">${card.processor} - ${card.lastFour}</option>`;
        });

        // إذا لم تكن هناك محافظ أو بطاقات، عرض رسالة
        if (this.userWallets.length === 0 && this.userCards.length === 0) {
            document.getElementById('paymentMethod').innerHTML = `
                <option value="">لا توجد طرق دفع متاحة</option>
                <option value="wallet">إنشاء محفظة جديدة</option>
            `;
        }
    }

    handlePaymentMethodChange(method) {
        document.getElementById('walletPayment').style.display = method === 'wallet' ? 'block' : 'none';
        document.getElementById('cardPayment').style.display = method === 'card' ? 'block' : 'none';

        if (method === 'wallet' && this.userWallets.length === 0) {
            this.showNotification('لا توجد محافظ مرتبطة، سيتم توجيهك لإنشاء محفظة', 'info');
            setTimeout(() => {
                window.location.href = 'wallet.html';
            }, 2000);
        }
    }

    async processPayment() {
        const paymentMethod = document.getElementById('paymentMethod').value;
        const password = document.getElementById('paymentPassword').value;
        
        if (!paymentMethod || !password) {
            this.showNotification('يرجى ملء جميع الحقول الإلزامية', 'error');
            return;
        }

        // محاكاة التحقق من كلمة المرور
        if (password !== '1234') { // كلمة مرور افتراضية للاختبار
            this.showNotification('كلمة المرور غير صحيحة', 'error');
            return;
        }

        this.showNotification('جاري معالجة الدفع...', 'info');
        
        try {
            // محاكاة عملية الدفع
            const paymentResult = await this.simulatePayment(paymentMethod);
            
            if (paymentResult.success) {
                this.finalizeConsultation(paymentResult);
            } else {
                this.showNotification(paymentResult.message, 'error');
            }
        } catch (error) {
            this.showNotification('حدث خطأ أثناء المعالجة', 'error');
        }
    }

    simulatePayment(paymentMethod) {
        return new Promise((resolve) => {
            setTimeout(() => {
                const success = Math.random() > 0.1; // 90% success rate
                
                if (success) {
                    resolve({
                        success: true,
                        transactionId: 'TXN' + Date.now(),
                        amount: this.currentConsultation.doctor.price,
                        method: paymentMethod
                    });
                } else {
                    resolve({
                        success: false,
                        message: 'فشل عملية الدفع. يرجى المحاولة مرة أخرى'
                    });
                }
            }, 2000);
        });
    }

    finalizeConsultation(paymentResult) {
        const consultation = {
            id: Date.now(),
            number: document.getElementById('consultationNumber').textContent,
            doctor: this.currentConsultation.doctor,
            type: this.currentConsultation.type,
            datetime: this.currentConsultation.datetime,
            description: this.currentConsultation.description,
            status: 'confirmed',
            sessionId: 'RM-' + Math.random().toString(36).substr(2, 6).toUpperCase(),
            createdAt: new Date().toISOString(),
            price: this.currentConsultation.doctor.price,
            payment: paymentResult,
            roomId: this.generateRoomId()
        };
        
        // تحديث رصيد المستخدم
        if (this.userAccount) {
            this.userAccount.balance -= consultation.price;
            localStorage.setItem('financialAccount', JSON.stringify(this.userAccount));
        }
        
        // إضافة إلى سجل الاستشارات
        this.userConsultations.unshift(consultation);
        localStorage.setItem('userConsultations', JSON.stringify(this.userConsultations));
        
        // إضافة إلى سجل المعاملات
        this.addToTransactionHistory(consultation, paymentResult);
        
        this.showNotification(`تم الدفع بنجاح: ${consultation.price} ر.ي`, 'success');
        
        // عرض تأكيد الحجز
        this.showConfirmationModal(consultation);
        
        closeModal('paymentModal');
    }

    addToTransactionHistory(consultation, paymentResult) {
        const transactions = JSON.parse(localStorage.getItem('financialTransactions')) || [];
        
        const transaction = {
            id: paymentResult.transactionId,
            type: 'consultation',
            title: `استشارة مع ${consultation.doctor.name}`,
            description: `${this.consultationTypes[consultation.type].name} - ${consultation.doctor.specialty}`,
            amount: -consultation.price,
            ref: consultation.number,
            date: new Date().toLocaleDateString('ar-EG'),
            time: new Date().toLocaleTimeString('ar-EG'),
            status: 'completed',
            icon: 'icon-consultation',
            method: paymentResult.method,
            doctor: consultation.doctor.name
        };
        
        transactions.unshift(transaction);
        localStorage.setItem('financialTransactions', JSON.stringify(transactions));
    }

    generateRoomId() {
        return 'room_' + Math.random().toString(36).substr(2, 9);
    }

    showConfirmationModal(consultation) {
        document.getElementById('finalConsultationNumber').textContent = consultation.number;
        document.getElementById('finalDoctor').textContent = consultation.doctor.name;
        
        const date = new Date(consultation.datetime);
        const formattedDate = date.toLocaleDateString('ar-EG', { 
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        document.getElementById('finalDateTime').textContent = formattedDate;
        document.getElementById('finalSessionId').textContent = consultation.sessionId;
        
        openModal('confirmationModal');
    }

    addAIMessage(message, isUser = false) {
        const aiAssistant = document.querySelector('.ai-assistant');
        if (!aiAssistant) return;

        // إنشاء عنصر الرسالة
        const messageElement = document.createElement('div');
        messageElement.className = `ai-message ${isUser ? 'user-message' : 'ai-response'}`;
        messageElement.innerHTML = `
            <div class="message-avatar">
                ${isUser ? '👤' : '🤖'}
            </div>
            <div class="message-content">
                <div class="message-text">${message}</div>
                <div class="message-time">${new Date().toLocaleTimeString('ar-EG', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                })}</div>
            </div>
        `;

        // إضافة الأنماط إذا لم تكن موجودة
        this.addAIMessageStyles();

        // إضافة الرسالة للواجهة
        const messagesContainer = aiAssistant.querySelector('.ai-messages') || this.createAIMessagesContainer(aiAssistant);
        messagesContainer.appendChild(messageElement);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        // حفظ في سجل المحادثة
        this.aiConversation.push({
            type: isUser ? 'user' : 'ai',
            message: message,
            timestamp: new Date()
        });
    }

    addAIMessageStyles() {
        if (document.getElementById('ai-message-styles')) return;

        const styles = `
            <style id="ai-message-styles">
                .ai-messages {
                    max-height: 200px;
                    overflow-y: auto;
                    margin-bottom: 15px;
                    padding: 10px;
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: var(--radius-md);
                }

                .ai-message {
                    display: flex;
                    gap: 10px;
                    margin-bottom: 15px;
                    animation: messageAppear 0.3s ease-out;
                }

                .ai-message.user-message {
                    flex-direction: row-reverse;
                }

                .ai-message.user-message .message-content {
                    background: rgba(255, 255, 255, 0.9);
                    color: var(--text-primary);
                }

                .ai-message.ai-response .message-content {
                    background: rgba(255, 255, 255, 0.2);
                    color: white;
                }

                .message-avatar {
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 16px;
                    flex-shrink: 0;
                }

                .message-content {
                    max-width: 70%;
                    padding: 10px 15px;
                    border-radius: var(--radius-md);
                    position: relative;
                }

                .message-text {
                    margin-bottom: 5px;
                    line-height: 1.4;
                }

                .message-time {
                    font-size: 10px;
                    opacity: 0.7;
                    text-align: left;
                }

                .user-message .message-time {
                    text-align: right;
                }

                .ai-typing {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    color: rgba(255, 255, 255, 0.7);
                    font-style: italic;
                    margin: 10px 0;
                }

                .typing-dots {
                    display: flex;
                    gap: 3px;
                }

                .typing-dots span {
                    width: 6px;
                    height: 6px;
                    border-radius: 50%;
                    background: rgba(255, 255, 255, 0.7);
                    animation: typing 1.4s infinite;
                }

                .typing-dots span:nth-child(2) {
                    animation-delay: 0.2s;
                }

                .typing-dots span:nth-child(3) {
                    animation-delay: 0.4s;
                }

                @keyframes messageAppear {
                    from {
                        opacity: 0;
                        transform: translateY(10px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                @keyframes typing {
                    0%, 60%, 100% {
                        transform: translateY(0);
                    }
                    30% {
                        transform: translateY(-5px);
                    }
                }
            </style>
        `;

        document.head.insertAdjacentHTML('beforeend', styles);
    }

    createAIMessagesContainer(aiAssistant) {
        // البحث عن حقل الإدخال
        const inputContainer = aiAssistant.querySelector('.ai-input-container');
        if (!inputContainer) return null;

        // إنشاء حاوية الرسائل
        const messagesContainer = document.createElement('div');
        messagesContainer.className = 'ai-messages';
        
        // إدراج حاوية الرسائل قبل حقل الإدخال
        inputContainer.parentNode.insertBefore(messagesContainer, inputContainer);
        
        return messagesContainer;
    }

    showAITypingIndicator() {
        const messagesContainer = document.querySelector('.ai-messages');
        if (!messagesContainer) return null;

        const typingElement = document.createElement('div');
        typingElement.className = 'ai-typing';
        typingElement.innerHTML = `
            <div class="message-avatar">🤖</div>
            <div class="message-content">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        `;

        messagesContainer.appendChild(typingElement);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        return typingElement;
    }

    removeAITypingIndicator(typingElement) {
        if (typingElement && typingElement.parentNode) {
            typingElement.parentNode.removeChild(typingElement);
        }
    }

    async askAI() {
        const questionInput = document.getElementById('aiQuestion');
        if (!questionInput) return;

        const question = questionInput.value.trim();
        
        if (!question) {
            this.showNotification('يرجى كتابة سؤالك', 'error');
            return;
        }

        if (this.isAIThinking) {
            this.showNotification('جاري معالجة سؤالك السابق...', 'info');
            return;
        }

        // إضافة سؤال المستخدم للواجهة
        this.addAIMessage(question, true);

        this.isAIThinking = true;
        questionInput.value = '';
        questionInput.disabled = true;

        // عرض مؤشر الكتابة
        const typingIndicator = this.showAITypingIndicator();

        try {
            const response = await this.getAIResponse(question);
            
            // إزالة مؤشر الكتابة
            this.removeAITypingIndicator(typingIndicator);
            
            // إضافة رد المساعد للواجهة
            this.addAIMessage(response.message);
            
            // إذا كان هناك توصية، عرضها بعد قليل
            if (response.recommendation) {
                setTimeout(() => {
                    this.addAIMessage(`💡 ${response.recommendation}`);
                    this.showNotification('قدم المساعد توصية طبية', 'info');
                }, 1000);
            }

            // إذا كانت الحالة طارئة، عرض تحذير
            if (response.urgency === 'high') {
                setTimeout(() => {
                    this.showEmergencyAlert(response);
                }, 1500);
            }
            
        } catch (error) {
            this.removeAITypingIndicator(typingIndicator);
            this.addAIMessage('عذراً، حدث خطأ في المعالجة. يرجى المحاولة مرة أخرى.');
            this.showNotification('حدث خطأ في التحليل', 'error');
        } finally {
            this.isAIThinking = false;
            questionInput.disabled = false;
            questionInput.focus();
        }
    }

    async getAIResponse(question) {
        // محاكاة استجابة الذكاء الاصطناعي مع تحليل حقيقي
        return new Promise((resolve) => {
            setTimeout(() => {
                const symptoms = this.extractSymptoms(question);
                const urgency = this.assessUrgency(symptoms);
                const recommendation = this.generateRecommendation(symptoms, urgency);
                const message = this.generateAIMessage(symptoms, urgency, question);
                
                resolve({
                    message: message,
                    recommendation: recommendation,
                    urgency: urgency,
                    symptoms: symptoms
                });
            }, 3000); // محاكاة وقت المعالجة
        });
    }

    extractSymptoms(question) {
        const symptomKeywords = {
            'heart': ['قلب', 'نوبة', 'ألم في الصدر', 'خفقان', 'ضيق تنفس', 'دوار'],
            'neuro': ['رأس', 'صداع', 'دوار', 'تنميل', 'ذاكرة', 'تركيز', 'أعصاب'],
            'child': ['طفل', 'رضيع', 'حرارة', 'سعال', 'إسهال', 'تقيؤ', 'مغص'],
            'skin': ['جلد', 'حبوب', 'حكة', 'طفح', 'احمرار', 'بثور', 'أكزيما'],
            'internal': ['معدة', 'بطن', 'غثيان', 'تقيؤ', 'إسهال', 'إمساك', 'حرقة'],
            'bones': ['عظام', 'مفاصل', 'ألم', 'تورم', 'التهاب', 'روماتيزم'],
            'emergency': ['طارئ', 'عاجل', 'نزيف', 'صعوبة تنفس', 'فقدان وعي', 'ألم شديد']
        };

        const foundSymptoms = [];
        const lowerQuestion = question.toLowerCase();
        
        for (const [category, keywords] of Object.entries(symptomKeywords)) {
            if (keywords.some(keyword => lowerQuestion.includes(keyword))) {
                foundSymptoms.push(category);
            }
        }

        return foundSymptoms.length > 0 ? foundSymptoms : ['general'];
    }

    assessUrgency(symptoms) {
        const emergencySymptoms = ['نزيف', 'صعوبة تنفس', 'فقدان وعي', 'ألم شديد'];
        const question = document.getElementById('aiQuestion')?.value.toLowerCase() || '';
        
        if (emergencySymptoms.some(symptom => question.includes(symptom))) {
            return 'high';
        }
        if (symptoms.includes('emergency') || symptoms.includes('heart')) {
            return 'high';
        }
        if (symptoms.includes('neuro') || symptoms.length > 2) {
            return 'medium';
        }
        return 'low';
    }

    generateRecommendation(symptoms, urgency) {
        const specialtyMap = {
            'heart': 'أمراض القلب',
            'neuro': 'الأعصاب',
            'child': 'طب الأطفال',
            'skin': 'الجلدية',
            'internal': 'الباطنية',
            'bones': 'العظام',
            'emergency': 'الطوارئ'
        };

        let recommendation = '';
        
        if (urgency === 'high') {
            recommendation = '🚨 حالة طارئة - يرجى استخدام خيار الاستشارة الطارئة أو التوجه لأقرب مستشفى';
        } else {
            const primarySpecialty = symptoms.find(s => s !== 'emergency') || 'general';
            if (specialtyMap[primarySpecialty]) {
                recommendation = `أنصحك باستشارة طبيب ${specialtyMap[primarySpecialty]}`;
            } else {
                recommendation = 'أنصحك باستشارة طبيب عام لتقييم حالتك';
            }
        }

        return recommendation;
    }

    generateAIMessage(symptoms, urgency, originalQuestion) {
        const baseMessages = {
            'high': `🚨 بناءً على وصفك للأعراض، هذه حالة تستدعي عناية طبية عاجلة. 
                    الأعراض التي ذكرتها تشير إلى حالة قد تتطلب تدخلاً فورياً. 
                    أنصحك باستخدام خيار الاستشارة الطارئة أو التوجه لأقرب مركز طبي.`,

            'medium': `🔍 شكراً لوصفك الدقيق للأعراض. 
                      بناءً على المعلومات التي قدمتها، يبدو أن حالتك تستدعي استشارة طبية متخصصة. 
                      أنصحك بحجز استشارة مع الطبيب المختص في أقرب وقت ممكن للمتابعة والتشخيص الدقيق.`,

            'low': `👋 مرحباً! شكراً لمشاركتي أعراضك.
                   بناءً على الوصف الذي قدمته، يبدو أن حالتك قد تستفيد من استشارة طبية. 
                   يمكنني مساعدتك في العثور على الطبيب المناسب أو الإجابة على استفساراتك الطبية العامة.`
        };

        // إضافة معلومات تخصصية حسب الأعراض
        let specializedAdvice = '';
        if (symptoms.includes('heart')) {
            specializedAdvice = '\n\n💓 ملاحظة: الأعراض المتعلقة بالقلب تتطلب تقييماً طبياً دقيقاً.';
        } else if (symptoms.includes('neuro')) {
            specializedAdvice = '\n\n🧠 ملاحظة: الأعراض العصبية تحتاج لمتابعة مع طبيب متخصص.';
        } else if (symptoms.includes('child')) {
            specializedAdvice = '\n\n👶 ملاحظة: صحة الأطفال تحتاج لعناية خاصة ومتابعة منتظمة.';
        }

        return baseMessages[urgency] + specializedAdvice;
    }

    showEmergencyAlert(response) {
        const alertContent = `
            <div class="modal-header" style="border-bottom-color: var(--error);">
                <div class="modal-title" style="color: var(--error);">
                    <i class="fas fa-exclamation-triangle"></i>
                    تنبيه طبي عاجل
                </div>
                <button class="close-modal" onclick="closeModal('emergencyAlert')">×</button>
            </div>
            <div style="padding: 20px; text-align: center;">
                <div style="font-size: 48px; color: var(--error); margin-bottom: 20px;">
                    🚨
                </div>
                <h3 style="color: var(--error); margin-bottom: 15px;">حالة طارئة</h3>
                <p style="margin-bottom: 20px; line-height: 1.6;">
                    بناءً على الأعراض التي وصفتها، هذه حالة تستدعي عناية طبية فورية.
                </p>
                <div style="background: #fef2f2; border: 2px solid var(--error); border-radius: var(--radius-md); padding: 15px; margin: 20px 0;">
                    <h4 style="color: var(--error); margin-bottom: 10px;">الإجراءات الفورية:</h4>
                    <ul style="text-align: right; list-style: none; padding: 0;">
                        <li style="margin-bottom: 8px;">📞 اتصل بالطوارئ (937)</li>
                        <li style="margin-bottom: 8px;">🏥 توجه لأقرب مستشفى</li>
                        <li style="margin-bottom: 8px;">👨‍⚕️ استخدم الاستشارة الطارئة</li>
                    </ul>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeModal('emergencyAlert')" style="background: var(--error);">
                        فهمت
                    </button>
                    <button class="btn btn-primary" onclick="consultationSystem.startEmergencyConsultation()">
                        <i class="fas fa-ambulance"></i>
                        استشارة طارئة
                    </button>
                </div>
            </div>
        `;

        this.createModal('emergencyAlert', alertContent);
        openModal('emergencyAlert');
    }

    startEmergencyConsultation() {
        closeModal('emergencyAlert');
        
        // اختيار طبيب طوارئ تلقائياً
        const emergencyDoctor = this.doctors.find(doctor => 
            doctor.availability.includes('now') && 
            doctor.features.includes('استشارة فيديو')
        );

        if (emergencyDoctor) {
            this.currentConsultation = {
                doctor: emergencyDoctor,
                type: 'emergency',
                datetime: new Date().toISOString(),
                description: 'استشارة طارئة - حالة عاجلة',
                attachments: [],
                isEmergency: true
            };

            this.showNotification(`جاري الاتصال بالدكتور ${emergencyDoctor.name}`, 'info');
            this.openCreateConsultationModal();
        } else {
            this.showNotification('لا يوجد أطباء متاحين حالياً للطوارئ', 'error');
        }
    }

    showNotification(message, type = 'info') {
        // إزالة أي إشعارات سابقة
        const existingNotifications = document.querySelectorAll('.notification');
        existingNotifications.forEach(notification => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        });

        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
            ${message}
        `;
        
        document.body.appendChild(notification);
        
        // إضافة أنماط الرسوم المتحركة إذا لم تكن موجودة
        if (!document.getElementById('notification-styles')) {
            const styles = `
                <style id="notification-styles">
                    .notification {
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        padding: 16px 24px;
                        border-radius: var(--radius-lg);
                        box-shadow: var(--shadow-large);
                        z-index: 3000;
                        font-weight: 700;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        animation: slideDown 0.3s ease-out;
                        max-width: 90%;
                        text-align: center;
                    }

                    .notification.success {
                        background: var(--success);
                        color: white;
                    }

                    .notification.error {
                        background: var(--error);
                        color: white;
                    }

                    .notification.info {
                        background: var(--info);
                        color: white;
                    }

                    @keyframes slideDown {
                        from {
                            opacity: 0;
                            transform: translateX(-50%) translateY(-50px);
                        }
                        to {
                            opacity: 1;
                            transform: translateX(-50%) translateY(0);
                        }
                    }
                </style>
            `;
            document.head.insertAdjacentHTML('beforeend', styles);
        }
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 4000);
    }

    updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('ar-EG', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true 
        });
        
        const timeElement = document.getElementById('currentTime');
        if (timeElement) {
            timeElement.textContent = timeString;
        }
    }
}

// نظام الدفع المتكامل
class PaymentIntegration {
    constructor() {
        this.walletProviders = {
            'jawali': { name: 'جوالي', fee: 0.01 },
            'jeeb': { name: 'جيب', fee: 0.015 },
            'onecash': { name: 'ون كاش', fee: 0.02 }
        };
    }

    async processWalletPayment(walletId, amount, password) {
        return new Promise((resolve) => {
            setTimeout(() => {
                const success = Math.random() > 0.05;
                
                if (success) {
                    resolve({
                        success: true,
                        transactionId: 'W' + Date.now(),
                        amount: amount,
                        fee: this.calculateFee(amount, 'wallet'),
                        netAmount: amount - this.calculateFee(amount, 'wallet')
                    });
                } else {
                    resolve({
                        success: false,
                        message: 'فشل عملية الدفع من المحفظة'
                    });
                }
            }, 1500);
        });
    }

    async processCardPayment(cardId, amount, password) {
        return new Promise((resolve) => {
            setTimeout(() => {
                const success = Math.random() > 0.03;
                
                if (success) {
                    resolve({
                        success: true,
                        transactionId: 'C' + Date.now(),
                        amount: amount,
                        authorizationCode: Math.random().toString(36).substr(2, 8).toUpperCase()
                    });
                } else {
                    resolve({
                        success: false,
                        message: 'فشل عملية الدفع بالبطاقة'
                    });
                }
            }, 2000);
        });
    }

    calculateFee(amount, method) {
        const provider = this.walletProviders[method];
        return provider ? Math.ceil(amount * provider.fee) : 0;
    }
}

// وظائف الواجهة العامة
function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        // إضافة تأثير الظهور
        modal.style.animation = 'modalAppear 0.3s ease-out';
    }
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

function selectConsultationType(type) {
    if (window.consultationSystem) {
        window.consultationSystem.selectConsultationType(type);
    }
}

function askAI() {
    if (window.consultationSystem) {
        window.consultationSystem.askAI();
    }
}

function proceedToPayment() {
    if (window.consultationSystem) {
        window.consultationSystem.proceedToPayment();
    }
}

function processPayment() {
    if (window.consultationSystem) {
        window.consultationSystem.processPayment();
    }
}

// إغلاق النوافذ بالضغط خارجها
document.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
});

// منع إرسال النماذج
document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
        });
    });
});

// تهيئة النظام عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', function() {
    window.consultationSystem = new AdvancedConsultationSystem();
    
    // إضافة تأثيرات تحميل أولية
    setTimeout(() => {
        if (window.consultationSystem) {
            window.consultationSystem.showNotification('مرحباً بك في نظام الاستشارات الطبية!', 'success');
        }
    }, 1000);
});

// جعل النظام متاحاً globally
window.AdvancedConsultationSystem = AdvancedConsultationSystem;
window.PaymentIntegration = PaymentIntegration;
</script>
</body>
</html>