<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>طلبات الصيدليات - طبيب 24/7</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
:root {
    --primary: #1e40af;
    --primary-dark: #1e3a8a;
    --primary-light: #dbeafe;
    --secondary: #dc2626;
    --accent: #f59e0b;
    --success: #059669;
    --warning: #d97706;
    --error: #dc2626;
    --dark: #1e1b4b;
    --light: #f0f9ff;
    --surface: #ffffff;
    --glass: rgba(255, 255, 255, 0.25);
    --glass-dark: rgba(255, 255, 255, 0.1);
    --text-primary: #1e293b;
    --text-secondary: #475569;
    --text-light: #64748b;
    --gradient-primary: linear-gradient(135deg, #1e40af 0%, #3730a3 100%);
    --gradient-hospital: linear-gradient(135deg, #1e40af 0%, #dc2626 100%);
    --gradient-premium: linear-gradient(135deg, #1e40af 0%, #3730a3 50%, #7c3aed 100%);
    --gradient-success: linear-gradient(135deg, #059669 0%, #10b981 100%);
    --gradient-pharmacy: linear-gradient(135deg, #059669 0%, #10b981 100%);
    --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.1);
    --shadow-glass: 0 8px 32px rgba(30, 64, 175, 0.2);
    --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.08);
    --shadow-large: 0 16px 48px rgba(0, 0, 0, 0.15);
    --radius-xl: 24px;
    --radius-lg: 20px;
    --radius-md: 16px;
    --radius-sm: 12px;
    --transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-bounce: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Tajawal', 'El Messiri', sans-serif;
    -webkit-tap-highlight-color: transparent;
}

body {
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #dbeafe 100%);
    color: var(--text-primary);
    direction: rtl;
    overflow-x: hidden;
    min-height: 100vh;
}

/* تصميم شريط الحالة المتميز */
.status-bar {
    background: transparent;
    color: var(--text-primary);
    padding: 12px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    font-weight: 500;
    backdrop-filter: blur(20px);
    position: relative;
    z-index: 1000;
}

.status-bar::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--glass);
    backdrop-filter: blur(20px);
    z-index: -1;
}

/* التطبيق الرئيسي */
.premium-app {
    max-width: 428px;
    margin: 0 auto;
    background: transparent;
    min-height: 100vh;
    position: relative;
    overflow: hidden;
}

/* الخلفية الديناميكية */
.background-effects {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
}

.floating-shapes {
    position: absolute;
    width: 100%;
    height: 100%;
}

.shape {
    position: absolute;
    border-radius: 50%;
    background: var(--gradient-primary);
    opacity: 0.1;
    animation: float 6s ease-in-out infinite;
}

.shape:nth-child(1) {
    width: 200px;
    height: 200px;
    top: 10%;
    left: 10%;
    animation-delay: 0s;
}

.shape:nth-child(2) {
    width: 150px;
    height: 150px;
    top: 60%;
    right: 20%;
    animation-delay: 2s;
}

.shape:nth-child(3) {
    width: 100px;
    height: 100px;
    bottom: 20%;
    left: 20%;
    animation-delay: 4s;
}

@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
}

/* الهيدر المتقدم */
.pharmacy-header {
    background: var(--gradient-pharmacy);
    color: white;
    padding: 40px 24px 30px;
    border-radius: 0 0 var(--radius-xl) var(--radius-xl);
    box-shadow: var(--shadow-glass);
    position: relative;
    overflow: hidden;
}

.header-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><polygon fill="rgba(255,255,255,0.05)" points="0,1000 1000,0 1000,1000"/></svg>');
    background-size: cover;
}

.header-content {
    position: relative;
    z-index: 2;
    text-align: center;
}

.header-title {
    font-size: 28px;
    font-weight: 800;
    margin-bottom: 8px;
    background: linear-gradient(45deg, #fff, #dbeafe);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.header-subtitle {
    font-size: 16px;
    opacity: 0.9;
    margin-bottom: 25px;
}

.quick-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-top: 20px;
}

.stat-item {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-md);
    padding: 15px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.stat-value {
    font-size: 20px;
    font-weight: 800;
    margin-bottom: 4px;
}

.stat-label {
    font-size: 12px;
    opacity: 0.9;
}

/* المحتوى الرئيسي */
.pharmacy-content {
    padding: 25px 20px;
    padding-bottom: 120px;
}

.section-title {
    font-size: 20px;
    font-weight: 800;
    margin: 30px 0 20px;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 12px;
    padding-right: 8px;
}

.section-title::before {
    content: '';
    width: 4px;
    height: 24px;
    background: var(--gradient-pharmacy);
    border-radius: 2px;
}

/* التبويبات */
.pharmacy-tabs {
    display: flex;
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 8px;
    margin-bottom: 25px;
    box-shadow: var(--shadow-card);
    border: 1px solid #f1f5f9;
}

.tab-btn {
    flex: 1;
    padding: 12px 16px;
    border: none;
    background: transparent;
    border-radius: var(--radius-md);
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: var(--transition-smooth);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    color: var(--text-secondary);
}

.tab-btn.active {
    background: var(--gradient-pharmacy);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-soft);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* البحث عن الأدوية */
.search-medicine-section {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
}

.search-container {
    position: relative;
    margin-bottom: 15px;
}

.search-input {
    width: 100%;
    padding: 15px 50px 15px 15px;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    font-size: 16px;
    transition: var(--transition-smooth);
}

.search-input:focus {
    border-color: var(--success);
    outline: none;
    box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
}

.search-icon {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
}

.search-actions {
    display: flex;
    gap: 12px;
}

.scan-btn, .upload-btn {
    flex: 1;
    padding: 12px 16px;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    background: white;
    color: var(--text-primary);
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: var(--transition-smooth);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.scan-btn:hover, .upload-btn:hover {
    border-color: var(--success);
    transform: translateY(-2px);
}

/* الأدوية المقترحة */
.suggested-medicines {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
}

.medicines-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-top: 20px;
}

.medicine-card {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    padding: 20px 15px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition-bounce);
    position: relative;
}

.medicine-card:hover {
    border-color: var(--success);
    transform: translateY(-5px);
    box-shadow: var(--shadow-soft);
}

.medicine-card.added {
    background: var(--primary-light);
    border-color: var(--primary);
}

.medicine-icon {
    width: 60px;
    height: 60px;
    border-radius: var(--radius-md);
    background: var(--gradient-pharmacy);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 12px;
    font-size: 24px;
    color: white;
}

.medicine-name {
    font-weight: 700;
    font-size: 14px;
    margin-bottom: 6px;
    line-height: 1.4;
}

.medicine-scientific {
    font-size: 11px;
    color: var(--text-secondary);
    margin-bottom: 8px;
    line-height: 1.3;
}

.medicine-price {
    font-weight: 800;
    font-size: 16px;
    color: var(--success);
    margin-bottom: 8px;
}

.medicine-availability {
    font-size: 11px;
    color: var(--text-light);
}

.add-to-cart-btn {
    background: var(--gradient-pharmacy);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: var(--radius-sm);
    font-size: 12px;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition-smooth);
    width: 100%;
    margin-top: 8px;
}

.add-to-cart-btn:hover {
    transform: translateY(-2px);
}

.add-to-cart-btn.added {
    background: var(--primary);
}

/* سلة الأدوية */
.cart-section {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
}

.cart-container {
    min-height: 200px;
    margin-bottom: 20px;
}

.empty-cart {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
}

.empty-cart i {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.cart-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: #f8fafc;
    border-radius: var(--radius-md);
    margin-bottom: 12px;
    border: 1px solid #e2e8f0;
}

.cart-item-image {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-sm);
    background: var(--gradient-pharmacy);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
    flex-shrink: 0;
}

.cart-item-details {
    flex: 1;
}

.cart-item-name {
    font-weight: 700;
    font-size: 14px;
    margin-bottom: 4px;
}

.cart-item-price {
    font-weight: 600;
    color: var(--success);
    font-size: 14px;
}

.cart-item-controls {
    display: flex;
    align-items: center;
    gap: 10px;
}

.quantity-controls {
    display: flex;
    align-items: center;
    gap: 8px;
    background: white;
    border-radius: var(--radius-sm);
    padding: 4px;
    border: 1px solid #e2e8f0;
}

.quantity-btn {
    width: 28px;
    height: 28px;
    border: none;
    background: var(--light);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-weight: 700;
    color: var(--primary);
}

.quantity-value {
    min-width: 30px;
    text-align: center;
    font-weight: 700;
    font-size: 14px;
}

.remove-item-btn {
    background: var(--error);
    color: white;
    border: none;
    width: 28px;
    height: 28px;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 12px;
}

.cart-summary {
    background: #f8fafc;
    border-radius: var(--radius-md);
    padding: 20px;
    border: 2px solid var(--success);
}

.summary-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #e2e8f0;
}

.summary-item:last-child {
    border-bottom: none;
}

.summary-item.total {
    font-weight: 800;
    font-size: 18px;
    color: var(--success);
    padding-top: 12px;
    border-top: 2px solid #e2e8f0;
}

/* معلومات التوصيل */
.delivery-section {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
}

.delivery-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
    margin-bottom: 20px;
}

.delivery-option {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: var(--transition-smooth);
}

.delivery-option:hover {
    border-color: var(--success);
    transform: translateX(-5px);
}

.delivery-option.active {
    background: var(--primary-light);
    border-color: var(--primary);
}

.option-icon {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-md);
    background: var(--gradient-pharmacy);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
    flex-shrink: 0;
}

.option-details {
    flex: 1;
}

.option-title {
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 4px;
}

.option-description {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 6px;
}

.option-price {
    font-weight: 800;
    color: var(--success);
    font-size: 16px;
}

.delivery-address, .pickup-location {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #e2e8f0;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 700;
    color: var(--text-primary);
    font-size: 14px;
}

.form-input, .form-select, .form-textarea {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    font-size: 16px;
    transition: var(--transition-smooth);
    background: white;
    font-family: 'Tajawal', sans-serif;
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
    border-color: var(--success);
    outline: none;
    box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
}

.form-textarea {
    resize: vertical;
    min-height: 80px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.pharmacy-info {
    background: #f8fafc;
    border-radius: var(--radius-md);
    padding: 15px;
    margin-top: 15px;
    border: 1px solid #e2e8f0;
}

.info-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    font-size: 14px;
}

.info-item i {
    color: var(--success);
    width: 16px;
}

/* الدفع */
.payment-section {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
}

.payment-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
}

.payment-option {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: var(--transition-smooth);
}

.payment-option:hover {
    border-color: var(--success);
    transform: translateX(-5px);
}

.payment-option.active {
    background: var(--primary-light);
    border-color: var(--primary);
}

.payment-option .option-icon {
    background: var(--gradient-primary);
}

.option-balance {
    font-weight: 600;
    color: var(--success);
    font-size: 14px;
}

/* تأكيد الطلب */
.order-actions {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
    text-align: center;
}

.confirm-order {
    width: 100%;
    padding: 18px 24px;
    font-size: 18px;
    background: var(--gradient-pharmacy);
}

.confirm-order:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-large);
}

/* طلباتي */
.orders-filter {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    overflow-x: auto;
    padding-bottom: 10px;
}

.filter-btn {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    padding: 10px 16px;
    border-radius: var(--radius-md);
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    white-space: nowrap;
    transition: var(--transition-smooth);
}

.filter-btn.active {
    background: var(--gradient-pharmacy);
    color: white;
    border-color: var(--success);
}

.orders-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.order-card {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 20px;
    box-shadow: var(--shadow-card);
    border: 1px solid #f1f5f9;
    transition: var(--transition-smooth);
}

.order-card:hover {
    transform: translateX(-5px);
    box-shadow: var(--shadow-soft);
}

.order-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e2e8f0;
}

.order-number {
    font-weight: 800;
    color: var(--primary);
    font-size: 16px;
}

.order-status {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
}

.status-pending { background: #fef3c7; color: #92400e; }
.status-confirmed { background: #d1fae5; color: #065f46; }
.status-delivered { background: #dcfce7; color: #166534; }
.status-cancelled { background: #fee2e2; color: #991b1b; }

.order-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

.order-detail {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.detail-label {
    font-size: 12px;
    color: var(--text-secondary);
}

.detail-value {
    font-weight: 600;
    font-size: 14px;
}

.order-medicines {
    margin-bottom: 15px;
}

.medicines-count {
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 8px;
}

.order-actions {
    display: flex;
    gap: 10px;
}

.action-btn {
    flex: 1;
    padding: 10px 16px;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    background: white;
    color: var(--text-primary);
    font-weight: 700;
    font-size: 13px;
    cursor: pointer;
    transition: var(--transition-smooth);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.action-btn.primary {
    background: var(--gradient-pharmacy);
    color: white;
    border-color: var(--success);
}

.action-btn:hover {
    transform: translateY(-2px);
}

/* روشتاتي */
.prescriptions-actions {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-card);
    margin-bottom: 25px;
    border: 1px solid #f1f5f9;
    text-align: center;
}

.prescriptions-list {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
}

.prescription-card {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 20px;
    box-shadow: var(--shadow-card);
    border: 1px solid #f1f5f9;
    transition: var(--transition-smooth);
}

.prescription-card:hover {
    transform: translateX(-5px);
    box-shadow: var(--shadow-soft);
}

.prescription-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.prescription-doctor {
    font-weight: 700;
    font-size: 16px;
    color: var(--text-primary);
}

.prescription-date {
    font-size: 13px;
    color: var(--text-secondary);
}

.prescription-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

.prescription-medicines {
    margin-bottom: 15px;
}

.medicines-list {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.6;
}

.prescription-actions {
    display: flex;
    gap: 10px;
}

/* النوافذ المنبثقة */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.modal-content {
    background: white;
    border-radius: var(--radius-xl);
    padding: 30px;
    max-width: 400px;
    width: 100%;
    box-shadow: var(--shadow-large);
    animation: modalAppear 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    max-height: 90vh;
    overflow-y: auto;
}

@keyframes modalAppear {
    from {
        opacity: 0;
        transform: scale(0.8) translateY(50px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.modal-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f1f5f9;
}

.modal-title {
    font-size: 22px;
    font-weight: 800;
    color: var(--text-primary);
}

.close-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--text-secondary);
    transition: var(--transition-smooth);
}

.close-modal:hover {
    color: var(--error);
    transform: rotate(90deg);
}

/* تأكيد الطلب */
.order-summary {
    margin-bottom: 25px;
}

.order-number {
    background: var(--primary-light);
    color: var(--primary);
    padding: 12px;
    border-radius: var(--radius-md);
    font-family: monospace;
    font-weight: 700;
    text-align: center;
    margin-bottom: 20px;
    font-size: 18px;
}

.summary-section {
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e2e8f0;
}

.summary-title {
    font-weight: 700;
    margin-bottom: 12px;
    color: var(--text-primary);
    font-size: 16px;
}

.medicines-list, .delivery-info, .payment-info {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.medicine-summary-item, .delivery-info-item, .payment-info-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #f1f5f9;
}

.medicine-summary-item:last-child, .delivery-info-item:last-child, .payment-info-item:last-child {
    border-bottom: none;
}

.total-amount {
    display: flex;
    justify-content: space-between;
    padding: 15px;
    background: #f8fafc;
    border-radius: var(--radius-md);
    font-weight: 800;
    font-size: 18px;
    color: var(--success);
    border: 2px solid var(--success);
}

.modal-actions {
    display: flex;
    gap: 12px;
}

.modal-actions .btn {
    flex: 1;
}

/* نجاح الطلب */
.success-content {
    text-align: center;
    padding: 20px 0;
}

.success-icon {
    font-size: 64px;
    color: var(--success);
    margin-bottom: 20px;
}

.success-content h3 {
    margin-bottom: 10px;
    color: var(--text-primary);
}

.success-content p {
    color: var(--text-secondary);
    margin-bottom: 20px;
    line-height: 1.6;
}

.order-details {
    background: #f8fafc;
    border-radius: var(--radius-lg);
    padding: 20px;
    margin: 20px 0;
    text-align: right;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #e2e8f0;
}

.detail-item:last-child {
    border-bottom: none;
}

.detail-label {
    font-weight: 600;
    color: var(--text-secondary);
}

.detail-value {
    font-weight: 700;
    color: var(--text-primary);
}

.tracking-info {
    margin: 25px 0;
}

.tracking-steps {
    display: flex;
    justify-content: space-between;
    position: relative;
    padding: 0 20px;
}

.tracking-steps::before {
    content: '';
    position: absolute;
    top: 20px;
    right: 50px;
    left: 50px;
    height: 3px;
    background: #e2e8f0;
    z-index: 1;
}

.tracking-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    z-index: 2;
    position: relative;
    flex: 1;
}

.step-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e2e8f0;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
    transition: var(--transition-smooth);
}

.tracking-step.active .step-icon {
    background: var(--gradient-pharmacy);
    color: white;
    transform: scale(1.1);
}

.step-label {
    font-size: 11px;
    font-weight: 700;
    color: var(--text-secondary);
    text-align: center;
}

.tracking-step.active .step-label {
    color: var(--success);
}

/* رفع الروشتة */
.upload-content {
    text-align: center;
}

.upload-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 25px;
}

.upload-option {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: var(--radius-md);
    padding: 25px 15px;
    cursor: pointer;
    transition: var(--transition-smooth);
}

.upload-option:hover {
    border-color: var(--success);
    transform: translateY(-5px);
}

.upload-option .option-icon {
    font-size: 32px;
    color: var(--success);
    margin-bottom: 12px;
}

.option-title {
    font-weight: 700;
    margin-bottom: 6px;
    font-size: 16px;
}

.option-description {
    font-size: 13px;
    color: var(--text-secondary);
}

.uploaded-prescriptions {
    margin: 20px 0;
}

.prescription-preview {
    background: #f8fafc;
    border-radius: var(--radius-md);
    padding: 15px;
    margin-bottom: 15px;
    border: 2px dashed #e2e8f0;
    text-align: center;
}

.prescription-preview img {
    max-width: 100%;
    border-radius: var(--radius-sm);
    margin-bottom: 10px;
}

.prescription-name {
    font-weight: 700;
    margin-bottom: 5px;
}

.prescription-size {
    font-size: 12px;
    color: var(--text-secondary);
}

.upload-instructions {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: 20px;
    text-align: right;
}

.instructions-title {
    font-weight: 700;
    margin-bottom: 12px;
    color: #92400e;
}

.upload-instructions ul {
    list-style: none;
    padding: 0;
}

.upload-instructions li {
    padding: 6px 0;
    position: relative;
    padding-right: 20px;
}

.upload-instructions li::before {
    content: '•';
    color: #f59e0b;
    font-weight: bold;
    position: absolute;
    right: 0;
}

/* الأزرار */
.btn {
    padding: 14px 24px;
    border: none;
    border-radius: var(--radius-md);
    font-weight: 800;
    cursor: pointer;
    transition: var(--transition-bounce);
    font-size: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: center;
}

.btn-primary {
    background: var(--gradient-pharmacy);
    color: white;
}

.btn-secondary {
    background: var(--light);
    color: var(--text-primary);
    border: 2px solid #e2e8f0;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-soft);
}

.btn:active {
    transform: translateY(0);
}

/* شريط التنقل السفلي */
.bottom-nav-premium {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    display: flex;
    padding: 15px;
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-soft);
    z-index: 1000;
    max-width: 380px;
    width: calc(100% - 40px);
}

.nav-item-premium {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 12px;
    border-radius: var(--radius-md);
    transition: var(--transition-bounce);
    flex: 1;
    position: relative;
    text-decoration: none;
    color: inherit;
}

.nav-item-premium.active {
    background: var(--gradient-pharmacy);
    color: white;
    transform: translateY(-10px);
}

.nav-item-premium.active .nav-label {
    color: white;
}

.nav-item-premium.active::before {
    content: '';
    position: absolute;
    top: -8px;
    width: 20px;
    height: 3px;
    background: var(--gradient-pharmacy);
    border-radius: 2px;
}

.nav-icon-premium {
    font-size: 20px;
    margin-bottom: 6px;
    transition: var(--transition-smooth);
}

.nav-item-premium.active .nav-icon-premium {
    transform: scale(1.2);
}

.nav-label {
    font-size: 11px;
    font-weight: 700;
    color: var(--text-secondary);
}

/* التكيف مع الشاشات */
@media (max-width: 428px) {
    .medicines-grid {
        grid-template-columns: 1fr;
    }
    
    .search-actions {
        flex-direction: column;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .upload-options {
        grid-template-columns: 1fr;
    }
    
    .modal-actions {
        flex-direction: column;
    }
    
    .order-details {
        grid-template-columns: 1fr;
    }
    
    .prescription-details {
        grid-template-columns: 1fr;
    }
    
    .order-actions {
        flex-direction: column;
    }
    
    .prescription-actions {
        flex-direction: column;
    }
    
    .tracking-steps {
        flex-direction: column;
        gap: 20px;
    }
    
    .tracking-steps::before {
        display: none;
    }
}
</style>
</head>
<body>
    <!-- تأثيرات الخلفية الديناميكية -->
    <div class="background-effects">
        <div class="floating-shapes">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
        </div>
    </div>

    <!-- شريط الحالة -->
    <div class="status-bar">
        <div class="status-left">
            <span id="currentTime">2:45</span>
        </div>
        <div class="status-right">
            <i class="fas fa-signal"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-battery-three-quarters"></i>
        </div>
    </div>

    <!-- التطبيق الرئيسي -->
    <div class="premium-app">
        <!-- الهيدر -->
        <div class="pharmacy-header">
            <div class="header-background"></div>
            <div class="header-content">
                <h1 class="header-title">طلبات الصيدليات</h1>
                <p class="header-subtitle">اطلب أدويتك من أفضل الصيدليات مع التوصيل السريع</p>
                
                <div class="quick-stats">
                    <div class="stat-item">
                        <div class="stat-value">100+</div>
                        <div class="stat-label">صيدلية متعاقدة</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">24/7</div>
                        <div class="stat-label">توصيل فوري</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">4.9</div>
                        <div class="stat-label">تقييم العملاء</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- المحتوى الرئيسي -->
        <div class="pharmacy-content">
            <!-- التبويبات -->
            <div class="pharmacy-tabs">
                <button class="tab-btn active" data-tab="new-order">
                    <i class="fas fa-plus-circle"></i>
                    طلب جديد
                </button>
                <button class="tab-btn" data-tab="my-orders">
                    <i class="fas fa-history"></i>
                    طلباتي
                </button>
                <button class="tab-btn" data-tab="prescriptions">
                    <i class="fas fa-file-prescription"></i>
                    روشتاتي
                </button>
            </div>

            <!-- تبويب طلب جديد -->
            <div class="tab-content active" id="new-order">
                <!-- البحث عن الأدوية -->
                <div class="search-medicine-section">
                    <div class="section-title">ابحث عن الأدوية</div>
                    <div class="search-container">
                        <input type="text" class="search-input" id="medicineSearch" placeholder="ابحث عن دواء أو مادة فعالة...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    <div class="search-actions">
                        <button class="scan-btn" onclick="openCameraScanner()">
                            <i class="fas fa-camera"></i>
                            مسح الروشتة
                        </button>
                        <button class="upload-btn" onclick="uploadPrescription()">
                            <i class="fas fa-upload"></i>
                            رفع روشتة
                        </button>
                    </div>
                </div>

                <!-- الأدوية المقترحة -->
                <div class="suggested-medicines">
                    <div class="section-title">أدوية مقترحة لك</div>
                    <div class="medicines-grid" id="suggestedMedicines">
                        <!-- سيتم تعبئتها بالجافاسكربت -->
                    </div>
                </div>

                <!-- سلة الأدوية -->
                <div class="cart-section">
                    <div class="section-title">سلة الأدوية</div>
                    <div class="cart-container" id="cartContainer">
                        <div class="empty-cart">
                            <i class="fas fa-shopping-cart"></i>
                            <p>سلة الأدوية فارغة</p>
                            <small>ابدأ بإضافة الأدوية من القائمة أعلاه</small>
                        </div>
                    </div>
                    
                    <div class="cart-summary" id="cartSummary" style="display: none;">
                        <div class="summary-item">
                            <span>المجموع:</span>
                            <span id="subtotal">0 ر.ي</span>
                        </div>
                        <div class="summary-item">
                            <span>رسوم التوصيل:</span>
                            <span id="deliveryFee">0 ر.ي</span>
                        </div>
                        <div class="summary-item total">
                            <span>الإجمالي:</span>
                            <span id="totalAmount">0 ر.ي</span>
                        </div>
                    </div>
                </div>

                <!-- معلومات التوصيل -->
                <div class="delivery-section">
                    <div class="section-title">معلومات التوصيل</div>
                    <div class="delivery-options">
                        <div class="delivery-option active" data-type="delivery">
                            <div class="option-icon">
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="option-details">
                                <div class="option-title">توصيل إلى العنوان</div>
                                <div class="option-description">توصيل سريع خلال 60 دقيقة</div>
                                <div class="option-price">10 ر.ي</div>
                            </div>
                        </div>
                        <div class="delivery-option" data-type="pickup">
                            <div class="option-icon">
                                <i class="fas fa-store"></i>
                            </div>
                            <div class="option-details">
                                <div class="option-title">استلام من الصيدلية</div>
                                <div class="option-description">استلام شخصي من أقرب صيدلية</div>
                                <div class="option-price">مجاني</div>
                            </div>
                        </div>
                    </div>

                    <div class="delivery-address" id="deliveryAddress">
                        <div class="form-group">
                            <label class="form-label">عنوان التوصيل</label>
                            <input type="text" class="form-input" id="addressInput" placeholder="أدخل عنوان التوصيل التفصيلي">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">المدينة</label>
                                <select class="form-select" id="citySelect">
                                    <option value="sanaa">صنعاء</option>
                                    <option value="aden">عدن</option>
                                    <option value="taiz">تعز</option>
                                    <option value="hodeidah">الحديدة</option>
                                    <option value="ibb">إب</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">الحي</label>
                                <input type="text" class="form-input" id="districtInput" placeholder="اسم الحي">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">تعليمات إضافية</label>
                            <textarea class="form-textarea" id="deliveryNotes" placeholder="أي تعليمات خاصة للتوصيل..." rows="2"></textarea>
                        </div>
                    </div>

                    <div class="pickup-location" id="pickupLocation" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">اختر الصيدلية</label>
                            <select class="form-select" id="pharmacySelect">
                                <option value="">اختر الصيدلية</option>
                            </select>
                        </div>
                        <div class="pharmacy-info" id="selectedPharmacyInfo" style="display: none;">
                            <div class="info-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span id="pharmacyAddress">---</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-clock"></i>
                                <span id="pharmacyHours">---</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-phone"></i>
                                <span id="pharmacyPhone">---</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- الدفع -->
                <div class="payment-section">
                    <div class="section-title">طريقة الدفع</div>
                    <div class="payment-options">
                        <div class="payment-option active" data-method="wallet">
                            <div class="option-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div class="option-details">
                                <div class="option-title">المحفظة الرقمية</div>
                                <div class="option-balance">الرصيد: <span id="walletBalance">0 ر.ي</span></div>
                            </div>
                        </div>
                        <div class="payment-option" data-method="cash">
                            <div class="option-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="option-details">
                                <div class="option-title">الدفع عند الاستلام</div>
                                <div class="option-description">ادفع نقداً عند التوصيل</div>
                            </div>
                        </div>
                        <div class="payment-option" data-method="card">
                            <div class="option-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <div class="option-details">
                                <div class="option-title">البطاقة الائتمانية</div>
                                <div class="option-description">دفع آمن عبر البطاقة</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- تأكيد الطلب -->
                <div class="order-actions">
                    <button class="btn btn-primary confirm-order" id="confirmOrder">
                        <i class="fas fa-shopping-bag"></i>
                        تأكيد الطلب
                    </button>
                </div>
            </div>

            <!-- تبويب طلباتي -->
            <div class="tab-content" id="my-orders">
                <div class="section-title">طلباتي السابقة</div>
                
                <div class="orders-filter">
                    <button class="filter-btn active" data-status="all">الكل</button>
                    <button class="filter-btn" data-status="pending">قيد المعالجة</button>
                    <button class="filter-btn" data-status="confirmed">مؤكدة</button>
                    <button class="filter-btn" data-status="delivered">تم التوصيل</button>
                    <button class="filter-btn" data-status="cancelled">ملغية</button>
                </div>

                <div class="orders-list" id="ordersList">
                    <!-- سيتم تعبئتها بالجافاسكربت -->
                </div>
            </div>

            <!-- تبويب روشتاتي -->
            <div class="tab-content" id="prescriptions">
                <div class="section-title">الروشتات الطبية</div>
                
                <div class="prescriptions-actions">
                    <button class="btn btn-primary" onclick="uploadPrescription()">
                        <i class="fas fa-upload"></i>
                        رفع روشتة جديدة
                    </button>
                </div>

                <div class="prescriptions-list" id="prescriptionsList">
                    <!-- سيتم تعبئتها بالجافاسكربت -->
                </div>
            </div>
        </div>

        <!-- نوافذ منبثقة -->
        
        <!-- نافذة تأكيد الطلب -->
        <div id="orderConfirmationModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">تأكيد الطلب</div>
                    <button class="close-modal" onclick="closeModal('orderConfirmationModal')">×</button>
                </div>
                
                <div class="order-summary">
                    <div class="order-number" id="orderNumber">ORD-2024-001</div>
                    
                    <div class="summary-section">
                        <div class="summary-title">تفاصيل الطلب</div>
                        <div class="medicines-list" id="orderMedicinesList">
                            <!-- سيتم تعبئتها بالجافاسكربت -->
                        </div>
                    </div>

                    <div class="summary-section">
                        <div class="summary-title">معلومات التوصيل</div>
                        <div class="delivery-info" id="orderDeliveryInfo">
                            <!-- سيتم تعبئتها بالجافاسكربت -->
                        </div>
                    </div>

                    <div class="summary-section">
                        <div class="summary-title">الدفع</div>
                        <div class="payment-info" id="orderPaymentInfo">
                            <!-- سيتم تعبئتها بالجافاسكربت -->
                        </div>
                    </div>

                    <div class="total-amount">
                        <span>المبلغ الإجمالي:</span>
                        <span id="orderTotalAmount">0 ر.ي</span>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeModal('orderConfirmationModal')">
                        تعديل الطلب
                    </button>
                    <button class="btn btn-primary" onclick="pharmacySystem.confirmOrder()">
                        <i class="fas fa-check-circle"></i>
                        تأكيد الطلب
                    </button>
                </div>
            </div>
        </div>

        <!-- نافذة نجاح الطلب -->
        <div id="orderSuccessModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">تم استلام طلبك</div>
                    <button class="close-modal" onclick="closeModal('orderSuccessModal')">×</button>
                </div>
                
                <div class="success-content">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>شكراً لطلبك!</h3>
                    <p>تم استلام طلبك بنجاح وسيتم تجهيزه قريباً</p>
                    
                    <div class="order-details">
                        <div class="detail-item">
                            <span class="detail-label">رقم الطلب:</span>
                            <span class="detail-value" id="successOrderNumber">ORD-2024-001</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">وقت التوصيل المتوقع:</span>
                            <span class="detail-value" id="expectedDelivery">60 دقيقة</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">المبلغ:</span>
                            <span class="detail-value" id="successOrderAmount">0 ر.ي</span>
                        </div>
                    </div>

                    <div class="tracking-info">
                        <div class="tracking-steps">
                            <div class="tracking-step active">
                                <div class="step-icon">
                                    <i class="fas fa-shopping-bag"></i>
                                </div>
                                <div class="step-label">تم استلام الطلب</div>
                            </div>
                            <div class="tracking-step">
                                <div class="step-icon">
                                    <i class="fas fa-capsules"></i>
                                </div>
                                <div class="step-label">جاري التجهيز</div>
                            </div>
                            <div class="tracking-step">
                                <div class="step-icon">
                                    <i class="fas fa-motorcycle"></i>
                                </div>
                                <div class="step-label">جاري التوصيل</div>
                            </div>
                            <div class="tracking-step">
                                <div class="step-icon">
                                    <i class="fas fa-home"></i>
                                </div>
                                <div class="step-label">تم التوصيل</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="closeModal('orderSuccessModal'); pharmacySystem.switchTab('my-orders')">
                        <i class="fas fa-history"></i>
                        متابعة الطلب
                    </button>
                    <button class="btn btn-secondary" onclick="closeModal('orderSuccessModal')">
                        <i class="fas fa-shopping-cart"></i>
                        طلب جديد
                    </button>
                </div>
            </div>
        </div>

        <!-- نافذة رفع الروشتة -->
        <div id="uploadPrescriptionModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">رفع روشتة طبية</div>
                    <button class="close-modal" onclick="closeModal('uploadPrescriptionModal')">×</button>
                </div>
                
                <div class="upload-content">
                    <div class="upload-options">
                        <div class="upload-option" onclick="openCameraScanner()">
                            <div class="option-icon">
                                <i class="fas fa-camera"></i>
                            </div>
                            <div class="option-title">التقاط صورة</div>
                            <div class="option-description">التقاط صورة للروشتة</div>
                        </div>
                        <div class="upload-option" onclick="openFilePicker()">
                            <div class="option-icon">
                                <i class="fas fa-folder-open"></i>
                            </div>
                            <div class="option-title">اختيار من الملفات</div>
                            <div class="option-description">رفع صورة مخزنة</div>
                        </div>
                    </div>

                    <div class="uploaded-prescriptions" id="uploadedPrescriptions">
                        <!-- سيتم تعبئتها بالجافاسكربت -->
                    </div>

                    <div class="upload-instructions">
                        <div class="instructions-title">تعليمات الرفع:</div>
                        <ul>
                            <li>تأكد من وضوح الصورة وجميع البيانات</li>
                            <li>يجب أن تكون الروشتة سارية المفعول</li>
                            <li>تأكد من وجود ختم الطبيب وتوقيعه</li>
                            <li>يجب أن تكون تاريخ الروشتة واضحاً</li>
                        </ul>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeModal('uploadPrescriptionModal')">
                        إلغاء
                    </button>
                    <button class="btn btn-primary" onclick="pharmacySystem.processPrescription()">
                        <i class="fas fa-check"></i>
                        تأكيد الرفع
                    </button>
                </div>
            </div>
        </div>

        <!-- شريط التنقل السفلي -->
        <div class="bottom-nav-premium">
            <a href="index.html" class="nav-item-premium">
                <div class="nav-icon-premium">
                    <i class="fas fa-home"></i>
                </div>
                <div class="nav-label">الرئيسية</div>
            </a>
            <a href="consultation.html" class="nav-item-premium">
                <div class="nav-icon-premium">
                    <i class="fas fa-stethoscope"></i>
                </div>
                <div class="nav-label">الاستشارات</div>
            </a>
            <a href="doctor-appointment.html" class="nav-item-premium">
                <div class="nav-icon-premium">
                    <i class="fas fa-user-md"></i>
                </div>
                <div class="nav-label">حجز دكتور</div>
            </a>
            <a href="pharmacy.html" class="nav-item-premium active">
                <div class="nav-icon-premium">
                    <i class="fas fa-prescription-bottle"></i>
                </div>
                <div class="nav-label">الصيدليات</div>
            </a>
            <a href="profile.html" class="nav-item-premium">
                <div class="nav-icon-premium">
                    <i class="fas fa-user"></i>
                </div>
                <div class="nav-label">حسابي</div>
            </a>
        </div>
    </div>

    <script>
  // نظام طلبات الصيدليات المتكامل
class PharmacySystem {
    constructor() {
        this.medicines = [];
        this.pharmacies = [];
        this.cart = [];
        this.orders = JSON.parse(localStorage.getItem('pharmacyOrders')) || [];
        this.prescriptions = JSON.parse(localStorage.getItem('userPrescriptions')) || [];
        this.currentTab = 'new-order';
        this.deliveryType = 'delivery';
        this.paymentMethod = 'wallet';
        this.currentFilter = 'all';
        this.init();
    }

    init() {
        this.loadMedicines();
        this.loadPharmacies();
        this.setupEventListeners();
        this.updateTime();
        this.loadUserData();
        this.updateCartSummary();
        this.setupFileInput();
        setInterval(() => this.updateTime(), 60000);
    }

    setupEventListeners() {
        // التبويبات
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.switchTab(e.currentTarget.dataset.tab);
            });
        });

        // البحث عن الأدوية
        const medicineSearch = document.getElementById('medicineSearch');
        if (medicineSearch) {
            medicineSearch.addEventListener('input', (e) => {
                this.handleMedicineSearch(e.target.value);
            });
        }

        // خيارات التوصيل
        document.querySelectorAll('.delivery-option').forEach(option => {
            option.addEventListener('click', (e) => {
                this.selectDeliveryType(e.currentTarget.dataset.type);
            });
        });

        // خيارات الدفع
        document.querySelectorAll('.payment-option').forEach(option => {
            option.addEventListener('click', (e) => {
                this.selectPaymentMethod(e.currentTarget.dataset.method);
            });
        });

        // تأكيد الطلب
        const confirmOrder = document.getElementById('confirmOrder');
        if (confirmOrder) {
            confirmOrder.addEventListener('click', () => {
                this.showOrderConfirmation();
            });
        }

        // اختيار الصيدلية
        const pharmacySelect = document.getElementById('pharmacySelect');
        if (pharmacySelect) {
            pharmacySelect.addEventListener('change', (e) => {
                this.selectPharmacy(e.target.value);
            });
        }

        // تصفية الطلبات
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.filterOrders(e.currentTarget.dataset.status);
            });
        });

        // تحديث العنوان
        const addressInput = document.getElementById('addressInput');
        if (addressInput) {
            addressInput.addEventListener('input', (e) => {
                this.updateDeliveryAddress(e.target.value);
            });
        }
    }

    setupFileInput() {
        // إنشاء عنصر إدخال الملفات مخفي
        this.fileInput = document.createElement('input');
        this.fileInput.type = 'file';
        this.fileInput.accept = 'image/*,.pdf,.doc,.docx';
        this.fileInput.style.display = 'none';
        this.fileInput.addEventListener('change', (e) => {
            this.handleFileSelect(e);
        });
        document.body.appendChild(this.fileInput);
    }

    loadUserData() {
        this.userAccount = JSON.parse(localStorage.getItem('financialAccount')) || { balance: 500 };
        this.updateWalletBalance();
    }

    updateWalletBalance() {
        const walletBalance = document.getElementById('walletBalance');
        if (walletBalance && this.userAccount) {
            walletBalance.textContent = this.userAccount.balance + ' ر.ي';
        }
    }

    loadMedicines() {
        this.medicines = [
            {
                id: 1,
                name: 'بانادول أزرق',
                scientificName: 'Paracetamol 500mg',
                price: 8,
                image: '💊',
                category: 'مسكنات',
                availability: true,
                description: 'مسكن للألم وخافض للحرارة'
            },
            {
                id: 2,
                name: 'فولتارين',
                scientificName: 'Diclofenac Sodium 50mg',
                price: 12,
                image: '💊',
                category: 'مسكنات',
                availability: true,
                description: 'مسكن للآلام ومضاد للالتهابات'
            },
            {
                id: 3,
                name: 'أموكسيسيلين',
                scientificName: 'Amoxicillin 500mg',
                price: 15,
                image: '💊',
                category: 'مضادات حيوية',
                availability: true,
                description: 'مضاد حيوي لعلاج الالتهابات البكتيرية'
            },
            {
                id: 4,
                name: 'فنتولين',
                scientificName: 'Salbutamol Inhaler',
                price: 25,
                image: '💨',
                category: 'جهاز تنفسي',
                availability: true,
                description: 'موسع للشعب الهوائية'
            },
            {
                id: 5,
                name: 'أدول',
                scientificName: 'Ibuprofen 400mg',
                price: 10,
                image: '💊',
                category: 'مسكنات',
                availability: true,
                description: 'مسكن للآلام ومضاد للالتهابات'
            },
            {
                id: 6,
                name: 'فيتامين سي',
                scientificName: 'Vitamin C 1000mg',
                price: 20,
                image: '🍊',
                category: 'فيتامينات',
                availability: true,
                description: 'مكمل غذائي لتقوية المناعة'
            },
            {
                id: 7,
                name: 'أوميغا 3',
                scientificName: 'Omega-3 1000mg',
                price: 35,
                image: '🐟',
                category: 'مكملات غذائية',
                availability: true,
                description: 'مكمل غذائي لصحة القلب'
            },
            {
                id: 8,
                name: 'كريم هايدروكورتيزون',
                scientificName: 'Hydrocortisone Cream 1%',
                price: 18,
                image: '🧴',
                category: 'مستحضرات جلدية',
                availability: true,
                description: 'كريم لعلاج الالتهابات الجلدية'
            }
        ];
        this.renderSuggestedMedicines();
    }

    loadPharmacies() {
        this.pharmacies = [
            {
                id: 1,
                name: 'صيدلية النخبة',
                address: 'شارع الزبيري، صنعاء',
                phone: '017234567',
                hours: '24/7',
                deliveryFee: 10,
                deliveryTime: '60 دقيقة'
            },
            {
                id: 2,
                name: 'صيدلية الأمل',
                address: 'حي السبعين، صنعاء',
                phone: '017234568',
                hours: '24/7',
                deliveryFee: 8,
                deliveryTime: '45 دقيقة'
            },
            {
                id: 3,
                name: 'صيدلية الحياة',
                address: 'كريتر، عدن',
                phone: '027234569',
                hours: '6:00 ص - 12:00 م',
                deliveryFee: 12,
                deliveryTime: '90 دقيقة'
            },
            {
                id: 4,
                name: 'صيدلية الشفاء',
                address: 'شارع 26 سبتمبر، تعز',
                phone: '047234570',
                hours: '8:00 ص - 11:00 م',
                deliveryFee: 10,
                deliveryTime: '75 دقيقة'
            }
        ];
        this.renderPharmaciesSelect();
    }

    renderSuggestedMedicines() {
        const container = document.getElementById('suggestedMedicines');
        if (!container) return;

        container.innerHTML = '';

        this.medicines.forEach(medicine => {
            const medicineElement = document.createElement('div');
            medicineElement.className = 'medicine-card';
            
            medicineElement.innerHTML = `
                <div class="medicine-icon">${medicine.image}</div>
                <div class="medicine-name">${medicine.name}</div>
                <div class="medicine-scientific">${medicine.scientificName}</div>
                <div class="medicine-price">${medicine.price} ر.ي</div>
                <div class="medicine-availability">${medicine.availability ? 'متوفر' : 'غير متوفر'}</div>
                <button class="add-to-cart-btn" onclick="pharmacySystem.addToCart(${medicine.id})">
                    <i class="fas fa-cart-plus"></i>
                    إضافة إلى السلة
                </button>
            `;
            
            container.appendChild(medicineElement);
        });
    }

    renderPharmaciesSelect() {
        const select = document.getElementById('pharmacySelect');
        if (!select) return;

        select.innerHTML = '<option value="">اختر الصيدلية</option>';
        
        this.pharmacies.forEach(pharmacy => {
            select.innerHTML += `<option value="${pharmacy.id}">${pharmacy.name}</option>`;
        });
    }

    switchTab(tabName) {
        this.currentTab = tabName;
        
        // تحديث التبويبات
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        document.querySelector(`.tab-btn[data-tab="${tabName}"]`).classList.add('active');

        // تحديث المحتوى
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        
        document.getElementById(tabName).classList.add('active');

        // تحميل البيانات إذا لزم الأمر
        if (tabName === 'my-orders') {
            this.renderOrders();
        } else if (tabName === 'prescriptions') {
            this.renderPrescriptions();
        }
    }

    handleMedicineSearch(query) {
        if (query.length >= 2) {
            const filteredMedicines = this.medicines.filter(medicine => 
                medicine.name.includes(query) || 
                medicine.scientificName.includes(query) ||
                medicine.category.includes(query)
            );
            this.renderFilteredMedicines(filteredMedicines);
        } else if (query.length === 0) {
            this.renderSuggestedMedicines();
        }
    }

    renderFilteredMedicines(medicines) {
        const container = document.getElementById('suggestedMedicines');
        if (!container) return;

        if (medicines.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i class="fas fa-search" style="font-size: 48px; margin-bottom: 16px;"></i>
                    <div>لا توجد نتائج</div>
                    <p style="font-size: 14px; margin-top: 8px;">جرب استخدام كلمات بحث مختلفة</p>
                </div>
            `;
            return;
        }

        container.innerHTML = '';

        medicines.forEach(medicine => {
            const medicineElement = document.createElement('div');
            medicineElement.className = 'medicine-card';
            
            medicineElement.innerHTML = `
                <div class="medicine-icon">${medicine.image}</div>
                <div class="medicine-name">${medicine.name}</div>
                <div class="medicine-scientific">${medicine.scientificName}</div>
                <div class="medicine-price">${medicine.price} ر.ي</div>
                <div class="medicine-availability">${medicine.availability ? 'متوفر' : 'غير متوفر'}</div>
                <button class="add-to-cart-btn" onclick="pharmacySystem.addToCart(${medicine.id})">
                    <i class="fas fa-cart-plus"></i>
                    إضافة إلى السلة
                </button>
            `;
            
            container.appendChild(medicineElement);
        });
    }

    addToCart(medicineId) {
        const medicine = this.medicines.find(m => m.id === medicineId);
        if (!medicine) return;

        const existingItem = this.cart.find(item => item.id === medicineId);
        
        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            this.cart.push({
                ...medicine,
                quantity: 1
            });
        }

        this.updateCartDisplay();
        this.showNotification(`${medicine.name} تمت الإضافة إلى السلة`, 'success');
    }

    removeFromCart(medicineId) {
        this.cart = this.cart.filter(item => item.id !== medicineId);
        this.updateCartDisplay();
        this.showNotification('تم إزالة الدواء من السلة', 'warning');
    }

    updateQuantity(medicineId, change) {
        const item = this.cart.find(item => item.id === medicineId);
        if (!item) return;

        item.quantity += change;
        
        if (item.quantity <= 0) {
            this.removeFromCart(medicineId);
        } else {
            this.updateCartDisplay();
        }
    }

    updateCartDisplay() {
        const container = document.getElementById('cartContainer');
        const summary = document.getElementById('cartSummary');
        
        if (!container) return;

        if (this.cart.length === 0) {
            container.innerHTML = `
                <div class="empty-cart">
                    <i class="fas fa-shopping-cart"></i>
                    <p>سلة الأدوية فارغة</p>
                    <small>ابدأ بإضافة الأدوية من القائمة أعلاه</small>
                </div>
            `;
            if (summary) summary.style.display = 'none';
            return;
        }

        container.innerHTML = '';
        
        this.cart.forEach(item => {
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item';
            cartItem.innerHTML = `
                <div class="cart-item-image">${item.image}</div>
                <div class="cart-item-details">
                    <div class="cart-item-name">${item.name}</div>
                    <div class="cart-item-price">${item.price} ر.ي</div>
                </div>
                <div class="cart-item-controls">
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="pharmacySystem.updateQuantity(${item.id}, -1)">-</button>
                        <span class="quantity-value">${item.quantity}</span>
                        <button class="quantity-btn" onclick="pharmacySystem.updateQuantity(${item.id}, 1)">+</button>
                    </div>
                    <button class="remove-item-btn" onclick="pharmacySystem.removeFromCart(${item.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(cartItem);
        });

        if (summary) {
            summary.style.display = 'block';
            this.updateCartSummary();
        }
    }

    updateCartSummary() {
        const subtotal = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const deliveryFee = this.deliveryType === 'delivery' ? 10 : 0;
        const total = subtotal + deliveryFee;

        const subtotalElement = document.getElementById('subtotal');
        const deliveryFeeElement = document.getElementById('deliveryFee');
        const totalElement = document.getElementById('totalAmount');

        if (subtotalElement) subtotalElement.textContent = subtotal + ' ر.ي';
        if (deliveryFeeElement) deliveryFeeElement.textContent = deliveryFee + ' ر.ي';
        if (totalElement) totalElement.textContent = total + ' ر.ي';
    }

    selectDeliveryType(type) {
        this.deliveryType = type;
        
        // تحديث الواجهة
        document.querySelectorAll('.delivery-option').forEach(option => {
            option.classList.remove('active');
        });
        
        document.querySelector(`.delivery-option[data-type="${type}"]`).classList.add('active');

        // إظهار/إخفاء الأقسام المناسبة
        const deliveryAddress = document.getElementById('deliveryAddress');
        const pickupLocation = document.getElementById('pickupLocation');
        
        if (type === 'delivery') {
            if (deliveryAddress) deliveryAddress.style.display = 'block';
            if (pickupLocation) pickupLocation.style.display = 'none';
        } else {
            if (deliveryAddress) deliveryAddress.style.display = 'none';
            if (pickupLocation) pickupLocation.style.display = 'block';
        }

        this.updateCartSummary();
    }

    selectPaymentMethod(method) {
        this.paymentMethod = method;
        
        document.querySelectorAll('.payment-option').forEach(option => {
            option.classList.remove('active');
        });
        
        document.querySelector(`.payment-option[data-method="${method}"]`).classList.add('active');
    }

    selectPharmacy(pharmacyId) {
        const pharmacy = this.pharmacies.find(p => p.id == pharmacyId);
        if (!pharmacy) return;

        const infoContainer = document.getElementById('selectedPharmacyInfo');
        if (!infoContainer) return;

        document.getElementById('pharmacyAddress').textContent = pharmacy.address;
        document.getElementById('pharmacyHours').textContent = pharmacy.hours;
        document.getElementById('pharmacyPhone').textContent = pharmacy.phone;
        
        infoContainer.style.display = 'block';
    }

    updateDeliveryAddress(address) {
        this.deliveryAddress = address;
    }

    showOrderConfirmation() {
        if (this.cart.length === 0) {
            this.showNotification('يرجى إضافة أدوية إلى السلة أولاً', 'error');
            return;
        }

        if (this.deliveryType === 'delivery' && (!this.deliveryAddress || this.deliveryAddress.trim() === '')) {
            this.showNotification('يرجى إدخال عنوان التوصيل', 'error');
            return;
        }

        if (this.deliveryType === 'pickup' && !document.getElementById('pharmacySelect').value) {
            this.showNotification('يرجى اختيار صيدلية', 'error');
            return;
        }

        this.prepareOrderSummary();
        this.openModal('orderConfirmationModal');
    }

    prepareOrderSummary() {
        // توليد رقم طلب عشوائي
        const orderNumber = 'ORD-' + new Date().getFullYear() + '-' + Math.random().toString(36).substr(2, 9).toUpperCase();
        document.getElementById('orderNumber').textContent = orderNumber;
        document.getElementById('successOrderNumber').textContent = orderNumber;

        // تحديث قائمة الأدوية
        const medicinesList = document.getElementById('orderMedicinesList');
        medicinesList.innerHTML = '';
        
        this.cart.forEach(item => {
            const medicineItem = document.createElement('div');
            medicineItem.className = 'medicine-summary-item';
            medicineItem.innerHTML = `
                <span>${item.name} × ${item.quantity}</span>
                <span>${item.price * item.quantity} ر.ي</span>
            `;
            medicinesList.appendChild(medicineItem);
        });

        // تحديث معلومات التوصيل
        const deliveryInfo = document.getElementById('orderDeliveryInfo');
        deliveryInfo.innerHTML = '';
        
        if (this.deliveryType === 'delivery') {
            deliveryInfo.innerHTML = `
                <div class="delivery-info-item">
                    <span>طريقة التوصيل:</span>
                    <span>توصيل إلى العنوان</span>
                </div>
                <div class="delivery-info-item">
                    <span>العنوان:</span>
                    <span>${this.deliveryAddress || 'غير محدد'}</span>
                </div>
                <div class="delivery-info-item">
                    <span>رسوم التوصيل:</span>
                    <span>10 ر.ي</span>
                </div>
            `;
        } else {
            const selectedPharmacy = this.pharmacies.find(p => p.id == document.getElementById('pharmacySelect').value);
            deliveryInfo.innerHTML = `
                <div class="delivery-info-item">
                    <span>طريقة التوصيل:</span>
                    <span>استلام من الصيدلية</span>
                </div>
                <div class="delivery-info-item">
                    <span>الصيدلية:</span>
                    <span>${selectedPharmacy ? selectedPharmacy.name : 'غير محددة'}</span>
                </div>
                <div class="delivery-info-item">
                    <span>رسوم التوصيل:</span>
                    <span>مجاني</span>
                </div>
            `;
        }

        // تحديث معلومات الدفع
        const paymentInfo = document.getElementById('orderPaymentInfo');
        paymentInfo.innerHTML = '';
        
        let paymentMethodText = '';
        switch (this.paymentMethod) {
            case 'wallet':
                paymentMethodText = 'المحفظة الرقمية';
                break;
            case 'cash':
                paymentMethodText = 'الدفع عند الاستلام';
                break;
            case 'card':
                paymentMethodText = 'البطاقة الائتمانية';
                break;
        }
        
        paymentInfo.innerHTML = `
            <div class="payment-info-item">
                <span>طريقة الدفع:</span>
                <span>${paymentMethodText}</span>
            </div>
        `;

        // تحديث المبلغ الإجمالي
        const subtotal = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const deliveryFee = this.deliveryType === 'delivery' ? 10 : 0;
        const total = subtotal + deliveryFee;
        
        document.getElementById('orderTotalAmount').textContent = total + ' ر.ي';
        document.getElementById('successOrderAmount').textContent = total + ' ر.ي';
        
        // تحديث وقت التوصيل المتوقع
        const expectedDelivery = this.deliveryType === 'delivery' ? '60 دقيقة' : 'جاهز للاستلام';
        document.getElementById('expectedDelivery').textContent = expectedDelivery;
    }

    confirmOrder() {
        const subtotal = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const deliveryFee = this.deliveryType === 'delivery' ? 10 : 0;
        const total = subtotal + deliveryFee;

        // إنشاء الطلب
        const order = {
            id: Date.now(),
            number: document.getElementById('orderNumber').textContent,
            medicines: [...this.cart],
            deliveryType: this.deliveryType,
            deliveryAddress: this.deliveryAddress,
            paymentMethod: this.paymentMethod,
            total: total,
            status: 'pending',
            createdAt: new Date().toISOString(),
            estimatedDelivery: this.deliveryType === 'delivery' ? '60 دقيقة' : 'جاهز للاستلام'
        };

        // إضافة الطلب إلى القائمة
        this.orders.unshift(order);
        localStorage.setItem('pharmacyOrders', JSON.stringify(this.orders));

        // تفريغ السلة
        this.cart = [];
        this.updateCartDisplay();

        // إغلاق النافذة الحالية وفتح نافذة النجاح
        this.closeModal('orderConfirmationModal');
        this.openModal('orderSuccessModal');

        // تحديث رصيد المحفظة إذا كان الدفع بالمحفظة
        if (this.paymentMethod === 'wallet' && this.userAccount) {
            this.userAccount.balance -= total;
            localStorage.setItem('financialAccount', JSON.stringify(this.userAccount));
            this.updateWalletBalance();
        }

        this.showNotification('تم تأكيد طلبك بنجاح', 'success');
    }

    // 1. تصفية الطلبات حسب الحالة - وظيفة حقيقية
    filterOrders(status) {
        this.currentFilter = status;
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        document.querySelector(`.filter-btn[data-status="${status}"]`).classList.add('active');

        this.renderOrders();
    }

    renderOrders() {
        const container = document.getElementById('ordersList');
        if (!container) return;

        container.innerHTML = '';

        // تصفية الطلبات حسب الحالة
        let filteredOrders = this.orders;
        if (this.currentFilter !== 'all') {
            filteredOrders = this.orders.filter(order => order.status === this.currentFilter);
        }

        if (filteredOrders.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i class="fas fa-history" style="font-size: 48px; margin-bottom: 16px;"></i>
                    <div>لا توجد طلبات ${this.currentFilter !== 'all' ? 'بهذه الحالة' : 'سابقة'}</div>
                    <p style="font-size: 14px; margin-top: 8px;">${this.currentFilter !== 'all' ? 'جرب اختيار حالة أخرى' : 'يمكنك البدء بطلب أدوية جديدة'}</p>
                </div>
            `;
            return;
        }

        filteredOrders.forEach(order => {
            const orderElement = document.createElement('div');
            orderElement.className = 'order-card';
            
            let statusClass = '';
            let statusText = '';
            
            switch (order.status) {
                case 'pending':
                    statusClass = 'status-pending';
                    statusText = 'قيد المعالجة';
                    break;
                case 'confirmed':
                    statusClass = 'status-confirmed';
                    statusText = 'مؤكدة';
                    break;
                case 'delivered':
                    statusClass = 'status-delivered';
                    statusText = 'تم التوصيل';
                    break;
                case 'cancelled':
                    statusClass = 'status-cancelled';
                    statusText = 'ملغية';
                    break;
            }

            orderElement.innerHTML = `
                <div class="order-header">
                    <div class="order-number">${order.number}</div>
                    <div class="order-status ${statusClass}">${statusText}</div>
                </div>
                <div class="order-details">
                    <div class="order-detail">
                        <div class="detail-label">التاريخ</div>
                        <div class="detail-value">${new Date(order.createdAt).toLocaleDateString('ar-YE')}</div>
                    </div>
                    <div class="order-detail">
                        <div class="detail-label">المبلغ</div>
                        <div class="detail-value">${order.total} ر.ي</div>
                    </div>
                    <div class="order-detail">
                        <div class="detail-label">طريقة التوصيل</div>
                        <div class="detail-value">${order.deliveryType === 'delivery' ? 'توصيل' : 'استلام'}</div>
                    </div>
                    <div class="order-detail">
                        <div class="detail-label">الدفع</div>
                        <div class="detail-value">${order.paymentMethod === 'cash' ? 'نقدي' : 'إلكتروني'}</div>
                    </div>
                </div>
                <div class="order-medicines">
                    <div class="medicines-count">${order.medicines.length} دواء</div>
                </div>
                <div class="order-actions">
                    <button class="action-btn" onclick="pharmacySystem.viewOrderDetails(${order.id})">
                        <i class="fas fa-eye"></i>
                        تفاصيل
                    </button>
                    ${order.status === 'pending' || order.status === 'confirmed' ? `
                        <button class="action-btn primary" onclick="pharmacySystem.trackOrder(${order.id})">
                            <i class="fas fa-map-marker-alt"></i>
                            تتبع الطلب
                        </button>
                    ` : ''}
                </div>
            `;
            
            container.appendChild(orderElement);
        });
    }

    // 2. فتح نافذة تفاصيل الطلب - وظيفة حقيقية
    viewOrderDetails(orderId) {
        const order = this.orders.find(o => o.id === orderId);
        if (!order) return;

        this.createOrderDetailsModal(order);
        this.openModal('orderDetailsModal');
    }

    createOrderDetailsModal(order) {
        // إنشاء نافذة تفاصيل الطلب
        let modal = document.getElementById('orderDetailsModal');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'orderDetailsModal';
            modal.className = 'modal';
            document.body.appendChild(modal);
        }

        let statusClass = '';
        let statusText = '';
        
        switch (order.status) {
            case 'pending':
                statusClass = 'status-pending';
                statusText = 'قيد المعالجة';
                break;
            case 'confirmed':
                statusClass = 'status-confirmed';
                statusText = 'مؤكدة';
                break;
            case 'delivered':
                statusClass = 'status-delivered';
                statusText = 'تم التوصيل';
                break;
            case 'cancelled':
                statusClass = 'status-cancelled';
                statusText = 'ملغية';
                break;
        }

        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">تفاصيل الطلب</div>
                    <button class="close-modal" onclick="pharmacySystem.closeModal('orderDetailsModal')">×</button>
                </div>
                
                <div class="order-summary">
                    <div class="order-number ${statusClass}">${order.number} - ${statusText}</div>
                    
                    <div class="summary-section">
                        <div class="summary-title">الأدوية المطلوبة</div>
                        <div class="medicines-list">
                            ${order.medicines.map(item => `
                                <div class="medicine-summary-item">
                                    <span>${item.name} × ${item.quantity}</span>
                                    <span>${item.price * item.quantity} ر.ي</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="summary-section">
                        <div class="summary-title">معلومات التوصيل</div>
                        <div class="delivery-info">
                            <div class="delivery-info-item">
                                <span>طريقة التوصيل:</span>
                                <span>${order.deliveryType === 'delivery' ? 'توصيل إلى العنوان' : 'استلام من الصيدلية'}</span>
                            </div>
                            <div class="delivery-info-item">
                                <span>${order.deliveryType === 'delivery' ? 'العنوان:' : 'الصيدلية:'}</span>
                                <span>${order.deliveryAddress || 'غير محدد'}</span>
                            </div>
                            <div class="delivery-info-item">
                                <span>وقت الإنشاء:</span>
                                <span>${new Date(order.createdAt).toLocaleString('ar-YE')}</span>
                            </div>
                        </div>
                    </div>

                    <div class="summary-section">
                        <div class="summary-title">الدفع</div>
                        <div class="payment-info">
                            <div class="payment-info-item">
                                <span>طريقة الدفع:</span>
                                <span>${order.paymentMethod === 'cash' ? 'الدفع عند الاستلام' : order.paymentMethod === 'wallet' ? 'المحفظة الرقمية' : 'البطاقة الائتمانية'}</span>
                            </div>
                            <div class="payment-info-item">
                                <span>حالة الدفع:</span>
                                <span>${order.paymentMethod === 'cash' ? 'سيتم الدفع عند الاستلام' : 'تم الدفع'}</span>
                            </div>
                        </div>
                    </div>

                    <div class="total-amount">
                        <span>المبلغ الإجمالي:</span>
                        <span>${order.total} ر.ي</span>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="pharmacySystem.closeModal('orderDetailsModal')">
                        إغلاق
                    </button>
                    ${order.status === 'pending' ? `
                        <button class="btn btn-primary" onclick="pharmacySystem.cancelOrder(${order.id})">
                            <i class="fas fa-times"></i>
                            إلغاء الطلب
                        </button>
                    ` : ''}
                </div>
            </div>
        `;
    }

    // 3. فتح شاشة تتبع الطلب - وظيفة حقيقية
    trackOrder(orderId) {
        const order = this.orders.find(o => o.id === orderId);
        if (!order) return;

        this.createOrderTrackingModal(order);
        this.openModal('orderTrackingModal');
    }

    createOrderTrackingModal(order) {
        let modal = document.getElementById('orderTrackingModal');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'orderTrackingModal';
            modal.className = 'modal';
            document.body.appendChild(modal);
        }

        // محاكاة مراحل التتبع
        const trackingSteps = this.generateTrackingSteps(order);

        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">تتبع الطلب</div>
                    <button class="close-modal" onclick="pharmacySystem.closeModal('orderTrackingModal')">×</button>
                </div>
                
                <div class="success-content">
                    <div class="order-number">${order.number}</div>
                    
                    <div class="tracking-info">
                        <div class="tracking-steps">
                            ${trackingSteps.map((step, index) => `
                                <div class="tracking-step ${step.active ? 'active' : ''}">
                                    <div class="step-icon">
                                        <i class="fas fa-${step.icon}"></i>
                                    </div>
                                    <div class="step-label">${step.label}</div>
                                    <div class="step-time">${step.time || ''}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="order-details">
                        <div class="detail-item">
                            <span class="detail-label">وقت التوصيل المتوقع:</span>
                            <span class="detail-value">${order.estimatedDelivery}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">السائق:</span>
                            <span class="detail-value">محمد أحمد - 771234567</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">موقع السائق الحالي:</span>
                            <span class="detail-value">حي السبعين، صنعاء</span>
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="pharmacySystem.closeModal('orderTrackingModal')">
                        إغلاق
                    </button>
                    <button class="btn btn-primary" onclick="pharmacySystem.contactDriver()">
                        <i class="fas fa-phone"></i>
                        الاتصال بالسائق
                    </button>
                </div>
            </div>
        `;
    }

    generateTrackingSteps(order) {
        const steps = [
            { icon: 'shopping-bag', label: 'تم استلام الطلب', active: true },
            { icon: 'capsules', label: 'جاري التجهيز', active: order.status !== 'pending' },
            { icon: 'motorcycle', label: 'جاري التوصيل', active: order.status === 'confirmed' || order.status === 'delivered' },
            { icon: 'home', label: 'تم التوصيل', active: order.status === 'delivered' }
        ];

        // إضافة أوقات افتراضية
        if (order.status !== 'pending') {
            steps[1].time = '10:30 ص';
        }
        if (order.status === 'confirmed' || order.status === 'delivered') {
            steps[2].time = '11:15 ص';
        }
        if (order.status === 'delivered') {
            steps[3].time = '12:00 ص';
        }

        return steps;
    }

    contactDriver() {
        this.showNotification('جاري الاتصال بالسائق...', 'info');
        // في التطبيق الحقيقي، سيتم فتح تطبيق الهاتف
        setTimeout(() => {
            this.showNotification('تم الاتصال بالسائق', 'success');
        }, 2000);
    }

    cancelOrder(orderId) {
        const order = this.orders.find(o => o.id === orderId);
        if (!order) return;

        order.status = 'cancelled';
        localStorage.setItem('pharmacyOrders', JSON.stringify(this.orders));
        
        this.closeModal('orderDetailsModal');
        this.renderOrders();
        this.showNotification('تم إلغاء الطلب بنجاح', 'success');
    }

    // 4. إضافة أدوية الروشتة إلى السلة - وظيفة حقيقية
    usePrescription(prescriptionId) {
        const prescription = this.prescriptions.find(p => p.id === prescriptionId);
        if (!prescription) return;

        // إضافة أدوية الروشتة إلى السلة
        prescription.medicines.forEach(medicineName => {
            const medicine = this.medicines.find(m => 
                m.name.includes(medicineName) || 
                m.scientificName.includes(medicineName)
            );
            
            if (medicine) {
                this.addToCart(medicine.id);
            }
        });

        this.showNotification(`تم إضافة ${prescription.medicines.length} دواء من الروشتة إلى السلة`, 'success');
        this.switchTab('new-order');
    }

    // 5. فتح نافذة عرض الروشتة - وظيفة حقيقية
    viewPrescription(prescriptionId) {
        const prescription = this.prescriptions.find(p => p.id === prescriptionId);
        if (!prescription) return;

        this.createPrescriptionViewModal(prescription);
        this.openModal('prescriptionViewModal');
    }

    createPrescriptionViewModal(prescription) {
        let modal = document.getElementById('prescriptionViewModal');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'prescriptionViewModal';
            modal.className = 'modal';
            document.body.appendChild(modal);
        }

        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">الروشتة الطبية</div>
                    <button class="close-modal" onclick="pharmacySystem.closeModal('prescriptionViewModal')">×</button>
                </div>
                
                <div class="prescription-view-content">
                    <div class="prescription-header">
                        <div class="prescription-doctor">د. ${prescription.doctor}</div>
                        <div class="prescription-specialty">${prescription.specialty}</div>
                        <div class="prescription-date">${new Date(prescription.date).toLocaleDateString('ar-YE')}</div>
                    </div>
                    
                    <div class="prescription-image">
                        ${prescription.imageUrl ? 
                            `<img src="${prescription.imageUrl}" alt="الروشتة الطبية" style="max-width: 100%; border-radius: 10px;">` :
                            `<div class="no-image" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                <i class="fas fa-file-image" style="font-size: 48px;"></i>
                                <p>لا توجد صورة للروشتة</p>
                            </div>`
                        }
                    </div>
                    
                    <div class="prescription-medicines">
                        <div class="section-title">الأدوية الموصوفة</div>
                        <div class="medicines-list">
                            ${prescription.medicines.map(medicine => `
                                <div class="medicine-item">
                                    <i class="fas fa-capsules"></i>
                                    <span>${medicine}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="prescription-notes">
                        <div class="section-title">ملاحظات الطبيب</div>
                        <div class="notes-content">${prescription.notes || 'لا توجد ملاحظات إضافية'}</div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="pharmacySystem.closeModal('prescriptionViewModal')">
                        إغلاق
                    </button>
                    <button class="btn btn-primary" onclick="pharmacySystem.usePrescription(${prescription.id})">
                        <i class="fas fa-shopping-cart"></i>
                        استخدام للطلب
                    </button>
                </div>
            </div>
        `;
    }

    renderPrescriptions() {
        const container = document.getElementById('prescriptionsList');
        if (!container) return;

        container.innerHTML = '';

        if (this.prescriptions.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i class="fas fa-file-prescription" style="font-size: 48px; margin-bottom: 16px;"></i>
                    <div>لا توجد روشتات طبية</div>
                    <p style="font-size: 14px; margin-top: 8px;">يمكنك رفع روشتاتك الطبية للاستفادة منها</p>
                </div>
            `;
            return;
        }

        this.prescriptions.forEach(prescription => {
            const prescriptionElement = document.createElement('div');
            prescriptionElement.className = 'prescription-card';
            
            prescriptionElement.innerHTML = `
                <div class="prescription-header">
                    <div class="prescription-doctor">د. ${prescription.doctor}</div>
                    <div class="prescription-date">${new Date(prescription.date).toLocaleDateString('ar-YE')}</div>
                </div>
                <div class="prescription-details">
                    <div class="prescription-detail">
                        <div class="detail-label">التخصص</div>
                        <div class="detail-value">${prescription.specialty}</div>
                    </div>
                    <div class="prescription-detail">
                        <div class="detail-label">الحالة</div>
                        <div class="detail-value">${prescription.isActive ? 'سارية' : 'منتهية'}</div>
                    </div>
                </div>
                <div class="prescription-medicines">
                    <div class="medicines-list">${prescription.medicines.slice(0, 3).join('، ')}${prescription.medicines.length > 3 ? '...' : ''}</div>
                </div>
                <div class="prescription-actions">
                    <button class="action-btn" onclick="pharmacySystem.usePrescription(${prescription.id})">
                        <i class="fas fa-shopping-cart"></i>
                        استخدام للطلب
                    </button>
                    <button class="action-btn" onclick="pharmacySystem.viewPrescription(${prescription.id})">
                        <i class="fas fa-eye"></i>
                        عرض التفاصيل
                    </button>
                </div>
            `;
            
            container.appendChild(prescriptionElement);
        });
    }

    // 6. معالجة الروشتة المرفوعة - وظيفة حقيقية
    processPrescription() {
        const uploadedFiles = document.getElementById('uploadedPrescriptions');
        if (!uploadedFiles || uploadedFiles.children.length === 0) {
            this.showNotification('يرجى رفع صورة الروشتة أولاً', 'error');
            return;
        }

        // محاكاة معالجة الروشتة
        this.showNotification('جاري معالجة الروشتة...', 'info');
        
        setTimeout(() => {
            const newPrescription = {
                id: Date.now(),
                doctor: 'أحمد محمد',
                specialty: 'باطنية',
                date: new Date().toISOString(),
                medicines: ['بانادول أزرق', 'أموكسيسيلين', 'فيتامين سي'],
                notes: 'يؤخذ الدواء بعد الطعام. الرجاء الالتزام بالجرعات المحددة.',
                isActive: true,
                imageUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmYWZiIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzY0NzQ4YiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+Uk9TSEVUQSDFGcOQxZnDkcWFPC90ZXh0Pjwvc3ZnPg=='
            };

            this.prescriptions.unshift(newPrescription);
            localStorage.setItem('userPrescriptions', JSON.stringify(this.prescriptions));

            this.closeModal('uploadPrescriptionModal');
            this.showNotification('تم معالجة الروشتة بنجاح وتم التعرف على 3 أدوية', 'success');
            
            if (this.currentTab === 'prescriptions') {
                this.renderPrescriptions();
            }
        }, 2000);
    }

    // 7. فتح كاميرا الجهاز - وظيفة حقيقية
    openCameraScanner() {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then((stream) => {
                    this.createCameraModal(stream);
                    this.openModal('cameraModal');
                })
                .catch((error) => {
                    console.error('Error accessing camera:', error);
                    this.showNotification('تعذر الوصول إلى الكاميرا. يرجى التحقق من الصلاحيات.', 'error');
                    // فتح اختيار الملفات كبديل
                    this.openFilePicker();
                });
        } else {
            this.showNotification('الكاميرا غير متوفرة في هذا المتصفح', 'error');
            this.openFilePicker();
        }
    }

    createCameraModal(stream) {
        let modal = document.getElementById('cameraModal');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'cameraModal';
            modal.className = 'modal';
            document.body.appendChild(modal);
        }

        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">التقاط صورة للروشتة</div>
                    <button class="close-modal" onclick="pharmacySystem.closeCamera()">×</button>
                </div>
                
                <div class="camera-content" style="text-align: center;">
                    <video id="cameraVideo" autoplay playsinline style="width: 100%; max-width: 400px; border-radius: 10px;"></video>
                    <canvas id="cameraCanvas" style="display: none;"></canvas>
                    
                    <div class="camera-instructions" style="margin: 20px 0; padding: 15px; background: #f8fafc; border-radius: 10px;">
                        <h4 style="margin-bottom: 10px;">تعليمات التقاط الصورة:</h4>
                        <ul style="text-align: right; list-style: none; padding: 0;">
                            <li>📷 تأكد من إضاءة جيدة</li>
                            <li>📄 ضع الروشتة بشكل مستقيم</li>
                            <li>🔍 تأكد من وضوح النص</li>
                            <li>📱 اقترب بما يكيف لرؤية التفاصيل</li>
                        </ul>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="pharmacySystem.closeCamera()">
                        إلغاء
                    </button>
                    <button class="btn btn-primary" onclick="pharmacySystem.capturePrescription()">
                        <i class="fas fa-camera"></i>
                        التقاط الصورة
                    </button>
                </div>
            </div>
        `;

        const video = document.getElementById('cameraVideo');
        video.srcObject = stream;
    }

    closeCamera() {
        const modal = document.getElementById('cameraModal');
        if (modal) {
            const video = document.getElementById('cameraVideo');
            if (video && video.srcObject) {
                const tracks = video.srcObject.getTracks();
                tracks.forEach(track => track.stop());
            }
            this.closeModal('cameraModal');
        }
    }

    capturePrescription() {
        const video = document.getElementById('cameraVideo');
        const canvas = document.getElementById('cameraCanvas');
        
        if (!video || !canvas) return;

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        const context = canvas.getContext('2d');
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // تحويل الصورة إلى base64
        const imageData = canvas.toDataURL('image/jpeg');
        
        this.closeCamera();
        this.handleCapturedImage(imageData);
    }

    handleCapturedImage(imageData) {
        this.addPrescriptionToUploadList(imageData, 'روشتة ملتقطة');
        this.showNotification('تم التقاط صورة الروشتة بنجاح', 'success');
    }

    // 8. فتح نافذة اختيار الملفات - وظيفة حقيقية
    openFilePicker() {
        this.fileInput.click();
    }

    handleFileSelect(event) {
        const files = event.target.files;
        if (files.length === 0) return;

        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const reader = new FileReader();
            
            reader.onload = (e) => {
                this.addPrescriptionToUploadList(e.target.result, file.name);
            };
            
            reader.readAsDataURL(file);
        }

        this.showNotification(`تم رفع ${files.length} ملف`, 'success');
    }

    addPrescriptionToUploadList(imageData, fileName) {
        const container = document.getElementById('uploadedPrescriptions');
        if (!container) return;

        const preview = document.createElement('div');
        preview.className = 'prescription-preview';
        preview.innerHTML = `
            <img src="${imageData}" alt="${fileName}" style="max-width: 100px; max-height: 100px; border-radius: 5px;">
            <div class="prescription-name">${fileName}</div>
            <div class="prescription-size">${Math.round(imageData.length / 1024)} KB</div>
            <button class="remove-item-btn" onclick="this.parentElement.remove()" style="position: absolute; top: 5px; left: 5px;">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        container.appendChild(preview);
    }

    updateTime() {
        const timeElement = document.getElementById('currentTime');
        if (timeElement) {
            const now = new Date();
            timeElement.textContent = now.toLocaleTimeString('ar-YE', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
        }
    }

    openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
    }

    closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    }

    showNotification(message, type = 'info') {
        // إنشاء عنصر الإشعار
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `
            <div class="notification-content">
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}-circle"></i>
                <span>${message}</span>
            </div>
        `;

        // إضافة الأنماط
        notification.style.cssText = `
            position: fixed;
            top: 100px;
            right: 20px;
            background: ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--error)' : 'var(--primary)'};
            color: white;
            padding: 15px 20px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-large);
            z-index: 10000;
            animation: slideInRight 0.3s ease-out;
            max-width: 400px;
        `;

        document.body.appendChild(notification);

        // إزالة الإشعار بعد 3 ثوان
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease-in';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }
}

// الدوال العامة
function openCameraScanner() {
    pharmacySystem.openCameraScanner();
}

function uploadPrescription() {
    pharmacySystem.openModal('uploadPrescriptionModal');
}

function openFilePicker() {
    pharmacySystem.openFilePicker();
}

function closeModal(modalId) {
    pharmacySystem.closeModal(modalId);
}

// تهيئة النظام عند تحميل الصفحة
let pharmacySystem;
document.addEventListener('DOMContentLoaded', function() {
    pharmacySystem = new PharmacySystem();
});

// إضافة أنماط CSS للرسوم المتحركة
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOutRight {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
    
    .notification {
        font-family: 'Tajawal', sans-serif;
        font-weight: 500;
    }
    
    .notification-content {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .notification-content i {
        font-size: 18px;
    }
    
    .step-time {
        font-size: 11px;
        color: var(--text-light);
        margin-top: 4px;
    }
    
    .medicine-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 0;
        border-bottom: 1px solid #f1f5f9;
    }
    
    .medicine-item:last-child {
        border-bottom: none;
    }
    
    .medicine-item i {
        color: var(--success);
    }
    
    .notes-content {
        background: #f8fafc;
        padding: 15px;
        border-radius: 10px;
        border-right: 3px solid var(--success);
    }
    
    .camera-instructions ul li {
        padding: 5px 0;
    }
`;
document.head.appendChild(style);
</script>
</body>
</html>
