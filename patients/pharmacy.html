<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø·Ù„Ø¨Ø§ØªÙŠ Ù…Ù† Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© - M24</title>
    <link rel="stylesheet" href="pharmacy-orders.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700;800&family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
    /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: Ø£Ø®Ø¶Ø± ØµÙŠØ¯Ù„Ø§Ù†ÙŠ */
    --primary: #2E7D32;
    --primary-dark: #1B5E20;
    --primary-light: #C8E6C9;
    --secondary: #1976D2;
    --accent: #FF5252;
    --success: #4CAF50;
    --warning: #FF9800;
    --info: #2196F3;

    /* Ø®Ù„ÙÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: ÙØ§ØªØ­Ø© ÙˆÙ…Ø±ÙŠØ­Ø© Ù„Ù„Ø¹ÙŠÙ† */
    --bg-light: #F8FDF8;
    --bg-surface: #ffffff;
    --shadow-light: -6px -6px 12px rgba(255, 255, 255, 0.9), 6px 6px 12px rgba(0, 0, 0, 0.08);
    --shadow-inset: inset 3px 3px 6px rgba(0, 0, 0, 0.1), inset -3px -3px 6px rgba(255, 255, 255, 0.9);
    --shadow-card: 0 10px 30px rgba(46, 125, 50, 0.15);
    --text-primary: #1E293B;
    --text-secondary: #475569;

    /* Ø§Ù„Ø²ÙˆØ§ÙŠØ§ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª */
    --radius-xl: 30px;
    --radius-lg: 20px;
    --radius-md: 16px;
    --radius-sm: 12px;
    --transition-liquid: all 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);

    /* Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø­Ø¯Ø«Ø© */
    --font-primary: 'IBM Plex Sans Arabic', 'Tajawal', sans-serif;
    --font-heading: 'Almarai', sans-serif;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: var(--font-primary);
    -webkit-tap-highlight-color: transparent;
}

body {
    background: var(--bg-light);
    color: var(--text-primary);
    direction: rtl;
    overflow-x: hidden;
    min-height: 100vh;
    font-size: 14px;
    line-height: 1.5;
}

/* Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
.ultra-app {
    max-width: 450px;
    min-height: 100vh;
    margin: 0 auto;
    background: var(--bg-light);
    position: relative;
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.05);
    overflow-x: hidden;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© */
.status-bar {
    background: transparent;
    color: var(--text-primary);
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    font-weight: 500;
    z-index: 1000;
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
.app-header {
    padding: 20px 16px 0;
}

.header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.title-section h1 {
    font-family: var(--font-heading);
    font-size: 22px;
    font-weight: 800;
    color: var(--primary-dark);
    margin-bottom: 4px;
}

.title-section p {
    font-size: 13px;
    color: var(--text-secondary);
}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ */
.action-icon {
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    cursor: pointer;
    transition: var(--transition-liquid);
    position: relative;
    font-size: 16px;
}

.action-icon:active {
    box-shadow: var(--shadow-inset);
    color: var(--primary-dark);
}

.icon-badge {
    position: absolute;
    top: 4px;
    right: 4px;
    background: var(--accent);
    color: white;
    border-radius: 50%;
    width: 14px;
    height: 14px;
    font-size: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© */
.search-filter-bar {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 18px;
}

.search-bar {
    background: var(--bg-light);
    box-shadow: var(--shadow-inset);
    padding: 10px 16px;
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
}

.search-input {
    flex: 1;
    border: none;
    background: transparent;
    font-size: 14px;
    color: var(--text-primary);
    outline: none;
    padding: 0;
}

.search-icon {
    color: var(--text-secondary);
    font-size: 14px;
}

.filter-btn {
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    border: none;
    width: 44px;
    height: 44px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    cursor: pointer;
    transition: var(--transition-liquid);
    font-size: 14px;
}

.filter-btn:active {
    box-shadow: var(--shadow-inset);
}

/* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ¨ÙˆÙŠØ¨ */
.tabs-section {
    padding: 0 16px 18px;
}

.tabs-container {
    display: flex;
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    border-radius: var(--radius-lg);
    padding: 4px;
}

.tab-btn {
    flex: 1;
    padding: 10px 12px;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-liquid);
    border-radius: var(--radius-md);
    font-size: 13px;
}

.tab-btn.active {
    background: var(--primary);
    color: white;
    box-shadow: var(--shadow-inset);
}

/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ */
.tab-content {
    display: none;
    padding: 0 16px 100px;
}

.tab-content.active {
    display: block;
}

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
.orders-container {
    display: flex;
    flex-direction: column;
    gap: 14px;
}

/* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ù„Ø¨ */
.order-card {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    transition: var(--transition-liquid);
    cursor: pointer;
    overflow: hidden;
    position: relative;
    border-right: 4px solid var(--primary);
}

.order-card:hover {
    box-shadow: var(--shadow-inset);
    transform: translateY(-2px);
}

.order-card.pending {
    border-right-color: var(--warning);
}

.order-card.in-progress {
    border-right-color: var(--info);
}

.order-card.completed {
    border-right-color: var(--success);
}

.order-card.cancelled {
    border-right-color: var(--accent);
}

.order-header {
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.order-info {
    flex: 1;
}

.order-id {
    font-weight: 700;
    color: var(--primary-dark);
    margin-bottom: 4px;
    font-size: 14px;
}

.order-date {
    font-size: 12px;
    color: var(--text-secondary);
}

.order-status {
    padding: 6px 12px;
    border-radius: var(--radius-sm);
    font-size: 11px;
    font-weight: 600;
    color: white;
}

.status-pending {
    background: var(--warning);
}

.status-in-progress {
    background: var(--info);
}

.status-completed {
    background: var(--success);
}

.status-cancelled {
    background: var(--accent);
}

.order-body {
    padding: 16px;
}

.order-items {
    margin-bottom: 12px;
}

.order-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
}

.order-item:last-child {
    border-bottom: none;
}

.item-name {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 13px;
}

.item-quantity {
    color: var(--text-secondary);
    font-size: 12px;
}

.item-price {
    font-weight: 700;
    color: var(--primary);
    font-size: 13px;
}

.order-total {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 12px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    font-weight: 700;
    color: var(--primary-dark);
}

.order-footer {
    padding: 0 16px 16px;
    display: flex;
    gap: 8px;
}

/* Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© */
.location-section {
    padding-bottom: 20px;
}

.location-header {
    background: var(--bg-light);
    padding: 16px;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.location-info {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
}

.location-info i {
    font-size: 24px;
    color: var(--primary);
}

.location-info h3 {
    font-size: 16px;
    color: var(--text-primary);
    margin-bottom: 4px;
}

.location-info p {
    font-size: 12px;
    color: var(--text-secondary);
}

.refresh-location-btn {
    background: var(--primary);
    color: white;
    border: none;
    width: 44px;
    height: 44px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition-liquid);
    font-size: 16px;
}

.refresh-location-btn:hover {
    background: var(--primary-dark);
}

.distance-filter {
    background: var(--bg-light);
    padding: 12px 16px;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.distance-filter label {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 14px;
}

.distance-filter select {
    background: var(--bg-surface);
    border: none;
    padding: 8px 12px;
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow-inset);
    color: var(--text-primary);
    font-size: 13px;
    outline: none;
}

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª */
.pharmacies-container {
    display: flex;
    flex-direction: column;
    gap: 14px;
}

/* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© */
.pharmacy-card {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    transition: var(--transition-liquid);
    cursor: pointer;
    overflow: hidden;
    position: relative;
}

.pharmacy-card:hover {
    box-shadow: var(--shadow-inset);
    transform: translateY(-2px);
}

.pharmacy-header {
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.pharmacy-info {
    flex: 1;
}

.pharmacy-name {
    font-weight: 700;
    color: var(--primary-dark);
    margin-bottom: 6px;
    font-size: 16px;
}

.pharmacy-address {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.pharmacy-meta {
    display: flex;
    gap: 12px;
    font-size: 12px;
    color: var(--text-secondary);
}

.pharmacy-meta span {
    display: flex;
    align-items: center;
    gap: 4px;
}

.pharmacy-distance {
    background: var(--primary);
    color: white;
    padding: 6px 12px;
    border-radius: var(--radius-sm);
    font-weight: 700;
    font-size: 12px;
}

.pharmacy-body {
    padding: 0 16px 16px;
}

.pharmacy-status {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
}

.status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.status-open {
    background: var(--success);
}

.status-closed {
    background: var(--accent);
}

.status-24h {
    background: var(--info);
}

.status-text {
    font-size: 13px;
    font-weight: 600;
}

.pharmacy-actions {
    display: flex;
    gap: 8px;
}

/* Ø²Ø± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ù… */
.order-fab {
    position: fixed;
    bottom: 80px;
    right: 25px;
    width: 55px;
    height: 55px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-card);
    z-index: 999;
    transition: var(--transition-liquid);
    border: none;
    cursor: pointer;
    font-size: 18px;
}

.order-fab:hover {
    transform: scale(1.1);
}

.order-fab:active {
    transform: scale(0.9);
}

/* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
.bottom-nav-dock {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    display: flex;
    padding: 6px 8px;
    border-radius: var(--radius-xl);
    z-index: 1000;
    max-width: 340px;
    width: calc(100% - 32px);
    border: 1px solid rgba(255, 255, 255, 0.5);
}

.nav-item-dock {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 6px 0;
    border-radius: var(--radius-md);
    transition: var(--transition-liquid);
    flex: 1;
    position: relative;
    text-decoration: none;
    color: var(--text-secondary);
}

.nav-item-dock.active {
    color: var(--primary-dark);
}

.nav-item-dock.active .nav-icon-dock {
    background: var(--primary);
    color: white;
    box-shadow: 0 4px 15px rgba(46, 125, 50, 0.5);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    transform: translateY(-8px);
    transition: var(--transition-liquid);
}

.nav-icon-dock {
    font-size: 16px;
    margin-bottom: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    transition: var(--transition-liquid);
}

.nav-label {
    font-size: 9px;
    font-weight: 600;
    margin-top: 2px;
    transition: var(--transition-liquid);
}

.nav-item-dock.active .nav-label {
    font-weight: 800;
    color: var(--primary-dark);
}

/* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
    transition: opacity 0.3s ease-out;
    z-index: 2000;
}

.modal-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.4);
    box-shadow: var(--shadow-card);
    animation: modalSlideUp 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    max-height: 85vh;
    overflow-y: auto;
}

@keyframes modalSlideUp {
    from {opacity: 0; transform: translateY(100%);}
    to {opacity: 1; transform: translateY(0);}
}

.modal-header {
    background: var(--primary);
    color: white;
    padding: 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
}

.modal-header h2 {
    margin: 0;
    font-size: 18px;
}

.close {
    font-size: 20px;
    cursor: pointer;
}

/* Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
.order-form {
    padding: 18px;
}

.form-group {
    margin-bottom: 16px;
}

.form-label {
    display: block;
    margin-bottom: 6px;
    font-weight: 600;
    color: var(--text-primary);
    font-size: 13px;
}

.form-input, .form-select, .form-textarea {
    width: 100%;
    padding: 10px 14px;
    border: none;
    background: var(--bg-light);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-inset);
    font-size: 14px;
    color: var(--text-primary);
    outline: none;
    transition: var(--transition-liquid);
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
    box-shadow: var(--shadow-light);
}

.form-textarea {
    resize: vertical;
    min-height: 80px;
}

/* Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© */
.medicines-list {
    margin-bottom: 16px;
}

.medicine-item {
    background: var(--bg-light);
    padding: 12px;
    border-radius: var(--radius-md);
    margin-bottom: 8px;
    box-shadow: var(--shadow-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.medicine-info {
    flex: 1;
}

.medicine-name {
    font-weight: 600;
    margin-bottom: 4px;
    font-size: 14px;
}

.medicine-details {
    display: flex;
    gap: 12px;
    font-size: 12px;
    color: var(--text-secondary);
}

.add-medicine-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: var(--radius-md);
    font-size: 14px;
    cursor: pointer;
    transition: var(--transition-liquid);
    display: flex;
    align-items: center;
    gap: 6px;
    width: 100%;
    justify-content: center;
}

.add-medicine-btn:hover {
    background: var(--primary-dark);
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.btn-primary {
    background: var(--primary);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition-liquid);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
}

.btn-secondary {
    background: var(--bg-light);
    color: var(--text-primary);
    border: none;
    padding: 10px 20px;
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-liquid);
    box-shadow: var(--shadow-light);
}

.btn-secondary:hover {
    box-shadow: var(--shadow-inset);
}

.btn-small {
    padding: 6px 12px;
    font-size: 12px;
}

.btn-full {
    width: 100%;
}

/* Ø§Ù„ØªÙ‚ÙŠÙŠÙ… */
.rating-stars {
    display: flex;
    justify-content: center;
    gap: 6px;
    margin: 16px 0;
}

.rating-star {
    font-size: 28px;
    color: #ddd;
    cursor: pointer;
    transition: var(--transition-liquid);
}

.rating-star.active {
    color: var(--warning);
}

.rating-star:hover {
    transform: scale(1.2);
}

/* Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
.loading-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--primary-light);
    border-top: 3px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 16px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø§Ù„Ø© */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-secondary);
}

.empty-state i {
    font-size: 48px;
    margin-bottom: 16px;
    color: var(--primary-light);
}

/* Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 428px) {
    .status-bar {
        padding: 8px 16px;
    }
    
    .app-header {
        padding: 16px 12px 0;
    }
    
    .tabs-section {
        padding: 0 12px 16px;
    }
    
    .tab-content {
        padding: 0 12px 90px;
    }
    
    .order-fab {
        bottom: 70px;
        right: 20px;
        width: 50px;
        height: 50px;
    }
    
    .bottom-nav-dock {
        bottom: 15px;
        max-width: 320px;
    }
    
    .pharmacy-actions {
        flex-direction: column;
    }
    
    .order-footer {
        flex-direction: column;
    }
}
  </style>
</head>
<body>
    <div class="ultra-app">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© -->
        <div class="status-bar">
            <div class="status-left">
                <span id="currentTime">10:03 Ù…</span>
            </div>
            <div class="status-right">
                <i class="fas fa-signal"></i>
                <i class="fas fa-wifi"></i>
                <i class="fas fa-battery-full"></i>
            </div>
        </div>

        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="app-header">
            <div class="header-top">
                <div class="title-section">
                    <h1>Ø·Ù„Ø¨Ø§ØªÙŠ Ù…Ù† Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© ğŸ¥</h1>
                    <p>Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¯ÙˆÙŠØ© ÙˆØ§Ù„Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª</p>
                </div>
                <div class="customer-actions">
                    <button class="action-icon" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        <span class="icon-badge" id="notificationBadge">3</span>
                    </button>
                    <button class="action-icon" id="locationBtn">
                        <i class="fas fa-map-marker-alt"></i>
                    </button>
                </div>
            </div>
            
            <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© -->
            <div class="search-filter-bar">
                <div class="search-bar">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¯ÙˆØ§Ø¡ØŒ ØµÙŠØ¯Ù„ÙŠØ© Ø£Ùˆ Ø·Ù„Ø¨..." id="searchInput">
                </div>
                <button class="filter-btn" id="filterBtn">
                    <i class="fas fa-filter"></i>
                </button>
            </div>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ¨ÙˆÙŠØ¨ -->
        <div class="tabs-section">
            <div class="tabs-container">
                <button class="tab-btn active" data-tab="current">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
                <button class="tab-btn" data-tab="history">Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
                <button class="tab-btn" data-tab="pharmacies">Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©</button>
            </div>
        </div>

        <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
        <div class="tab-content active" id="currentTab">
            <div class="orders-container">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>

        <!-- Ù…Ø­ØªÙˆÙ‰ Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
        <div class="tab-content" id="historyTab">
            <div class="orders-container">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>

        <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© -->
        <div class="tab-content" id="pharmaciesTab">
            <div class="location-section">
                <div class="location-header">
                    <div class="location-info">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <h3 id="currentLocationText">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...</h3>
                            <p id="locationStatus">ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ø§ÙƒØªØ´Ø§Ù Ø£Ù‚Ø±Ø¨ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª</p>
                        </div>
                    </div>
                    <button class="refresh-location-btn" id="refreshLocation">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>

                <div class="distance-filter">
                    <label>Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¨Ø­Ø«:</label>
                    <select id="distanceRange">
                        <option value="5">5 ÙƒÙ…</option>
                        <option value="10" selected>10 ÙƒÙ…</option>
                        <option value="15">15 ÙƒÙ…</option>
                        <option value="20">20 ÙƒÙ…</option>
                    </select>
                </div>

                <div class="pharmacies-container" id="pharmaciesContainer">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>

        <!-- Ø²Ø± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ù… -->
        <button class="order-fab" id="newOrderBtn">
            <i class="fas fa-plus"></i>
        </button>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ -->
        <div class="bottom-nav-dock">
            <a href="index.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-home"></i>
                </div>
                <div class="nav-label">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
            </a>
            <a href="pharmacy-orders.html" class="nav-item-dock active">
                <div class="nav-icon-dock">
                    <i class="fas fa-pills"></i>
                </div>
                <div class="nav-label">Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</div>
            </a>
            <a href="doctor-appointment.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-user-md"></i>
                </div>
                <div class="nav-label">Ø­Ø¬Ø² Ø¯ÙƒØªÙˆØ±</div>
            </a>
            <a href="financial.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="nav-label">Ø§Ù„Ù…Ø­ÙØ¸Ø©</div>
            </a>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ -->
    <div id="newOrderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø·Ù„Ø¨ Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="newOrderBody">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ -->
    <div id="orderDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="orderDetailsTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="orderDetailsBody">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© -->
    <div id="pharmacyDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="pharmacyDetailsTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="pharmacyDetailsBody">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… -->
    <div id="confirmReceiptModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="confirmReceiptBody">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
    <div id="ratingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø©</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="ratingModalBody">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>

    <script>
        // Ù†Ø¸Ø§Ù… Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
class AdvancedPharmacyOrders {
    constructor() {
        this.orders = [];
        this.pharmacies = [];
        this.filteredPharmacies = [];
        this.currentOrders = [];
        this.orderHistory = [];
        this.currentOrder = null;
        this.currentPharmacy = null;
        this.userLocation = null;
        this.currentTab = 'current';
        this.searchQuery = '';
        this.distanceRange = 10;
        this.init();
    }

    init() {
        this.loadOrders();
        this.loadPharmacies();
        this.setupEventListeners();
        this.renderCurrentOrders();
        this.updateTime();
        this.getUserLocation();
    }

    // =============================================
    // Ù†Ø¸Ø§Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù…Ø³Ø§ÙØ§Øª
    // =============================================

    getUserLocation() {
        const savedLocation = localStorage.getItem('user_location');
        
        if (savedLocation) {
            this.userLocation = JSON.parse(savedLocation);
            this.updateLocationUI();
            this.findNearbyPharmacies();
            return;
        }

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø¯Ù…Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­
        if (navigator.geolocation) {
            document.getElementById('locationStatus').textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...';
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    this.userLocation = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        address: 'Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ'
                    };
                    
                    localStorage.setItem('user_location', JSON.stringify(this.userLocation));
                    this.updateLocationUI();
                    this.findNearbyPharmacies();
                    this.reverseGeocode(position.coords.latitude, position.coords.longitude);
                },
                (error) => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹:', error);
                    this.handleLocationError(error);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        } else {
            this.handleLocationError(new Error('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø¯Ù…Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹'));
        }
    }

    reverseGeocode(lat, lng) {
        // Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ø¹Ù…Ù„ÙŠØ© reverse geocoding
        const addresses = [
            'Ø­ÙŠ Ø§Ù„Ù†Ø²Ù‡Ø©ØŒ ØµÙ†Ø¹Ø§Ø¡',
            'Ø­ÙŠ Ø§Ù„ØªØ­Ø±ÙŠØ±ØŒ ØµÙ†Ø¹Ø§Ø¡', 
            'Ø­ÙŠ Ø§Ù„Ø´ÙŠØ® Ø¹Ø«Ù…Ø§Ù†ØŒ Ø¹Ø¯Ù†',
            'Ø­ÙŠ Ø§Ù„ØµØ§ÙÙŠØ©ØŒ ØªØ¹Ø²'
        ];
        
        const randomAddress = addresses[Math.floor(Math.random() * addresses.length)];
        
        setTimeout(() => {
            this.userLocation.address = randomAddress;
            localStorage.setItem('user_location', JSON.stringify(this.userLocation));
            this.updateLocationUI();
        }, 1500);
    }

    handleLocationError(error) {
        let errorMessage = 'ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ';
        
        switch(error.code) {
            case error.PERMISSION_DENIED:
                errorMessage = 'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù† Ø¨ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
                break;
            case error.POSITION_UNAVAILABLE:
                errorMessage = 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­Ø©';
                break;
            case error.TIMEOUT:
                errorMessage = 'Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
                break;
        }
        
        document.getElementById('locationStatus').textContent = errorMessage;
        document.getElementById('currentLocationText').textContent = 'ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ
        this.userLocation = {
            latitude: 15.3694,
            longitude: 44.1910,
            address: 'ØµÙ†Ø¹Ø§Ø¡ØŒ Ø§Ù„ÙŠÙ…Ù†'
        };
        
        this.findNearbyPharmacies();
    }

    updateLocationUI() {
        if (this.userLocation && this.userLocation.address) {
            document.getElementById('currentLocationText').textContent = this.userLocation.address;
            document.getElementById('locationStatus').textContent = 'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ù†Ø¬Ø§Ø­';
        }
    }

    refreshLocation() {
        document.getElementById('locationStatus').textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹...';
        localStorage.removeItem('user_location');
        this.getUserLocation();
    }

    // =============================================
    // Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª
    // =============================================

    calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; // Ù†ØµÙ Ù‚Ø·Ø± Ø§Ù„Ø£Ø±Ø¶ Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±
        const dLat = this.deg2rad(lat2 - lat1);
        const dLon = this.deg2rad(lon2 - lon1);
        
        const a = 
            Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(this.deg2rad(lat1)) * Math.cos(this.deg2rad(lat2)) * 
            Math.sin(dLon/2) * Math.sin(dLon/2);
        
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
        const distance = R * c; // Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±
        
        return Math.round(distance * 10) / 10; // ØªÙ‚Ø±ÙŠØ¨ Ù„Ø£Ù‚Ø±Ø¨ Ù…Ù†Ø²Ù„Ø© Ø¹Ø´Ø±ÙŠØ©
    }

    deg2rad(deg) {
        return deg * (Math.PI/180);
    }

    findNearbyPharmacies() {
        if (!this.userLocation) return;

        this.filteredPharmacies = this.pharmacies.map(pharmacy => {
            const distance = this.calculateDistance(
                this.userLocation.latitude,
                this.userLocation.longitude,
                pharmacy.location.latitude,
                pharmacy.location.longitude
            );
            
            return {
                ...pharmacy,
                distance: distance,
                isNearby: distance <= this.distanceRange
            };
        }).filter(pharmacy => pharmacy.isNearby)
          .sort((a, b) => a.distance - b.distance);

        this.renderPharmacies();
    }

    // =============================================
    // Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    // =============================================

    loadOrders() {
        const savedOrders = localStorage.getItem('pharmacy_orders');
        
        if (savedOrders) {
            this.orders = JSON.parse(savedOrders);
        } else {
            this.orders = this.getSampleOrders();
        }
        
        this.updateOrdersLists();
        this.saveOrders();
    }

    getSampleOrders() {
        return [
            {
                id: 'PH-2024-001',
                pharmacyId: 1,
                pharmacyName: 'ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ù†Ø®Ø¨Ø©',
                items: [
                    { name: 'Ø¨Ø§Ø±Ø§Ø³ÙŠØªØ§Ù…ÙˆÙ„', quantity: 2, price: 5 },
                    { name: 'ÙÙŠØªØ§Ù…ÙŠÙ† C', quantity: 1, price: 15 },
                    { name: 'ÙƒØ±ÙŠÙ… Ù…Ø±Ø·Ø¨', quantity: 1, price: 12 }
                ],
                total: 32,
                status: 'in-progress',
                orderDate: '2024-01-15',
                deliveryDate: '2024-01-15',
                address: 'Ø­ÙŠ Ø§Ù„Ù†Ø²Ù‡Ø©ØŒ ØµÙ†Ø¹Ø§Ø¡',
                paymentMethod: 'Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©',
                notes: 'Ø§Ù„ØªÙˆØµÙŠÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø³Ø§Ø¹Ø© 6 Ù…Ø³Ø§Ø¡Ù‹'
            },
            {
                id: 'PH-2024-002',
                pharmacyId: 2,
                pharmacyName: 'ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ø£Ù…Ù„',
                items: [
                    { name: 'Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø¨Ø±Ø¯', quantity: 1, price: 25 },
                    { name: 'Ø´Ø±Ø§Ø¨ Ù„Ù„Ø³Ø¹Ø§Ù„', quantity: 1, price: 18 }
                ],
                total: 43,
                status: 'completed',
                orderDate: '2024-01-14',
                deliveryDate: '2024-01-14',
                address: 'Ø­ÙŠ Ø§Ù„ØªØ­Ø±ÙŠØ±ØŒ ØµÙ†Ø¹Ø§Ø¡',
                paymentMethod: 'Ù†Ù‚Ø¯ÙŠ',
                notes: ''
            },
            {
                id: 'PH-2024-003',
                pharmacyId: 3,
                pharmacyName: 'ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ø­ÙŠØ§Ø©',
                items: [
                    { name: 'Ù…Ø¶Ø§Ø¯ Ø­ÙŠÙˆÙŠ', quantity: 1, price: 30 },
                    { name: 'Ù…Ø³ÙƒÙ† Ø£Ù„Ù…', quantity: 1, price: 8 }
                ],
                total: 38,
                status: 'pending',
                orderDate: '2024-01-16',
                deliveryDate: '2024-01-16',
                address: 'Ø­ÙŠ Ø§Ù„ØµØ§ÙÙŠØ©ØŒ ØªØ¹Ø²',
                paymentMethod: 'Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©',
                notes: 'Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø§Ù„Ø¨Ù†Ø³Ù„ÙŠÙ†'
            }
        ];
    }

    loadPharmacies() {
        const savedPharmacies = localStorage.getItem('pharmacies_data');
        
        if (savedPharmacies) {
            this.pharmacies = JSON.parse(savedPharmacies);
        } else {
            this.pharmacies = this.getSamplePharmacies();
        }
        
        this.savePharmacies();
    }

    getSamplePharmacies() {
        // Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø­ÙˆÙ„ ØµÙ†Ø¹Ø§Ø¡
        const baseLat = 15.3694;
        const baseLng = 44.1910;
        
        return [
            {
                id: 1,
                name: 'ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ù†Ø®Ø¨Ø©',
                address: 'Ø­ÙŠ Ø§Ù„Ù†Ø²Ù‡Ø©ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©ØŒ ØµÙ†Ø¹Ø§Ø¡',
                phone: '017234567',
                workingHours: '24 Ø³Ø§Ø¹Ø©',
                status: 'open',
                rating: 4.8,
                delivery: true,
                location: {
                    latitude: baseLat + 0.005,
                    longitude: baseLng + 0.005
                },
                services: ['ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ', 'Ø§Ø³ØªØ´Ø§Ø±Ø© ØµÙŠØ¯Ù„Ø§Ù†ÙŠØ©', 'Ø£Ø¯ÙˆÙŠØ© Ù…ÙˆØµÙˆÙØ©']
            },
            {
                id: 2,
                name: 'ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ø£Ù…Ù„',
                address: 'Ø­ÙŠ Ø§Ù„ØªØ­Ø±ÙŠØ±ØŒ Ù…Ø¬Ù…Ø¹ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØŒ ØµÙ†Ø¹Ø§Ø¡',
                phone: '017234568',
                workingHours: '8:00 Øµ - 12:00 Ù…',
                status: 'closed',
                rating: 4.5,
                delivery: true,
                location: {
                    latitude: baseLat - 0.003,
                    longitude: baseLng + 0.004
                },
                services: ['ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹', 'Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø·Ø¨ÙŠØ©']
            },
            {
                id: 3,
                name: 'ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ø­ÙŠØ§Ø©',
                address: 'Ø­ÙŠ Ø§Ù„ØµØ§ÙÙŠØ©ØŒ Ø£Ù…Ø§Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØŒ ØªØ¹Ø²',
                phone: '047123456',
                workingHours: '24 Ø³Ø§Ø¹Ø©',
                status: '24h',
                rating: 4.9,
                delivery: true,
                location: {
                    latitude: 13.5789,
                    longitude: 44.0219
                },
                services: ['ØªÙˆØµÙŠÙ„ ÙÙˆØ±ÙŠ', 'ØµÙŠØ¯Ù„ÙŠ Ù…ØªØ®ØµØµ', 'Ù…Ø¹Ø¯Ø§Øª Ø·Ø¨ÙŠØ©']
            },
            {
                id: 4,
                name: 'ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ø´ÙØ§Ø¡',
                address: 'Ø­ÙŠ Ø§Ù„Ø´ÙŠØ® Ø¹Ø«Ù…Ø§Ù†ØŒ Ø´Ø§Ø±Ø¹ Ø®ÙˆØ±Ù…ÙƒØ³Ø±ØŒ Ø¹Ø¯Ù†',
                phone: '027123457',
                workingHours: '7:00 Øµ - 11:00 Ù…',
                status: 'open',
                rating: 4.6,
                delivery: false,
                location: {
                    latitude: 12.7855,
                    longitude: 45.0187
                },
                services: ['Ø£Ø¯ÙˆÙŠØ© Ø£ØµÙ„ÙŠØ©', 'Ø¹Ø±ÙˆØ¶ Ø®Ø§ØµØ©']
            },
            {
                id: 5,
                name: 'ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ø±Ø­Ù…Ø©',
                address: 'Ø­ÙŠ Ø§Ù„Ù‚Ø¯Ø³ØŒ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø±Ø§Ø¦Ø¯ØŒ ØµÙ†Ø¹Ø§Ø¡',
                phone: '017234569',
                workingHours: '24 Ø³Ø§Ø¹Ø©',
                status: '24h',
                rating: 4.7,
                delivery: true,
                location: {
                    latitude: baseLat + 0.002,
                    longitude: baseLng - 0.003
                },
                services: ['ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ', 'Ø®ØµÙˆÙ…Ø§Øª ÙƒØ¨Ø§Ø± Ø§Ù„Ø³Ù†', 'Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ©']
            }
        ];
    }

    updateOrdersLists() {
        this.currentOrders = this.orders.filter(order => 
            order.status === 'pending' || order.status === 'in-progress'
        );
        
        this.orderHistory = this.orders.filter(order => 
            order.status === 'completed' || order.status === 'cancelled'
        );
    }

    saveOrders() {
        localStorage.setItem('pharmacy_orders', JSON.stringify(this.orders));
    }

    savePharmacies() {
        localStorage.setItem('pharmacies_data', JSON.stringify(this.pharmacies));
    }

    // =============================================
    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ø±Ø¶Ø§Øª
    // =============================================

    renderCurrentOrders() {
        const container = document.querySelector('#currentTab .orders-container');
        
        if (this.currentOrders.length === 0) {
            container.innerHTML = this.getEmptyState('current');
            return;
        }

        let ordersHTML = '';
        
        this.currentOrders.forEach(order => {
            ordersHTML += this.generateOrderCard(order);
        });

        container.innerHTML = ordersHTML;
    }

    renderOrderHistory() {
        const container = document.querySelector('#historyTab .orders-container');
        
        if (this.orderHistory.length === 0) {
            container.innerHTML = this.getEmptyState('history');
            return;
        }

        let ordersHTML = '';
        
        this.orderHistory.forEach(order => {
            ordersHTML += this.generateOrderCard(order);
        });

        container.innerHTML = ordersHTML;
    }

    renderPharmacies() {
        const container = document.getElementById('pharmaciesContainer');
        
        if (!this.userLocation) {
            container.innerHTML = `
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <div>Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...</div>
                </div>
            `;
            return;
        }

        if (this.filteredPharmacies.length === 0) {
            container.innerHTML = this.getEmptyState('pharmacies');
            return;
        }

        let pharmaciesHTML = '';
        
        this.filteredPharmacies.forEach(pharmacy => {
            pharmaciesHTML += this.generatePharmacyCard(pharmacy);
        });

        container.innerHTML = pharmaciesHTML;
    }

    generateOrderCard(order) {
        const statusText = {
            'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
            'in-progress': 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²',
            'completed': 'Ù…ÙƒØªÙ…Ù„',
            'cancelled': 'Ù…Ù„ØºÙŠ'
        }[order.status];

        const statusClass = {
            'pending': 'status-pending',
            'in-progress': 'status-in-progress',
            'completed': 'status-completed',
            'cancelled': 'status-cancelled'
        }[order.status];

        const itemsHTML = order.items.map(item => `
            <div class="order-item">
                <div class="item-name">${item.name}</div>
                <div class="item-quantity">${item.quantity}x</div>
                <div class="item-price">${item.price} Ø±.ÙŠ</div>
            </div>
        `).join('');

        return `
            <div class="order-card ${order.status}" onclick="pharmacyOrders.showOrderDetails('${order.id}')">
                <div class="order-header">
                    <div class="order-info">
                        <div class="order-id">${order.id}</div>
                        <div class="order-date">${order.orderDate}</div>
                    </div>
                    <div class="order-status ${statusClass}">${statusText}</div>
                </div>
                <div class="order-body">
                    <div class="order-items">
                        ${itemsHTML}
                    </div>
                    <div class="order-total">
                        <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                        <span>${order.total} Ø±.ÙŠ</span>
                    </div>
                </div>
                <div class="order-footer">
                    <button class="btn-secondary btn-small" onclick="event.stopPropagation(); pharmacyOrders.showOrderDetails('${order.id}')">
                        <i class="fas fa-eye"></i>
                        Ø§Ù„ØªÙØ§ØµÙŠÙ„
                    </button>
                    ${order.status === 'pending' ? `
                        <button class="btn-secondary btn-small" onclick="event.stopPropagation(); pharmacyOrders.cancelOrder('${order.id}')">
                            <i class="fas fa-times"></i>
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                    ` : ''}
                    ${order.status === 'in-progress' ? `
                        <button class="btn-primary btn-small" onclick="event.stopPropagation(); pharmacyOrders.trackOrder('${order.id}')">
                            <i class="fas fa-map-marker-alt"></i>
                            ØªØªØ¨Ø¹
                        </button>
                    ` : ''}
                </div>
            </div>
        `;
    }

    generatePharmacyCard(pharmacy) {
        const statusConfig = {
            'open': { text: 'Ù…ÙØªÙˆØ­ Ø§Ù„Ø¢Ù†', class: 'status-open' },
            'closed': { text: 'Ù…ØºÙ„Ù‚', class: 'status-closed' },
            '24h': { text: 'Ù…ÙØªÙˆØ­ 24 Ø³Ø§Ø¹Ø©', class: 'status-24h' }
        }[pharmacy.status] || { text: 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ', class: 'status-closed' };

        const servicesHTML = pharmacy.services.slice(0, 2).map(service => 
            `<span style="background: var(--primary-light); padding: 2px 6px; border-radius: var(--radius-sm); font-size: 11px; color: var(--primary-dark);">${service}</span>`
        ).join(' ');

        return `
            <div class="pharmacy-card" onclick="pharmacyOrders.showPharmacyDetails(${pharmacy.id})">
                <div class="pharmacy-header">
                    <div class="pharmacy-info">
                        <div class="pharmacy-name">${pharmacy.name}</div>
                        <div class="pharmacy-address">
                            <i class="fas fa-map-marker-alt"></i>
                            ${pharmacy.address}
                        </div>
                        <div class="pharmacy-meta">
                            <span>
                                <i class="fas fa-clock"></i>
                                ${pharmacy.workingHours}
                            </span>
                            <span>
                                <i class="fas fa-star" style="color: var(--warning);"></i>
                                ${pharmacy.rating}
                            </span>
                            ${pharmacy.delivery ? '<span><i class="fas fa-motorcycle" style="color: var(--success);"></i> ØªÙˆØµÙŠÙ„</span>' : ''}
                        </div>
                        <div style="margin-top: 8px;">
                            ${servicesHTML}
                        </div>
                    </div>
                    <div class="pharmacy-distance">${pharmacy.distance} ÙƒÙ…</div>
                </div>
                <div class="pharmacy-body">
                    <div class="pharmacy-status">
                        <div class="status-indicator ${statusConfig.class}"></div>
                        <div class="status-text">${statusConfig.text}</div>
                    </div>
                    <div class="pharmacy-actions">
                        <button class="btn-secondary btn-small" onclick="event.stopPropagation(); pharmacyOrders.showPharmacyDetails(${pharmacy.id})">
                            <i class="fas fa-info-circle"></i>
                            Ø§Ù„ØªÙØ§ØµÙŠÙ„
                        </button>
                        <button class="btn-primary btn-small" onclick="event.stopPropagation(); pharmacyOrders.createOrderFromPharmacy(${pharmacy.id})">
                            <i class="fas fa-shopping-cart"></i>
                            Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    getEmptyState(type) {
        const states = {
            'current': {
                icon: 'fas fa-clipboard-list',
                title: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ©',
                message: 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° Ø­Ø§Ù„ÙŠØ§Ù‹'
            },
            'history': {
                icon: 'fas fa-history',
                title: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø©',
                message: 'Ù„Ù… ØªÙ‚Ù… Ø¨Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ù‚Ø¨Ù„'
            },
            'pharmacies': {
                icon: 'fas fa-map-marker-alt',
                title: 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙŠØ¯Ù„ÙŠØ§Øª Ù‚Ø±ÙŠØ¨Ø©',
                message: 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙŠØ¯Ù„ÙŠØ§Øª Ø¶Ù…Ù† Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø¯Ø¯'
            }
        };

        const state = states[type] || states.current;

        return `
            <div class="empty-state">
                <i class="${state.icon}"></i>
                <h3>${state.title}</h3>
                <p>${state.message}</p>
            </div>
        `;
    }

    // =============================================
    // Ù†Ø¸Ø§Ù… Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
    // =============================================

    showOrderDetails(orderId) {
        const order = this.orders.find(o => o.id === orderId);
        if (!order) return;

        this.currentOrder = order;
        const modal = document.getElementById('orderDetailsModal');
        
        document.getElementById('orderDetailsTitle').textContent = `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ ${order.id}`;
        
        const itemsHTML = order.items.map(item => `
            <div class="order-item">
                <div class="item-name">${item.name}</div>
                <div class="item-quantity">${item.quantity}x</div>
                <div class="item-price">${item.price} Ø±.ÙŠ</div>
            </div>
        `).join('');

        const statusText = {
            'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
            'in-progress': 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²',
            'completed': 'Ù…ÙƒØªÙ…Ù„',
            'cancelled': 'Ù…Ù„ØºÙŠ'
        }[order.status];

        const modalBody = document.getElementById('orderDetailsBody');
        modalBody.innerHTML = `
            <div class="order-details">
                <div class="detail-section">
                    <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</span>
                            <span>${order.id}</span>
                        </div>
                        <div class="detail-item">
                            <span>Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©:</span>
                            <span>${order.pharmacyName}</span>
                        </div>
                        <div class="detail-item">
                            <span>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</span>
                            <span>${order.orderDate}</span>
                        </div>
                        <div class="detail-item">
                            <span>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:</span>
                            <span class="order-status ${order.status}">${statusText}</span>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h3>
                    <div class="order-items">
                        ${itemsHTML}
                    </div>
                    <div class="order-total">
                        <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                        <span>${order.total} Ø±.ÙŠ</span>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
                            <span>${order.address}</span>
                        </div>
                        <div class="detail-item">
                            <span>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</span>
                            <span>${order.paymentMethod}</span>
                        </div>
                        ${order.notes ? `
                            <div class="detail-item">
                                <span>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</span>
                                <span>${order.notes}</span>
                            </div>
                        ` : ''}
                    </div>
                </div>

                <div class="detail-actions">
                    ${order.status === 'pending' ? `
                        <button class="btn-secondary" onclick="pharmacyOrders.cancelOrder('${order.id}')">
                            <i class="fas fa-times"></i>
                            Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨
                        </button>
                    ` : ''}
                    
                    ${order.status === 'in-progress' ? `
                        <button class="btn-primary" onclick="pharmacyOrders.trackOrder('${order.id}')">
                            <i class="fas fa-map-marker-alt"></i>
                            ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨
                        </button>
                    ` : ''}
                    
                    ${order.status === 'completed' ? `
                        <button class="btn-primary" onclick="pharmacyOrders.rateOrder('${order.id}')">
                            <i class="fas fa-star"></i>
                            ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø©
                        </button>
                    ` : ''}
                    
                    <button class="btn-secondary" onclick="pharmacyOrders.printOrder('${order.id}')">
                        <i class="fas fa-print"></i>
                        Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                    </button>
                </div>
            </div>
        `;

        modal.style.display = 'block';
    }

    showPharmacyDetails(pharmacyId) {
        const pharmacy = this.pharmacies.find(p => p.id === pharmacyId);
        if (!pharmacy) return;

        this.currentPharmacy = pharmacy;
        const modal = document.getElementById('pharmacyDetailsModal');
        
        document.getElementById('pharmacyDetailsTitle').textContent = pharmacy.name;
        
        const servicesHTML = pharmacy.services.map(service => `
            <span class="service-tag">${service}</span>
        `).join('');

        const modalBody = document.getElementById('pharmacyDetailsBody');
        modalBody.innerHTML = `
            <div class="pharmacy-details">
                <div class="pharmacy-header-large">
                    <div class="pharmacy-name-large">${pharmacy.name}</div>
                    <div class="pharmacy-rating">
                        <i class="fas fa-star" style="color: var(--warning);"></i>
                        <span>${pharmacy.rating} (125 ØªÙ‚ÙŠÙŠÙ…)</span>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${pharmacy.address}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-phone"></i>
                            <span>${pharmacy.phone}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-clock"></i>
                            <span>${pharmacy.workingHours}</span>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h3>
                    <div class="services-tags">
                        ${servicesHTML}
                    </div>
                </div>

                ${pharmacy.distance ? `
                    <div class="detail-section">
                        <h3>Ø§Ù„Ù…Ø³Ø§ÙØ©</h3>
                        <div class="distance-info">
                            <i class="fas fa-road"></i>
                            <span>ØªØ¨Ø¹Ø¯ Ø¹Ù†Ùƒ Ø­ÙˆØ§Ù„ÙŠ ${pharmacy.distance} ÙƒÙŠÙ„ÙˆÙ…ØªØ±</span>
                        </div>
                    </div>
                ` : ''}

                <div class="detail-actions">
                    <button class="btn-secondary" onclick="pharmacyOrders.callPharmacy('${pharmacy.phone}')">
                        <i class="fas fa-phone"></i>
                        Ø§ØªØµÙ„ Ø¨Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©
                    </button>
                    <button class="btn-primary" onclick="pharmacyOrders.createOrderFromPharmacy(${pharmacy.id})">
                        <i class="fas fa-shopping-cart"></i>
                        Ø·Ù„Ø¨ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©
                    </button>
                </div>
            </div>
        `;

        modal.style.display = 'block';
    }

    showNewOrderModal() {
        const modal = document.getElementById('newOrderModal');
        const modalBody = document.getElementById('newOrderBody');
        
        modalBody.innerHTML = `
            <div class="order-form">
                <div class="form-group">
                    <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</label>
                    <select class="form-select" id="selectedPharmacy">
                        <option value="">Ø§Ø®ØªØ± ØµÙŠØ¯Ù„ÙŠØ©...</option>
                        ${this.pharmacies.filter(p => p.delivery).map(pharmacy => `
                            <option value="${pharmacy.id}">${pharmacy.name} - ${pharmacy.distance ? pharmacy.distance + ' ÙƒÙ…' : ''}</option>
                        `).join('')}
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                    <div class="medicines-list" id="medicinesList">
                        <div class="empty-state" style="padding: 20px;">
                            <i class="fas fa-pills"></i>
                            <p>Ù„Ù… ØªØ¶Ù Ø£ÙŠ Ø£Ø¯ÙˆÙŠØ© Ø¨Ø¹Ø¯</p>
                        </div>
                    </div>
                    <button class="add-medicine-btn" onclick="pharmacyOrders.addMedicineItem()">
                        <i class="fas fa-plus"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡
                    </button>
                </div>

                <div class="form-group">
                    <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„</label>
                    <input type="text" class="form-input" id="deliveryAddress" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„" value="${this.userLocation?.address || ''}">
                </div>

                <div class="form-group">
                    <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                    <textarea class="form-textarea" id="orderNotes" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø·Ù„Ø¨..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                    <select class="form-select" id="paymentMethod">
                        <option value="Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©">Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</option>
                        <option value="Ù†Ù‚Ø¯ÙŠ">Ù†Ù‚Ø¯ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
                        <option value="Ø¨Ø·Ø§Ù‚Ø©">Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†</option>
                    </select>
                </div>

                <div class="order-summary">
                    <div class="order-total">
                        <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                        <span id="orderTotal">0 Ø±.ÙŠ</span>
                    </div>
                </div>

                <button class="btn-primary btn-full" onclick="pharmacyOrders.submitOrder()">
                    <i class="fas fa-paper-plane"></i>
                    ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
                </button>
            </div>
        `;

        modal.style.display = 'block';
    }

    // =============================================
    // Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    // =============================================

    addMedicineItem() {
        const medicinesList = document.getElementById('medicinesList');
        
        const medicineItem = document.createElement('div');
        medicineItem.className = 'medicine-item';
        medicineItem.innerHTML = `
            <div class="medicine-info">
                <input type="text" class="form-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡" style="margin-bottom: 8px;">
                <div class="medicine-details">
                    <input type="number" class="form-input" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" style="width: 80px;" min="1" value="1">
                    <input type="number" class="form-input" placeholder="Ø§Ù„Ø³Ø¹Ø±" style="width: 100px;" min="0" value="0">
                    <span>Ø±.ÙŠ</span>
                </div>
            </div>
            <button class="btn-secondary btn-small" onclick="this.parentElement.remove(); pharmacyOrders.updateOrderTotal()">
                <i class="fas fa-times"></i>
            </button>
        `;

        // Ø¥Ø²Ø§Ù„Ø© Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§Øº Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        const emptyState = medicinesList.querySelector('.empty-state');
        if (emptyState) {
            emptyState.remove();
        }

        medicinesList.appendChild(medicineItem);
    }

    updateOrderTotal() {
        const medicinesList = document.getElementById('medicinesList');
        const medicineItems = medicinesList.querySelectorAll('.medicine-item');
        
        let total = 0;
        
        medicineItems.forEach(item => {
            const quantity = parseInt(item.querySelector('input[placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©"]').value) || 0;
            const price = parseInt(item.querySelector('input[placeholder="Ø§Ù„Ø³Ø¹Ø±"]').value) || 0;
            total += quantity * price;
        });

        document.getElementById('orderTotal').textContent = total + ' Ø±.ÙŠ';
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§Øº Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø£Ø¯ÙˆÙŠØ©
        if (medicineItems.length === 0) {
            medicinesList.innerHTML = `
                <div class="empty-state" style="padding: 20px;">
                    <i class="fas fa-pills"></i>
                    <p>Ù„Ù… ØªØ¶Ù Ø£ÙŠ Ø£Ø¯ÙˆÙŠØ© Ø¨Ø¹Ø¯</p>
                </div>
            `;
        }
    }

    submitOrder() {
        const selectedPharmacy = document.getElementById('selectedPharmacy').value;
        const deliveryAddress = document.getElementById('deliveryAddress').value;
        const orderNotes = document.getElementById('orderNotes').value;
        const paymentMethod = document.getElementById('paymentMethod').value;

        if (!selectedPharmacy) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙŠØ¯Ù„ÙŠØ©');
            return;
        }

        const medicinesList = document.getElementById('medicinesList');
        const medicineItems = medicinesList.querySelectorAll('.medicine-item');
        
        if (medicineItems.length === 0) {
            alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø£Ø¯ÙˆÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
            return;
        }

        const items = [];
        medicineItems.forEach(item => {
            const name = item.querySelector('input[placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡"]').value;
            const quantity = parseInt(item.querySelector('input[placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©"]').value);
            const price = parseInt(item.querySelector('input[placeholder="Ø§Ù„Ø³Ø¹Ø±"]').value);
            
            if (name && quantity > 0 && price >= 0) {
                items.push({ name, quantity, price });
            }
        });

        if (items.length === 0) {
            alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
            return;
        }

        const total = items.reduce((sum, item) => sum + (item.quantity * item.price), 0);
        const pharmacy = this.pharmacies.find(p => p.id == selectedPharmacy);

        const newOrder = {
            id: 'PH-' + new Date().getFullYear() + '-' + (this.orders.length + 1).toString().padStart(3, '0'),
            pharmacyId: pharmacy.id,
            pharmacyName: pharmacy.name,
            items: items,
            total: total,
            status: 'pending',
            orderDate: new Date().toISOString().split('T')[0],
            deliveryDate: new Date().toISOString().split('T')[0],
            address: deliveryAddress,
            paymentMethod: paymentMethod,
            notes: orderNotes
        };

        this.orders.unshift(newOrder);
        this.updateOrdersLists();
        this.saveOrders();

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.getElementById('newOrderModal').style.display = 'none';
        this.renderCurrentOrders();

        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
        this.showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
    }

    cancelOrder(orderId) {
        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) {
            const order = this.orders.find(o => o.id === orderId);
            if (order) {
                order.status = 'cancelled';
                this.updateOrdersLists();
                this.saveOrders();
                this.renderCurrentOrders();
                
                if (document.getElementById('orderDetailsModal').style.display === 'block') {
                    document.getElementById('orderDetailsModal').style.display = 'none';
                }
                
                this.showNotification('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }
    }

    trackOrder(orderId) {
        // Ù…Ø­Ø§ÙƒØ§Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØªØ¨Ø¹
        alert('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªØªØ¨Ø¹...\nØ³ÙŠØªÙ… ÙØªØ­ Ø®Ø±ÙŠØ·Ø© ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨ Ù‚Ø±ÙŠØ¨Ø§Ù‹');
    }

    rateOrder(orderId) {
        const order = this.orders.find(o => o.id === orderId);
        if (!order) return;

        this.currentOrder = order;
        const modal = document.getElementById('ratingModal');
        
        const modalBody = document.getElementById('ratingModalBody');
        modalBody.innerHTML = `
            <div class="rating-form">
                <div class="form-group">
                    <label class="form-label">Ù‚ÙŠÙ… ØªØ¬Ø±Ø¨ØªÙƒ Ù…Ø¹ ${order.pharmacyName}</label>
                    <div class="rating-stars" id="ratingStars">
                        <i class="fas fa-star rating-star" data-rating="1"></i>
                        <i class="fas fa-star rating-star" data-rating="2"></i>
                        <i class="fas fa-star rating-star" data-rating="3"></i>
                        <i class="fas fa-star rating-star" data-rating="4"></i>
                        <i class="fas fa-star rating-star" data-rating="5"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ØªØ¹Ù„ÙŠÙ‚Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <textarea class="form-textarea" id="ratingComment" placeholder="Ø´Ø§Ø±ÙƒÙ†Ø§ ØªØ¬Ø±Ø¨ØªÙƒ Ù…Ø¹ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©..."></textarea>
                </div>

                <button class="btn-primary btn-full" onclick="pharmacyOrders.submitRating()">
                    <i class="fas fa-paper-plane"></i>
                    Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                </button>
            </div>
        `;

        // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ø¬ÙˆÙ…
        setTimeout(() => {
            document.querySelectorAll('.rating-star').forEach(star => {
                star.addEventListener('click', () => {
                    const rating = parseInt(star.dataset.rating);
                    this.setRatingStars(rating);
                });
            });
        }, 100);

        modal.style.display = 'block';
    }

    setRatingStars(rating) {
        document.querySelectorAll('.rating-star').forEach((star, index) => {
            if (index < rating) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
    }

    submitRating() {
        const activeStars = document.querySelectorAll('.rating-star.active').length;
        const comment = document.getElementById('ratingComment').value;

        if (activeStars === 0) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªÙ‚ÙŠÙŠÙ…');
            return;
        }

        // Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ø®Ø§Ø¯Ù…)
        this.showNotification('Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚ÙŠÙŠÙ…Ùƒ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        document.getElementById('ratingModal').style.display = 'none';
    }

    createOrderFromPharmacy(pharmacyId) {
        const pharmacy = this.pharmacies.find(p => p.id === pharmacyId);
        if (!pharmacy) return;

        this.showNewOrderModal();
        
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
        setTimeout(() => {
            document.getElementById('selectedPharmacy').value = pharmacy.id;
            if (this.userLocation?.address) {
                document.getElementById('deliveryAddress').value = this.userLocation.address;
            }
        }, 100);

        document.getElementById('pharmacyDetailsModal').style.display = 'none';
    }

    callPharmacy(phoneNumber) {
        if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø±Ù‚Ù…: ${phoneNumber}ØŸ`)) {
            window.location.href = `tel:${phoneNumber}`;
        }
    }

    printOrder(orderId) {
        const order = this.orders.find(o => o.id === orderId);
        if (!order) return;

        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <!DOCTYPE html>
            <html dir="rtl" lang="ar">
            <head>
                <title>Ø·Ø¨Ø§Ø¹Ø© Ø·Ù„Ø¨ ${order.id}</title>
                <meta charset="UTF-8">
                <style>
                    body { font-family: Arial, sans-serif; margin: 20px; font-size: 14px; }
                    .header { text-align: center; margin-bottom: 20px; }
                    .order-info { margin-bottom: 20px; }
                    .items-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                    .items-table th, .items-table td { border: 1px solid #ddd; padding: 8px; text-align: right; }
                    .total { font-weight: bold; font-size: 16px; text-align: left; }
                </style>
            </head>
            <body>
                <div class="header">
                    <h1>ÙØ§ØªÙˆØ±Ø© Ø·Ù„Ø¨ ØµÙŠØ¯Ù„ÙŠØ©</h1>
                    <p>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${order.id}</p>
                </div>
                <div class="order-info">
                    <p><strong>Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©:</strong> ${order.pharmacyName}</p>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${order.orderDate}</p>
                    <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:</strong> ${order.status}</p>
                </div>
                <table class="items-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø¯ÙˆØ§Ø¡</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${order.items.map(item => `
                            <tr>
                                <td>${item.name}</td>
                                <td>${item.quantity}</td>
                                <td>${item.price} Ø±.ÙŠ</td>
                                <td>${item.quantity * item.price} Ø±.ÙŠ</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${order.total} Ø±.ÙŠ</div>
            </body>
            </html>
        `);
        printWindow.document.close();
    }

    // =============================================
    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø§Øª
    // =============================================

    setupEventListeners() {
        // Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.switchTab(e.target.dataset.tab);
            });
        });

        // Ø§Ù„Ø¨Ø­Ø«
        document.getElementById('searchInput').addEventListener('input', (e) => {
            this.searchOrders(e.target.value);
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹
        document.getElementById('refreshLocation').addEventListener('click', () => {
            this.refreshLocation();
        });

        // Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¨Ø­Ø«
        document.getElementById('distanceRange').addEventListener('change', (e) => {
            this.distanceRange = parseInt(e.target.value);
            this.findNearbyPharmacies();
        });

        // Ø²Ø± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        document.getElementById('newOrderBtn').addEventListener('click', () => {
            this.showNewOrderModal();
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ°
        document.querySelectorAll('.close').forEach(closeBtn => {
            closeBtn.addEventListener('click', function() {
                this.closest('.modal').style.display = 'none';
            });
        });

        // Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†ÙˆØ§ÙØ°
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
    }

    switchTab(tabName) {
        this.currentTab = tabName;
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø´Ø·Ø©
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(tabName + 'Tab').classList.add('active');
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
        switch(tabName) {
            case 'current':
                this.renderCurrentOrders();
                break;
            case 'history':
                this.renderOrderHistory();
                break;
            case 'pharmacies':
                this.findNearbyPharmacies();
                break;
        }
    }

    searchOrders(query) {
        this.searchQuery = query.toLowerCase();
        
        if (this.currentTab === 'current') {
            const filteredOrders = this.currentOrders.filter(order => 
                order.id.toLowerCase().includes(this.searchQuery) ||
                order.pharmacyName.toLowerCase().includes(this.searchQuery) ||
                order.items.some(item => item.name.toLowerCase().includes(this.searchQuery))
            );
            
            this.renderFilteredOrders(filteredOrders, '#currentTab .orders-container');
        } else if (this.currentTab === 'history') {
            const filteredOrders = this.orderHistory.filter(order => 
                order.id.toLowerCase().includes(this.searchQuery) ||
                order.pharmacyName.toLowerCase().includes(this.searchQuery) ||
                order.items.some(item => item.name.toLowerCase().includes(this.searchQuery))
            );
            
            this.renderFilteredOrders(filteredOrders, '#historyTab .orders-container');
        }
    }

    renderFilteredOrders(orders, containerSelector) {
        const container = document.querySelector(containerSelector);
        
        if (orders.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-search"></i>
                    <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h3>
                    <p>Ù„Ù… Ù†Ø¹Ø«Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ</p>
                </div>
            `;
            return;
        }

        let ordersHTML = '';
        orders.forEach(order => {
            ordersHTML += this.generateOrderCard(order);
        });

        container.innerHTML = ordersHTML;
    }

    updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('ar-EG', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true 
        });
        document.getElementById('currentTime').textContent = timeString;
    }

    showNotification(message, type = 'info') {
        // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø³Ø§Ø¨Ù‚Ø©
        const existingNotifications = document.querySelectorAll('.custom-notification');
        existingNotifications.forEach(notification => notification.remove());

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯
        const notification = document.createElement('div');
        notification.className = `custom-notification ${type}`;
        notification.innerHTML = `
            <div style="
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#F44336' : '#2196F3'};
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 12px;
                animation: slideDown 0.3s ease-out;
                max-width: 90%;
            ">
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                ${message}
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 4 Ø«ÙˆØ§Ù†
        setTimeout(() => {
            if (notification.parentNode) {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
        }, 4000);
    }
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
document.addEventListener('DOMContentLoaded', function() {
    window.pharmacyOrders = new AdvancedPharmacyOrders();
});
    </script>
</body>
</html>
