<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M24- Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„ØªÙˆØµÙŠÙ„</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700;800&family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
:root {
    /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
    --primary: #00897B;
    --primary-dark: #00695C;
    --primary-light: #B2DFDB;
    --secondary: #FFB300;
    --accent: #FF5252;
    --success: #4CAF50;
    --warning: #FF9800;
    --info: #2196F3;
    --danger: #F44336;

    /* Ø®Ù„ÙÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
    --bg-light: #E0F2F1;
    --bg-surface: #ffffff;
    --shadow-light: -6px -6px 12px rgba(255, 255, 255, 0.9), 6px 6px 12px rgba(0, 0, 0, 0.1);
    --shadow-inset: inset 3px 3px 6px rgba(0, 0, 0, 0.1), inset -3px -3px 6px rgba(255, 255, 255, 0.9);
    --shadow-card: 0 10px 30px rgba(0, 0, 0, 0.15);
    --text-primary: #1E293B;
    --text-secondary: #475569;

    /* Ø§Ù„Ø²ÙˆØ§ÙŠØ§ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª */
    --radius-xl: 30px;
    --radius-lg: 20px;
    --radius-md: 16px;
    --radius-sm: 12px;
    --transition-liquid: all 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Tajawal', sans-serif;
    -webkit-tap-highlight-color: transparent;
}

body {
    background: var(--bg-light);
    color: var(--text-primary);
    direction: rtl;
    overflow-x: hidden;
    min-height: 100vh;
}

/* Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
.ultra-app {
    max-width: 450px;
    min-height: 100vh;
    margin: 0 auto;
    background: var(--bg-light);
    position: relative;
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.05);
    overflow-x: hidden;
    padding-bottom: 100px;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© */
.status-bar {
    background: transparent;
    color: var(--text-primary);
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    font-weight: 500;
    z-index: 1000;
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
.app-header {
    padding: 24px 20px 0;
}

.header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.title-section h1 {
    font-family: 'Almarai', sans-serif;
    font-size: 26px;
    font-weight: 800;
    color: var(--primary-dark);
    margin-bottom: 4px;
}

.title-section p {
    font-size: 14px;
    color: var(--text-secondary);
}

.company-actions {
    display: flex;
    gap: 10px;
}

.action-icon {
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    cursor: pointer;
    transition: var(--transition-liquid);
    position: relative;
    font-size: 18px;
}

.action-icon:active {
    box-shadow: var(--shadow-inset);
    color: var(--primary-dark);
}

.icon-badge {
    position: absolute;
    top: 5px;
    right: 5px;
    background: var(--accent);
    color: white;
    border-radius: 50%;
    width: 16px;
    height: 16px;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
.quick-stats-bar {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    padding: 0 20px 20px;
}

.stat-item {
    background: var(--bg-light);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-light);
    padding: 12px 8px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition-liquid);
    position: relative;
}

.stat-item.active {
    background: var(--primary);
    color: white;
    box-shadow: var(--shadow-inset);
}

.stat-item.active::before {
    content: '';
    position: absolute;
    bottom: -4px;
    right: 50%;
    transform: translateX(50%);
    width: 20px;
    height: 3px;
    background: var(--primary);
    border-radius: 2px;
}

.stat-number {
    font-family: 'Almarai', sans-serif;
    font-size: 18px;
    font-weight: 800;
    margin-bottom: 4px;
}

.stat-label {
    font-size: 10px;
    font-weight: 600;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… */
.control-bar {
    padding: 0 20px 20px;
    display: flex;
    gap: 12px;
    align-items: center;
}

.search-container {
    flex: 1;
}

.search-input-wrapper {
    position: relative;
    background: var(--bg-light);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-light);
    padding: 0 16px;
    display: flex;
    align-items: center;
}

.search-input-wrapper i {
    color: var(--text-secondary);
    margin-left: 8px;
}

.search-input-wrapper input {
    background: transparent;
    border: none;
    padding: 12px 0;
    width: 100%;
    color: var(--text-primary);
    font-size: 14px;
}

.search-input-wrapper input:focus {
    outline: none;
}

.search-input-wrapper input::placeholder {
    color: var(--text-secondary);
}

.filter-actions {
    display: flex;
    gap: 8px;
}

.filter-btn {
    background: var(--bg-light);
    border: none;
    padding: 12px 16px;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-light);
    color: var(--text-primary);
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: var(--transition-liquid);
    font-size: 14px;
}

.filter-btn:active {
    box-shadow: var(--shadow-inset);
}

.btn-primary {
    background: var(--primary);
    color: white;
    border: none;
    padding: 12px 16px;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-light);
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: var(--transition-liquid);
    font-size: 14px;
}

.btn-primary:active {
    box-shadow: var(--shadow-inset);
    transform: translateY(2px);
}

.btn-danger {
    background: var(--danger);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-weight: 600;
    transition: var(--transition-liquid);
}

.btn-danger:active {
    transform: translateY(2px);
}

/* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
    transition: opacity 0.3s ease-out;
    z-index: 2000;
}

.modal-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.4);
    box-shadow: var(--shadow-card);
    animation: modalSlideUp 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    max-height: 85vh;
    overflow-y: auto;
}

@keyframes modalSlideUp {
    from {opacity: 0; transform: translateY(100%);}
    to {opacity: 1; transform: translateY(0);}
}

.modal-header {
    background: var(--primary);
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
}

.modal-header h2 {
    margin: 0;
    font-size: 20px;
}

.close {
    font-size: 24px;
    cursor: pointer;
}

.modal-body {
    padding: 20px;
}

/* Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙ„ØªØ±Ø© */
.filter-section {
    margin-bottom: 24px;
}

.filter-section h4 {
    margin-bottom: 12px;
    color: var(--text-primary);
    font-size: 16px;
}

.filter-options {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.filter-option {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    padding: 8px 0;
}

.filter-option input {
    display: none;
}

.checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid var(--primary);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-liquid);
}

.filter-option input:checked + .checkmark {
    background: var(--primary);
}

.filter-option input:checked + .checkmark::after {
    content: 'âœ“';
    color: white;
    font-size: 12px;
}

.form-select {
    width: 100%;
    background: var(--bg-light);
    border: none;
    padding: 12px 16px;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-light);
    color: var(--text-primary);
    font-size: 14px;
    cursor: pointer;
}

.btn-secondary {
    background: var(--bg-light);
    color: var(--text-primary);
    border: none;
    padding: 12px 20px;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-light);
    cursor: pointer;
    font-weight: 600;
    flex: 1;
    transition: var(--transition-liquid);
}

.btn-secondary:active {
    box-shadow: var(--shadow-inset);
}

/* Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
.deliveries-container {
    padding: 0 20px 20px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.section-header h3 {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
}

.view-options {
    display: flex;
    gap: 8px;
    background: var(--bg-light);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-light);
    padding: 4px;
}

.view-option {
    background: transparent;
    border: none;
    width: 36px;
    height: 36px;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition-liquid);
}

.view-option.active {
    background: var(--primary);
    color: white;
    box-shadow: var(--shadow-light);
}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
.deliveries-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.delivery-item {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    padding: 16px;
    transition: var(--transition-liquid);
    cursor: pointer;
    border-right: 4px solid var(--primary);
}

.delivery-item:hover {
    box-shadow: var(--shadow-inset);
    transform: translateY(-2px);
}

.delivery-item.pending {
    border-right-color: var(--warning);
}

.delivery-item.in_progress {
    border-right-color: var(--info);
}

.delivery-item.delivered {
    border-right-color: var(--success);
}

.delivery-item.delayed {
    border-right-color: var(--danger);
}

.delivery-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
}

.order-info {
    flex: 1;
}

.order-number {
    font-weight: 700;
    margin-bottom: 4px;
    color: var(--text-primary);
}

.customer-name {
    font-size: 14px;
    color: var(--text-secondary);
}

.delivery-status {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-align: center;
}

.status-pending {
    background: #FFF3E0;
    color: #EF6C00;
}

.status-in_progress {
    background: #E3F2FD;
    color: #1565C0;
}

.status-delivered {
    background: #E8F5E8;
    color: #2E7D32;
}

.status-delayed {
    background: #FFEBEE;
    color: #C62828;
}

.delivery-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
}

.detail-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: var(--text-secondary);
}

.detail-item i {
    width: 16px;
    color: var(--primary);
}

.delivery-actions {
    display: flex;
    gap: 8px;
}

.action-btn {
    flex: 1;
    background: var(--bg-light);
    border: none;
    padding: 8px 12px;
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow-light);
    color: var(--text-primary);
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    transition: var(--transition-liquid);
}

.action-btn:active {
    box-shadow: var(--shadow-inset);
}

.action-btn.primary {
    background: var(--primary);
    color: white;
}

/* Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
.deliveries-map {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    overflow: hidden;
}

.map-placeholder {
    padding: 60px 20px;
    text-align: center;
    color: var(--text-secondary);
}

.map-placeholder i {
    font-size: 48px;
    margin-bottom: 16px;
    color: var(--primary);
}

.map-placeholder h4 {
    margin-bottom: 8px;
    color: var(--text-primary);
}

/* Ù‚Ø³Ù… Ø§Ù„Ø£Ø¯Ø§Ø¡ */
.performance-section {
    padding: 0 20px 20px;
}

.performance-cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
}

.performance-card {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    padding: 16px;
    text-align: center;
    transition: var(--transition-liquid);
}

.performance-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 12px;
    font-size: 20px;
    color: white;
}

.performance-icon.success {
    background: var(--success);
}

.performance-icon.warning {
    background: var(--warning);
}

.performance-icon.primary {
    background: var(--primary);
}

.performance-value {
    font-family: 'Almarai', sans-serif;
    font-size: 18px;
    font-weight: 800;
    margin-bottom: 4px;
    color: var(--text-primary);
}

.performance-label {
    font-size: 12px;
    color: var(--text-secondary);
}

.btn-text {
    background: none;
    border: none;
    color: var(--primary);
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: var(--transition-liquid);
}

/* Ù‚Ø³Ù… Ø§Ù„Ø³Ø¹Ø§Ø© */
.couriers-section {
    padding: 0 20px 20px;
}

.couriers-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.courier-item {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: var(--transition-liquid);
}

.courier-avatar {
    width: 50px;
    height: 50px;
    background: var(--primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 18px;
    font-weight: 600;
    flex-shrink: 0;
}

.courier-info {
    flex: 1;
}

.courier-name {
    font-weight: 700;
    margin-bottom: 4px;
    color: var(--text-primary);
}

.courier-details {
    font-size: 12px;
    color: var(--text-secondary);
}

.courier-status {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    font-weight: 600;
    flex-shrink: 0;
}

.status-online {
    color: var(--success);
}

.status-offline {
    color: var(--text-secondary);
}

.status-busy {
    color: var(--warning);
}

.status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.status-online .status-indicator {
    background: var(--success);
}

.status-offline .status-indicator {
    background: var(--text-secondary);
}

.status-busy .status-indicator {
    background: var(--warning);
}

/* Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
.form-group {
    margin-bottom: 16px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text-primary);
}

.form-input, .form-textarea {
    width: 100%;
    background: var(--bg-light);
    border: none;
    padding: 12px 16px;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-light);
    color: var(--text-primary);
    font-size: 14px;
    transition: var(--transition-liquid);
}

.form-input:focus, .form-textarea:focus {
    outline: none;
    box-shadow: var(--shadow-inset);
}

.form-textarea {
    resize: vertical;
    min-height: 80px;
}

.form-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
}

/* ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨ */
.tracking-container {
    padding: 20px 0;
}

.tracking-steps {
    display: flex;
    flex-direction: column;
    gap: 20px;
    position: relative;
}

.tracking-steps::before {
    content: '';
    position: absolute;
    right: 16px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--primary-light);
}

.tracking-step {
    display: flex;
    gap: 16px;
    align-items: flex-start;
    position: relative;
}

.step-icon {
    width: 32px;
    height: 32px;
    background: var(--primary-light);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    font-size: 14px;
    z-index: 2;
    flex-shrink: 0;
}

.step-icon.completed {
    background: var(--success);
    color: white;
}

.step-icon.current {
    background: var(--primary);
    color: white;
}

.step-content {
    flex: 1;
    padding-bottom: 8px;
}

.step-title {
    font-weight: 600;
    margin-bottom: 4px;
    color: var(--text-primary);
}

.step-description {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 4px;
}

.step-time {
    font-size: 12px;
    color: var(--text-secondary);
}

/* Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¶ÙˆØ¦ÙŠ */
.scan-container {
    text-align: center;
}

.scanner-placeholder {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    padding: 60px 20px;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
}

.scanner-placeholder i {
    font-size: 64px;
    margin-bottom: 16px;
    color: var(--primary);
}

.scan-actions {
    display: flex;
    gap: 12px;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
.bottom-nav-dock {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    display: flex;
    padding: 8px 10px;
    border-radius: var(--radius-xl);
    z-index: 1000;
    max-width: 360px;
    width: calc(100% - 40px);
    border: 1px solid rgba(255, 255, 255, 0.5);
}

.nav-item-dock {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px 0;
    border-radius: var(--radius-md);
    transition: var(--transition-liquid);
    flex: 1;
    position: relative;
    text-decoration: none;
    color: var(--text-secondary);
}

.nav-item-dock.active {
    color: var(--primary-dark);
}

.nav-item-dock.active .nav-icon-dock {
    background: var(--primary);
    color: white;
    box-shadow: 0 4px 15px rgba(0, 137, 123, 0.5);
    width: 44px;
    height: 44px;
    border-radius: 50%;
    transform: translateY(-10px);
    transition: var(--transition-liquid);
}

.nav-icon-dock {
    font-size: 20px;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    transition: var(--transition-liquid);
}

.nav-label {
    font-size: 10px;
    font-weight: 600;
    margin-top: 4px;
    transition: var(--transition-liquid);
}

.nav-item-dock.active .nav-label {
    font-weight: 800;
    color: var(--primary-dark);
}

/* Ù†Ù…Ø§Ø°Ø¬ Ø¥Ø¶Ø§ÙÙŠØ© */
.product-item {
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
    align-items: center;
}

.product-name {
    flex: 2;
}

.product-quantity {
    flex: 1;
}

.remove-product {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    font-weight: bold;
}

.notifications-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.notification-item {
    background: var(--bg-light);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-light);
    padding: 16px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
    transition: var(--transition-liquid);
}

.notification-item.unread {
    border-right: 4px solid var(--primary);
}

.notification-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
    flex-shrink: 0;
}

.notification-icon.info {
    background: var(--info);
}

.notification-icon.success {
    background: var(--success);
}

.notification-icon.warning {
    background: var(--warning);
}

.notification-icon.danger {
    background: var(--danger);
}

.notification-content {
    flex: 1;
}

.notification-title {
    font-weight: 600;
    margin-bottom: 4px;
    color: var(--text-primary);
}

.notification-message {
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 4px;
}

.notification-time {
    font-size: 12px;
    color: var(--text-secondary);
}

.couriers-full-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.courier-full-item {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: var(--transition-liquid);
}

.courier-actions {
    display: flex;
    gap: 8px;
}

.courier-action-btn {
    background: var(--bg-light);
    border: none;
    padding: 8px 12px;
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow-light);
    color: var(--text-primary);
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: var(--transition-liquid);
}

.courier-action-btn:active {
    box-shadow: var(--shadow-inset);
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ */
.liquid-transition {
    transition: var(--transition-liquid);
}

/* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ */
@media (max-width: 400px) {
    .quick-stats-bar {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .performance-cards {
        grid-template-columns: 1fr;
    }
    
    .control-bar {
        flex-direction: column;
    }
    
    .filter-actions {
        width: 100%;
    }
    
    .delivery-details {
        grid-template-columns: 1fr;
    }
    
    .delivery-actions {
        flex-direction: column;
    }
    
    .product-item {
        flex-direction: column;
    }
}

/* Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØªÙˆØ³Øª */
@keyframes slideDown {
    from { transform: translateX(-50%) translateY(-100px); opacity: 0; }
    to { transform: translateX(-50%) translateY(0); opacity: 1; }
}

@keyframes slideUp {
    from { transform: translateX(-50%) translateY(0); opacity: 1; }
    to { transform: translateX(-50%) translateY(-100px); opacity: 0; }
}
</style>
</head>
<body>
    <div class="ultra-app">
        <div class="status-bar">
            <div class="status-left">
                <span id="currentTime">--:--</span>
            </div>
            <div class="status-right">
                <i class="fas fa-signal"></i>
                <i class="fas fa-wifi"></i>
                <i class="fas fa-battery-full"></i>
            </div>
        </div>

        <div class="app-header">
            <div class="header-top">
                <div class="title-section">
                    <h1>M24 Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„ØªÙˆØµÙŠÙ„ ğŸšš</h1>
                    <p>Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„ØªØªØ¨Ø¹</p>
                </div>
                <div class="company-actions">
                    <button class="action-icon liquid-transition" id="notificationsBtn" onclick="window.shipping.showNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="icon-badge" id="notificationsBadge">3</span>
                    </button>
                    <button class="action-icon liquid-transition" id="scanBtn" onclick="window.shipping.showScanModal()">
                        <i class="fas fa-qrcode"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="quick-stats-bar">
            <div class="stat-item active" data-status="pending">
                <div class="stat-number" id="stat-pending-count">18</div>
                <div class="stat-label">Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„</div>
            </div>
            <div class="stat-item" data-status="in_progress">
                <div class="stat-number" id="stat-in_progress-count">12</div>
                <div class="stat-label">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„</div>
            </div>
            <div class="stat-item" data-status="delivered">
                <div class="stat-number" id="stat-delivered-count">45</div>
                <div class="stat-label">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</div>
            </div>
            <div class="stat-item" data-status="delayed">
                <div class="stat-number" id="stat-delayed-count">3</div>
                <div class="stat-label">Ù…ØªØ£Ø®Ø±Ø©</div>
            </div>
        </div>

        <div class="control-bar">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø§Ù„Ø¹Ù…ÙŠÙ„...">
                </div>
            </div>
            <div class="filter-actions">
                <button class="filter-btn" id="filterBtn" onclick="window.shipping.showFilterModal()">
                    <i class="fas fa-filter"></i>
                    Ø§Ù„ÙÙ„ØªØ±Ø©
                </button>
                <button class="btn-primary" id="newDeliveryBtn" onclick="window.shipping.createNewDelivery()">
                    <i class="fas fa-plus"></i>
                    ØªÙˆØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>
        </div>

        <div id="filterModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ÙÙ„ØªØ±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                    <span class="close" onclick="window.shipping.closeFilterModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="filter-section">
                        <h4>Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</h4>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="checkbox" name="status" value="pending" checked>
                                <span class="checkmark"></span>
                                Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="status" value="in_progress" checked>
                                <span class="checkmark"></span>
                                Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="status" value="delivered">
                                <span class="checkmark"></span>
                                ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="status" value="delayed">
                                <span class="checkmark"></span>
                                Ù…ØªØ£Ø®Ø±Ø©
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="status" value="cancelled">
                                <span class="checkmark"></span>
                                Ù…Ù„ØºÙŠØ©
                            </label>
                        </div>
                    </div>

                    <div class="filter-section">
                        <h4>Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØµÙŠÙ„</h4>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="express" checked>
                                <span class="checkmark"></span>
                                Ø³Ø±ÙŠØ¹
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="standard" checked>
                                <span class="checkmark"></span>
                                Ø¹Ø§Ø¯ÙŠ
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="scheduled">
                                <span class="checkmark"></span>
                                Ù…Ø¬Ø¯ÙˆÙ„
                            </label>
                        </div>
                    </div>

                    <div class="filter-section">
                        <h4>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</h4>
                        <select id="timeFilter" class="form-select">
                            <option value="today">Ø§Ù„ÙŠÙˆÙ…</option>
                            <option value="week">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
                            <option value="month" selected>Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</option>
                            <option value="custom">Ù…Ø®ØµØµ</option>
                        </select>
                    </div>

                    <div class="filter-actions">
                        <button class="btn-secondary" onclick="window.shipping.resetFilters()">
                            Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                        </button>
                        <button class="btn-primary" onclick="window.shipping.applyFilters()">
                            ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø©
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="deliveries-container">
            <div class="section-header">
                <h3>Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
                <div class="view-options">
                    <button class="view-option active" data-view="list">
                        <i class="fas fa-list"></i>
                    </button>
                    <button class="view-option" data-view="map">
                        <i class="fas fa-map"></i>
                    </button>
                </div>
            </div>

            <div id="listView" class="deliveries-list">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>

            <div id="mapView" class="deliveries-map" style="display: none;">
                <div class="map-placeholder">
                    <i class="fas fa-map-marked-alt"></i>
                    <h4>Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</h4>
                    <p>Ø¹Ø±Ø¶ ØªÙØ§Ø¹Ù„ÙŠ Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</p>
                    <button class="btn-primary" onclick="window.shipping.showRealMap()">
                        <i class="fas fa-map"></i>
                        Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
                    </button>
                </div>
            </div>
        </div>

        <div class="performance-section">
            <div class="section-header">
                <h3>Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
                <button class="btn-text" onclick="window.shipping.showPerformanceDetails()">
                    Ø§Ù„ØªÙØ§ØµÙŠÙ„
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>

            <div class="performance-cards">
                <div class="performance-card">
                    <div class="performance-icon success">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="performance-info">
                        <div class="performance-value">94%</div>
                        <div class="performance-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</div>
                    </div>
                </div>

                <div class="performance-card">
                    <div class="performance-icon warning">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="performance-info">
                        <div class="performance-value">28 Ø¯</div>
                        <div class="performance-label">Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª</div>
                    </div>
                </div>

                <div class="performance-card">
                    <div class="performance-icon primary">
                        <i class="fas fa-truck"></i>
                    </div>
                    <div class="performance-info">
                        <div class="performance-value">12</div>
                        <div class="performance-label">Ø³Ø§Ø¹ÙŠ Ù†Ø´Ø·</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="couriers-section">
            <div class="section-header">
                <h3>Ø§Ù„Ø³Ø¹Ø§Ø© Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</h3>
                <button class="btn-text" onclick="window.shipping.manageCouriers()">
                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¹Ø§Ø©
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>

            <div class="couriers-list" id="activeCouriers">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>

        <div class="bottom-nav-dock">
            <a href="index.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-home"></i>
                </div>
                <div class="nav-label">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
            </a>
            <a href="orders.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="nav-label">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
            </a>
            <a href="shipping.html" class="nav-item-dock active">
                <div class="nav-icon-dock">
                    <i class="fas fa-truck"></i>
                </div>
                <div class="nav-label">Ø§Ù„ØªÙˆØµÙŠÙ„</div>
            </a>
            <a href="customers.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-users"></i>
                </div>
                <div class="nav-label">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
            </a>
            <a href="reports.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <div class="nav-label">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
            </a>
        </div>
    </div>

    <!-- Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div id="orderDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="orderDetailsTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h2>
                <span class="close" onclick="window.shipping.closeOrderDetails()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="orderDetailsContent">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>
    </div>

    <div id="trackingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</h2>
                <span class="close" onclick="window.shipping.closeTracking()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="tracking-container" id="trackingContent">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>
    </div>

    <div id="assignCourierModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø¹ÙŠ</h2>
                <span class="close" onclick="window.shipping.closeAssignCourier()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="assign-form">
                    <div class="form-group">
                        <label>Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¹ÙŠ:</label>
                        <select id="courierSelect" class="form-select">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¹ÙŠ...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ÙˆÙ‚Øª Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</label>
                        <input type="datetime-local" id="estimatedTime" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                        <textarea id="deliveryNotes" class="form-textarea" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªÙˆØµÙŠÙ„..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button class="btn-secondary" onclick="window.shipping.closeAssignCourier()">Ø¥Ù„ØºØ§Ø¡</button>
                        <button class="btn-primary" onclick="window.shipping.confirmAssignment()">ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³Ø§Ø¹ÙŠ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="scanModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ù…Ø³Ø­ Ø§Ù„Ø·Ù„Ø¨</h2>
                <span class="close" onclick="window.shipping.closeScanModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="scan-container">
                    <div class="scanner-placeholder">
                        <i class="fas fa-qrcode"></i>
                        <p>Ø¶Ø¹ ÙƒÙˆØ¯ QR Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¥Ø·Ø§Ø± Ù„Ù„Ù…Ø³Ø­</p>
                    </div>
                    <div class="scan-actions">
                        <button class="btn-secondary" onclick="window.shipping.closeScanModal()">
                            <i class="fas fa-times"></i>
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button class="btn-primary" onclick="window.shipping.simulateScan()">
                            <i class="fas fa-camera"></i>
                            Ù…Ø³Ø­ Ø¶ÙˆØ¦ÙŠ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="newDeliveryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ØªÙˆØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h2>
                <span class="close" onclick="window.shipping.closeNewDeliveryModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="new-delivery-form">
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</label>
                        <input type="text" id="newOrderNumber" class="form-input" placeholder="Ù…Ø«Ø§Ù„: ORD-2024-001">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
                        <input type="text" id="newCustomerName" class="form-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
                    </div>
                    <div class="form-group">
                        <label>Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
                        <input type="tel" id="newCustomerPhone" class="form-input" placeholder="+966501234567">
                    </div>
                    <div class="form-group">
                        <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„:</label>
                        <textarea id="newCustomerAddress" class="form-textarea" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØµÙŠÙ„:</label>
                        <select id="newDeliveryType" class="form-select">
                            <option value="express">Ø³Ø±ÙŠØ¹</option>
                            <option value="standard" selected>Ø¹Ø§Ø¯ÙŠ</option>
                            <option value="scheduled">Ù…Ø¬Ø¯ÙˆÙ„</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</label>
                        <div id="productsContainer">
                            <div class="product-item">
                                <input type="text" class="form-input product-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
                                <input type="number" class="form-input product-quantity" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" min="1">
                                <button class="btn-danger remove-product" onclick="window.shipping.removeProduct(this)">Ã—</button>
                            </div>
                        </div>
                        <button class="btn-secondary" onclick="window.shipping.addProduct()">
                            <i class="fas fa-plus"></i>
                            Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
                        </button>
                    </div>
                    <div class="form-group">
                        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                        <textarea id="newDeliveryNotes" class="form-textarea" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªÙˆØµÙŠÙ„..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button class="btn-secondary" onclick="window.shipping.closeNewDeliveryModal()">Ø¥Ù„ØºØ§Ø¡</button>
                        <button class="btn-primary" onclick="window.shipping.confirmNewDelivery()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆØµÙŠÙ„</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
                <span class="close" onclick="window.shipping.closeNotificationsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="notifications-list" id="notificationsList">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>
    </div>

    <div id="couriersManagementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¹Ø§Ø©</h2>
                <span class="close" onclick="window.shipping.closeCouriersManagementModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="couriers-management">
                    <div class="section-header">
                        <h3>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¹Ø§Ø©</h3>
                        <button class="btn-primary" onclick="window.shipping.showAddCourierModal()">
                            <i class="fas fa-plus"></i>
                            Ø¥Ø¶Ø§ÙØ© Ø³Ø§Ø¹ÙŠ
                        </button>
                    </div>
                    <div class="couriers-full-list" id="couriersFullList">
                        <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="addCourierModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø¥Ø¶Ø§ÙØ© Ø³Ø§Ø¹ÙŠ Ø¬Ø¯ÙŠØ¯</h2>
                <span class="close" onclick="window.shipping.closeAddCourierModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="add-courier-form">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¹ÙŠ:</label>
                        <input type="text" id="newCourierName" class="form-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¹ÙŠ">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                        <input type="tel" id="newCourierPhone" class="form-input" placeholder="+966501234567">
                    </div>
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:</label>
                        <select id="newCourierVehicle" class="form-select">
                            <option value="Ø¯Ø±Ø§Ø¬Ø© Ù†Ø§Ø±ÙŠØ©">Ø¯Ø±Ø§Ø¬Ø© Ù†Ø§Ø±ÙŠØ©</option>
                            <option value="Ø³ÙŠØ§Ø±Ø©">Ø³ÙŠØ§Ø±Ø©</option>
                            <option value="Ø´Ø§Ø­Ù†Ø© ØµØºÙŠØ±Ø©">Ø´Ø§Ø­Ù†Ø© ØµØºÙŠØ±Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:</label>
                        <input type="text" id="newCourierVehicleNumber" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ù… 1234">
                    </div>
                    <div class="form-actions">
                        <button class="btn-secondary" onclick="window.shipping.closeAddCourierModal()">Ø¥Ù„ØºØ§Ø¡</button>
                        <button class="btn-primary" onclick="window.shipping.confirmAddCourier()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø§Ø¹ÙŠ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
// Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
class ShippingManagement {
    constructor() {
        this.deliveries = [];
        this.couriers = [];
        this.filteredDeliveries = [];
        this.currentDelivery = null;
        this.currentView = 'list';
        this.currentFilters = {
            status: ['pending', 'in_progress'],
            type: ['express', 'standard'],
            timeRange: 'month'
        };
        this.socket = null;
        this.courierLocations = new Map();
        this.notifications = [];
        this.init();
    }

    init() {
        this.loadData();
        this.setupEventListeners();
        this.setupRealTimeConnection();
        this.renderDeliveries();
        this.renderCouriers();
        this.updateTime();
        this.startRealTimeUpdates();
        this.updateStatisticsDisplay();
        this.setupNotifications();
    }

    setupRealTimeConnection() {
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§ØªØµØ§Ù„ WebSocket Ø­Ù‚ÙŠÙ‚ÙŠ
        this.socket = {
            connected: true,
            on: (event, callback) => {
                if (event === 'courier_location_update') {
                    this.setupCourierLocationUpdates(callback);
                } else if (event === 'delivery_status_update') {
                    this.setupDeliveryStatusUpdates(callback);
                } else if (event === 'new_notification') {
                    this.setupNotificationUpdates(callback);
                }
            },
            emit: (event, data) => {
                console.log(`Emitting ${event}:`, data);
            }
        };

        // Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
        this.socket.on('courier_location_update', this.handleCourierLocationUpdate.bind(this));
        this.socket.on('delivery_status_update', this.handleDeliveryStatusUpdate.bind(this));
        this.socket.on('new_notification', this.handleNewNotification.bind(this));
    }

    setupCourierLocationUpdates(callback) {
        // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        setInterval(() => {
            this.couriers.filter(c => c.online).forEach(courier => {
                const newLocation = this.generateRandomLocation(courier.currentLocation);
                callback({
                    courierId: courier.id,
                    location: newLocation,
                    timestamp: new Date().toISOString()
                });
            });
        }, 5000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
    }

    setupDeliveryStatusUpdates(callback) {
        // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ø¯ÙŠØ«Ø§Øª Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        setInterval(() => {
            const inProgressDeliveries = this.deliveries.filter(d => 
                d.status === 'in_progress' && Math.random() > 0.9 // Ø§Ø­ØªÙ…Ø§Ù„ 10%
            );
            
            inProgressDeliveries.forEach(delivery => {
                callback({
                    deliveryId: delivery.id,
                    status: 'delivered',
                    timestamp: new Date().toISOString()
                });
            });
        }, 10000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
    }

    setupNotificationUpdates(callback) {
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        setInterval(() => {
            if (Math.random() > 0.8) { // Ø§Ø­ØªÙ…Ø§Ù„ 20%
                const notificationTypes = [
                    {
                        type: 'new_delivery',
                        title: 'Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯',
                        message: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø¹ÙŠ',
                        icon: 'fas fa-truck'
                    },
                    {
                        type: 'delivery_delayed',
                        title: 'ØªØ£Ø®Ø± ÙÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„',
                        message: 'Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„ Ù…ØªØ£Ø®Ø± ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…ØªØ§Ø¨Ø¹Ø©',
                        icon: 'fas fa-clock'
                    },
                    {
                        type: 'courier_assigned',
                        title: 'ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø¹ÙŠ',
                        message: 'ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø¹ÙŠ Ù„Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­',
                        icon: 'fas fa-user-check'
                    }
                ];
                
                const randomNotification = notificationTypes[Math.floor(Math.random() * notificationTypes.length)];
                callback({
                    ...randomNotification,
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    read: false
                });
            }
        }, 30000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
    }

    handleCourierLocationUpdate(data) {
        const courier = this.couriers.find(c => c.id === data.courierId);
        if (courier) {
            courier.currentLocation = data.location;
            this.courierLocations.set(courier.id, {
                location: data.location,
                timestamp: data.timestamp
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø§Ø¹ÙŠ Ù…Ø¹Ø±ÙˆØ¶Ø§Ù‹
            this.updateCourierDisplay(courier.id);
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¹Ø±Ø¶ Ù„Ù„Ø®Ø±ÙŠØ·Ø©ØŒ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹
            if (this.currentView === 'map') {
                this.updateMapView();
            }
            this.saveData();
        }
    }

    handleDeliveryStatusUpdate(data) {
        const delivery = this.deliveries.find(d => d.id === data.deliveryId);
        if (delivery && delivery.status !== data.status) {
            delivery.status = data.status;
            delivery.actualTime = data.timestamp;
            
            // ØªØ­Ø¯ÙŠØ« ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨
            const deliveredStep = delivery.tracking.find(step => step.step === 'delivered');
            if (deliveredStep) {
                deliveredStep.completed = true;
                deliveredStep.time = data.timestamp;
            }
            
            this.saveData();
            this.renderDeliveries();
            this.updateStatisticsDisplay();
            
            this.showToast(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ${delivery.orderNumber} Ø¥Ù„Ù‰ "${this.getStatusText(data.status)}"`);
        }
    }

    handleNewNotification(data) {
        this.notifications.unshift(data);
        this.saveData();
        this.updateNotificationsBadge();
        
        // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± ÙÙˆØ±ÙŠ
        this.showToast(data.message, 'info');
    }

    generateRandomLocation(currentLocation) {
        const areas = {
            'ØµÙ†Ø¹Ø§Ø¡': ['Ø¯Ø§Ø±Ø³', 'Ø§Ù„Ø­ØµØ¨Ø©', 'Ø§Ù„Ø³ØªÙŠÙ†', 'Ø­Ø¯Ø©', 'Ø³Ø¹ÙˆØ§Ù†', 'Ø§Ù„Ø³Ø¨Ø¹ÙŠÙ†'],
            'Ø­Ø¬Ø©': ['Ù‚Ø§Ø±Ø©', 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'ÙˆØ´Ø­Ø©', 'ÙƒØ´Ø±', 'Ø¹Ø§Ù‡Ù…'],
            'Ø¹Ù…Ø±Ø§Ù†': ['Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'Ø®Ø§Ø±Ù', 'Ø­ÙˆØ«', 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©']
        };
        
        const cityMatch = currentLocation.match(/(\S+)/);
        const city = cityMatch ? cityMatch[1] : 'ØµÙ†Ø¹Ø§Ø¡';
        const availableAreas = areas[city] || ['Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©'];
        const randomArea = availableAreas[Math.floor(Math.random() * availableAreas.length)];
        
        return `${city} - ${randomArea}`;
    }

    updateCourierDisplay(courierId) {
        const courierElement = document.querySelector(`[data-courier-id="${courierId}"]`);
        if (courierElement) {
            const courier = this.couriers.find(c => c.id === courierId);
            const locationElement = courierElement.querySelector('.courier-location');
            if (locationElement && courier) {
                locationElement.textContent = courier.currentLocation;
            }
        }
    }

    loadData() {
        const savedDeliveries = localStorage.getItem('pharma_shipping_deliveries');
        const savedCouriers = localStorage.getItem('pharma_shipping_couriers');
        const savedNotifications = localStorage.getItem('pharma_shipping_notifications');

        if (savedDeliveries) {
            this.deliveries = JSON.parse(savedDeliveries);
        } else {
            this.deliveries = this.getDefaultDeliveries();
        }

        if (savedCouriers) {
            this.couriers = JSON.parse(savedCouriers);
        } else {
            this.couriers = this.getDefaultCouriers();
        }

        if (savedNotifications) {
            this.notifications = JSON.parse(savedNotifications);
        } else {
            this.notifications = this.getDefaultNotifications();
        }

        this.filteredDeliveries = [...this.deliveries];
        this.saveData();
    }

    getDefaultDeliveries() {
        return [
            {
                id: 1,
                orderNumber: 'ORD-2024-001',
                customerName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                customerPhone: '+966501234567',
                customerAddress: 'ØµÙ†Ø¹Ø§Ø¡ - Ø­Ø¯Ø© - Ø´Ø§Ø±Ø¹ Ø§Ù„Ø®Ù…Ø³ÙŠÙ† ',
                deliveryType: 'express',
                status: 'in_progress',
                assignedCourier: 1,
                estimatedTime: '2024-11-14T14:30:00',
                actualTime: null,
                items: [
                    { name: 'Ø¨Ø§Ø±Ø§Ø³ÙŠØªØ§Ù…ÙˆÙ„ 500 Ù…Ø¬Ù…', quantity: 2 },
                    { name: 'ÙÙŠØªØ§Ù…ÙŠÙ† Ø³ÙŠ 1000 Ù…Ø¬Ù…', quantity: 1 }
                ],
                totalAmount: 165,
                deliveryFee: 15,
                notes: 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ù‚Ø¨Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ø¨Ù€ 30 Ø¯Ù‚ÙŠÙ‚Ø©',
                tracking: [
                    { step: 'order_placed', description: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', time: '2024-11-14T10:00:00', completed: true },
                    { step: 'preparing', description: 'Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨', time: '2024-11-14T10:15:00', completed: true },
                    { step: 'assigned', description: 'ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³Ø§Ø¹ÙŠ', time: '2024-11-14T10:30:00', completed: true },
                    { step: 'picked_up', description: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±', time: '2024-11-14T13:45:00', completed: true },
                    { step: 'on_the_way', description: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ù„Ù„ØªÙˆØµÙŠÙ„', time: '2024-11-14T14:00:00', completed: true },
                    { step: 'delivered', description: 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…', time: null, completed: false }
                ],
                createdAt: '2024-11-14T10:00:00'
            },
            {
                id: 2,
                orderNumber: 'ORD-2024-002',
                customerName: 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ',
                customerPhone: '+966502345678',
                customerAddress: 'Ø­Ø¬Ø© - Ù‚Ø§Ø±Ø© -  Ø§Ù„Ø­Ø¨Ø§Ù„',
                deliveryType: 'standard',
                status: 'pending',
                assignedCourier: null,
                estimatedTime: '2024-11-14T16:00:00',
                actualTime: null,
                items: [
                    { name: 'ÙƒØ±ÙŠÙ… Ù‡ÙŠØ¯Ø±ÙˆÙƒÙˆØ±ØªÙŠØ²ÙˆÙ† 1%', quantity: 1 },
                    { name: 'Ù‚Ø·Ø±Ø© Ø§Ù„Ø¹ÙŠÙ† Ø§Ù„Ù…Ø±Ø·Ø¨Ø©', quantity: 1 }
                ],
                totalAmount: 50,
                deliveryFee: 10,
                notes: 'Ø§Ù„Ø¹Ù…ÙŠÙ„Ø© ØªÙ†ØªØ¸Ø± Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø¨ÙØ§Ø±Øº Ø§Ù„ØµØ¨Ø±',
                tracking: [
                    { step: 'order_placed', description: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', time: '2024-11-14T11:30:00', completed: true },
                    { step: 'preparing', description: 'Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨', time: '2024-11-14T11:45:00', completed: true },
                    { step: 'assigned', description: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø¹ÙŠ', time: null, completed: false },
                    { step: 'picked_up', description: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…', time: null, completed: false },
                    { step: 'on_the_way', description: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙˆØµÙŠÙ„', time: null, completed: false },
                    { step: 'delivered', description: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ³Ù„ÙŠÙ…', time: null, completed: false }
                ],
                createdAt: '2024-11-14T11:30:00'
            },
            {
                id: 3,
                orderNumber: 'ORD-2024-003',
                customerName: 'Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡',
                customerPhone: '+966503456789',
                customerAddress: 'Ø¹Ù…Ø±Ø§Ù† - Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© - Ø´Ø§Ø±Ø¹ Ø¹Ø´Ø±ÙŠÙ†',
                deliveryType: 'express',
                status: 'delivered',
                assignedCourier: 2,
                estimatedTime: '2024-11-13T15:00:00',
                actualTime: '2024-11-13T14:45:00',
                items: [
                    { name: 'Ø£ÙˆÙ…ÙŠØºØ§ 3 ÙƒØ¨Ø³ÙˆÙ„Ø§Øª', quantity: 1 },
                    { name: 'Ø£Ù…ÙˆÙƒØ³ÙŠØ³ÙŠÙ„ÙŠÙ† 500 Ù…Ø¬Ù…', quantity: 2 }
                ],
                totalAmount: 145,
                deliveryFee: 15,
                notes: 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø´Ø®ØµÙŠØ§Ù‹',
                tracking: [
                    { step: 'order_placed', description: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', time: '2024-11-13T13:00:00', completed: true },
                    { step: 'preparing', description: 'Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨', time: '2024-11-13T13:15:00', completed: true },
                    { step: 'assigned', description: 'ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³Ø§Ø¹ÙŠ', time: '2024-11-13T13:30:00', completed: true },
                    { step: 'picked_up', description: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±', time: '2024-11-13T14:00:00', completed: true },
                    { step: 'on_the_way', description: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ù„Ù„ØªÙˆØµÙŠÙ„', time: '2024-11-13T14:15:00', completed: true },
                    { step: 'delivered', description: 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…', time: '2024-11-13T14:45:00', completed: true }
                ],
                createdAt: '2024-11-13T13:00:00'
            },
            {
                id: 4,
                orderNumber: 'ORD-2024-004',
                customerName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø³Ø¹Ø¯',
                customerPhone: '+966504567890',
                customerAddress: 'ØµÙ†Ø¹Ø§Ø¡ - Ø§Ù„Ø³ØªÙŠÙ† - Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ† Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠ',
                deliveryType: 'scheduled',
                status: 'delayed',
                assignedCourier: 3,
                estimatedTime: '2024-11-14T12:00:00',
                actualTime: null,
                items: [
                    { name: 'ÙÙŠØªØ§Ù…ÙŠÙ† Ø³ÙŠ 1000 Ù…Ø¬Ù…', quantity: 1 },
                    { name: 'Ø´Ø±Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø§Ù„ Ù„Ù„Ø£Ø·ÙØ§Ù„', quantity: 1 }
                ],
                totalAmount: 63,
                deliveryFee: 10,
                notes: 'ØªØ£Ø®Ø± Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø²Ø­Ø§Ù… Ø§Ù„Ù…Ø±ÙˆØ±ÙŠ',
                tracking: [
                    { step: 'order_placed', description: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', time: '2024-11-14T09:00:00', completed: true },
                    { step: 'preparing', description: 'Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨', time: '2024-11-14T09:15:00', completed: true },
                    { step: 'assigned', description: 'ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³Ø§Ø¹ÙŠ', time: '2024-11-14T09:30:00', completed: true },
                    { step: 'picked_up', description: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±', time: '2024-11-14T10:00:00', completed: true },
                    { step: 'on_the_way', description: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ù„Ù„ØªÙˆØµÙŠÙ„', time: '2024-11-14T10:30:00', completed: true },
                    { step: 'delivered', description: 'Ù…ØªØ£Ø®Ø± ÙÙŠ Ø§Ù„ØªØ³Ù„ÙŠÙ…', time: null, completed: false }
                ],
                createdAt: '2024-11-14T09:00:00'
            },
            {
                id: 5,
                orderNumber: 'ORD-2024-005',
                customerName: 'Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯',
                customerPhone: '+966505678901',
                customerAddress: 'ØµÙ†Ø¹Ø§Ø¡ - Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø·Ø§Ø± -   Ø¯Ø§Ø±Ø³',
                deliveryType: 'standard',
                status: 'pending',
                assignedCourier: null,
                estimatedTime: '2024-11-14T17:00:00',
                actualTime: null,
                items: [
                    { name: 'Ø¨Ø§Ø±Ø§Ø³ÙŠØªØ§Ù…ÙˆÙ„ 500 Ù…Ø¬Ù…', quantity: 3 },
                    { name: 'Ù‚Ø·Ø±Ø© Ø§Ù„Ø¹ÙŠÙ† Ø§Ù„Ù…Ø±Ø·Ø¨Ø©', quantity: 2 }
                ],
                totalAmount: 89,
                deliveryFee: 10,
                notes: '',
                tracking: [
                    { step: 'order_placed', description: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', time: '2024-11-14T12:00:00', completed: true },
                    { step: 'preparing', description: 'Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨', time: '2024-11-14T12:15:00', completed: true },
                    { step: 'assigned', description: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø¹ÙŠ', time: null, completed: false },
                    { step: 'picked_up', description: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…', time: null, completed: false },
                    { step: 'on_the_way', description: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙˆØµÙŠÙ„', time: null, completed: false },
                    { step: 'delivered', description: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ³Ù„ÙŠÙ…', time: null, completed: false }
                ],
                createdAt: '2024-11-14T12:00:00'
            }
        ];
    }

    getDefaultCouriers() {
        return [
            {
                id: 1,
                name: 'Ø³Ø§Ù„Ù… Ù…Ø­Ù…Ø¯',
                phone: '+966511223344',
                vehicle: 'Ø¯Ø±Ø§Ø¬Ø© Ù†Ø§Ø±ÙŠØ©',
                vehicleNumber: 'Ù… 1234',
                status: 'busy',
                currentLocation: 'ØµÙ†Ø¹Ø§Ø¡ - Ø¯Ø§Ø±Ø³',
                deliveriesToday: 8,
                rating: 4.8,
                online: true
            },
            {
                id: 2,
                name: 'ÙÙ‡Ø¯ Ø£Ø­Ù…Ø¯',
                phone: '+966522334455',
                vehicle: 'Ø³ÙŠØ§Ø±Ø©',
                vehicleNumber: 'Ù… 5678',
                status: 'online',
                currentLocation: 'ØµÙ†Ø¹Ø§Ø¡ - Ø§Ù„Ø³ØªÙŠÙ†',
                deliveriesToday: 5,
                rating: 4.9,
                online: true
            },
            {
                id: 3,
                name: 'Ù†Ø§ØµØ± Ø®Ø§Ù„Ø¯',
                phone: '+966533445566',
                vehicle: 'Ø¯Ø±Ø§Ø¬Ø© Ù†Ø§Ø±ÙŠØ©',
                vehicleNumber: 'Ù… 9012',
                status: 'online',
                currentLocation: 'ØµÙ†Ø¹Ø§Ø¡ - Ø³Ø¹ÙˆØ§Ù†',
                deliveriesToday: 6,
                rating: 4.7,
                online: true
            },
            {
                id: 4,
                name: 'ÙŠÙˆØ³Ù Ø¹Ù„ÙŠ',
                phone: '+966544556677',
                vehicle: 'Ø³ÙŠØ§Ø±Ø©',
                vehicleNumber: 'Ù… 3456',
                status: 'offline',
                currentLocation: 'ØµÙ†Ø¹Ø§Ø¡ - Ø­Ø¯Ø©',
                deliveriesToday: 0,
                rating: 4.6,
                online: false
            }
        ];
    }

    getDefaultNotifications() {
        return [
            {
                id: 1,
                type: 'new_delivery',
                title: 'Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯',
                message: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯ ORD-2024-006',
                icon: 'fas fa-truck',
                timestamp: '2024-11-14T10:15:00',
                read: false
            },
            {
                id: 2,
                type: 'delivery_delayed',
                title: 'ØªØ£Ø®Ø± ÙÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„',
                message: 'Ø·Ù„Ø¨ ORD-2024-004 Ù…ØªØ£Ø®Ø± Ø¹Ù† Ù…ÙˆØ¹Ø¯Ù‡',
                icon: 'fas fa-clock',
                timestamp: '2024-11-14T09:45:00',
                read: false
            },
            {
                id: 3,
                type: 'courier_assigned',
                title: 'ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø¹ÙŠ',
                message: 'ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø¹ÙŠ Ø³Ø§Ù„Ù… Ù…Ø­Ù…Ø¯ Ù„Ø·Ù„Ø¨ ORD-2024-001',
                icon: 'fas fa-user-check',
                timestamp: '2024-11-14T08:30:00',
                read: true
            }
        ];
    }

    saveData() {
        localStorage.setItem('pharma_shipping_deliveries', JSON.stringify(this.deliveries));
        localStorage.setItem('pharma_shipping_couriers', JSON.stringify(this.couriers));
        localStorage.setItem('pharma_shipping_notifications', JSON.stringify(this.notifications));
    }

    setupEventListeners() {
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.searchDeliveries(e.target.value);
            });
        }

        document.querySelectorAll('.stat-item').forEach(item => {
            item.addEventListener('click', (e) => {
                this.filterByStatus(e);
            });
        });

        document.querySelectorAll('.view-option').forEach(option => {
            option.addEventListener('click', (e) => {
                this.changeView(e.currentTarget.dataset.view);
            });
        });

        setInterval(() => {
            this.updateTime();
        }, 60000);

        window.addEventListener('click', (e) => {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
    }

    setupNotifications() {
        this.updateNotificationsBadge();
    }

    updateNotificationsBadge() {
        const unreadCount = this.notifications.filter(n => !n.read).length;
        const badge = document.getElementById('notificationsBadge');
        if (badge) {
            badge.textContent = unreadCount;
            badge.style.display = unreadCount > 0 ? 'flex' : 'none';
        }
    }

    updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('ar-EG', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true 
        });
        const timeElement = document.getElementById('currentTime');
        if (timeElement) {
            timeElement.textContent = timeString;
        }
    }

    updateStatisticsDisplay() {
        const counts = this.deliveries.reduce((acc, delivery) => {
            acc[delivery.status] = (acc[delivery.status] || 0) + 1;
            return acc;
        }, {});

        document.getElementById('stat-pending-count').textContent = counts['pending'] || 0;
        document.getElementById('stat-in_progress-count').textContent = (counts['in_progress'] || 0) + (counts['assigned'] || 0);
        document.getElementById('stat-delivered-count').textContent = counts['delivered'] || 0;
        document.getElementById('stat-delayed-count').textContent = counts['delayed'] || 0;
    }

    searchDeliveries(query) {
        if (query.trim() === '') {
            this.applyFilters(); 
        } else {
            const searchTerm = query.toLowerCase();
            this.filteredDeliveries = this.deliveries.filter(delivery => 
                delivery.orderNumber.toLowerCase().includes(searchTerm) ||
                delivery.customerName.toLowerCase().includes(searchTerm) ||
                delivery.customerPhone.includes(searchTerm)
            );
        }
        
        this.renderDeliveries();
    }

    filterByStatus(e) {
        const statusItem = e.currentTarget.closest('.stat-item');
        const status = statusItem.dataset.status;

        document.querySelectorAll('.stat-item').forEach(item => item.classList.remove('active'));
        statusItem.classList.add('active');

        this.currentFilters.status = [status];
        this.currentFilters.type = ['express', 'standard', 'scheduled'];
        this.currentFilters.timeRange = 'month';
        
        document.querySelectorAll('input[name="status"]').forEach(cb => {
            cb.checked = cb.value === status;
        });
        document.querySelectorAll('input[name="type"]').forEach(cb => {
            cb.checked = true;
        });
        document.getElementById('timeFilter').value = 'month';

        this.applyFilters(false);
    }

    showFilterModal() {
        document.getElementById('filterModal').style.display = 'block';
    }

    closeFilterModal() {
        document.getElementById('filterModal').style.display = 'none';
    }

    applyFilters(showToast = true) {
        const statusCheckboxes = document.querySelectorAll('#filterModal input[name="status"]:checked');
        this.currentFilters.status = Array.from(statusCheckboxes).map(cb => cb.value);
        
        const typeCheckboxes = document.querySelectorAll('#filterModal input[name="type"]:checked');
        this.currentFilters.type = Array.from(typeCheckboxes).map(cb => cb.value);
        
        this.currentFilters.timeRange = document.getElementById('timeFilter').value;

        this.filteredDeliveries = this.deliveries.filter(delivery => {
            const statusMatch = this.currentFilters.status.includes(delivery.status);
            const typeMatch = this.currentFilters.type.includes(delivery.deliveryType);
            const timeMatch = this.checkTimeRange(delivery.createdAt, this.currentFilters.timeRange);
            
            return statusMatch && typeMatch && timeMatch;
        });
        
        document.querySelectorAll('.stat-item').forEach(item => item.classList.remove('active'));
        
        this.renderDeliveries();
        this.closeFilterModal();
        
        if (showToast) {
            this.showToast('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø© Ø¨Ù†Ø¬Ø§Ø­');
        }
    }

    resetFilters() {
        document.querySelectorAll('#filterModal input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = true;
        });
        document.getElementById('timeFilter').value = 'month';
        
        this.currentFilters = {
            status: ['pending', 'in_progress', 'delivered', 'delayed', 'cancelled'],
            type: ['express', 'standard', 'scheduled'],
            timeRange: 'month'
        };
        
        this.filteredDeliveries = [...this.deliveries];
        this.renderDeliveries();
        this.showToast('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±');
    }

    checkTimeRange(dateString, timeRange) {
        const date = new Date(dateString);
        const now = new Date();
        
        switch(timeRange) {
            case 'today':
                return date.toDateString() === now.toDateString();
            case 'week':
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                return date >= weekAgo;
            case 'month':
                const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                return date >= monthAgo;
            default:
                return true;
        }
    }

    changeView(view) {
        this.currentView = view;
        
        document.querySelectorAll('.view-option').forEach(option => {
            option.classList.toggle('active', option.dataset.view === view);
        });
        
        document.getElementById('listView').style.display = view === 'list' ? 'block' : 'none';
        document.getElementById('mapView').style.display = view === 'map' ? 'block' : 'none';
        
        if (view === 'map') {
            this.updateMapView();
        }
    }

    updateMapView() {
        const mapView = document.getElementById('mapView');
        mapView.innerHTML = `
            <div class="map-placeholder">
                <i class="fas fa-map-marked-alt"></i>
                <h4>Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ø­ÙŠØ©</h4>
                <p>Ø¹Ø±Ø¶ Ø­ÙŠ Ù„Ù€ ${this.filteredDeliveries.length} Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„</p>
                <div style="margin-top: 20px; text-align: left;">
                    ${this.filteredDeliveries.map(delivery => `
                        <div style="margin: 10px 0; padding: 10px; background: var(--bg-light); border-radius: var(--radius-md);">
                            <strong>${delivery.orderNumber}</strong> - ${delivery.customerName}<br>
                            <small>${delivery.customerAddress}</small>
                        </div>
                    `).join('')}
                </div>
                <button class="btn-primary" onclick="window.shipping.showRealMap()">
                    <i class="fas fa-map"></i>
                    Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
                </button>
            </div>
        `;
    }

    renderDeliveries() {
        const listView = document.getElementById('listView');
        
        if (this.filteredDeliveries.length === 0) {
            listView.innerHTML = `
                <div class="delivery-item" style="text-align: center; padding: 40px 20px;">
                    <i class="fas fa-box-open" style="font-size: 48px; color: var(--text-secondary); margin-bottom: 16px;"></i>
                    <h4 style="color: var(--text-secondary); margin-bottom: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</h4>
                    <p style="color: var(--text-secondary);">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
                </div>
            `;
            return;
        }

        listView.innerHTML = this.filteredDeliveries.map(delivery => `
            <div class="delivery-item ${delivery.status}" onclick="window.shipping.showOrderDetails(${delivery.id})">
                <div class="delivery-header">
                    <div class="order-info">
                        <div class="order-number">${delivery.orderNumber}</div>
                        <div class="customer-name">${delivery.customerName}</div>
                    </div>
                    <div class="delivery-status status-${delivery.status}">
                        ${this.getStatusText(delivery.status)}
                    </div>
                </div>
                <div class="delivery-details">
                    <div class="detail-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>${delivery.customerAddress}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-clock"></i>
                        <span>${this.formatTime(delivery.estimatedTime)}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-truck"></i>
                        <span>${this.getDeliveryTypeText(delivery.deliveryType)}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>${delivery.totalAmount + delivery.deliveryFee} Ø±.Ø³</span>
                    </div>
                </div>
                <div class="delivery-actions">
                    ${delivery.status === 'pending' ? `
                        <button class="action-btn primary" onclick="event.stopPropagation(); window.shipping.assignCourier(${delivery.id})">
                            <i class="fas fa-user-plus"></i>
                            ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø¹ÙŠ
                        </button>
                    ` : ''}
                    <button class="action-btn" onclick="event.stopPropagation(); window.shipping.trackOrder(${delivery.id})">
                        <i class="fas fa-map-marked-alt"></i>
                        ØªØªØ¨Ø¹
                    </button>
                    <button class="action-btn" onclick="event.stopPropagation(); window.shipping.contactCustomer('${delivery.customerPhone}')">
                        <i class="fas fa-phone"></i>
                        Ø§ØªØµÙ„
                    </button>
                </div>
            </div>
        `).join('');
    }

    renderCouriers() {
        const couriersList = document.getElementById('activeCouriers');
        const activeCouriers = this.couriers.filter(courier => courier.online);
        
        if (activeCouriers.length === 0) {
            couriersList.innerHTML = `
                <div class="courier-item" style="text-align: center; padding: 40px 20px;">
                    <i class="fas fa-truck" style="font-size: 48px; color: var(--text-secondary); margin-bottom: 16px;"></i>
                    <h4 style="color: var(--text-secondary); margin-bottom: 8px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¹Ø§Ø© Ù†Ø´Ø·ÙŠÙ†</h4>
                    <p style="color: var(--text-secondary);">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¹Ø§Ø© ØºÙŠØ± Ù…ØªØµÙ„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
            `;
            return;
        }

        couriersList.innerHTML = activeCouriers.map(courier => `
            <div class="courier-item" data-courier-id="${courier.id}">
                <div class="courier-avatar">
                    ${courier.name.split(' ')[0].charAt(0)}
                </div>
                <div class="courier-info">
                    <div class="courier-name">${courier.name}</div>
                    <div class="courier-details">
                        <span class="courier-location">${courier.currentLocation}</span>
                        â€¢ ${courier.vehicle} (${courier.vehicleNumber})
                        â€¢ ${courier.deliveriesToday} ØªÙˆØµÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…
                    </div>
                </div>
                <div class="courier-status status-${courier.status}">
                    <span class="status-indicator"></span>
                    ${this.getCourierStatusText(courier.status)}
                </div>
            </div>
        `).join('');
    }

    getStatusText(status) {
        const statusMap = {
            'pending': 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„',
            'in_progress': 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„',
            'delivered': 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…',
            'delayed': 'Ù…ØªØ£Ø®Ø±Ø©',
            'cancelled': 'Ù…Ù„ØºÙŠØ©'
        };
        return statusMap[status] || status;
    }

    getDeliveryTypeText(type) {
        const typeMap = {
            'express': 'Ø³Ø±ÙŠØ¹',
            'standard': 'Ø¹Ø§Ø¯ÙŠ',
            'scheduled': 'Ù…Ø¬Ø¯ÙˆÙ„'
        };
        return typeMap[type] || type;
    }

    getCourierStatusText(status) {
        const statusMap = {
            'online': 'Ù…ØªØµÙ„',
            'offline': 'ØºÙŠØ± Ù…ØªØµÙ„',
            'busy': 'Ù…Ø´ØºÙˆÙ„'
        };
        return statusMap[status] || status;
    }

    formatTime(timeString) {
        if (!timeString) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        const date = new Date(timeString);
        return date.toLocaleTimeString('ar-EG', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true 
        });
    }

    showOrderDetails(deliveryId) {
        const delivery = this.deliveries.find(d => d.id === deliveryId);
        if (!delivery) return;

        this.currentDelivery = delivery;

        document.getElementById('orderDetailsTitle').textContent = `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ ${delivery.orderNumber}`;
        
        const assignedCourier = delivery.assignedCourier ? 
            this.couriers.find(c => c.id === delivery.assignedCourier) : null;

        document.getElementById('orderDetailsContent').innerHTML = `
            <div style="margin-bottom: 24px;">
                <h4 style="margin-bottom: 16px; color: var(--primary);">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
                <div style="display: grid; gap: 12px;">
                    <div><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${delivery.customerName}</div>
                    <div><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${delivery.customerPhone}</div>
                    <div><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${delivery.customerAddress}</div>
                </div>
            </div>

            <div style="margin-bottom: 24px;">
                <h4 style="margin-bottom: 16px; color: var(--primary);">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h4>
                <div style="background: var(--bg-light); padding: 16px; border-radius: var(--radius-md);">
                    ${delivery.items.map(item => `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>${item.name}</span>
                            <span>${item.quantity} Ã—</span>
                        </div>
                    `).join('')}
                    <hr style="margin: 12px 0; border-color: var(--primary-light);">
                    <div style="display: flex; justify-content: space-between; font-weight: bold;">
                        <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                        <span>${delivery.totalAmount + delivery.deliveryFee} Ø±.Ø³</span>
                    </div>
                </div>
            </div>

            <div style="margin-bottom: 24px;">
                <h4 style="margin-bottom: 16px; color: var(--primary);">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h4>
                <div style="display: grid; gap: 8px;">
                    <div><strong>Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØµÙŠÙ„:</strong> ${this.getDeliveryTypeText(delivery.deliveryType)}</div>
                    <div><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span class="status-${delivery.status}">${this.getStatusText(delivery.status)}</span></div>
                    <div><strong>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</strong> ${this.formatTime(delivery.estimatedTime)}</div>
                    ${assignedCourier ? `
                        <div><strong>Ø§Ù„Ø³Ø§Ø¹ÙŠ:</strong> ${assignedCourier.name}</div>
                        <div><strong>Ù…Ø±ÙƒØ¨Ø© Ø§Ù„Ø³Ø§Ø¹ÙŠ:</strong> ${assignedCourier.vehicle} (${assignedCourier.vehicleNumber})</div>
                    ` : '<div><strong>Ø§Ù„Ø³Ø§Ø¹ÙŠ:</strong> Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¨Ø¹Ø¯</div>'}
                </div>
            </div>

            ${delivery.notes ? `
                <div style="margin-bottom: 24px;">
                    <h4 style="margin-bottom: 8px; color: var(--primary);">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h4>
                    <p style="background: var(--bg-light); padding: 12px; border-radius: var(--radius-md);">${delivery.notes}</p>
                </div>
            ` : ''}

            <div class="form-actions">
                <button class="btn-secondary" onclick="window.shipping.contactCustomer('${delivery.customerPhone}')">
                    <i class="fas fa-phone"></i>
                    Ø§ØªØµØ§Ù„
                </button>
                ${delivery.status === 'pending' ? `
                    <button class="btn-primary" onclick="window.shipping.assignCourier(${delivery.id})">
                        <i class="fas fa-user-plus"></i>
                        ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø¹ÙŠ
                    </button>
                ` : ''}
                <button class="btn-primary" onclick="window.shipping.trackOrder(${delivery.id})">
                    <i class="fas fa-map-marked-alt"></i>
                    ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨
                </button>
            </div>
        `;

        document.getElementById('orderDetailsModal').style.display = 'block';
    }

    closeOrderDetails() {
        document.getElementById('orderDetailsModal').style.display = 'none';
        this.currentDelivery = null;
    }

    trackOrder(deliveryId) {
        const delivery = this.deliveries.find(d => d.id === deliveryId);
        if (!delivery) return;

        document.getElementById('trackingContent').innerHTML = `
            <div style="margin-bottom: 20px;">
                <h4 style="margin-bottom: 8px;">${delivery.orderNumber}</h4>
                <p style="color: var(--text-secondary);">${delivery.customerName} - ${delivery.customerAddress}</p>
            </div>
            <div class="tracking-steps">
                ${delivery.tracking.map((step, index) => `
                    <div class="tracking-step">
                        <div class="step-icon ${step.completed ? 'completed' : step.step === 'on_the_way' ? 'current' : ''}">
                            <i class="fas fa-${this.getStepIcon(step.step)}"></i>
                        </div>
                        <div class="step-content">
                            <div class="step-title">${step.description}</div>
                            ${step.time ? `<div class="step-time">${this.formatTime(step.time)}</div>` : ''}
                        </div>
                    </div>
                `).join('')}
            </div>
        `;

        document.getElementById('trackingModal').style.display = 'block';
    }

    getStepIcon(step) {
        const iconMap = {
            'order_placed': 'shopping-cart',
            'preparing': 'box',
            'assigned': 'user-tie',
            'picked_up': 'shopping-bag',
            'on_the_way': 'truck',
            'delivered': 'check-circle'
        };
        return iconMap[step] || 'circle';
    }

    closeTracking() {
        document.getElementById('trackingModal').style.display = 'none';
    }

    assignCourier(deliveryId) {
        const delivery = this.deliveries.find(d => d.id === deliveryId);
        if (!delivery) return;

        this.currentDelivery = delivery;

        const availableCouriers = this.couriers.filter(courier => 
            courier.online && courier.status !== 'busy'
        );

        const courierSelect = document.getElementById('courierSelect');
        courierSelect.innerHTML = `
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¹ÙŠ...</option>
            ${availableCouriers.map(courier => `
                <option value="${courier.id}">
                    ${courier.name} - ${courier.vehicle} (${courier.deliveriesToday} ØªÙˆØµÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…)
                </option>
            `).join('')}
        `;

        const estimatedTime = new Date();
        estimatedTime.setHours(estimatedTime.getHours() + 1);
        document.getElementById('estimatedTime').value = estimatedTime.toISOString().slice(0, 16);

        document.getElementById('assignCourierModal').style.display = 'block';
    }

    closeAssignCourier() {
        document.getElementById('assignCourierModal').style.display = 'none';
        this.currentDelivery = null;
    }

    confirmAssignment() {
        const courierId = parseInt(document.getElementById('courierSelect').value);
        const estimatedTime = document.getElementById('estimatedTime').value;
        const notes = document.getElementById('deliveryNotes').value;

        if (!courierId) {
            this.showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø³Ø§Ø¹ÙŠ', 'error');
            return;
        }

        const courier = this.couriers.find(c => c.id === courierId);
        const delivery = this.currentDelivery;

        if (delivery && courier) {
            delivery.assignedCourier = courierId;
            delivery.status = 'in_progress';
            delivery.estimatedTime = estimatedTime;
            if (notes) {
                delivery.notes = delivery.notes ? `${delivery.notes}\n${notes}` : notes;
            }

            const assignedStep = delivery.tracking.find(step => step.step === 'assigned');
            if (assignedStep) {
                assignedStep.completed = true;
                assignedStep.time = new Date().toISOString();
            }

            courier.status = 'busy';
            courier.deliveriesToday += 1;

            this.saveData();
            this.renderDeliveries();
            this.renderCouriers();
            this.closeAssignCourier();
            this.closeOrderDetails();

            this.showToast(`ØªÙ… ØªØ¹ÙŠÙŠÙ† ${courier.name} Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ ${delivery.orderNumber}`);
        }
    }

    contactCustomer(phoneNumber) {
        window.open(`tel:${phoneNumber}`);
        this.showToast(`Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¹Ù…ÙŠÙ„ ${phoneNumber}`);
    }

    // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
    showScanModal() {
        document.getElementById('scanModal').style.display = 'block';
    }

    closeScanModal() {
        document.getElementById('scanModal').style.display = 'none';
    }

    simulateScan() {
        this.showToast('Ø¬Ø§Ø±ÙŠ Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯...');
        
        setTimeout(() => {
            const randomDelivery = this.deliveries.find(d => d.status === 'in_progress');
            if (randomDelivery) {
                this.showOrderDetails(randomDelivery.id);
                this.closeScanModal();
                this.showToast(`ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø·Ù„Ø¨ ${randomDelivery.orderNumber} Ø¨Ù†Ø¬Ø§Ø­`);
            } else {
                this.showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„', 'error');
            }
        }, 2000);
    }

    // ÙˆØ¸ÙŠÙØ© Ø¥Ù†Ø´Ø§Ø¡ ØªÙˆØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯
    createNewDelivery() {
        document.getElementById('newDeliveryModal').style.display = 'block';
        this.resetNewDeliveryForm();
    }

    closeNewDeliveryModal() {
        document.getElementById('newDeliveryModal').style.display = 'none';
    }

    resetNewDeliveryForm() {
        document.getElementById('newOrderNumber').value = '';
        document.getElementById('newCustomerName').value = '';
        document.getElementById('newCustomerPhone').value = '';
        document.getElementById('newCustomerAddress').value = '';
        document.getElementById('newDeliveryType').value = 'standard';
        document.getElementById('newDeliveryNotes').value = '';
        
        const productsContainer = document.getElementById('productsContainer');
        productsContainer.innerHTML = `
            <div class="product-item">
                <input type="text" class="form-input product-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
                <input type="number" class="form-input product-quantity" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" min="1" value="1">
                <button class="btn-danger remove-product" onclick="window.shipping.removeProduct(this)">Ã—</button>
            </div>
        `;
    }

    addProduct() {
        const productsContainer = document.getElementById('productsContainer');
        const productItem = document.createElement('div');
        productItem.className = 'product-item';
        productItem.innerHTML = `
            <input type="text" class="form-input product-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <input type="number" class="form-input product-quantity" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" min="1" value="1">
            <button class="btn-danger remove-product" onclick="window.shipping.removeProduct(this)">Ã—</button>
        `;
        productsContainer.appendChild(productItem);
    }

    removeProduct(button) {
        const productItem = button.closest('.product-item');
        if (document.querySelectorAll('.product-item').length > 1) {
            productItem.remove();
        } else {
            this.showToast('ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
        }
    }

    confirmNewDelivery() {
        const orderNumber = document.getElementById('newOrderNumber').value.trim();
        const customerName = document.getElementById('newCustomerName').value.trim();
        const customerPhone = document.getElementById('newCustomerPhone').value.trim();
        const customerAddress = document.getElementById('newCustomerAddress').value.trim();
        const deliveryType = document.getElementById('newDeliveryType').value;
        const notes = document.getElementById('newDeliveryNotes').value.trim();

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (!orderNumber || !customerName || !customerPhone || !customerAddress) {
            this.showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
            return;
        }

        // Ø¬Ù…Ø¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        const productItems = document.querySelectorAll('.product-item');
        const items = Array.from(productItems).map(item => {
            const name = item.querySelector('.product-name').value.trim();
            const quantity = parseInt(item.querySelector('.product-quantity').value);
            return { name, quantity };
        }).filter(item => item.name && item.quantity > 0);

        if (items.length === 0) {
            this.showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
            return;
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯
        const newDelivery = {
            id: Date.now(),
            orderNumber,
            customerName,
            customerPhone,
            customerAddress,
            deliveryType,
            status: 'pending',
            assignedCourier: null,
            estimatedTime: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString(), // Ø¨Ø¹Ø¯ Ø³Ø§Ø¹ØªÙŠÙ†
            actualTime: null,
            items,
            totalAmount: items.reduce((sum, item) => sum + (item.quantity * 50), 0), // Ø³Ø¹Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ
            deliveryFee: deliveryType === 'express' ? 15 : 10,
            notes,
            tracking: [
                { step: 'order_placed', description: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', time: new Date().toISOString(), completed: true },
                { step: 'preparing', description: 'Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨', time: null, completed: false },
                { step: 'assigned', description: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø¹ÙŠ', time: null, completed: false },
                { step: 'picked_up', description: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…', time: null, completed: false },
                { step: 'on_the_way', description: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙˆØµÙŠÙ„', time: null, completed: false },
                { step: 'delivered', description: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ³Ù„ÙŠÙ…', time: null, completed: false }
            ],
            createdAt: new Date().toISOString()
        };

        this.deliveries.push(newDelivery);
        this.filteredDeliveries.push(newDelivery);
        this.saveData();
        this.renderDeliveries();
        this.updateStatisticsDisplay();
        this.closeNewDeliveryModal();

        this.showToast(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØµÙŠÙ„ ${orderNumber} Ø¨Ù†Ø¬Ø§Ø­`);
    }

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
    showNotifications() {
        document.getElementById('notificationsModal').style.display = 'block';
        this.renderNotifications();
    }

    closeNotificationsModal() {
        document.getElementById('notificationsModal').style.display = 'none';
    }

    renderNotifications() {
        const notificationsList = document.getElementById('notificationsList');
        
        if (this.notifications.length === 0) {
            notificationsList.innerHTML = `
                <div class="notification-item" style="text-align: center; padding: 40px 20px;">
                    <i class="fas fa-bell-slash" style="font-size: 48px; color: var(--text-secondary); margin-bottom: 16px;"></i>
                    <h4 style="color: var(--text-secondary); margin-bottom: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h4>
                    <p style="color: var(--text-secondary);">Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</p>
                </div>
            `;
            return;
        }

        notificationsList.innerHTML = this.notifications.map(notification => `
            <div class="notification-item ${notification.read ? '' : 'unread'}" onclick="window.shipping.markNotificationAsRead(${notification.id})">
                <div class="notification-icon ${this.getNotificationTypeClass(notification.type)}">
                    <i class="${notification.icon}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-title">${notification.title}</div>
                    <div class="notification-message">${notification.message}</div>
                    <div class="notification-time">${this.formatTime(notification.timestamp)}</div>
                </div>
            </div>
        `).join('');
    }

    getNotificationTypeClass(type) {
        const typeMap = {
            'new_delivery': 'info',
            'delivery_delayed': 'warning',
            'courier_assigned': 'success'
        };
        return typeMap[type] || 'info';
    }

    markNotificationAsRead(notificationId) {
        const notification = this.notifications.find(n => n.id === notificationId);
        if (notification && !notification.read) {
            notification.read = true;
            this.saveData();
            this.updateNotificationsBadge();
            this.renderNotifications();
        }
    }

    // ÙˆØ¸ÙŠÙØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¹Ø§Ø©
    manageCouriers() {
        document.getElementById('couriersManagementModal').style.display = 'block';
        this.renderFullCouriersList();
    }

    closeCouriersManagementModal() {
        document.getElementById('couriersManagementModal').style.display = 'none';
    }

    renderFullCouriersList() {
        const couriersFullList = document.getElementById('couriersFullList');
        
        couriersFullList.innerHTML = this.couriers.map(courier => `
            <div class="courier-full-item">
                <div class="courier-avatar">
                    ${courier.name.split(' ')[0].charAt(0)}
                </div>
                <div class="courier-info">
                    <div class="courier-name">${courier.name}</div>
                    <div class="courier-details">
                        <span class="courier-location">${courier.currentLocation}</span>
                        â€¢ ${courier.vehicle} (${courier.vehicleNumber})
                        â€¢ ${courier.deliveriesToday} ØªÙˆØµÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…
                        â€¢ ØªÙ‚ÙŠÙŠÙ…: ${courier.rating}/5
                    </div>
                </div>
                <div class="courier-status status-${courier.status}">
                    <span class="status-indicator"></span>
                    ${this.getCourierStatusText(courier.status)}
                </div>
                <div class="courier-actions">
                    <button class="courier-action-btn" onclick="window.shipping.editCourier(${courier.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="courier-action-btn" onclick="window.shipping.toggleCourierStatus(${courier.id})">
                        <i class="fas fa-power-off"></i>
                    </button>
                </div>
            </div>
        `).join('');
    }

    showAddCourierModal() {
        document.getElementById('addCourierModal').style.display = 'block';
    }

    closeAddCourierModal() {
        document.getElementById('addCourierModal').style.display = 'none';
    }

    confirmAddCourier() {
        const name = document.getElementById('newCourierName').value.trim();
        const phone = document.getElementById('newCourierPhone').value.trim();
        const vehicle = document.getElementById('newCourierVehicle').value;
        const vehicleNumber = document.getElementById('newCourierVehicleNumber').value.trim();

        if (!name || !phone || !vehicle || !vehicleNumber) {
            this.showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
            return;
        }

        const newCourier = {
            id: Date.now(),
            name,
            phone,
            vehicle,
            vehicleNumber,
            status: 'offline',
            currentLocation: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
            deliveriesToday: 0,
            rating: 5.0,
            online: false
        };

        this.couriers.push(newCourier);
        this.saveData();
        this.renderCouriers();
        this.renderFullCouriersList();
        this.closeAddCourierModal();

        this.showToast(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø§Ø¹ÙŠ ${name} Ø¨Ù†Ø¬Ø§Ø­`);
    }

    editCourier(courierId) {
        this.showToast(`ÙØªØ­ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¹ÙŠ ${courierId}`);
    }

    toggleCourierStatus(courierId) {
        const courier = this.couriers.find(c => c.id === courierId);
        if (courier) {
            courier.online = !courier.online;
            courier.status = courier.online ? 'online' : 'offline';
            this.saveData();
            this.renderCouriers();
            this.renderFullCouriersList();
            this.showToast(`ØªÙ… ${courier.online ? 'ØªØ´ØºÙŠÙ„' : 'Ø¥ÙŠÙ‚Ø§Ù'} Ø§Ù„Ø³Ø§Ø¹ÙŠ ${courier.name}`);
        }
    }

    // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
    showRealMap() {
        this.showToast('ÙØªØ­ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©');
    }

    showPerformanceDetails() {
        this.showToast('Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙˆØµÙŠÙ„');
    }

    showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.style.cssText = `
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: ${type === 'error' ? 'var(--danger)' : type === 'warning' ? 'var(--warning)' : type === 'info' ? 'var(--info)' : 'var(--success)'};
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-card);
            z-index: 10000;
            font-weight: 600;
            animation: slideDown 0.3s ease-out;
        `;
        
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => {
            toast.style.animation = 'slideUp 0.3s ease-in';
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }, 3000);
    }

    startRealTimeUpdates() {
        setInterval(() => {
            this.deliveries.forEach(delivery => {
                if (delivery.status === 'in_progress' && Math.random() < 0.1) {
                    delivery.status = 'delivered';
                    delivery.actualTime = new Date().toISOString();
                    
                    const deliveredStep = delivery.tracking.find(step => step.step === 'delivered');
                    if (deliveredStep) {
                        deliveredStep.completed = true;
                        deliveredStep.time = delivery.actualTime;
                    }

                    if (delivery.assignedCourier) {
                        const courier = this.couriers.find(c => c.id === delivery.assignedCourier);
                        if (courier) {
                            courier.status = 'online';
                        }
                    }
                }
            });

            this.saveData();
            this.renderDeliveries();
            this.renderCouriers();
            this.updateStatisticsDisplay();
        }, 30000);
    }
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    window.shipping = new ShippingManagement();
});
</script>
</body>
</html>
