<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø§Ù„ÙŠ - Ù…Ø®ØªØ¨Ø±Ø§Øª 24/7</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700;800&family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
:root {
    /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª */
    --primary: #1976D2;
    --primary-dark: #1565C0;
    --primary-light: #BBDEFB;
    --secondary: #4CAF50;
    --accent: #FF5252;
    --success: #4CAF50;
    --warning: #FF9800;
    --info: #2196F3;
    --danger: #F44336;
    --purple: #9C27B0;
    --pink: #E91E63;

    /* Ø®Ù„ÙÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
    --bg-light: #F5F9FF;
    --bg-surface: #ffffff;
    --shadow-light: -6px -6px 12px rgba(255, 255, 255, 0.9), 6px 6px 12px rgba(0, 0, 0, 0.08);
    --shadow-inset: inset 3px 3px 6px rgba(0, 0, 0, 0.1), inset -3px -3px 6px rgba(255, 255, 255, 0.9);
    --shadow-card: 0 10px 30px rgba(25, 118, 210, 0.15);
    --text-primary: #1E293B;
    --text-secondary: #475569;

    /* Ø§Ù„Ø²ÙˆØ§ÙŠØ§ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª */
    --radius-xl: 30px;
    --radius-lg: 20px;
    --radius-md: 16px;
    --radius-sm: 12px;
    --transition-liquid: all 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Tajawal', sans-serif;
    -webkit-tap-highlight-color: transparent;
}

body {
    background: var(--bg-light);
    color: var(--text-primary);
    direction: rtl;
    overflow-x: hidden;
    min-height: 100vh;
}

/* Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
.ultra-app {
    max-width: 450px;
    min-height: 100vh;
    margin: 0 auto;
    background: var(--bg-light);
    position: relative;
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.05);
    overflow-x: hidden;
    padding-bottom: 100px;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© */
.status-bar {
    background: transparent;
    color: var(--text-primary);
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    font-weight: 500;
    z-index: 1000;
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© */
.background-effects {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
}

.floating-shapes {
    position: absolute;
    width: 100%;
    height: 100%;
}

.shape {
    position: absolute;
    border-radius: 50%;
    background: var(--primary);
    opacity: 0.1;
    animation: float 6s ease-in-out infinite;
}

.shape:nth-child(1) {
    width: 200px;
    height: 200px;
    top: 10%;
    left: 10%;
    animation-delay: 0s;
}

.shape:nth-child(2) {
    width: 150px;
    height: 150px;
    top: 60%;
    right: 20%;
    animation-delay: 2s;
}

.shape:nth-child(3) {
    width: 100px;
    height: 100px;
    bottom: 20%;
    left: 20%;
    animation-delay: 4s;
}

@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
.app-header {
    padding: 24px 20px 0;
}

.header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.title-section h1 {
    font-family: 'Almarai', sans-serif;
    font-size: 26px;
    font-weight: 800;
    color: var(--primary-dark);
    margin-bottom: 4px;
}

.title-section p {
    font-size: 14px;
    color: var(--text-secondary);
}

.invoice-actions {
    display: flex;
    gap: 10px;
}

.action-icon {
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    cursor: pointer;
    transition: var(--transition-liquid);
    position: relative;
    font-size: 18px;
}

.action-icon:active {
    box-shadow: var(--shadow-inset);
    color: var(--primary-dark);
}

/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ */
.account-info-bar {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: var(--shadow-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.account-number-display {
    display: flex;
    align-items: center;
    gap: 12px;
    font-family: 'Almarai', sans-serif;
}

.account-label {
    font-size: 14px;
    color: var(--text-secondary);
    font-weight: 600;
}

.account-value {
    font-size: 16px;
    font-weight: 800;
    color: var(--primary-dark);
    background: var(--primary-light);
    padding: 8px 12px;
    border-radius: var(--radius-md);
    font-family: monospace;
}

.copy-btn {
    background: var(--primary);
    color: white;
    border: none;
    width: 36px;
    height: 36px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition-liquid);
}

.copy-btn:hover {
    background: var(--primary-dark);
    transform: scale(1.05);
}

/* Ù…Ù„Ø®Øµ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª */
.revenue-summary {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 20px;
}

.revenue-card {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: var(--transition-liquid);
}

.revenue-card:hover {
    box-shadow: var(--shadow-inset);
}

.revenue-icon {
    width: 40px;
    height: 40px;
    background: var(--primary);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 18px;
}

.revenue-info {
    flex: 1;
}

.revenue-value {
    font-family: 'Almarai', sans-serif;
    font-size: 18px;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 4px;
}

.revenue-label {
    font-size: 12px;
    color: var(--text-secondary);
}

/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© */
.stats-bar {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 16px;
}

.stat-item {
    text-align: center;
    padding: 16px 8px;
    background: var(--bg-light);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-light);
    transition: var(--transition-liquid);
    cursor: pointer;
}

.stat-item:hover {
    box-shadow: var(--shadow-inset);
    transform: scale(0.98);
}

.stat-item.active {
    background: var(--primary);
    color: white;
}

.stat-item.active .stat-value,
.stat-item.active .stat-label {
    color: white;
}

.stat-value {
    font-family: 'Almarai', sans-serif;
    font-size: 18px;
    font-weight: 800;
    color: var(--primary-dark);
    margin-bottom: 4px;
}

.stat-label {
    font-size: 11px;
    opacity: 0.8;
}

/* Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª */
.categories-section {
    padding: 0 20px;
    margin-bottom: 20px;
}

.categories-scroll {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    scrollbar-width: none;
}

.categories-scroll::-webkit-scrollbar {
    display: none;
}

.category-chip {
    padding: 12px 20px;
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    border-radius: var(--radius-lg);
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition-liquid);
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 8px;
    border: 1px solid transparent;
}

.category-chip.active {
    background: var(--primary);
    color: white;
    box-shadow: var(--shadow-inset);
    transform: scale(0.95);
    border-color: var(--primary-dark);
}

.category-chip:hover {
    box-shadow: var(--shadow-inset);
}

.category-count {
    background: rgba(255, 255, 255, 0.3);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
}

/* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± */
.invoices-management {
    padding: 0 20px;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª */
.toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 16px;
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
}

.view-options {
    display: flex;
    gap: 8px;
}

.view-option {
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition-liquid);
}

.view-option.active {
    background: var(--primary);
    color: white;
    box-shadow: var(--shadow-inset);
}

.view-option:hover {
    box-shadow: var(--shadow-inset);
}

.sort-options select {
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    border: none;
    padding: 10px 16px;
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: 14px;
    cursor: pointer;
    outline: none;
    transition: var(--transition-liquid);
}

.sort-options select:focus {
    box-shadow: var(--shadow-inset);
}

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ÙÙˆØ§ØªÙŠØ± */
.invoices-container {
    margin-bottom: 20px;
}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± */
.invoices-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.invoices-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
}

/* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ù‚Ø§Ø¦Ù…Ø©) */
.invoice-card-list {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    transition: var(--transition-liquid);
    cursor: pointer;
    padding: 16px;
    position: relative;
}

.invoice-card-list:hover {
    box-shadow: var(--shadow-inset);
}

.invoice-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
}

.invoice-info {
    flex: 1;
}

.invoice-number {
    font-family: 'Almarai', sans-serif;
    font-size: 16px;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 4px;
}

.invoice-customer {
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 4px;
}

.invoice-date {
    font-size: 12px;
    color: var(--text-secondary);
}

.invoice-amount {
    text-align: left;
}

.amount-value {
    font-family: 'Almarai', sans-serif;
    font-size: 18px;
    font-weight: 800;
    color: var(--primary-dark);
    margin-bottom: 4px;
}

.amount-label {
    font-size: 11px;
    color: var(--text-secondary);
}

.invoice-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 12px;
    border-top: 1px solid var(--primary-light);
}

.invoice-status {
    padding: 6px 12px;
    border-radius: var(--radius-sm);
    font-size: 12px;
    font-weight: 700;
    text-align: center;
}

.status-draft {
    background: var(--text-secondary);
    color: white;
}

.status-sent {
    background: var(--info);
    color: white;
}

.status-pending {
    background: var(--warning);
    color: white;
}

.status-paid {
    background: var(--success);
    color: white;
}

.status-overdue {
    background: var(--danger);
    color: white;
}

.status-cancelled {
    background: var(--text-secondary);
    color: white;
    opacity: 0.7;
}

.invoice-actions-list {
    display: flex;
    gap: 8px;
}

/* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ø´Ø¨ÙƒØ©) */
.invoice-card-grid {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-light);
    transition: var(--transition-liquid);
    cursor: pointer;
    padding: 16px;
    text-align: center;
    position: relative;
}

.invoice-card-grid:hover {
    box-shadow: var(--shadow-inset);
    transform: translateY(-2px);
}

.invoice-icon {
    width: 50px;
    height: 50px;
    background: var(--primary);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
    margin: 0 auto 12px;
}

.invoice-number-grid {
    font-family: 'Almarai', sans-serif;
    font-size: 14px;
    font-weight: 800;
    margin-bottom: 8px;
    color: var(--text-primary);
}

.invoice-customer-grid {
    font-size: 12px;
    color: var(--text-secondary);
    margin-bottom: 8px;
}

.invoice-amount-grid {
    font-family: 'Almarai', sans-serif;
    font-size: 16px;
    font-weight: 800;
    color: var(--primary-dark);
    margin-bottom: 8px;
}

.invoice-date-grid {
    font-size: 11px;
    color: var(--text-secondary);
    margin-bottom: 12px;
}

.invoice-status-grid {
    padding: 6px 12px;
    border-radius: var(--radius-sm);
    font-size: 11px;
    font-weight: 700;
    display: inline-block;
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
.floating-actions {
    position: fixed;
    bottom: 100px;
    left: 30px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 1000;
}

.floating-action-btn {
    background: var(--primary);
    color: white;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    box-shadow: var(--shadow-card);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    cursor: pointer;
    transition: var(--transition-liquid);
    z-index: 1000;
}

.floating-action-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 25px rgba(25, 118, 210, 0.4);
}

.floating-action-btn:active {
    transform: scale(0.95);
}

/* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
.bottom-nav-dock {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    display: flex;
    padding: 8px 10px;
    border-radius: var(--radius-xl);
    z-index: 1000;
    max-width: 360px;
    width: calc(100% - 40px);
    border: 1px solid rgba(255, 255, 255, 0.5);
}

.nav-item-dock {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px 0;
    border-radius: var(--radius-md);
    transition: var(--transition-liquid);
    flex: 1;
    position: relative;
    text-decoration: none;
    color: var(--text-secondary);
}

.nav-item-dock.active {
    color: var(--primary-dark);
}

.nav-item-dock.active .nav-icon-dock {
    background: var(--primary);
    color: white;
    box-shadow: 0 4px 15px rgba(25, 118, 210, 0.5);
    width: 44px;
    height: 44px;
    border-radius: 50%;
    transform: translateY(-10px);
    transition: var(--transition-liquid);
}

.nav-icon-dock {
    font-size: 20px;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    transition: var(--transition-liquid);
}

.nav-label {
    font-size: 10px;
    font-weight: 600;
    margin-top: 4px;
    transition: var(--transition-liquid);
}

.nav-item-dock.active .nav-label {
    font-weight: 800;
    color: var(--primary-dark);
}

/* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
    transition: opacity 0.3s ease-out;
    z-index: 2000;
}

.modal-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.4);
    box-shadow: var(--shadow-card);
    animation: modalSlideUp 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    max-height: 85vh;
    overflow-y: auto;
}

.modal-content.large-modal {
    max-height: 90vh;
}

.modal-content.small-modal {
    max-width: 300px;
    margin: 0 auto;
    top: 50%;
    bottom: auto;
    transform: translateY(-50%);
    border-radius: var(--radius-xl);
}

@keyframes modalSlideUp {
    from {opacity: 0; transform: translateY(100%);}
    to {opacity: 1; transform: translateY(0);}
}

.modal-header {
    background: var(--primary);
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    position: sticky;
    top: 0;
    z-index: 10;
}

.modal-header h2 {
    margin: 0;
    font-size: 20px;
}

.close {
    font-size: 24px;
    cursor: pointer;
}

.modal-body {
    padding: 20px;
}

/* Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙØ§ØªÙˆØ±Ø© */
.invoice-form {
    display: flex;
    flex-direction: column;
    gap: 24px;
}

.form-section {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    padding: 20px;
    box-shadow: var(--shadow-light);
}

.form-section h3 {
    margin-bottom: 16px;
    color: var(--primary-dark);
    font-size: 18px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.form-section h3::before {
    content: '';
    width: 4px;
    height: 20px;
    background: var(--primary);
    border-radius: 2px;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.form-group label {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 14px;
}

.form-group input,
.form-group select,
.form-group textarea {
    background: var(--bg-surface);
    border: 1px solid var(--primary-light);
    border-radius: var(--radius-md);
    padding: 12px 16px;
    font-size: 14px;
    color: var(--text-primary);
    transition: var(--transition-liquid);
    outline: none;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
}

.form-group textarea {
    resize: vertical;
    min-height: 80px;
}

.form-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    padding-top: 20px;
    border-top: 1px solid var(--primary-light);
}

/* Ø£Ø²Ø±Ø§Ø± */
.btn-neumorphism {
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-md);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-liquid);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 14px;
    background: var(--bg-light);
    box-shadow: var(--shadow-light);
    color: var(--primary);
}

.btn-neumorphism:active {
    box-shadow: var(--shadow-inset);
    transform: scale(0.95);
}

.btn-primary-neumorphism {
    background: var(--primary);
    box-shadow: 0 4px 15px rgba(25, 118, 210, 0.4);
    color: white;
}

.btn-primary-neumorphism:active {
    box-shadow: var(--shadow-inset);
    background: var(--primary-dark);
}

.btn-secondary-neumorphism {
    background: var(--secondary);
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
    color: white;
}

.btn-secondary-neumorphism:active {
    box-shadow: var(--shadow-inset);
    background: #388E3C;
}

.btn-danger-neumorphism {
    background: var(--danger);
    box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
    color: white;
}

.btn-danger-neumorphism:active {
    box-shadow: var(--shadow-inset);
    background: #D32F2F;
}

.btn-small {
    padding: 8px 16px;
    font-size: 12px;
}

/* Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø­Ø³Ø§Ø¨ */
.no-account-state {
    text-align: center;
    padding: 60px 20px;
    background: var(--bg-surface);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-card);
    margin: 40px 20px;
}

.no-account-icon {
    font-size: 64px;
    color: var(--primary-light);
    margin-bottom: 20px;
}

.no-account-title {
    font-size: 24px;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 12px;
}

.no-account-description {
    font-size: 16px;
    color: var(--text-secondary);
    margin-bottom: 30px;
    line-height: 1.6;
}

.create-account-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 16px 32px;
    border-radius: var(--radius-lg);
    font-size: 18px;
    font-weight: 800;
    cursor: pointer;
    transition: var(--transition-liquid);
    display: inline-flex;
    align-items: center;
    gap: 12px;
    box-shadow: var(--shadow-card);
}

.create-account-btn:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-card);
}

/* Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
.loading-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    padding: 40px 20px;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid var(--primary-light);
    border-top: 4px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ */
.load-more-section {
    display: flex;
    justify-content: center;
    padding: 20px;
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ */
.liquid-transition {
    transition: var(--transition-liquid);
}

/* Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø§ÙØ¸ */
.wallet-options {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-bottom: 24px;
}

.wallet-option {
    background: var(--bg-light);
    border: 2px solid transparent;
    border-radius: var(--radius-lg);
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition-liquid);
    box-shadow: var(--shadow-light);
}

.wallet-option:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-card);
}

.wallet-option.selected {
    border-color: var(--primary);
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
}

.wallet-icon {
    width: 50px;
    height: 50px;
    background: var(--primary);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 12px;
    font-size: 20px;
    color: white;
}

.wallet-name {
    font-weight: 700;
    color: var(--text-primary);
    font-size: 14px;
}

/* Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ */
.receipt-preview {
    background: white;
    border-radius: var(--radius-lg);
    padding: 24px;
    box-shadow: var(--shadow-card);
    border: 1px solid #e2e8f0;
    margin-bottom: 20px;
}

.receipt-header {
    text-align: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 2px solid var(--primary);
}

.receipt-title {
    font-size: 20px;
    font-weight: 800;
    color: var(--primary-dark);
    margin-bottom: 8px;
}

.receipt-subtitle {
    font-size: 14px;
    color: var(--text-secondary);
}

.receipt-details {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 24px;
}

.receipt-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #f1f5f9;
}

.receipt-label {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 14px;
}

.receipt-value {
    font-weight: 700;
    color: var(--text-primary);
    font-size: 14px;
}

.receipt-amount {
    font-size: 18px;
    font-weight: 800;
    color: var(--primary-dark);
}

.receipt-footer {
    text-align: center;
    padding-top: 16px;
    border-top: 2px solid var(--primary);
    color: var(--text-secondary);
    font-size: 12px;
}

.receipt-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
}

/* ØªØ­Ù…ÙŠÙ„ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ */
.statement-options {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-bottom: 24px;
}

.statement-option {
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    padding: 20px;
    cursor: pointer;
    transition: var(--transition-liquid);
    border: 2px solid transparent;
    box-shadow: var(--shadow-light);
}

.statement-option:hover {
    transform: translateX(-8px);
    border-color: var(--primary);
}

.statement-option.selected {
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    border-color: var(--primary);
}

.statement-period {
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 8px;
    font-size: 16px;
}

.statement-dates {
    font-size: 14px;
    color: var(--text-secondary);
}

.statement-summary {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 16px;
}

.statement-stat {
    text-align: center;
    padding: 12px;
    background: white;
    border-radius: var(--radius-md);
    border: 1px solid #e2e8f0;
}

.statement-stat-value {
    font-weight: 800;
    color: var(--primary);
    font-size: 14px;
    margin-bottom: 4px;
}

.statement-stat-label {
    font-size: 11px;
    color: var(--text-secondary);
}

/* ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø© */
.categories-tabs {
    display: flex;
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    padding: 8px;
    box-shadow: var(--shadow-light);
    margin-bottom: 20px;
    overflow-x: auto;
}

.category-tab {
    flex: 1;
    background: none;
    border: none;
    padding: 12px 16px;
    border-radius: var(--radius-md);
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition-liquid);
    white-space: nowrap;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-width: 120px;
}

.category-tab.active {
    background: var(--primary);
    color: white;
    box-shadow: var(--shadow-inset);
}

.category-tab:hover {
    background: var(--primary-light);
    color: var(--primary-dark);
}

.category-count {
    background: rgba(255, 255, 255, 0.3);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¨Ø¶ Ù„Ù„Ø±ØµÙŠØ¯ */
.pulse-balance {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ø­Ø³Ù†Ø© */
.notification {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--success);
    color: white;
    padding: 16px 24px;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-card);
    z-index: 3000;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 12px;
    animation: slideDown 0.3s ease-out;
    max-width: 90%;
}

.notification.error {
    background: var(--danger);
}

.notification.warning {
    background: var(--warning);
}

.notification.info {
    background: var(--info);
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(-50px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
.btn-neumorphism:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}

.btn-neumorphism:disabled:active {
    transform: none !important;
    box-shadow: var(--shadow-light) !important;
}

/* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ */
@media (max-width: 480px) {
    .stats-bar {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .revenue-summary {
        grid-template-columns: 1fr;
    }
    
    .invoices-grid {
        grid-template-columns: 1fr;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .floating-actions {
        left: 20px;
        bottom: 90px;
    }
    
    .floating-action-btn {
        width: 50px;
        height: 50px;
        font-size: 18px;
    }
    
    .account-info-bar {
        flex-direction: column;
        gap: 12px;
        text-align: center;
    }
    
    .wallet-options {
        grid-template-columns: 1fr;
    }
    
    .receipt-actions {
        flex-direction: column;
    }
    
    .statement-summary {
        grid-template-columns: 1fr;
    }
    
    .categories-tabs {
        flex-wrap: wrap;
    }
    
    .category-tab {
        min-width: calc(50% - 8px);
    }
    
    .modal-content {
        margin: 10px;
        width: calc(100% - 20px);
    }
    
    .form-section {
        padding: 16px;
    }
    
    .modal-header {
        padding: 16px;
    }
    
    .modal-body {
        padding: 16px;
    }
}

@media (max-width: 380px) {
    .header-top {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
    }
    
    .invoice-actions {
        align-self: flex-end;
    }
    
    .categories-scroll {
        gap: 8px;
    }
    
    .category-chip {
        padding: 10px 16px;
        font-size: 14px;
    }
    
    .bottom-nav-dock {
        padding: 6px 8px;
    }
    
    .nav-icon-dock {
        width: 40px;
        height: 40px;
        font-size: 18px;
    }
    
    .nav-item-dock.active .nav-icon-dock {
        width: 40px;
        height: 40px;
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
@media (min-width: 451px) {
    .ultra-app {
        border-radius: 20px;
        margin: 20px auto;
        min-height: calc(100vh - 40px);
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø¯Ø§Ø¡ */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* Ø¯Ø¹Ù… Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø¸Ù„Ù… */


/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙˆØµÙˆÙ„ */
@media (prefers-reduced-transparency: reduce) {
    .modal {
        background-color: rgba(0, 0, 0, 0.7);
        backdrop-filter: none;
    }
    
    .modal-content {
        background: var(--bg-surface);
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ØªØ±ÙƒÙŠØ² */
.btn-neumorphism:focus-visible,
.action-icon:focus-visible,
.floating-action-btn:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
}

.form-group input:focus-visible,
.form-group select:focus-visible,
.form-group textarea:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 1px;
}
</style>
</head>
<body>
    <!-- ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© -->
    <div class="background-effects">
        <div class="floating-shapes">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
        </div>
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© -->
    <div class="status-bar">
        <div class="status-left">
            <span id="currentTime">2:45</span>
        </div>
        <div class="status-right">
            <i class="fas fa-signal"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-battery-three-quarters"></i>
        </div>
    </div>

    <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="ultra-app">
        <!-- Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø­Ø³Ø§Ø¨ -->
        <div id="noAccountState" class="no-account-state">
            <div class="no-account-icon">
                <i class="fas fa-flask"></i>
            </div>
            <div class="no-account-title">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ø®ØªØ¨Ø±</div>
            <div class="no-account-description">
                Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¢Ù† Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±<br>
                ÙˆØªØ­ØµÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†
            </div>
            <button class="btn-neumorphism btn-primary-neumorphism create-account-btn" onclick="openModal('createAccountModal')">
                <i class="fas fa-plus-circle"></i>
                Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ¨Ø±
            </button>
        </div>

        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø§Ù„ÙŠ (ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨) -->
        <div id="financialHeader" class="app-header" style="display: none;">
            <div class="header-top">
                <div class="title-section">
                    <h1>Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø§Ù„ÙŠ ğŸ’°</h1>
                    <p>Ø¥Ø¯Ø§Ø±Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ø®ØªØ¨Ø±</p>
                </div>
                <div class="invoice-actions">
                    <button class="action-icon liquid-transition" onclick="refreshTransactions()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="action-icon liquid-transition" onclick="downloadStatement()">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="action-icon liquid-transition" onclick="openModal('linkWalletModal')">
                        <i class="fas fa-wallet"></i>
                    </button>
                </div>
            </div>

            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ -->
            <div class="account-info-bar">
                <div class="account-number-display">
                    <span class="account-label">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:</span>
                    <span class="account-value" id="displayAccountNumber">---</span>
                    <button class="copy-btn" onclick="copyAccountNumber()">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>

            <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª -->
            <div class="revenue-summary">
                <div class="revenue-card">
                    <div class="revenue-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="revenue-info">
                        <div class="revenue-value" id="displayBalance">0 Ø±.Ø³</div>
                        <div class="revenue-label">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­</div>
                    </div>
                </div>
                <div class="revenue-card">
                    <div class="revenue-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="revenue-info">
                        <div class="revenue-value" id="monthlyIncome">0 Ø±.Ø³</div>
                        <div class="revenue-label">Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±</div>
                    </div>
                </div>
            </div>

            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
            <div class="stats-bar">
                <div class="stat-item liquid-transition active" onclick="filterByCategory('all')">
                    <div class="stat-value" id="totalTransactions">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</div>
                </div>
                <div class="stat-item liquid-transition" onclick="filterByCategory('deposit')">
                    <div class="stat-value" id="depositCount">0</div>
                    <div class="stat-label">Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</div>
                </div>
                <div class="stat-item liquid-transition" onclick="filterByCategory('withdrawal')">
                    <div class="stat-value" id="withdrawalCount">0</div>
                    <div class="stat-label">Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª</div>
                </div>
                <div class="stat-item liquid-transition" onclick="filterByCategory('transfer')">
                    <div class="stat-value" id="transferCount">0</div>
                    <div class="stat-label">Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨) -->
        <div id="financialContent" class="invoices-management" style="display: none;">
            <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
            <div class="toolbar">
                <div class="view-options">
                    <button class="view-option active" data-view="list" onclick="changeView('list')">
                        <i class="fas fa-list"></i>
                    </button>
                    <button class="view-option" data-view="grid" onclick="changeView('grid')">
                        <i class="fas fa-th-large"></i>
                    </button>
                </div>
                <div class="sort-options">
                    <select id="sortSelect" onchange="sortTransactions()">
                        <option value="date_desc">Ø§Ù„Ø£Ø­Ø¯Ø«</option>
                        <option value="date_asc">Ø§Ù„Ø£Ù‚Ø¯Ù…</option>
                        <option value="amount_desc">Ø§Ù„Ù…Ø¨Ù„Øº (ÙƒØ¨ÙŠØ±-ØµØºÙŠØ±)</option>
                        <option value="amount_asc">Ø§Ù„Ù…Ø¨Ù„Øº (ØµØºÙŠØ±-ÙƒØ¨ÙŠØ±)</option>
                    </select>
                </div>
            </div>

            <!-- Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª -->
            <div class="categories-section">
                <div class="categories-scroll" id="categoriesScroll">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>

            <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª -->
            <div class="invoices-container">
                <div class="invoices-list" id="transactionsList">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                </div>

                <div class="invoices-grid" id="transactionsGrid" style="display: none;">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                </div>
            </div>

            <!-- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ -->
            <div class="load-more-section">
                <button class="btn-neumorphism btn-primary-neumorphism" id="loadMoreBtn" onclick="loadMoreTransactions()">
                    <i class="fas fa-sync-alt"></i>
                    ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯
                </button>
            </div>
        </div>

        <!-- Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø§Ø¦Ù… -->
        <div class="floating-actions">
            <button class="floating-action-btn liquid-transition" onclick="openModal('depositModal')">
                <i class="fas fa-download"></i>
            </button>
            <button class="floating-action-btn liquid-transition" onclick="openModal('withdrawModal')">
                <i class="fas fa-upload"></i>
            </button>
            <button class="floating-action-btn liquid-transition" onclick="openModal('transferModal')">
                <i class="fas fa-exchange-alt"></i>
            </button>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ -->
        <div class="bottom-nav-dock">
            <a href="index.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-home"></i>
                </div>
                <div class="nav-label">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
            </a>
            <a href="test-requests.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-file-medical-alt"></i>
                </div>
                <div class="nav-label">Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„</div>
            </a>
            <a href="financial-account.html" class="nav-item-dock active">
                <div class="nav-icon-dock">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="nav-label">Ø§Ù„Ù…Ø§Ù„</div>
            </a>
            <a href="results.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-file-medical"></i>
                </div>
                <div class="nav-label">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</div>
            </a>
            <a href="profile.html" class="nav-item-dock">
                <div class="nav-icon-dock">
                    <i class="fas fa-user"></i>
                </div>
                <div class="nav-label">Ø­Ø³Ø§Ø¨ÙŠ</div>
            </a>
        </div>
    </div>

    <!-- Ù†ÙˆØ§ÙØ° Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    
    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ -->
    <div id="createAccountModal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ¨Ø±</h2>
                <span class="close" onclick="closeModal('createAccountModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form class="invoice-form">
                    <div class="form-section">
                        <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="labName">Ø§Ø³Ù… Ø§Ù„Ù…Ø®ØªØ¨Ø± *</label>
                                <input type="text" id="labName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø®ØªØ¨Ø±" required>
                            </div>
                            <div class="form-group">
                                <label for="licenseNumber">Ø±Ù‚Ù… ØªØ±Ø®ÙŠØµ Ø§Ù„Ù…Ø®ØªØ¨Ø± *</label>
                                <input type="text" id="licenseNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø®ÙŠØµ" required>
                            </div>
                            <div class="form-group">
                                <label for="ownerName">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ *</label>
                                <input type="text" id="ownerName" placeholder="Ø§Ø³Ù… Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ø®ØªØ¨Ø±" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
                                <input type="email" id="email" placeholder="example@email.com" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                                <input type="tel" id="phone" placeholder="05XXXXXXXX" required>
                            </div>
                            <div class="form-group">
                                <label for="address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† *</label>
                                <textarea id="address" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„ØªÙØµÙŠÙ„ÙŠ" required></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ©</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                                <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©" required>
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                                <input type="password" id="confirmPassword" placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-neumorphism" onclick="closeModal('createAccountModal')">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="button" class="btn-neumorphism btn-primary-neumorphism" onclick="createAccount()">
                            <i class="fas fa-check"></i>
                            Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ -->
    <div id="depositModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø¥ÙŠØ¯Ø§Ø¹ Ø£Ù…ÙˆØ§Ù„</h2>
                <span class="close" onclick="closeModal('depositModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form class="invoice-form">
                    <div class="form-section">
                        <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="depositAmount">Ø§Ù„Ù…Ø¨Ù„Øº *</label>
                                <input type="number" id="depositAmount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ" min="100" step="10" required>
                            </div>
                            <div class="form-group">
                                <label for="depositMethod">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ *</label>
                                <select id="depositMethod" required>
                                    <option value="">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</option>
                                    <option value="stc">STC Pay</option>
                                    <option value="mada">Ù…Ø¯Ù‰</option>
                                    <option value="bank">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                                    <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="depositWalletNumber">Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© *</label>
                                <input type="text" id="depositWalletNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©" required>
                            </div>
                            <div class="form-group">
                                <label for="depositPurpose">Ø§Ù„ØºØ±Ø¶ Ù…Ù† Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</label>
                                <select id="depositPurpose">
                                    <option value="general">Ø±ØµÙŠØ¯ Ø¹Ø§Ù…</option>
                                    <option value="equipment">Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</option>
                                    <option value="supplies">Ù„Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª</option>
                                    <option value="operations">Ù„Ù„ØªØ´ØºÙŠÙ„</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-neumorphism" onclick="closeModal('depositModal')">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="button" class="btn-neumorphism btn-primary-neumorphism" onclick="processDeposit()">
                            <i class="fas fa-check"></i>
                            Ø¥ÙŠØ¯Ø§Ø¹
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³Ø­Ø¨ -->
    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø³Ø­Ø¨ Ø£Ù…ÙˆØ§Ù„</h2>
                <span class="close" onclick="closeModal('withdrawModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form class="invoice-form">
                    <div class="form-section">
                        <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø­Ø¨</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="withdrawAmount">Ø§Ù„Ù…Ø¨Ù„Øº *</label>
                                <input type="number" id="withdrawAmount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ" min="100" step="10" required>
                            </div>
                            <div class="form-group">
                                <label for="withdrawMethod">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨ *</label>
                                <select id="withdrawMethod" required onchange="showWithdrawDetails()">
                                    <option value="">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨</option>
                                    <option value="bank_transfer">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                                    <option value="wallet">Ø¥Ù„Ù‰ Ù…Ø­ÙØ¸Ø© Ø±Ù‚Ù…ÙŠØ©</option>
                                    <option value="cash">Ø³Ø­Ø¨ Ù†Ù‚Ø¯ÙŠ</option>
                                </select>
                            </div>
                            
                            <div id="withdrawBankDetails" style="display: none; grid-column: 1 / -1;">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="bankName">Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ *</label>
                                        <input type="text" id="bankName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ">
                                    </div>
                                    <div class="form-group">
                                        <label for="bankAccount">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ *</label>
                                        <input type="text" id="bankAccount" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨">
                                    </div>
                                    <div class="form-group">
                                        <label for="accountHolder">Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨ *</label>
                                        <input type="text" id="accountHolder" placeholder="Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨">
                                    </div>
                                </div>
                            </div>
                            
                            <div id="withdrawWalletDetails" style="display: none; grid-column: 1 / -1;">
                                <div class="form-group">
                                    <label for="withdrawWalletNumber">Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© *</label>
                                    <input type="text" id="withdrawWalletNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="withdrawPurpose">Ø§Ù„ØºØ±Ø¶ Ù…Ù† Ø§Ù„Ø³Ø­Ø¨</label>
                                <input type="text" id="withdrawPurpose" placeholder="Ø§Ù„ØºØ±Ø¶ Ù…Ù† Ø§Ù„Ø³Ø­Ø¨">
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-neumorphism" onclick="closeModal('withdrawModal')">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="button" class="btn-neumorphism btn-primary-neumorphism" onclick="processWithdrawal()">
                            <i class="fas fa-check"></i>
                            Ø³Ø­Ø¨
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ -->
    <div id="transferModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ØªØ­ÙˆÙŠÙ„ Ø£Ù…ÙˆØ§Ù„</h2>
                <span class="close" onclick="closeModal('transferModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form class="invoice-form">
                    <div class="form-section">
                        <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="transferAmount">Ø§Ù„Ù…Ø¨Ù„Øº *</label>
                                <input type="number" id="transferAmount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ" min="100" step="10" required>
                            </div>
                            <div class="form-group">
                                <label for="recipientType">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù… *</label>
                                <select id="recipientType" required>
                                    <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…</option>
                                    <option value="supplier">Ù…ÙˆØ±Ø¯</option>
                                    <option value="distributor">Ù…ÙˆØ²Ø¹</option>
                                    <option value="lab">Ù…Ø®ØªØ¨Ø± Ø¢Ø®Ø±</option>
                                    <option value="individual">ÙØ±Ø¯</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="recipientName">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… *</label>
                                <input type="text" id="recipientName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…" required>
                            </div>
                            <div class="form-group">
                                <label for="recipientAccount">Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªÙ„Ù… *</label>
                                <input type="text" id="recipientAccount" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø£Ùˆ Ø§Ù„Ù…Ø­ÙØ¸Ø©" required>
                            </div>
                            <div class="form-group">
                                <label for="transferPurpose">Ø§Ù„ØºØ±Ø¶ Ù…Ù† Ø§Ù„ØªØ­ÙˆÙŠÙ„ *</label>
                                <input type="text" id="transferPurpose" placeholder="Ø§Ù„ØºØ±Ø¶ Ù…Ù† Ø§Ù„ØªØ­ÙˆÙŠÙ„" required>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label for="transferNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                                <textarea id="transferNotes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-neumorphism" onclick="closeModal('transferModal')">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="button" class="btn-neumorphism btn-primary-neumorphism" onclick="processTransfer()">
                            <i class="fas fa-check"></i>
                            ØªØ­ÙˆÙŠÙ„
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø© -->
    <div id="linkWalletModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø±Ø¨Ø· Ù…Ø­ÙØ¸Ø© Ø±Ù‚Ù…ÙŠØ©</h2>
                <span class="close" onclick="closeModal('linkWalletModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form class="invoice-form">
                    <div class="form-section">
                        <h3>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­ÙØ¸Ø©</h3>
                        <div class="wallet-options">
                            <div class="wallet-option" data-wallet="stc" onclick="selectWallet('stc')">
                                <div class="wallet-icon">
                                    <i class="fas fa-mobile-alt"></i>
                                </div>
                                <div class="wallet-name">STC Pay</div>
                            </div>
                            <div class="wallet-option" data-wallet="mada" onclick="selectWallet('mada')">
                                <div class="wallet-icon">
                                    <i class="fas fa-credit-card"></i>
                                </div>
                                <div class="wallet-name">Ù…Ø¯Ù‰</div>
                            </div>
                            <div class="wallet-option" data-wallet="bank" onclick="selectWallet('bank')">
                                <div class="wallet-icon">
                                    <i class="fas fa-university"></i>
                                </div>
                                <div class="wallet-name">Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ</div>
                            </div>
                        </div>
                    </div>

                    <div id="walletFormSection" style="display: none;">
                        <div class="form-section">
                            <h3 id="selectedWalletTitle">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø©</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="walletNumber">Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© *</label>
                                    <input type="text" id="walletNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©" required>
                                </div>
                                <div class="form-group">
                                    <label for="walletOwner">Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø­ÙØ¸Ø© *</label>
                                    <input type="text" id="walletOwner" placeholder="Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø­ÙØ¸Ø©" required>
                                </div>
                                <div class="form-group">
                                    <label for="walletPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³Ø¬Ù„ *</label>
                                    <input type="tel" id="walletPhone" placeholder="05XXXXXXXX" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-neumorphism" onclick="closeModal('linkWalletModal')">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="button" class="btn-neumorphism btn-primary-neumorphism" id="linkWalletBtn" onclick="linkWallet()" disabled>
                            <i class="fas fa-link"></i>
                            Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø©
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© -->
    <div id="transactionDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</h2>
                <span class="close" onclick="closeModal('transactionDetailsModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="receipt-preview" id="receiptContent">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
                <div class="receipt-actions">
                    <button class="btn-neumorphism btn-primary-neumorphism" onclick="printReceipt()">
                        <i class="fas fa-print"></i>
                        Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
                    </button>
                    <button class="btn-neumorphism btn-secondary-neumorphism" onclick="downloadReceipt()">
                        <i class="fas fa-download"></i>
                        ØªØ­Ù…ÙŠÙ„ PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loadingModal" class="modal">
        <div class="modal-content small-modal">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p>
            </div>
        </div>
    </div>

    <script>
// Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª Ù…Ø¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
class LabFinancialSystem {
    constructor() {
        this.labAccount = JSON.parse(localStorage.getItem('labFinancialAccount')) || null;
        this.transactions = JSON.parse(localStorage.getItem('labTransactions')) || [];
        this.linkedWallets = JSON.parse(localStorage.getItem('labLinkedWallets')) || [];
        this.currentView = 'list';
        this.visibleTransactions = 12;
        this.currentFilter = 'all';
        this.sortBy = 'date_desc';
        this.selectedWallet = null;
        this.init();
    }

    init() {
        this.updateUI();
        this.setupEventListeners();
        this.startLiveUpdates();
        this.updateTime();
        this.renderCategories();
        setInterval(() => this.updateTime(), 60000);
    }

    setupEventListeners() {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
        setInterval(() => {
            this.updateTime();
        }, 60000);

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø¨Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
        window.addEventListener('click', (e) => {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Ù…Ù†Ø¹ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
            });
        });
    }

    // 1. Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ ÙØ±ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ
    generateAccountNumber() {
        const timestamp = Date.now().toString();
        const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        return `LAB${timestamp.slice(-6)}${random}`;
    }

    // 2. Ù†Ø¸Ø§Ù… Ø±Ø¨Ø· Ø§Ù„Ù…Ø­Ø§ÙØ¸
    async linkWallet(walletData) {
        if (!this.labAccount) {
            this.showNotification('ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹', 'error');
            return false;
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©
        this.showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©...');
        
        return new Promise((resolve) => {
            setTimeout(() => {
                this.hideLoading();
                
                const success = Math.random() > 0.2; // 80% success rate
                if (success) {
                    const linkedWallet = {
                        id: 'W' + Date.now(),
                        type: walletData.type,
                        name: this.getWalletProviderName(walletData.type),
                        number: walletData.number,
                        owner: walletData.owner,
                        phone: walletData.phone,
                        isVerified: true,
                        linkedAt: new Date().toISOString(),
                        balance: Math.floor(Math.random() * 50000) + 1000
                    };
                    
                    this.linkedWallets.push(linkedWallet);
                    localStorage.setItem('labLinkedWallets', JSON.stringify(this.linkedWallets));
                    
                    this.showNotification(`ØªÙ… Ø±Ø¨Ø· Ù…Ø­ÙØ¸Ø© ${linkedWallet.name} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    resolve(true);
                } else {
                    this.showNotification('ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    resolve(false);
                }
            }, 2000);
        });
    }

    getWalletProviderName(walletType) {
        const providers = {
            'stc': 'STC Pay',
            'mada': 'Ù…Ø¯Ù‰',
            'bank': 'Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ',
            'cash': 'Ù†Ù‚Ø¯ÙŠ'
        };
        return providers[walletType] || walletType;
    }

    // 3. ØªÙ†Ø²ÙŠÙ„ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨
    downloadStatement(period = 'month') {
        if (!this.labAccount) {
            this.showNotification('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù„ØªØ­Ù…ÙŠÙ„ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨', 'error');
            return;
        }

        this.showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨...');

        setTimeout(() => {
            this.hideLoading();
            
            const filteredTransactions = this.getFilteredTransactionsByPeriod(period);
            const statementData = this.generateStatementData(filteredTransactions, period);
            const csvContent = this.generateCSV(statementData);
            
            this.downloadCSV(csvContent, `ÙƒØ´Ù_Ø§Ù„Ø­Ø³Ø§Ø¨_${period}_${new Date().toISOString().split('T')[0]}.csv`);
            this.showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }, 1500);
    }

    getFilteredTransactionsByPeriod(period) {
        const now = new Date();
        let startDate;

        switch (period) {
            case 'week':
                startDate = new Date(now.setDate(now.getDate() - 7));
                break;
            case 'month':
                startDate = new Date(now.setMonth(now.getMonth() - 1));
                break;
            case 'quarter':
                startDate = new Date(now.setMonth(now.getMonth() - 3));
                break;
            case 'year':
                startDate = new Date(now.setFullYear(now.getFullYear() - 1));
                break;
            default:
                startDate = new Date(0); // Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
        }

        return this.transactions.filter(transaction => 
            new Date(transaction.date) >= startDate
        );
    }

    generateStatementData(transactions, period) {
        const totalIncome = transactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
        const totalExpenses = transactions.filter(t => t.amount < 0).reduce((sum, t) => sum + Math.abs(t.amount), 0);
        const netBalance = totalIncome - totalExpenses;

        return {
            period: period,
            transactions: transactions,
            summary: {
                totalIncome,
                totalExpenses,
                netBalance,
                transactionCount: transactions.length
            }
        };
    }

    generateCSV(statementData) {
        let csv = 'ØªØ§Ø±ÙŠØ®,ÙˆÙ‚Øª,Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©,Ø§Ù„ÙˆØµÙ,Ø§Ù„Ù…Ø¨Ù„Øº,Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹,Ø§Ù„Ø­Ø§Ù„Ø©\n';
        
        statementData.transactions.forEach(transaction => {
            const row = [
                transaction.date,
                transaction.time,
                this.getTransactionTypeText(transaction.type),
                transaction.description,
                transaction.amount,
                transaction.ref,
                this.getStatusText(transaction.status)
            ].join(',');
            
            csv += row + '\n';
        });

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø®Øµ
        csv += '\nÙ…Ù„Ø®Øµ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨\n';
        csv += `Ø§Ù„ÙØªØ±Ø©,${statementData.period}\n`;
        csv += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª,${statementData.summary.totalIncome}\n`;
        csv += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª,${statementData.summary.totalExpenses}\n`;
        csv += `ØµØ§ÙÙŠ Ø§Ù„Ø±ØµÙŠØ¯,${statementData.summary.netBalance}\n`;
        csv += `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª,${statementData.summary.transactionCount}\n`;

        return csv;
    }

    downloadCSV(csvContent, fileName) {
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        
        link.setAttribute('href', url);
        link.setAttribute('download', fileName);
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // 4. Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª ÙÙŠ Ù†ÙˆØ§ÙØ° Ù…Ù†Ø¨Ø«Ù‚Ø©
    showTransactionDetails(transactionId) {
        const transaction = this.transactions.find(t => t.id === transactionId);
        if (!transaction) return;

        this.showReceipt(transaction);
    }

    showReceipt(transaction) {
        const receiptContent = document.getElementById('receiptContent');
        
        const receiptHTML = `
            <div class="receipt-header">
                <div class="receipt-title">Ø¥ÙŠØµØ§Ù„ Ù…Ø¹Ø§Ù…Ù„Ø©</div>
                <div class="receipt-subtitle">Ù…Ø®ØªØ¨Ø±Ø§Øª 24/7</div>
            </div>
            
            <div class="receipt-details">
                <div class="receipt-row">
                    <span class="receipt-label">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©:</span>
                    <span class="receipt-value">${transaction.ref}</span>
                </div>
                
                <div class="receipt-row">
                    <span class="receipt-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©:</span>
                    <span class="receipt-value">${this.getTransactionTypeText(transaction.type)}</span>
                </div>
                
                <div class="receipt-row">
                    <span class="receipt-label">Ø§Ù„ÙˆØµÙ:</span>
                    <span class="receipt-value">${transaction.description}</span>
                </div>
                
                <div class="receipt-row">
                    <span class="receipt-label">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª:</span>
                    <span class="receipt-value">${transaction.date} - ${transaction.time}</span>
                </div>
                
                ${transaction.method ? `
                <div class="receipt-row">
                    <span class="receipt-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</span>
                    <span class="receipt-value">${this.getPaymentMethodName(transaction.method)}</span>
                </div>
                ` : ''}
                
                ${transaction.recipient ? `
                <div class="receipt-row">
                    <span class="receipt-label">Ø§Ù„Ù…Ø³ØªÙ„Ù…:</span>
                    <span class="receipt-value">${transaction.recipient}</span>
                </div>
                ` : ''}
                
                <div class="receipt-row">
                    <span class="receipt-label">Ø§Ù„Ù…Ø¨Ù„Øº:</span>
                    <span class="receipt-value receipt-amount" style="color: ${transaction.amount >= 0 ? 'var(--success)' : 'var(--danger)'}">
                        ${transaction.amount >= 0 ? '+' : ''}${transaction.amount} Ø±.Ø³
                    </span>
                </div>
                
                <div class="receipt-row">
                    <span class="receipt-label">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                    <span class="receipt-value">${this.getStatusText(transaction.status)}</span>
                </div>
            </div>
            
            <div class="receipt-footer">
                <div>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…ÙƒÙ… Ø®Ø¯Ù…Ø§Øª Ù…Ø®ØªØ¨Ø±Ø§Øª 24/7</div>
                <div>Ù„Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª: 800244007</div>
            </div>
        `;
        
        receiptContent.innerHTML = receiptHTML;
        openModal('transactionDetailsModal');
    }

    // 5. Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
    renderCategories() {
        const container = document.getElementById('categoriesScroll');
        if (!container) return;

        const categories = [
            { id: 'all', name: 'Ø§Ù„ÙƒÙ„', icon: 'fa-list', count: this.transactions.length },
            { id: 'deposit', name: 'Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª', icon: 'fa-download', count: this.transactions.filter(t => t.type === 'deposit').length },
            { id: 'withdrawal', name: 'Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª', icon: 'fa-upload', count: this.transactions.filter(t => t.type === 'withdrawal').length },
            { id: 'transfer', name: 'Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª', icon: 'fa-exchange-alt', count: this.transactions.filter(t => t.type === 'transfer').length },
            { id: 'test_payment', name: 'Ø¯ÙØ¹Ø§Øª Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„', icon: 'fa-vial', count: this.transactions.filter(t => t.type === 'test_payment').length },
            { id: 'equipment', name: 'Ø´Ø±Ø§Ø¡ Ø£Ø¬Ù‡Ø²Ø©', icon: 'fa-microscope', count: this.transactions.filter(t => t.type === 'equipment').length }
        ];

        let categoriesHTML = '';
        categories.forEach(category => {
            categoriesHTML += `
                <div class="category-chip liquid-transition ${this.currentFilter === category.id ? 'active' : ''}" 
                     data-category="${category.id}" onclick="filterByCategory('${category.id}')">
                    <i class="fas ${category.icon}"></i>
                    ${category.name}
                    <span class="category-count">${category.count}</span>
                </div>
            `;
        });

        container.innerHTML = categoriesHTML;
    }

    updateUI() {
        if (this.labAccount) {
            document.getElementById('noAccountState').style.display = 'none';
            document.getElementById('financialHeader').style.display = 'block';
            document.getElementById('financialContent').style.display = 'block';
            
            document.getElementById('displayBalance').textContent = `${this.labAccount.balance.toLocaleString()} Ø±.Ø³`;
            document.getElementById('monthlyIncome').textContent = `${this.getMonthlyIncome().toLocaleString()} Ø±.Ø³`;
            document.getElementById('displayAccountNumber').textContent = this.labAccount.accountNumber;
            
            this.updateStats();
            this.renderTransactions();
            this.updateLoadMoreButton();
            this.renderCategories();
        } else {
            document.getElementById('noAccountState').style.display = 'block';
            document.getElementById('financialHeader').style.display = 'none';
            document.getElementById('financialContent').style.display = 'none';
        }
    }

    updateStats() {
        const totalTransactions = this.transactions.length;
        const depositCount = this.transactions.filter(t => t.type === 'deposit').length;
        const withdrawalCount = this.transactions.filter(t => t.type === 'withdrawal').length;
        const transferCount = this.transactions.filter(t => t.type === 'transfer').length;

        document.getElementById('totalTransactions').textContent = totalTransactions;
        document.getElementById('depositCount').textContent = depositCount;
        document.getElementById('withdrawalCount').textContent = withdrawalCount;
        document.getElementById('transferCount').textContent = transferCount;
    }

    createAccount(accountData) {
        const accountNumber = this.generateAccountNumber();
        const newAccount = {
            ...accountData,
            accountNumber: accountNumber,
            balance: 0,
            createdAt: new Date().toISOString(),
            status: 'active'
        };

        this.labAccount = newAccount;
        localStorage.setItem('labFinancialAccount', JSON.stringify(newAccount));
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
        this.addTransaction({
            type: 'account_creation',
            title: 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ¨Ø±',
            description: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ø®ØªØ¨Ø±',
            amount: 0,
            status: 'completed'
        });
        
        this.showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        this.updateUI();
        
        return newAccount;
    }

    addTransaction(transaction) {
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        if (!transaction.id) {
            transaction.id = 'T' + Date.now();
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        if (!transaction.date) {
            transaction.date = new Date().toLocaleDateString('ar-EG');
        }
        if (!transaction.time) {
            transaction.time = new Date().toLocaleTimeString('ar-EG');
        }

        this.transactions.unshift(transaction);
        this.saveData();
        this.updateUI();
    }

    // Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
    getTransactionTypeText(type) {
        const types = {
            'deposit': 'Ø¥ÙŠØ¯Ø§Ø¹',
            'withdrawal': 'Ø³Ø­Ø¨',
            'transfer': 'ØªØ­ÙˆÙŠÙ„',
            'test_payment': 'Ø¯ÙØ¹Ø© ØªØ­Ø§Ù„ÙŠÙ„',
            'equipment': 'Ø´Ø±Ø§Ø¡ Ø£Ø¬Ù‡Ø²Ø©',
            'account_creation': 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨',
            'supply': 'ØªÙˆØ±ÙŠØ¯'
        };
        return types[type] || type;
    }

    showLoading(message = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...') {
        const loadingModal = document.getElementById('loadingModal');
        const loadingText = loadingModal.querySelector('p');
        loadingText.textContent = message;
        loadingModal.style.display = 'block';
    }

    hideLoading() {
        document.getElementById('loadingModal').style.display = 'none';
    }

    showNotification(message, type = 'info') {
        // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø³Ø§Ø¨Ù‚Ø©
        const existingNotifications = document.querySelectorAll('.notification');
        existingNotifications.forEach(notification => notification.remove());

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
            ${message}
        `;
        
        document.body.appendChild(notification);
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 4 Ø«ÙˆØ§Ù†
        setTimeout(() => {
            if (notification.parentNode) {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
        }, 4000);
    }

    // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ Ù…Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª
    processDeposit(depositData) {
        if (!this.labAccount) return false;

        const transactionId = 'DP' + Date.now().toString().slice(-8);
        const newTransaction = {
            id: transactionId,
            type: 'deposit',
            title: `Ø¥ÙŠØ¯Ø§Ø¹ Ø¹Ø¨Ø± ${this.getPaymentMethodName(depositData.method)}`,
            description: `Ø¥ÙŠØ¯Ø§Ø¹ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ¨Ø± - ${depositData.purpose}`,
            amount: depositData.amount,
            ref: transactionId,
            date: new Date().toLocaleDateString('ar-EG'),
            time: new Date().toLocaleTimeString('ar-EG'),
            status: 'completed',
            icon: 'fa-vial',
            method: depositData.method,
            walletNumber: depositData.walletNumber
        };

        this.labAccount.balance += depositData.amount;
        this.addTransaction(newTransaction);
        this.showNotification(`ØªÙ… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­: ${depositData.amount.toLocaleString()} Ø±.Ø³`, 'success');
        
        return true;
    }

    processWithdrawal(withdrawalData) {
        if (!this.labAccount) return false;
        if (this.labAccount.balance < withdrawalData.amount) {
            this.showNotification('Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ', 'error');
            return false;
        }

        const transactionId = 'WD' + Date.now().toString().slice(-8);
        const newTransaction = {
            id: transactionId,
            type: 'withdrawal',
            title: `Ø³Ø­Ø¨ Ø¹Ø¨Ø± ${withdrawalData.method}`,
            description: `Ø³Ø­Ø¨ Ù…Ù† Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ¨Ø± - ${withdrawalData.purpose}`,
            amount: -withdrawalData.amount,
            ref: transactionId,
            date: new Date().toLocaleDateString('ar-EG'),
            time: new Date().toLocaleTimeString('ar-EG'),
            status: 'completed',
            icon: 'fa-microscope',
            method: withdrawalData.method,
            bankDetails: withdrawalData.bankDetails
        };

        this.labAccount.balance -= withdrawalData.amount;
        this.addTransaction(newTransaction);
        this.showNotification(`ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­: ${withdrawalData.amount.toLocaleString()} Ø±.Ø³`, 'success');
        
        return true;
    }

    processTransfer(transferData) {
        if (!this.labAccount) return false;
        if (this.labAccount.balance < transferData.amount) {
            this.showNotification('Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ', 'error');
            return false;
        }

        const transactionId = 'TR' + Date.now().toString().slice(-8);
        const newTransaction = {
            id: transactionId,
            type: 'transfer',
            title: `ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ${transferData.recipientName}`,
            description: `ØªØ­ÙˆÙŠÙ„ ${transferData.purpose} - ${transferData.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª'}`,
            amount: -transferData.amount,
            ref: transactionId,
            date: new Date().toLocaleDateString('ar-EG'),
            time: new Date().toLocaleTimeString('ar-EG'),
            status: 'completed',
            icon: 'fa-flask',
            recipient: transferData.recipientName,
            account: transferData.recipientAccount,
            purpose: transferData.purpose
        };

        this.labAccount.balance -= transferData.amount;
        this.addTransaction(newTransaction);
        this.showNotification(`ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­: ${transferData.amount.toLocaleString()} Ø±.Ø³`, 'success');
        
        return true;
    }

    saveData() {
        localStorage.setItem('labFinancialAccount', JSON.stringify(this.labAccount));
        localStorage.setItem('labTransactions', JSON.stringify(this.transactions));
        localStorage.setItem('labLinkedWallets', JSON.stringify(this.linkedWallets));
    }

    // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ...
    getMonthlyIncome() {
        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();
        
        return this.transactions
            .filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate.getMonth() === currentMonth && 
                       transactionDate.getFullYear() === currentYear &&
                       t.amount > 0;
            })
            .reduce((sum, t) => sum + t.amount, 0);
    }

    getFilteredTransactions() {
        let filtered = this.transactions;

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
        if (this.currentFilter !== 'all') {
            filtered = filtered.filter(t => t.type === this.currentFilter);
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙØ±Ø²
        this.applySorting(filtered);

        return filtered;
    }

    applySorting(transactions) {
        switch (this.sortBy) {
            case 'date_desc':
                transactions.sort((a, b) => new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time));
                break;
            case 'date_asc':
                transactions.sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time));
                break;
            case 'amount_desc':
                transactions.sort((a, b) => b.amount - a.amount);
                break;
            case 'amount_asc':
                transactions.sort((a, b) => a.amount - b.amount);
                break;
        }
    }

    renderTransactions() {
        this.renderTransactionsList();
        this.renderTransactionsGrid();
        this.renderCategories(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
    }

    renderTransactionsList() {
        const container = document.getElementById('transactionsList');
        const transactionsToShow = this.getFilteredTransactions().slice(0, this.visibleTransactions);
        
        let listHTML = '';
        transactionsToShow.forEach(transaction => {
            listHTML += `
                <div class="invoice-card-list liquid-transition" onclick="labFinancialSystem.showTransactionDetails('${transaction.id}')">
                    <div class="invoice-header">
                        <div class="invoice-info">
                            <div class="invoice-number">${transaction.title}</div>
                            <div class="invoice-customer">${transaction.description}</div>
                            <div class="invoice-date">${transaction.date} - ${transaction.time}</div>
                        </div>
                        <div class="invoice-amount">
                            <div class="amount-value" style="color: ${transaction.amount >= 0 ? 'var(--success)' : 'var(--danger)'}">
                                ${transaction.amount >= 0 ? '+' : ''}${transaction.amount} Ø±.Ø³
                            </div>
                            <div class="amount-label">${transaction.ref}</div>
                        </div>
                    </div>
                    <div class="invoice-footer">
                        <div class="invoice-status status-${transaction.status}">
                            ${this.getStatusText(transaction.status)}
                        </div>
                        <div class="invoice-actions-list">
                            <button class="btn-neumorphism btn-small" onclick="event.stopPropagation(); labFinancialSystem.showTransactionDetails('${transaction.id}')">
                                <i class="fas fa-receipt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        });

        if (transactionsToShow.length === 0) {
            listHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i class="fas fa-receipt" style="font-size: 48px; margin-bottom: 16px;"></i>
                    <div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</div>
                </div>
            `;
        }

        container.innerHTML = listHTML;
    }

    renderTransactionsGrid() {
        const container = document.getElementById('transactionsGrid');
        const transactionsToShow = this.getFilteredTransactions().slice(0, this.visibleTransactions);
        
        let gridHTML = '';
        transactionsToShow.forEach(transaction => {
            gridHTML += `
                <div class="invoice-card-grid liquid-transition" onclick="labFinancialSystem.showTransactionDetails('${transaction.id}')">
                    <div class="invoice-icon" style="background: ${this.getTransactionColor(transaction.type)}">
                        <i class="fas ${this.getTransactionIcon(transaction.type)}"></i>
                    </div>
                    <div class="invoice-number-grid">${transaction.title}</div>
                    <div class="invoice-customer-grid">${transaction.description}</div>
                    <div class="invoice-amount-grid" style="color: ${transaction.amount >= 0 ? 'var(--success)' : 'var(--danger)'}">
                        ${transaction.amount >= 0 ? '+' : ''}${transaction.amount} Ø±.Ø³
                    </div>
                    <div class="invoice-date-grid">${transaction.date}</div>
                    <div class="invoice-status-grid status-${transaction.status}">
                        ${this.getStatusText(transaction.status)}
                    </div>
                </div>
            `;
        });

        if (transactionsToShow.length === 0) {
            gridHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-secondary); grid-column: 1 / -1;">
                    <i class="fas fa-receipt" style="font-size: 48px; margin-bottom: 16px;"></i>
                    <div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</div>
                </div>
            `;
        }

        container.innerHTML = gridHTML;
    }

    getTransactionIcon(type) {
        const icons = {
            'deposit': 'fa-download',
            'withdrawal': 'fa-upload',
            'transfer': 'fa-exchange-alt',
            'account_creation': 'fa-user-plus',
            'test_payment': 'fa-vial',
            'equipment': 'fa-microscope',
            'supply': 'fa-truck-loading'
        };
        return icons[type] || 'fa-exchange-alt';
    }

    getTransactionColor(type) {
        const colors = {
            'deposit': 'var(--success)',
            'withdrawal': 'var(--warning)',
            'transfer': 'var(--info)',
            'account_creation': 'var(--primary)',
            'test_payment': 'var(--purple)',
            'equipment': 'var(--accent)',
            'supply': 'var(--secondary)'
        };
        return colors[type] || 'var(--primary)';
    }

    getStatusText(status) {
        const statusMap = {
            'completed': 'Ù…ÙƒØªÙ…Ù„',
            'pending': 'Ù…Ø¹Ù„Ù‚',
            'failed': 'ÙØ§Ø´Ù„',
            'cancelled': 'Ù…Ù„ØºÙŠ'
        };
        return statusMap[status] || status;
    }

    getPaymentMethodName(methodId) {
        const methods = {
            'stc': 'STC Pay',
            'mada': 'Ù…Ø¯Ù‰',
            'bank': 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ',
            'cash': 'Ù†Ù‚Ø¯ÙŠ'
        };
        return methods[methodId] || methodId;
    }

    changeView(view) {
        this.currentView = view;
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø±Ø¶
        document.querySelectorAll('.view-option').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.view === view) {
                btn.classList.add('active');
            }
        });

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶
        const listView = document.getElementById('transactionsList');
        const gridView = document.getElementById('transactionsGrid');
        
        if (view === 'list') {
            listView.style.display = 'flex';
            gridView.style.display = 'none';
        } else {
            listView.style.display = 'none';
            gridView.style.display = 'grid';
        }
    }

    filterByCategory(category) {
        this.currentFilter = category;
        this.visibleTransactions = 12;
        this.renderTransactions();
        this.updateLoadMoreButton();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©
        document.querySelectorAll('.stat-item').forEach(item => item.classList.remove('active'));
        if (category === 'all') {
            document.querySelector('.stat-item:nth-child(1)').classList.add('active');
        } else if (category === 'deposit') {
            document.querySelector('.stat-item:nth-child(2)').classList.add('active');
        } else if (category === 'withdrawal') {
            document.querySelector('.stat-item:nth-child(3)').classList.add('active');
        } else if (category === 'transfer') {
            document.querySelector('.stat-item:nth-child(4)').classList.add('active');
        }
    }

    sortTransactions() {
        const sortSelect = document.getElementById('sortSelect');
        this.sortBy = sortSelect.value;
        this.renderTransactions();
    }

    loadMoreTransactions() {
        this.visibleTransactions += 8;
        this.renderTransactions();
        this.updateLoadMoreButton();
    }

    updateLoadMoreButton() {
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const filteredTransactions = this.getFilteredTransactions();
        
        if (loadMoreBtn) {
            if (this.visibleTransactions >= filteredTransactions.length) {
                loadMoreBtn.style.display = 'none';
            } else {
                loadMoreBtn.style.display = 'flex';
            }
        }
    }

    updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('ar-EG', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true 
        });
        const timeElement = document.getElementById('currentTime');
        if (timeElement) {
            timeElement.textContent = timeString;
        }
    }

    startLiveUpdates() {
        setInterval(() => {
            if (this.labAccount && Math.random() > 0.7) {
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø¯ÙØ¹Ø§Øª ØªØ­Ø§Ù„ÙŠÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
                const testAmount = Math.floor(Math.random() * 500) + 100;
                const testData = {
                    amount: testAmount,
                    testType: ['CBC', 'Ø³ÙƒØ±', 'ÙƒÙˆÙ„ÙŠØ³ØªØ±ÙˆÙ„', 'Ù‡Ø±Ù…ÙˆÙ†Ø§Øª'][Math.floor(Math.random() * 4)],
                    patientName: 'Ù…Ø±ÙŠØ¶'
                };
                this.processTestPayment(testData);
            }
        }, 30000);
    }

    processTestPayment(testData) {
        if (!this.labAccount) return false;

        const transactionId = 'TP' + Date.now().toString().slice(-8);
        const newTransaction = {
            id: transactionId,
            type: 'test_payment',
            title: `Ø¯ÙØ¹Ø© ØªØ­Ù„ÙŠÙ„ ${testData.testType}`,
            description: `Ø¯ÙØ¹Ø© ØªØ­Ù„ÙŠÙ„ ${testData.testType} - ${testData.patientName}`,
            amount: testData.amount,
            ref: transactionId,
            date: new Date().toLocaleDateString('ar-EG'),
            time: new Date().toLocaleTimeString('ar-EG'),
            status: 'completed',
            icon: 'fa-vial',
            patient: testData.patientName,
            testType: testData.testType
        };

        this.labAccount.balance += testData.amount;
        this.addTransaction(newTransaction);
        
        return true;
    }
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª
const labFinancialSystem = new LabFinancialSystem();

// ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
function openModal(modalId) {
    document.getElementById(modalId).style.display = 'block';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function createAccount() {
    const formData = {
        labName: document.getElementById('labName').value,
        licenseNumber: document.getElementById('licenseNumber').value,
        ownerName: document.getElementById('ownerName').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        password: document.getElementById('password').value
    };

    if (!formData.labName || !formData.licenseNumber || !formData.ownerName || !formData.email || !formData.phone || !formData.address || !formData.password) {
        labFinancialSystem.showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©', 'error');
        return;
    }

    if (document.getElementById('password').value !== document.getElementById('confirmPassword').value) {
        labFinancialSystem.showNotification('ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©', 'error');
        return;
    }

    labFinancialSystem.createAccount(formData);
    closeModal('createAccountModal');
}

function processDeposit() {
    const depositData = {
        amount: parseFloat(document.getElementById('depositAmount').value),
        method: document.getElementById('depositMethod').value,
        walletNumber: document.getElementById('depositWalletNumber').value,
        purpose: document.getElementById('depositPurpose').value
    };

    if (!depositData.amount || !depositData.method || !depositData.walletNumber) {
        labFinancialSystem.showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©', 'error');
        return;
    }

    if (depositData.amount < 100) {
        labFinancialSystem.showNotification('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ù‡Ùˆ 100 Ø±.Ø³', 'error');
        return;
    }

    const success = labFinancialSystem.processDeposit(depositData);
    if (success) {
        closeModal('depositModal');
        document.getElementById('depositAmount').value = '';
        document.getElementById('depositWalletNumber').value = '';
    }
}

function processWithdrawal() {
    const withdrawalData = {
        amount: parseFloat(document.getElementById('withdrawAmount').value),
        method: document.getElementById('withdrawMethod').value,
        purpose: document.getElementById('withdrawPurpose').value,
        walletNumber: document.getElementById('withdrawWalletNumber')?.value || ''
    };

    if (!withdrawalData.amount || !withdrawalData.method) {
        labFinancialSystem.showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©', 'error');
        return;
    }

    if (withdrawalData.amount < 100) {
        labFinancialSystem.showNotification('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨ Ù‡Ùˆ 100 Ø±.Ø³', 'error');
        return;
    }

    const success = labFinancialSystem.processWithdrawal(withdrawalData);
    if (success) {
        closeModal('withdrawModal');
        document.getElementById('withdrawAmount').value = '';
    }
}

function processTransfer() {
    const transferData = {
        amount: parseFloat(document.getElementById('transferAmount').value),
        recipientType: document.getElementById('recipientType').value,
        recipientName: document.getElementById('recipientName').value,
        recipientAccount: document.getElementById('recipientAccount').value,
        purpose: document.getElementById('transferPurpose').value,
        notes: document.getElementById('transferNotes').value
    };

    if (!transferData.amount || !transferData.recipientType || !transferData.recipientName || !transferData.recipientAccount || !transferData.purpose) {
        labFinancialSystem.showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©', 'error');
        return;
    }

    if (transferData.amount < 100) {
        labFinancialSystem.showNotification('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„ØªØ­ÙˆÙŠÙ„ Ù‡Ùˆ 100 Ø±.Ø³', 'error');
        return;
    }

    const success = labFinancialSystem.processTransfer(transferData);
    if (success) {
        closeModal('transferModal');
        document.getElementById('transferAmount').value = '';
        document.getElementById('recipientName').value = '';
        document.getElementById('recipientAccount').value = '';
        document.getElementById('transferPurpose').value = '';
        document.getElementById('transferNotes').value = '';
    }
}

function filterByCategory(category) {
    labFinancialSystem.filterByCategory(category);
}

function changeView(view) {
    labFinancialSystem.changeView(view);
}

function sortTransactions() {
    labFinancialSystem.sortTransactions();
}

function loadMoreTransactions() {
    labFinancialSystem.loadMoreTransactions();
}

function refreshTransactions() {
    labFinancialSystem.showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
    setTimeout(() => {
        labFinancialSystem.renderTransactions();
        labFinancialSystem.showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
    }, 1000);
}

function downloadStatement() {
    labFinancialSystem.downloadStatement('month');
}

function showWithdrawDetails() {
    const method = document.getElementById('withdrawMethod').value;
    document.getElementById('withdrawBankDetails').style.display = method === 'bank_transfer' ? 'block' : 'none';
    document.getElementById('withdrawWalletDetails').style.display = method === 'wallet' ? 'block' : 'none';
}

// ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø­Ø§ÙØ¸
function selectWallet(walletType) {
    labFinancialSystem.selectedWallet = walletType;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    document.querySelectorAll('.wallet-option').forEach(option => {
        option.classList.remove('selected');
    });
    document.querySelector(`.wallet-option[data-wallet="${walletType}"]`).classList.add('selected');
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø­ÙØ¸Ø©
    document.getElementById('walletFormSection').style.display = 'block';
    document.getElementById('selectedWalletTitle').textContent = `Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø­ÙØ¸Ø© ${labFinancialSystem.getWalletProviderName(walletType)}`;
    document.getElementById('linkWalletBtn').disabled = false;
}

async function linkWallet() {
    if (!labFinancialSystem.selectedWallet) {
        labFinancialSystem.showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ÙØ¸Ø©', 'error');
        return;
    }

    const walletData = {
        type: labFinancialSystem.selectedWallet,
        number: document.getElementById('walletNumber').value,
        owner: document.getElementById('walletOwner').value,
        phone: document.getElementById('walletPhone').value
    };

    if (!walletData.number || !walletData.owner || !walletData.phone) {
        labFinancialSystem.showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
        return;
    }

    const success = await labFinancialSystem.linkWallet(walletData);
    if (success) {
        closeModal('linkWalletModal');
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('walletNumber').value = '';
        document.getElementById('walletOwner').value = '';
        document.getElementById('walletPhone').value = '';
        document.getElementById('walletFormSection').style.display = 'none';
        document.getElementById('linkWalletBtn').disabled = true;
        labFinancialSystem.selectedWallet = null;
    }
}

// ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª
function printReceipt() {
    window.print();
}

function downloadReceipt() {
    labFinancialSystem.showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ù…Ù„Ù PDF...', 'info');
    setTimeout(() => {
        labFinancialSystem.showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥ÙŠØµØ§Ù„ ÙƒÙ…Ù„Ù PDF', 'success');
    }, 1500);
}

// Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨
function copyAccountNumber() {
    const accountNumber = document.getElementById('displayAccountNumber').textContent;
    navigator.clipboard.writeText(accountNumber).then(() => {
        labFinancialSystem.showNotification('ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨', 'success');
    }).catch(() => {
        labFinancialSystem.showNotification('ÙØ´Ù„ Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨', 'error');
    });
}
</script>
</body>
</html>